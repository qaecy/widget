import{a as N}from"./chunk-22TYSVVA.js";import{O as n,S as i,Ta as a,ec as p,fc as G,hc as C}from"./chunk-PX2GBTR3.js";import{$ as W,Da as Y,N as B,ea as V,ja as Z,ka as q,l as v,sa as J,v as M}from"./chunk-GSV7GFVO.js";import{Ca as O,Ga as X,W as $,Y as K,t as T,v as _,wa as A,za as Q}from"./chunk-QWYGOFBQ.js";import{d as ee}from"./chunk-VNCJOYNM.js";import{O as H}from"./chunk-36JE2O54.js";import{a as m}from"./chunk-DAQOROHW.js";var b=function(e){return e.AUTH_USER_INPUT_NEEDED="'Your setup requires input from the user either because one than one SSO provider is set or because user/pw is required. User input is therefore needed'",e.CHAT_SESSION_CREATED="A new chat session was created",e.CREATING_CHAT_SESSION="Creating chat session...",e.LAST_VISIT_SET="Last visit updated",e.NO_FILES_NO_SYNC_RIGHTS="The project has no files and you do not have sync rights. Therefore, there is nothing to search. Please reach out to a project admin.",e.ORGANIZATIONS_NONE="The user is not assosiated with an organization.",e.ORGANIZATIONS_SINGLE="The user is assosiated with exactly one organization.",e.ORGANIZATIONS_MULTIPLE="The user is assosiated with more than one organization.",e.PROJECT_HAS_DATA="Received project data",e.PROJECT_NO_DATA="No data found for the specified project",e}(b||{});var u=function(e){return e.AGENT_API_NOT_AVAILABLE="The agent API is offline",e.AGENT_API_NOT_CALLABLE="The agent API was not callable",e.FIREBASE_NOT_INITIALIZED="Firebase has not been initialized",e.MISSING_CONFIG='"Please provide config using init() method!"',e.MISSING_PROJECT_DATA="Project data is not available",e.MISSING_PROJECT_ID='No project id is defined. Please specify using the "pid" attribute',e.MISSING_USER_ID="User id is not available.",e.ORG_NO_ADMINS_SELECTED="An organization must have at least one admin",e.ORG_NO_MEMBERS_SELECTED="An organization must have at least one member",e.PROJ_NO_ADMINS_SELECTED="A project must have at least one admin",e.PROJ_NO_MEMBERS_SELECTED="A project must have at least one member",e}(u||{});var te=class{id;name;created=new Date().toISOString();admins=[];members=[];alternativeIDs=[];constructor(d=N(),t="ABC"){this.id=d,this.name=t,this.alternativeIDs=[d]}},re=class{organizationID;id;name;created=new Date().toISOString();lastSync=null;isPublic=!1;members=[];syncers=[];admins=[];alternativeIDs=[];syncDetails={};constructor(d,t=N(),r="ABC"){this.organizationID=d,this.id=t,this.name=r,this.alternativeIDs=[t]}},U=class{id;projectId;userId;created=new Date().toISOString();updated=new Date().toISOString();constructor(d=N(),t,r){this.id=d,this.projectId=t,this.userId=r}};var se=class extends U{entries=[]},P=class{prompt;id;responseText="";created=new Date().toISOString();updated=new Date().toISOString();finished=!1;error="";chunkCount=0;constructor(d,t=N()){this.prompt=d,this.id=t}};var oe=class extends P{context={};promptHTML=""};var D=class{auth=new x;menuAlwaysVisible=!1;menuOptions=[j.ASSISTANT,j.SYNC_OVERVIEW,j.SIGN_OUT];hostApp=ie.SHAREPOINT;config;fab=new L},x=class{providers=[S.MICROSOFT];persistence=E.LOCAL},j=function(e){return e.ASSISTANT="ASSISTANT",e.SYNC_OVERVIEW="SYNC_OVERVIEW",e.SIGN_OUT="SIGN_OUT",e}(j||{}),S=function(e){return e.GOOGLE="GOOGLE",e.MICROSOFT="microsoft.com",e.USER_PW="USER_PW",e.NO_AUTH="NO_AUTH",e}(S||{}),E=function(e){return e.LOCAL="LOCAL",e.SESSION="SESSION",e.NONE="NONE",e}(E||{}),ie=function(e){return e.SHAREPOINT="SharePoint",e.QAECY="QAECY",e}(ie||{}),L=class{brderRadius="1rem";chatWidth="300px";chatHeight="70vh"};var I=(()=>{class e{_auth;_persistence=E.NONE;_user=a(void 0);_selectedProvider=a(void 0);_token=a(void 0);_tokenRefreshUnsubscribe;constructor(){this._auth=Y(H()),this._auth.onAuthStateChanged(t=>{if(t)this._user.update(()=>Object.assign({},t)),this._subscribeToTokenChanges();else{this._user.update(()=>{}),this._token.set(void 0);let r=this._tokenRefreshUnsubscribe;r!==void 0&&r()}})}get user(){return this._user}get token(){return this._token}async setPersistence(t){if(this._persistence!==t){switch(this._persistence=t,t){case E.LOCAL:await this._auth.setPersistence(Z);break;case E.SESSION:await this._auth.setPersistence(q);break;case E.NONE:await this._auth.setPersistence(v);break;default:await this._auth.setPersistence(v)}console.info(`New persistence setting: ${t}`)}}set providers(t){if(t.length===1){let r=t[0];r!==S.USER_PW&&r!==S.NO_AUTH&&this._selectedProvider.set(t[0])}}set selectedProvider(t){this._selectedProvider.set(t),this._user()===void 0&&this.getUserOrRequestSignIn()}async signOut(){await V(this._auth)}async getUserOrRequestSignIn(){let t=this._auth.currentUser,r=this._selectedProvider();if(!t)if(r!==void 0){let s=new M(r);t=(await J(this._auth,s)).user}else console.info(b.AUTH_USER_INPUT_NEEDED);return t}async userPWSignIn(t,r){return(await B(this._auth,t,r)).user}_subscribeToTokenChanges(){this._tokenRefreshUnsubscribe=W(this._auth,async t=>{if(t){let r=await t.getIdToken();this._token.set(r),console.log("Token refreshed")}})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var k="qaecy-mvp-406413";var ne="spaces_chats_eu_west6",ae="spaces_raw_eu_west6",ce="spaces_processed_eu_west6",ue="europe-west6",de="chatSessions",fe="organizations",he="projects",pe="users",le="userTermsAcceptance",_e="acceptTerms",me="https://accessors-api-gateway-ueyeemwf2a-oa.a.run.app",Ie="http://localhost:8093",Je="assistant/chat-session",Ye="assistant/wake-up",$e="https://www.qaecy.com/termsofuse",z="567369dcf855a9c0330ea01cc0f98fab";var h=(()=>{class e{_app;_auth;_functionAcceptTerms;_storageProcessed;_storageRaw;_storageChatSessions;_collectionChatSessions;_collectionOrganizations;_collectionProjects;_collectionUsers;_collectionUserTermsAcceptance;_ready=a(!1);_usingEmulators=a(!1);get app(){return this._app}get usingEmulators(){return this._usingEmulators}get functionAcceptTerms(){return this._functionAcceptTerms}get storageProcessed(){return this._storageProcessed}get storageRaw(){return this._storageRaw}get storageChatSessions(){return this._storageChatSessions}get collectionChatSessions(){return this._collectionChatSessions}get collectionOrganizations(){return this._collectionOrganizations}get collectionProjects(){return this._collectionProjects}get collectionUsers(){return this._collectionUsers}get collectionUserTermsAcceptance(){return this._collectionUserTermsAcceptance}get ready(){return this._ready}async init(t){let{initializeApp:r}=await import("./chunk-ZICKP5DU.js"),{connectAuthEmulator:s,getAuth:o}=await import("./chunk-SLAVO63I.js"),{connectFirestoreEmulator:c,getFirestore:f}=await import("./chunk-UCUTNQLC.js"),{connectFunctionsEmulator:w,getFunctions:je}=await import("./chunk-SOGWAEGZ.js"),{connectStorageEmulator:y,getStorage:R}=await import("./chunk-KLWV5IKU.js"),De=Object.assign(t,{authDomain:`${k}.firebaseapp.com`,projectId:k,messagingSenderId:"734737865998"}),g=r(De),F=je(g,ue);this._functionAcceptTerms=ee(F,_e),this._storageProcessed=R(g,ce),this._storageRaw=R(g,ae),this._storageChatSessions=R(g,ne),this._collectionChatSessions=T(f(),de),this._collectionOrganizations=T(f(),fe),this._collectionProjects=T(f(),he),this._collectionUsers=T(f(),pe),this._collectionUserTermsAcceptance=T(f(),le),this._auth=o(g),t.useEmulator&&(s(this._auth,"http://localhost:9099"),c(f(g),"localhost",8080),w(F,"localhost",5001),y(this._storageProcessed,"localhost",9199),y(this._storageRaw,"localhost",9199),y(this._storageChatSessions,"localhost",9199),console.info("Firebase emulators attached")),this._usingEmulators.set(t.useEmulator),this._app=g,this._ready.set(!0)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var ge=(()=>{class e{_firebase=i(h);_collection=this._firebase.collectionProjects;async getProjectData(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,t);try{return(await A(r)).data()}catch(s){console.warn(s);return}}async createProjectIfNotExists(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,t.id);try{await O(r,m({},t))}catch(s){console.warn(s)}}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Se=(()=>{class e{_repo=i(ge);_projectId=a(void 0);_projectData=a(void 0);hostInfo=a(void 0);set projectId(t){t!==this._projectId()&&(this._projectId.set(t),this._fetchProjectData())}get projectData(){return this._projectData}async createProject(t){await this._repo.createProjectIfNotExists(t),await this._fetchProjectData()}async _fetchProjectData(){let t=this._projectId();if(t===void 0)throw new Error("Project not set");let r=await this._repo.getProjectData(t);r===void 0?this._projectData.set(null):this._projectData.update(()=>Object.assign({},r))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Ee=(()=>{class e{_firebase=i(h);_collection=this._firebase.collectionOrganizations;async getUserOrganizations(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);try{let r=[];for(let s of t){let c=(await Q($(this._collection,K("members","array-contains",s)))).docs.map(f=>f.data());if(c.length){r=c;break}}return r}catch(r){return console.warn(r),[]}}async createOrganizationIfNotExists(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,t.id);try{let s=await A(r);if(console.log("AA"),s.exists())return;let o=await O(r,m({},t));console.log(o)}catch(s){console.warn(s)}}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Te=(()=>{class e{_firebase=i(h);_collection=this._firebase.collectionUsers;async getUserData(t,r=!0){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let s=_(this._collection,t),c=(await A(s)).data();return r&&c!==void 0&&this._setLastVisit(c),c}async _setLastVisit(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,t.id);t.lastVisit=new Date().toISOString(),await O(r,m({},t)),console.info(b.LAST_VISIT_SET)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Ae=(e,d)=>e===d?!0:e===void 0||d===void 0||e.length!==d.length?!1:e.every((t,r)=>t===d[r]);var Oe=(()=>{class e{_repo=i(Te);_auth=i(I);_organizationRepo=i(Ee);organizations=a(void 0,{equal:(t,r)=>t!==void 0&&r!==void 0&&Ae(t,r)});_userData=a(void 0);isOrgAdmin=a(!1);_userIds=a([]);onUserChange=C(async()=>{if(this._auth.user()===void 0){this.organizations.update(()=>{});return}this.fetchUserOrganizations(),this._fetchUserData()});get userIds(){return this._userIds}get userData(){return this._userData}async fetchUserOrganizations(){let t=this._auth.user();if(t===void 0)throw new Error("Can't fetch organizations when user is not signed in");let r=t.providerData.map(c=>c.uid),s=[t.uid,...r];if(t===void 0)throw new Error("User not set");let o=await this._organizationRepo.getUserOrganizations(s);this._userIds.set(s),this.organizations.update(()=>[...o])}async _fetchUserData(){let t=this._auth.user();if(t===void 0)throw new Error("Can't fetch user data when user is not signed in");let r=await this._repo.getUserData(t.uid);this._userData.update(()=>Object.assign({},r))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var we=(()=>{class e{options=a(new D);static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Ne=(()=>{class e{_firebase=i(h);_collection=this._firebase.collectionUserTermsAcceptance;_termsAcceptanceData=a(void 0);get termsAcceptanceData(){return this._termsAcceptanceData}subscribeToUserTermsAcceptance(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,t);return X(r,async s=>{if(s.exists()){let o=s.data();this._termsAcceptanceData.update(()=>Object.assign({},o))}})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var be=(()=>{class e{_firebase=i(h);_auth=i(I);_repo=i(Ne);userHasAcceptedTerms=p(()=>this._repo.termsAcceptanceData()!==void 0);userHasAcceptedOutdatedTerms=p(()=>{let t=this._repo.termsAcceptanceData();return t===void 0?!1:t.documentHash!==z});subscribeToUserTermsAcceptanceOnUserChange=C(async()=>{let t=this._auth.user();t!==void 0&&this._repo.subscribeToUserTermsAcceptance(t.uid)});async setTermsAndConditionsAccept(){let t=this._firebase.functionAcceptTerms;if(t===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let s=await(await fetch("https://api.ipify.org?format=json")).json();await t({documentHash:z,ip:s.ip})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Ce=(()=>{class e{_auth=i(I);_firebase=i(h);_baseURL=p(()=>this._firebase.usingEmulators()?Ie:me);_token=this._auth.token;async sendAuthenticatedRequest(t,r,s,o={}){let c={"Content-Type":"application/json"};if(this._token()===void 0)throw new Error("Token not available");c.Authorization=`Bearer ${this._token()}`,o.method=r,o.headers=o.headers===void 0?c:m(m({},o.headers),c),s!==void 0&&(o.body=JSON.stringify(s)),r!=="POST"&&delete o.body;let f=`${this._baseURL()}/${t}`,w=await fetch(f,o);if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);return w}pingRoute=async(t,r=5e3)=>{let s=`${this._baseURL()}/${t}`;try{let o=new AbortController,c=setTimeout(()=>o.abort(),r);if(this._token()===void 0)throw new Error("Token not available");let f={Authorization:`Bearer ${this._token()}`};return await fetch(s,{signal:o.signal,headers:f}),clearTimeout(c),!0}catch(o){return o.name==="AbortError"?console.error("Request timed out"):console.error("Server is offline or unreachable"),!1}};static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var gr=(()=>{class e{_optionsService=i(we);_auth=i(I);_gateway=i(Ce);_user=i(Oe);_terms=i(be);_project=i(Se);view=a("sync");_selectedOrganization=G(()=>{let t=this._user.organizations();if(!(t===void 0||!t.length)&&t.length===1)return t[0]});_userIsOrgAdmin=p(()=>{let t=this._selectedOrganization();return t===void 0?!1:this._isCurrentUserOrgAdmin(t)});_userCanSync=p(()=>{let t=this._project.projectData();return!t||t===void 0?!1:this._isCurrentUserSyncer(t)});authDisabled=p(()=>this._optionsService.options().auth.providers.length===1&&this._optionsService.options().auth.providers[0]===S.NO_AUTH);userOrganizations=this._user.organizations;projectData=this._project.projectData;projectExists=p(()=>this.projectData()!==null);userHasOrgs=p(()=>{let t=this.userOrganizations();return!(t===void 0||t.length===0)});userHasAgreedToTerms=this._terms.userHasAcceptedTerms;userHasAgreedToOutdatedTerms=this._terms.userHasAcceptedOutdatedTerms;set options(t){this._optionsService.options.set(t),this._auth.providers=t.auth.providers,this._auth.setPersistence(t.auth.persistence).then(()=>{this._auth.getUserOrRequestSignIn()}).catch(r=>{console.error(r)})}get options(){return this._optionsService.options}get user(){return this._auth.user}set projectId(t){this._project.projectId=t}get selectedOrganization(){return this._selectedOrganization}set selectedOrganization(t){this._selectedOrganization.set(t)}get userIsOrgAdmin(){return this._userIsOrgAdmin}get userCanSync(){return this._userCanSync}_isCurrentUserOrgAdmin(t){let r=this._user.userIds(),s=!1;for(let o of r)if(t.admins.includes(o)){s=!0;break}return s}_isCurrentUserSyncer(t){let r=this._user.userIds(),s=!1;for(let o of r)if(t.syncers.includes(o)||t.admins.includes(o)){s=!0;break}return s}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();export{te as a,re as b,U as c,se as d,oe as e,D as f,j as g,S as h,L as i,b as j,I as k,Je as l,Ye as m,$e as n,h as o,u as p,Se as q,Ee as r,Oe as s,we as t,be as u,Ce as v,gr as w};
