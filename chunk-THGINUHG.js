import{a as w}from"./chunk-22TYSVVA.js";import{O as o,S as a,Ta as n,bc as m,cc as F,ec as G}from"./chunk-SUJ2ERSS.js";import{Da as q,N as k,ea as W,ja as M,ka as V,l as R,sa as Z,v as B}from"./chunk-GSV7GFVO.js";import{Ca as E,W as J,Y,t as A,v as _,wa as g,za as K}from"./chunk-QWYGOFBQ.js";import{d as $}from"./chunk-VNCJOYNM.js";import{O as H}from"./chunk-36JE2O54.js";import{a as f}from"./chunk-DAQOROHW.js";var N=function(t){return t.AUTH_USER_INPUT_NEEDED="'Your setup requires input from the user either because one than one SSO provider is set or because user/pw is required. User input is therefore needed'",t.CHAT_SESSION_CREATED="A new chat session was created",t.CREATING_CHAT_SESSION="Creating chat session...",t.LAST_VISIT_SET="Last visit updated",t.NO_FILES_NO_SYNC_RIGHTS="The project has no files and you do not have sync rights. Therefore, there is nothing to search. Please reach out to a project admin.",t.ORGANIZATIONS_NONE="The user is not assosiated with an organization.",t.ORGANIZATIONS_SINGLE="The user is assosiated with exactly one organization.",t.ORGANIZATIONS_MULTIPLE="The user is assosiated with more than one organization.",t.PROJECT_HAS_DATA="Received project data",t.PROJECT_NO_DATA="No data found for the specified project",t}(N||{});var Q=class{id;name;created=new Date().toISOString();admins=[];members=[];alternativeIDs=[];constructor(u=w(),e="ABC"){this.id=u,this.name=e,this.alternativeIDs=[u]}},X=class{organizationID;id;name;created=new Date().toISOString();lastSync=null;isPublic=!1;members=[];syncers=[];admins=[];alternativeIDs=[];syncDetails={};constructor(u,e=w(),r="ABC"){this.organizationID=u,this.id=e,this.name=r,this.alternativeIDs=[e]}},v=class{id;projectId;userId;created=new Date().toISOString();updated=new Date().toISOString();constructor(u=w(),e,r){this.id=u,this.projectId=e,this.userId=r}};var tt=class extends v{entries=[]};var j=class{auth=new b;menuAlwaysVisible=!1;menuOptions=[C.ASSISTANT,C.SYNC_OVERVIEW,C.SIGN_OUT];hostApp=et.SHAREPOINT;config},b=class{providers=[I.MICROSOFT];persistence=S.LOCAL},C=function(t){return t.ASSISTANT="ASSISTANT",t.SYNC_OVERVIEW="SYNC_OVERVIEW",t.SIGN_OUT="SIGN_OUT",t}(C||{}),I=function(t){return t.GOOGLE="GOOGLE",t.MICROSOFT="microsoft.com",t.USER_PW="USER_PW",t.NO_AUTH="NO_AUTH",t}(I||{}),S=function(t){return t.LOCAL="LOCAL",t.SESSION="SESSION",t.NONE="NONE",t}(S||{}),et=function(t){return t.SHAREPOINT="SharePoint",t.QAECY="QAECY",t}(et||{});var U=(()=>{class t{_auth;_persistence=S.NONE;_user=n(void 0);_selectedProvider=n(void 0);constructor(){this._auth=q(H()),this._auth.onAuthStateChanged(e=>{e?this._user.update(()=>Object.assign({},e)):this._user.update(()=>{})})}get user(){return this._user}async setPersistence(e){if(this._persistence!==e){switch(this._persistence=e,e){case S.LOCAL:await this._auth.setPersistence(M);break;case S.SESSION:await this._auth.setPersistence(V);break;case S.NONE:await this._auth.setPersistence(R);break;default:await this._auth.setPersistence(R)}console.info(`New persistence setting: ${e}`)}}set providers(e){if(e.length===1){let r=e[0];r!==I.USER_PW&&r!==I.NO_AUTH&&this._selectedProvider.set(e[0])}}set selectedProvider(e){this._selectedProvider.set(e),this._user()===void 0&&this.getUserOrRequestSignIn()}async signOut(){await W(this._auth)}async getUserOrRequestSignIn(){let e=this._auth.currentUser,r=this._selectedProvider();if(!e)if(r!==void 0){let s=new B(r);e=(await Z(this._auth,s)).user}else console.info(N.AUTH_USER_INPUT_NEEDED);return e}async userPWSignIn(e,r){return(await k(this._auth,e,r)).user}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var x="qaecy-mvp-406413";var rt="spaces_chats_eu_west6",st="spaces_raw_eu_west6",it="spaces_processed_eu_west6",ot="europe-west6",nt="chatSessions",at="organizations",ct="projects",ut="users",dt="assistant",L="https://accessors-api-gateway-ueyeemwf2a-oa.a.run.app",ht="http://localhost:8093",zt="assistant/chat-session";var O=(()=>{class t{_app;_auth;_functionAssistant;_storageProcessed;_storageRaw;_storageChatSessions;_collectionChatSessions;_collectionOrganizations;_collectionProjects;_collectionUsers;_baseURL=L;_ready=n(!1);get app(){return this._app}get functionAssistant(){return this._functionAssistant}get storageProcessed(){return this._storageProcessed}get storageRaw(){return this._storageRaw}get storageChatSessions(){return this._storageChatSessions}get collectionChatSessions(){return this._collectionChatSessions}get collectionOrganizations(){return this._collectionOrganizations}get collectionProjects(){return this._collectionProjects}get collectionUsers(){return this._collectionUsers}get ready(){return this._ready}async init(e){let{initializeApp:r}=await import("./chunk-ZICKP5DU.js"),{connectAuthEmulator:s,getAuth:i}=await import("./chunk-SLAVO63I.js"),{connectFirestoreEmulator:c,getFirestore:d}=await import("./chunk-UCUTNQLC.js"),{connectFunctionsEmulator:y,getFunctions:T}=await import("./chunk-SOGWAEGZ.js"),{connectStorageEmulator:D,getStorage:P}=await import("./chunk-KLWV5IKU.js"),gt=Object.assign(e,{authDomain:`${x}.firebaseapp.com`,projectId:x,messagingSenderId:"734737865998"}),p=r(gt),z=T(p,ot);this._functionAssistant=$(z,dt),this._storageProcessed=P(p,it),this._storageRaw=P(p,st),this._storageChatSessions=P(p,rt),this._collectionChatSessions=A(d(),nt),this._collectionOrganizations=A(d(),at),this._collectionProjects=A(d(),ct),this._collectionUsers=A(d(),ut),this._auth=i(p),e.useEmulator?(this._baseURL=ht,s(this._auth,"http://localhost:9099"),c(d(p),"localhost",8080),y(z,"localhost",5001),D(this._storageProcessed,"localhost",9199),D(this._storageRaw,"localhost",9199),D(this._storageChatSessions,"localhost",9199),console.info("Firebase emulators attached")):this._baseURL=L,this._app=p,this._ready.set(!0)}async sendRequest(e,r,s,i={}){let c={"Content-Type":"application/json"};if(this._auth===void 0)throw new Error("Auth not set");let d=await this._auth.currentUser?.getIdToken();d&&(c.Authorization=`Bearer ${d}`),i.method=r,i.headers=i.headers===void 0?c:f(f({},i.headers),c),s!==void 0&&(i.body=JSON.stringify(s)),r!=="POST"&&delete i.body;let y=`${this._baseURL}/${e}`,T=await fetch(y,i);if(T.status===500)throw console.error(T),new Error("Query failed");return T}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var h=function(t){return t.FIREBASE_NOT_INITIALIZED="Firebase has not been initialized",t.MISSING_CONFIG='"Please provide config using init() method!"',t.MISSING_PROJECT_DATA="Project data is not available",t.MISSING_PROJECT_ID='No project id is defined. Please specify using the "pid" attribute',t.MISSING_USER_ID="User id is not available.",t.ORG_NO_ADMINS_SELECTED="An organization must have at least one admin",t.ORG_NO_MEMBERS_SELECTED="An organization must have at least one member",t.PROJ_NO_ADMINS_SELECTED="A project must have at least one admin",t.PROJ_NO_MEMBERS_SELECTED="A project must have at least one member",t}(h||{});var ft=(()=>{class t{_firebase=a(O);_collection=this._firebase.collectionProjects;async getProjectData(e){if(this._collection===void 0)throw new Error(h.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,e);try{return(await g(r)).data()}catch(s){console.warn(s);return}}async createProjectIfNotExists(e){if(this._collection===void 0)throw new Error(h.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,e.id);try{await E(r,f({},e))}catch(s){console.warn(s)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var _t=(()=>{class t{_repo=a(ft);_projectId=n(void 0);_projectData=n(void 0);hostInfo=n(void 0);set projectId(e){e!==this._projectId()&&(this._projectId.set(e),this._fetchProjectData())}get projectData(){return this._projectData}async createProject(e){await this._repo.createProjectIfNotExists(e),await this._fetchProjectData()}async _fetchProjectData(){let e=this._projectId();if(e===void 0)throw new Error("Project not set");let r=await this._repo.getProjectData(e);r===void 0?this._projectData.set(null):this._projectData.update(()=>Object.assign({},r))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var lt=(()=>{class t{_firebase=a(O);_collection=this._firebase.collectionOrganizations;async getUserOrganizations(e){if(this._collection===void 0)throw new Error(h.FIREBASE_NOT_INITIALIZED);try{let r=[];for(let s of e){let c=(await K(J(this._collection,Y("members","array-contains",s)))).docs.map(d=>d.data());if(c.length){r=c;break}}return r}catch(r){return console.warn(r),[]}}async createOrganizationIfNotExists(e){if(this._collection===void 0)throw new Error(h.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,e.id);try{if((await g(r)).exists())return;let i=await E(r,f({},e));console.log(i)}catch(s){console.warn(s)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var pt=(()=>{class t{_firebase=a(O);_collection=this._firebase.collectionUsers;async getUserData(e,r=!0){if(this._collection===void 0)throw new Error(h.FIREBASE_NOT_INITIALIZED);let s=_(this._collection,e),c=(await g(s)).data();return r&&c!==void 0&&this._setLastVisit(c),c}async _setLastVisit(e){if(this._collection===void 0)throw new Error(h.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,e.id);e.lastVisit=new Date().toISOString(),await E(r,f({},e)),console.info(N.LAST_VISIT_SET)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var It=(t,u)=>t===u?!0:t===void 0||u===void 0||t.length!==u.length?!1:t.every((e,r)=>e===u[r]);var St=(()=>{class t{_repo=a(pt);_auth=a(U);_organizationRepo=a(lt);organizations=n(void 0,{equal:(e,r)=>e!==void 0&&r!==void 0&&It(e,r)});_userData=n(void 0);isOrgAdmin=n(!1);_userIds=n([]);onUserChange=G(async()=>{if(this._auth.user()===void 0){this.organizations.update(()=>{});return}this.fetchUserOrganizations(),this._fetchUserData()});get userIds(){return this._userIds}get userData(){return this._userData}async fetchUserOrganizations(){let e=this._auth.user();if(e===void 0)throw new Error("Can't fetch organizations when user is not signed in");let r=e.providerData.map(c=>c.uid),s=[e.uid,...r];if(e===void 0)throw new Error("User not set");let i=await this._organizationRepo.getUserOrganizations(s);this._userIds.set(s),this.organizations.update(()=>[...i])}async _fetchUserData(){let e=this._auth.user();if(e===void 0)throw new Error("Can't fetch user data when user is not signed in");let r=await this._repo.getUserData(e.uid);this._userData.update(()=>Object.assign({},r))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var mt=(()=>{class t{options=n(new j);static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Fe=(()=>{class t{_optionsService=a(mt);_auth=a(U);_user=a(St);_project=a(_t);view=n("sync");_selectedOrganization=F(()=>{let e=this._user.organizations();if(!(e===void 0||!e.length)&&e.length===1)return e[0]});_userIsOrgAdmin=m(()=>{let e=this._selectedOrganization();return e===void 0?!1:this._isCurrentUserOrgAdmin(e)});_userCanSync=m(()=>{let e=this._project.projectData();return!e||e===void 0?!1:this._isCurrentUserSyncer(e)});authDisabled=m(()=>this._optionsService.options().auth.providers.length===1&&this._optionsService.options().auth.providers[0]===I.NO_AUTH);userOrganizations=this._user.organizations;projectData=this._project.projectData;projectExists=m(()=>this.projectData()!==null);userHasOrgs=m(()=>{let e=this.userOrganizations();return!(e===void 0||e.length===0)});set options(e){this._optionsService.options.set(e),this._auth.providers=e.auth.providers,this._auth.setPersistence(e.auth.persistence).then(()=>{this._auth.getUserOrRequestSignIn()}).catch(r=>{console.error(r)})}get options(){return this._optionsService.options}get user(){return this._auth.user}set projectId(e){this._project.projectId=e}get selectedOrganization(){return this._selectedOrganization}set selectedOrganization(e){this._selectedOrganization.set(e)}get userIsOrgAdmin(){return this._userIsOrgAdmin}get userCanSync(){return this._userCanSync}_isCurrentUserOrgAdmin(e){let r=this._user.userIds(),s=!1;for(let i of r)if(e.admins.includes(i)){s=!0;break}return s}_isCurrentUserSyncer(e){let r=this._user.userIds(),s=!1;for(let i of r)if(e.syncers.includes(i)||e.admins.includes(i)){s=!0;break}return s}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();export{Q as a,X as b,tt as c,j as d,C as e,I as f,N as g,U as h,zt as i,O as j,h as k,_t as l,lt as m,St as n,mt as o,Fe as p};
