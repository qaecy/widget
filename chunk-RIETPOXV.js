import{F as Dl,G as No,H as Nl,L as kl,O as Fl,R as ko,c as Rl,e as bl,f as Er,l as Do,m as Pl,n as Vl,q as Ar,v as Tt,w as xl,x as $t,y as Cl}from"./chunk-I7PEP2DU.js";import{g as Co,h as V}from"./chunk-TJICSKBO.js";var Ml=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ll={};var we,Fo;(function(){var r;function t(v,p){function w(){}w.prototype=p.prototype,v.D=p.prototype,v.prototype=new w,v.prototype.constructor=v,v.C=function(T,I,A){for(var y=Array(arguments.length-2),ee=2;ee<arguments.length;ee++)y[ee-2]=arguments[ee];return p.prototype[I].apply(T,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,p,w){w||(w=0);var T=Array(16);if(typeof p=="string")for(var I=0;16>I;++I)T[I]=p.charCodeAt(w++)|p.charCodeAt(w++)<<8|p.charCodeAt(w++)<<16|p.charCodeAt(w++)<<24;else for(I=0;16>I;++I)T[I]=p[w++]|p[w++]<<8|p[w++]<<16|p[w++]<<24;p=v.g[0],w=v.g[1],I=v.g[2];var A=v.g[3],y=p+(A^w&(I^A))+T[0]+3614090360&4294967295;p=w+(y<<7&4294967295|y>>>25),y=A+(I^p&(w^I))+T[1]+3905402710&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(w^A&(p^w))+T[2]+606105819&4294967295,I=A+(y<<17&4294967295|y>>>15),y=w+(p^I&(A^p))+T[3]+3250441966&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(A^w&(I^A))+T[4]+4118548399&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(I^p&(w^I))+T[5]+1200080426&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(w^A&(p^w))+T[6]+2821735955&4294967295,I=A+(y<<17&4294967295|y>>>15),y=w+(p^I&(A^p))+T[7]+4249261313&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(A^w&(I^A))+T[8]+1770035416&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(I^p&(w^I))+T[9]+2336552879&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(w^A&(p^w))+T[10]+4294925233&4294967295,I=A+(y<<17&4294967295|y>>>15),y=w+(p^I&(A^p))+T[11]+2304563134&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(A^w&(I^A))+T[12]+1804603682&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(I^p&(w^I))+T[13]+4254626195&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(w^A&(p^w))+T[14]+2792965006&4294967295,I=A+(y<<17&4294967295|y>>>15),y=w+(p^I&(A^p))+T[15]+1236535329&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(I^A&(w^I))+T[1]+4129170786&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^I&(p^w))+T[6]+3225465664&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(A^p))+T[11]+643717713&4294967295,I=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(I^A))+T[0]+3921069994&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(w^I))+T[5]+3593408605&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^I&(p^w))+T[10]+38016083&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(A^p))+T[15]+3634488961&4294967295,I=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(I^A))+T[4]+3889429448&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(w^I))+T[9]+568446438&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^I&(p^w))+T[14]+3275163606&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(A^p))+T[3]+4107603335&4294967295,I=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(I^A))+T[8]+1163531501&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(w^I))+T[13]+2850285829&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^I&(p^w))+T[2]+4243563512&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(A^p))+T[7]+1735328473&4294967295,I=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(I^A))+T[12]+2368359562&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(w^I^A)+T[5]+4294588738&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^I)+T[8]+2272392833&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^w)+T[11]+1839030562&4294967295,I=A+(y<<16&4294967295|y>>>16),y=w+(I^A^p)+T[14]+4259657740&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(w^I^A)+T[1]+2763975236&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^I)+T[4]+1272893353&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^w)+T[7]+4139469664&4294967295,I=A+(y<<16&4294967295|y>>>16),y=w+(I^A^p)+T[10]+3200236656&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(w^I^A)+T[13]+681279174&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^I)+T[0]+3936430074&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^w)+T[3]+3572445317&4294967295,I=A+(y<<16&4294967295|y>>>16),y=w+(I^A^p)+T[6]+76029189&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(w^I^A)+T[9]+3654602809&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^I)+T[12]+3873151461&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^w)+T[15]+530742520&4294967295,I=A+(y<<16&4294967295|y>>>16),y=w+(I^A^p)+T[2]+3299628645&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(I^(w|~A))+T[0]+4096336452&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~I))+T[7]+1126891415&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~w))+T[14]+2878612391&4294967295,I=A+(y<<15&4294967295|y>>>17),y=w+(A^(I|~p))+T[5]+4237533241&4294967295,w=I+(y<<21&4294967295|y>>>11),y=p+(I^(w|~A))+T[12]+1700485571&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~I))+T[3]+2399980690&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~w))+T[10]+4293915773&4294967295,I=A+(y<<15&4294967295|y>>>17),y=w+(A^(I|~p))+T[1]+2240044497&4294967295,w=I+(y<<21&4294967295|y>>>11),y=p+(I^(w|~A))+T[8]+1873313359&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~I))+T[15]+4264355552&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~w))+T[6]+2734768916&4294967295,I=A+(y<<15&4294967295|y>>>17),y=w+(A^(I|~p))+T[13]+1309151649&4294967295,w=I+(y<<21&4294967295|y>>>11),y=p+(I^(w|~A))+T[4]+4149444226&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~I))+T[11]+3174756917&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~w))+T[2]+718787259&4294967295,I=A+(y<<15&4294967295|y>>>17),y=w+(A^(I|~p))+T[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,v.g[2]=v.g[2]+I&4294967295,v.g[3]=v.g[3]+A&4294967295}n.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var w=p-this.blockSize,T=this.B,I=this.h,A=0;A<p;){if(I==0)for(;A<=w;)i(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<p;)if(T[I++]=v.charCodeAt(A++),I==this.blockSize){i(this,T),I=0;break}}else for(;A<p;)if(T[I++]=v[A++],I==this.blockSize){i(this,T),I=0;break}}this.h=I,this.o+=p},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var w=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=w&255,w/=256;for(this.u(v),v=Array(16),p=w=0;4>p;++p)for(var T=0;32>T;T+=8)v[w++]=this.g[p]>>>T&255;return v};function s(v,p){var w=u;return Object.prototype.hasOwnProperty.call(w,v)?w[v]:w[v]=p(v)}function a(v,p){this.h=p;for(var w=[],T=!0,I=v.length-1;0<=I;I--){var A=v[I]|0;T&&A==p||(w[I]=A,T=!1)}this.g=w}var u={};function c(v){return-128<=v&&128>v?s(v,function(p){return new a([p|0],0>p?-1:0)}):new a([v|0],0>v?-1:0)}function d(v){if(isNaN(v)||!isFinite(v))return g;if(0>v)return x(d(-v));for(var p=[],w=1,T=0;v>=w;T++)p[T]=v/w|0,w*=4294967296;return new a(p,0)}function f(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return x(f(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=d(Math.pow(p,8)),T=g,I=0;I<v.length;I+=8){var A=Math.min(8,v.length-I),y=parseInt(v.substring(I,I+A),p);8>A?(A=d(Math.pow(p,A)),T=T.j(A).add(d(y))):(T=T.j(w),T=T.add(d(y)))}return T}var g=c(0),_=c(1),R=c(16777216);r=a.prototype,r.m=function(){if(k(this))return-x(this).m();for(var v=0,p=1,w=0;w<this.g.length;w++){var T=this.i(w);v+=(0<=T?T:4294967296+T)*p,p*=4294967296}return v},r.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(N(this))return"0";if(k(this))return"-"+x(this).toString(v);for(var p=d(Math.pow(v,6)),w=this,T="";;){var I=Q(w,p).g;w=G(w,I.j(p));var A=((0<w.g.length?w.g[0]:w.h)>>>0).toString(v);if(w=I,N(w))return A+T;for(;6>A.length;)A="0"+A;T=A+T}},r.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function N(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function k(v){return v.h==-1}r.l=function(v){return v=G(this,v),k(v)?-1:N(v)?0:1};function x(v){for(var p=v.g.length,w=[],T=0;T<p;T++)w[T]=~v.g[T];return new a(w,~v.h).add(_)}r.abs=function(){return k(this)?x(this):this},r.add=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0,I=0;I<=p;I++){var A=T+(this.i(I)&65535)+(v.i(I)&65535),y=(A>>>16)+(this.i(I)>>>16)+(v.i(I)>>>16);T=y>>>16,A&=65535,y&=65535,w[I]=y<<16|A}return new a(w,w[w.length-1]&-2147483648?-1:0)};function G(v,p){return v.add(x(p))}r.j=function(v){if(N(this)||N(v))return g;if(k(this))return k(v)?x(this).j(x(v)):x(x(this).j(v));if(k(v))return x(this.j(x(v)));if(0>this.l(R)&&0>v.l(R))return d(this.m()*v.m());for(var p=this.g.length+v.g.length,w=[],T=0;T<2*p;T++)w[T]=0;for(T=0;T<this.g.length;T++)for(var I=0;I<v.g.length;I++){var A=this.i(T)>>>16,y=this.i(T)&65535,ee=v.i(I)>>>16,ir=v.i(I)&65535;w[2*T+2*I]+=y*ir,z(w,2*T+2*I),w[2*T+2*I+1]+=A*ir,z(w,2*T+2*I+1),w[2*T+2*I+1]+=y*ee,z(w,2*T+2*I+1),w[2*T+2*I+2]+=A*ee,z(w,2*T+2*I+2)}for(T=0;T<p;T++)w[T]=w[2*T+1]<<16|w[2*T];for(T=p;T<2*p;T++)w[T]=0;return new a(w,0)};function z(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function U(v,p){this.g=v,this.h=p}function Q(v,p){if(N(p))throw Error("division by zero");if(N(v))return new U(g,g);if(k(v))return p=Q(x(v),p),new U(x(p.g),x(p.h));if(k(p))return p=Q(v,x(p)),new U(x(p.g),p.h);if(30<v.g.length){if(k(v)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var w=_,T=p;0>=T.l(v);)w=Z(w),T=Z(T);var I=$(w,1),A=$(T,1);for(T=$(T,2),w=$(w,2);!N(T);){var y=A.add(T);0>=y.l(v)&&(I=I.add(w),A=y),T=$(T,1),w=$(w,1)}return p=G(v,I.j(p)),new U(I,p)}for(I=g;0<=v.l(p);){for(w=Math.max(1,Math.floor(v.m()/p.m())),T=Math.ceil(Math.log(w)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),A=d(w),y=A.j(p);k(y)||0<y.l(v);)w-=T,A=d(w),y=A.j(p);N(A)&&(A=_),I=I.add(A),v=G(v,y)}return new U(I,v)}r.A=function(v){return Q(this,v).h},r.and=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0;T<p;T++)w[T]=this.i(T)&v.i(T);return new a(w,this.h&v.h)},r.or=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0;T<p;T++)w[T]=this.i(T)|v.i(T);return new a(w,this.h|v.h)},r.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0;T<p;T++)w[T]=this.i(T)^v.i(T);return new a(w,this.h^v.h)};function Z(v){for(var p=v.g.length+1,w=[],T=0;T<p;T++)w[T]=v.i(T)<<1|v.i(T-1)>>>31;return new a(w,v.h)}function $(v,p){var w=p>>5;p%=32;for(var T=v.g.length-w,I=[],A=0;A<T;A++)I[A]=0<p?v.i(A+w)>>>p|v.i(A+w+1)<<32-p:v.i(A+w);return new a(I,v.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Fo=Ll.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,we=Ll.Integer=a}).apply(typeof Ml<"u"?Ml:typeof self<"u"?self:typeof window<"u"?window:{});var Di=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ie={};var Mo,gm,_n,Lo,Sr,Ni,Oo,qo,Uo;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,l,h){return o==Array.prototype||o==Object.prototype||(o[l]=h.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Di=="object"&&Di];for(var l=0;l<o.length;++l){var h=o[l];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function i(o,l){if(l)t:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var E=o[m];if(!(E in h))break t;h=h[E]}o=o[o.length-1],m=h[o],l=l(m),l!=m&&l!=null&&t(h,o,{configurable:!0,writable:!0,value:l})}}function s(o,l){o instanceof String&&(o+="");var h=0,m=!1,E={next:function(){if(!m&&h<o.length){var P=h++;return{value:l(P,o[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}i("Array.prototype.values",function(o){return o||function(){return s(this,function(l,h){return h})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return l=l!="object"?l:o?Array.isArray(o)?"array":l:"null",l=="array"||l=="object"&&typeof o.length=="number"}function d(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function f(o,l,h){return o.call.apply(o.bind,arguments)}function g(o,l,h){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,m),o.apply(l,E)}}return function(){return o.apply(l,arguments)}}function _(o,l,h){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,_.apply(null,arguments)}function R(o,l){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function N(o,l){function h(){}h.prototype=l.prototype,o.aa=l.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(m,E,P){for(var M=Array(arguments.length-2),rt=2;rt<arguments.length;rt++)M[rt-2]=arguments[rt];return l.prototype[E].apply(m,M)}}function k(o){let l=o.length;if(0<l){let h=Array(l);for(let m=0;m<l;m++)h[m]=o[m];return h}return[]}function x(o,l){for(let h=1;h<arguments.length;h++){let m=arguments[h];if(c(m)){let E=o.length||0,P=m.length||0;o.length=E+P;for(let M=0;M<P;M++)o[E+M]=m[M]}else o.push(m)}}class G{constructor(l,h){this.i=l,this.j=h,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function z(o){return/^[\s\xa0]*$/.test(o)}function U(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function Q(o){return Q[" "](o),o}Q[" "]=function(){};var Z=U().indexOf("Gecko")!=-1&&!(U().toLowerCase().indexOf("webkit")!=-1&&U().indexOf("Edge")==-1)&&!(U().indexOf("Trident")!=-1||U().indexOf("MSIE")!=-1)&&U().indexOf("Edge")==-1;function $(o,l,h){for(let m in o)l.call(h,o[m],m,o)}function v(o,l){for(let h in o)l.call(void 0,o[h],h,o)}function p(o){let l={};for(let h in o)l[h]=o[h];return l}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(o,l){let h,m;for(let E=1;E<arguments.length;E++){m=arguments[E];for(h in m)o[h]=m[h];for(let P=0;P<w.length;P++)h=w[P],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function I(o){var l=1;o=o.split(":");let h=[];for(;0<l&&o.length;)h.push(o.shift()),l--;return o.length&&h.push(o.join(":")),h}function A(o){u.setTimeout(()=>{throw o},0)}function y(){var o=so;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class ee{constructor(){this.h=this.g=null}add(l,h){let m=ir.get();m.set(l,h),this.h?this.h.next=m:this.g=m,this.h=m}}var ir=new G(()=>new Ff,o=>o.reset());class Ff{constructor(){this.next=this.g=this.h=null}set(l,h){this.h=l,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let sr,or=!1,so=new ee,Sc=()=>{let o=u.Promise.resolve(void 0);sr=()=>{o.then(Mf)}};var Mf=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){A(h)}var l=ir;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}or=!1};function ge(){this.s=this.s,this.C=this.C}ge.prototype.s=!1,ge.prototype.ma=function(){this.s||(this.s=!0,this.N())},ge.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function St(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}St.prototype.h=function(){this.defaultPrevented=!0};var Lf=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,l),u.removeEventListener("test",h,l)}catch{}return o}();function ar(o,l){if(St.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(Z){t:{try{Q(l.nodeName);var E=!0;break t}catch{}E=!1}E||(l=null)}}else h=="mouseover"?l=o.fromElement:h=="mouseout"&&(l=o.toElement);this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:Of[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&ar.aa.h.call(this)}}N(ar,St);var Of={2:"touch",3:"pen",4:"mouse"};ar.prototype.h=function(){ar.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var ur="closure_listenable_"+(1e6*Math.random()|0),qf=0;function Uf(o,l,h,m,E){this.listener=o,this.proxy=null,this.src=l,this.type=h,this.capture=!!m,this.ha=E,this.key=++qf,this.da=this.fa=!1}function gi(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function pi(o){this.src=o,this.g={},this.h=0}pi.prototype.add=function(o,l,h,m,E){var P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);var M=ao(o,l,m,E);return-1<M?(l=o[M],h||(l.fa=!1)):(l=new Uf(l,this.src,P,!!m,E),l.fa=h,o.push(l)),l};function oo(o,l){var h=l.type;if(h in o.g){var m=o.g[h],E=Array.prototype.indexOf.call(m,l,void 0),P;(P=0<=E)&&Array.prototype.splice.call(m,E,1),P&&(gi(l),o.g[h].length==0&&(delete o.g[h],o.h--))}}function ao(o,l,h,m){for(var E=0;E<o.length;++E){var P=o[E];if(!P.da&&P.listener==l&&P.capture==!!h&&P.ha==m)return E}return-1}var uo="closure_lm_"+(1e6*Math.random()|0),co={};function Rc(o,l,h,m,E){if(m&&m.once)return Pc(o,l,h,m,E);if(Array.isArray(l)){for(var P=0;P<l.length;P++)Rc(o,l[P],h,m,E);return null}return h=mo(h),o&&o[ur]?o.K(l,h,d(m)?!!m.capture:!!m,E):bc(o,l,h,!1,m,E)}function bc(o,l,h,m,E,P){if(!l)throw Error("Invalid event type");var M=d(E)?!!E.capture:!!E,rt=ho(o);if(rt||(o[uo]=rt=new pi(o)),h=rt.add(l,h,m,M,P),h.proxy)return h;if(m=Bf(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)Lf||(E=M),E===void 0&&(E=!1),o.addEventListener(l.toString(),m,E);else if(o.attachEvent)o.attachEvent(xc(l.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Bf(){function o(h){return l.call(o.src,o.listener,h)}let l=Gf;return o}function Pc(o,l,h,m,E){if(Array.isArray(l)){for(var P=0;P<l.length;P++)Pc(o,l[P],h,m,E);return null}return h=mo(h),o&&o[ur]?o.L(l,h,d(m)?!!m.capture:!!m,E):bc(o,l,h,!0,m,E)}function Vc(o,l,h,m,E){if(Array.isArray(l))for(var P=0;P<l.length;P++)Vc(o,l[P],h,m,E);else m=d(m)?!!m.capture:!!m,h=mo(h),o&&o[ur]?(o=o.i,l=String(l).toString(),l in o.g&&(P=o.g[l],h=ao(P,h,m,E),-1<h&&(gi(P[h]),Array.prototype.splice.call(P,h,1),P.length==0&&(delete o.g[l],o.h--)))):o&&(o=ho(o))&&(l=o.g[l.toString()],o=-1,l&&(o=ao(l,h,m,E)),(h=-1<o?l[o]:null)&&lo(h))}function lo(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[ur])oo(l.i,o);else{var h=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(h,m,o.capture):l.detachEvent?l.detachEvent(xc(h),m):l.addListener&&l.removeListener&&l.removeListener(m),(h=ho(l))?(oo(h,o),h.h==0&&(h.src=null,l[uo]=null)):gi(o)}}}function xc(o){return o in co?co[o]:co[o]="on"+o}function Gf(o,l){if(o.da)o=!0;else{l=new ar(l,this);var h=o.listener,m=o.ha||o.src;o.fa&&lo(o),o=h.call(m,l)}return o}function ho(o){return o=o[uo],o instanceof pi?o:null}var fo="__closure_events_fn_"+(1e9*Math.random()>>>0);function mo(o){return typeof o=="function"?o:(o[fo]||(o[fo]=function(l){return o.handleEvent(l)}),o[fo])}function Rt(){ge.call(this),this.i=new pi(this),this.M=this,this.F=null}N(Rt,ge),Rt.prototype[ur]=!0,Rt.prototype.removeEventListener=function(o,l,h,m){Vc(this,o,l,h,m)};function Nt(o,l){var h,m=o.F;if(m)for(h=[];m;m=m.F)h.push(m);if(o=o.M,m=l.type||l,typeof l=="string")l=new St(l,o);else if(l instanceof St)l.target=l.target||o;else{var E=l;l=new St(m,o),T(l,E)}if(E=!0,h)for(var P=h.length-1;0<=P;P--){var M=l.g=h[P];E=_i(M,m,!0,l)&&E}if(M=l.g=o,E=_i(M,m,!0,l)&&E,E=_i(M,m,!1,l)&&E,h)for(P=0;P<h.length;P++)M=l.g=h[P],E=_i(M,m,!1,l)&&E}Rt.prototype.N=function(){if(Rt.aa.N.call(this),this.i){var o=this.i,l;for(l in o.g){for(var h=o.g[l],m=0;m<h.length;m++)gi(h[m]);delete o.g[l],o.h--}}this.F=null},Rt.prototype.K=function(o,l,h,m){return this.i.add(String(o),l,!1,h,m)},Rt.prototype.L=function(o,l,h,m){return this.i.add(String(o),l,!0,h,m)};function _i(o,l,h,m){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();for(var E=!0,P=0;P<l.length;++P){var M=l[P];if(M&&!M.da&&M.capture==h){var rt=M.listener,Et=M.ha||M.src;M.fa&&oo(o.i,M),E=rt.call(Et,m)!==!1&&E}}return E&&!m.defaultPrevented}function Cc(o,l,h){if(typeof o=="function")h&&(o=_(o,h));else if(o&&typeof o.handleEvent=="function")o=_(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function Dc(o){o.g=Cc(()=>{o.g=null,o.i&&(o.i=!1,Dc(o))},o.l);let l=o.h;o.h=null,o.m.apply(null,l)}class zf extends ge{constructor(l,h){super(),this.m=l,this.l=h,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Dc(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function cr(o){ge.call(this),this.h=o,this.g={}}N(cr,ge);var Nc=[];function kc(o){$(o.g,function(l,h){this.g.hasOwnProperty(h)&&lo(l)},o),o.g={}}cr.prototype.N=function(){cr.aa.N.call(this),kc(this)},cr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var go=u.JSON.stringify,jf=u.JSON.parse,Kf=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function po(){}po.prototype.h=null;function Fc(o){return o.h||(o.h=o.i())}function Mc(){}var lr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function _o(){St.call(this,"d")}N(_o,St);function yo(){St.call(this,"c")}N(yo,St);var Ge={},Lc=null;function yi(){return Lc=Lc||new Rt}Ge.La="serverreachability";function Oc(o){St.call(this,Ge.La,o)}N(Oc,St);function hr(o){let l=yi();Nt(l,new Oc(l))}Ge.STAT_EVENT="statevent";function qc(o,l){St.call(this,Ge.STAT_EVENT,o),this.stat=l}N(qc,St);function kt(o){let l=yi();Nt(l,new qc(l,o))}Ge.Ma="timingevent";function Uc(o,l){St.call(this,Ge.Ma,o),this.size=l}N(Uc,St);function dr(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function fr(){this.g=!0}fr.prototype.xa=function(){this.g=!1};function $f(o,l,h,m,E,P){o.info(function(){if(o.g)if(P)for(var M="",rt=P.split("&"),Et=0;Et<rt.length;Et++){var Y=rt[Et].split("=");if(1<Y.length){var bt=Y[0];Y=Y[1];var Pt=bt.split("_");M=2<=Pt.length&&Pt[1]=="type"?M+(bt+"="+Y+"&"):M+(bt+"=redacted&")}}else M=null;else M=P;return"XMLHTTP REQ ("+m+") [attempt "+E+"]: "+l+`
`+h+`
`+M})}function Qf(o,l,h,m,E,P,M){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+E+"]: "+l+`
`+h+`
`+P+" "+M})}function fn(o,l,h,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+Hf(o,h)+(m?" "+m:"")})}function Wf(o,l){o.info(function(){return"TIMEOUT: "+l})}fr.prototype.info=function(){};function Hf(o,l){if(!o.g)return l;if(!l)return null;try{var h=JSON.parse(l);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var m=h[o];if(!(2>m.length)){var E=m[1];if(Array.isArray(E)&&!(1>E.length)){var P=E[0];if(P!="noop"&&P!="stop"&&P!="close")for(var M=1;M<E.length;M++)E[M]=""}}}}return go(h)}catch{return l}}var wi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Bc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},wo;function vi(){}N(vi,po),vi.prototype.g=function(){return new XMLHttpRequest},vi.prototype.i=function(){return{}},wo=new vi;function pe(o,l,h,m){this.j=o,this.i=l,this.l=h,this.R=m||1,this.U=new cr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Gc}function Gc(){this.i=null,this.g="",this.h=!1}var zc={},vo={};function To(o,l,h){o.L=1,o.v=Ai(ne(l)),o.m=h,o.P=!0,jc(o,null)}function jc(o,l){o.F=Date.now(),Ti(o),o.A=ne(o.v);var h=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),il(h.i,"t",m),o.C=0,h=o.j.J,o.h=new Gc,o.g=Il(o.j,h?l:null,!o.m),0<o.O&&(o.M=new zf(_(o.Y,o,o.g),o.O)),l=o.U,h=o.g,m=o.ca;var E="readystatechange";Array.isArray(E)||(E&&(Nc[0]=E.toString()),E=Nc);for(var P=0;P<E.length;P++){var M=Rc(h,E[P],m||l.handleEvent,!1,l.h||l);if(!M)break;l.g[M.key]=M}l=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),hr(),$f(o.i,o.u,o.A,o.l,o.R,o.m)}pe.prototype.ca=function(o){o=o.target;let l=this.M;l&&re(o)==3?l.j():this.Y(o)},pe.prototype.Y=function(o){try{if(o==this.g)t:{let Pt=re(this.g);var l=this.g.Ba();let pn=this.g.Z();if(!(3>Pt)&&(Pt!=3||this.g&&(this.h.h||this.g.oa()||hl(this.g)))){this.J||Pt!=4||l==7||(l==8||0>=pn?hr(3):hr(2)),Io(this);var h=this.g.Z();this.X=h;e:if(Kc(this)){var m=hl(this.g);o="";var E=m.length,P=re(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ze(this),mr(this);var M="";break e}this.h.i=new u.TextDecoder}for(l=0;l<E;l++)this.h.h=!0,o+=this.h.i.decode(m[l],{stream:!(P&&l==E-1)});m.length=0,this.h.g+=o,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=h==200,Qf(this.i,this.u,this.A,this.l,this.R,Pt,h),this.o){if(this.T&&!this.K){e:{if(this.g){var rt,Et=this.g;if((rt=Et.g?Et.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(rt)){var Y=rt;break e}}Y=null}if(h=Y)fn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Eo(this,h);else{this.o=!1,this.s=3,kt(12),ze(this),mr(this);break t}}if(this.P){h=!0;let Gt;for(;!this.J&&this.C<M.length;)if(Gt=Jf(this,M),Gt==vo){Pt==4&&(this.s=4,kt(14),h=!1),fn(this.i,this.l,null,"[Incomplete Response]");break}else if(Gt==zc){this.s=4,kt(15),fn(this.i,this.l,M,"[Invalid Chunk]"),h=!1;break}else fn(this.i,this.l,Gt,null),Eo(this,Gt);if(Kc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Pt!=4||M.length!=0||this.h.h||(this.s=1,kt(16),h=!1),this.o=this.o&&h,!h)fn(this.i,this.l,M,"[Invalid Chunked Response]"),ze(this),mr(this);else if(0<M.length&&!this.W){this.W=!0;var bt=this.j;bt.g==this&&bt.ba&&!bt.M&&(bt.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),Vo(bt),bt.M=!0,kt(11))}}else fn(this.i,this.l,M,null),Eo(this,M);Pt==4&&ze(this),this.o&&!this.J&&(Pt==4?yl(this.j,this):(this.o=!1,Ti(this)))}else fm(this.g),h==400&&0<M.indexOf("Unknown SID")?(this.s=3,kt(12)):(this.s=0,kt(13)),ze(this),mr(this)}}}catch{}finally{}};function Kc(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Jf(o,l){var h=o.C,m=l.indexOf(`
`,h);return m==-1?vo:(h=Number(l.substring(h,m)),isNaN(h)?zc:(m+=1,m+h>l.length?vo:(l=l.slice(m,m+h),o.C=m+h,l)))}pe.prototype.cancel=function(){this.J=!0,ze(this)};function Ti(o){o.S=Date.now()+o.I,$c(o,o.I)}function $c(o,l){if(o.B!=null)throw Error("WatchDog timer not null");o.B=dr(_(o.ba,o),l)}function Io(o){o.B&&(u.clearTimeout(o.B),o.B=null)}pe.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(Wf(this.i,this.A),this.L!=2&&(hr(),kt(17)),ze(this),this.s=2,mr(this)):$c(this,this.S-o)};function mr(o){o.j.G==0||o.J||yl(o.j,o)}function ze(o){Io(o);var l=o.M;l&&typeof l.ma=="function"&&l.ma(),o.M=null,kc(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function Eo(o,l){try{var h=o.j;if(h.G!=0&&(h.g==o||Ao(h.h,o))){if(!o.K&&Ao(h.h,o)&&h.G==3){try{var m=h.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var E=m;if(E[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)Vi(h),bi(h);else break t;Po(h),kt(18)}}else h.za=E[1],0<h.za-h.T&&37500>E[2]&&h.F&&h.v==0&&!h.C&&(h.C=dr(_(h.Za,h),6e3));if(1>=Hc(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else Ke(h,11)}else if((o.K||h.g==o)&&Vi(h),!z(l))for(E=h.Da.g.parse(l),l=0;l<E.length;l++){let Y=E[l];if(h.T=Y[0],Y=Y[1],h.G==2)if(Y[0]=="c"){h.K=Y[1],h.ia=Y[2];let bt=Y[3];bt!=null&&(h.la=bt,h.j.info("VER="+h.la));let Pt=Y[4];Pt!=null&&(h.Aa=Pt,h.j.info("SVER="+h.Aa));let pn=Y[5];pn!=null&&typeof pn=="number"&&0<pn&&(m=1.5*pn,h.L=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;let Gt=o.g;if(Gt){let Ci=Gt.g?Gt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ci){var P=m.h;P.g||Ci.indexOf("spdy")==-1&&Ci.indexOf("quic")==-1&&Ci.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(So(P,P.h),P.h=null))}if(m.D){let xo=Gt.g?Gt.g.getResponseHeader("X-HTTP-Session-Id"):null;xo&&(m.ya=xo,it(m.I,m.D,xo))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),m=h;var M=o;if(m.qa=Tl(m,m.J?m.ia:null,m.W),M.K){Jc(m.h,M);var rt=M,Et=m.L;Et&&(rt.I=Et),rt.B&&(Io(rt),Ti(rt)),m.g=M}else pl(m);0<h.i.length&&Pi(h)}else Y[0]!="stop"&&Y[0]!="close"||Ke(h,7);else h.G==3&&(Y[0]=="stop"||Y[0]=="close"?Y[0]=="stop"?Ke(h,7):bo(h):Y[0]!="noop"&&h.l&&h.l.ta(Y),h.v=0)}}hr(4)}catch{}}var Xf=class{constructor(o,l){this.g=o,this.map=l}};function Qc(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Wc(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Hc(o){return o.h?1:o.g?o.g.size:0}function Ao(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function So(o,l){o.g?o.g.add(l):o.h=l}function Jc(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}Qc.prototype.cancel=function(){if(this.i=Xc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function Xc(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let l=o.i;for(let h of o.g.values())l=l.concat(h.D);return l}return k(o.i)}function Yf(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(c(o)){for(var l=[],h=o.length,m=0;m<h;m++)l.push(o[m]);return l}l=[],h=0;for(m in o)l[h++]=o[m];return l}function Zf(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||typeof o=="string"){var l=[];o=o.length;for(var h=0;h<o;h++)l.push(h);return l}l=[],h=0;for(let m in o)l[h++]=m;return l}}}function Yc(o,l){if(o.forEach&&typeof o.forEach=="function")o.forEach(l,void 0);else if(c(o)||typeof o=="string")Array.prototype.forEach.call(o,l,void 0);else for(var h=Zf(o),m=Yf(o),E=m.length,P=0;P<E;P++)l.call(void 0,m[P],h&&h[P],o)}var Zc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function tm(o,l){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var m=o[h].indexOf("="),E=null;if(0<=m){var P=o[h].substring(0,m);E=o[h].substring(m+1)}else P=o[h];l(P,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function je(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof je){this.h=o.h,Ii(this,o.j),this.o=o.o,this.g=o.g,Ei(this,o.s),this.l=o.l;var l=o.i,h=new _r;h.i=l.i,l.g&&(h.g=new Map(l.g),h.h=l.h),tl(this,h),this.m=o.m}else o&&(l=String(o).match(Zc))?(this.h=!1,Ii(this,l[1]||"",!0),this.o=gr(l[2]||""),this.g=gr(l[3]||"",!0),Ei(this,l[4]),this.l=gr(l[5]||"",!0),tl(this,l[6]||"",!0),this.m=gr(l[7]||"")):(this.h=!1,this.i=new _r(null,this.h))}je.prototype.toString=function(){var o=[],l=this.j;l&&o.push(pr(l,el,!0),":");var h=this.g;return(h||l=="file")&&(o.push("//"),(l=this.o)&&o.push(pr(l,el,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(pr(h,h.charAt(0)=="/"?rm:nm,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",pr(h,sm)),o.join("")};function ne(o){return new je(o)}function Ii(o,l,h){o.j=h?gr(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function Ei(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function tl(o,l,h){l instanceof _r?(o.i=l,om(o.i,o.h)):(h||(l=pr(l,im)),o.i=new _r(l,o.h))}function it(o,l,h){o.i.set(l,h)}function Ai(o){return it(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function gr(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function pr(o,l,h){return typeof o=="string"?(o=encodeURI(o).replace(l,em),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function em(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var el=/[#\/\?@]/g,nm=/[#\?:]/g,rm=/[#\?]/g,im=/[#\?@]/g,sm=/#/g;function _r(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function _e(o){o.g||(o.g=new Map,o.h=0,o.i&&tm(o.i,function(l,h){o.add(decodeURIComponent(l.replace(/\+/g," ")),h)}))}r=_r.prototype,r.add=function(o,l){_e(this),this.i=null,o=mn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(l),this.h+=1,this};function nl(o,l){_e(o),l=mn(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function rl(o,l){return _e(o),l=mn(o,l),o.g.has(l)}r.forEach=function(o,l){_e(this),this.g.forEach(function(h,m){h.forEach(function(E){o.call(l,E,m,this)},this)},this)},r.na=function(){_e(this);let o=Array.from(this.g.values()),l=Array.from(this.g.keys()),h=[];for(let m=0;m<l.length;m++){let E=o[m];for(let P=0;P<E.length;P++)h.push(l[m])}return h},r.V=function(o){_e(this);let l=[];if(typeof o=="string")rl(this,o)&&(l=l.concat(this.g.get(mn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)l=l.concat(o[h])}return l},r.set=function(o,l){return _e(this),this.i=null,o=mn(this,o),rl(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o?(o=this.V(o),0<o.length?String(o[0]):l):l};function il(o,l,h){nl(o,l),0<h.length&&(o.i=null,o.g.set(mn(o,l),k(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],l=Array.from(this.g.keys());for(var h=0;h<l.length;h++){var m=l[h];let P=encodeURIComponent(String(m)),M=this.V(m);for(m=0;m<M.length;m++){var E=P;M[m]!==""&&(E+="="+encodeURIComponent(String(M[m]))),o.push(E)}}return this.i=o.join("&")};function mn(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function om(o,l){l&&!o.j&&(_e(o),o.i=null,o.g.forEach(function(h,m){var E=m.toLowerCase();m!=E&&(nl(this,m),il(this,E,h))},o)),o.j=l}function am(o,l){let h=new fr;if(u.Image){let m=new Image;m.onload=R(ye,h,"TestLoadImage: loaded",!0,l,m),m.onerror=R(ye,h,"TestLoadImage: error",!1,l,m),m.onabort=R(ye,h,"TestLoadImage: abort",!1,l,m),m.ontimeout=R(ye,h,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}function um(o,l){let h=new fr,m=new AbortController,E=setTimeout(()=>{m.abort(),ye(h,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:m.signal}).then(P=>{clearTimeout(E),P.ok?ye(h,"TestPingServer: ok",!0,l):ye(h,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(E),ye(h,"TestPingServer: error",!1,l)})}function ye(o,l,h,m,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),m(h)}catch{}}function cm(){this.g=new Kf}function lm(o,l,h){let m=h||"";try{Yc(o,function(E,P){let M=E;d(E)&&(M=go(E)),l.push(m+P+"="+encodeURIComponent(M))})}catch(E){throw l.push(m+"type="+encodeURIComponent("_badmap")),E}}function yr(o){this.l=o.Ub||null,this.j=o.eb||!1}N(yr,po),yr.prototype.g=function(){return new Si(this.l,this.j)},yr.prototype.i=function(o){return function(){return o}}({});function Si(o,l){Rt.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}N(Si,Rt),r=Si.prototype,r.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,vr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,wr(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,vr(this)),this.g&&(this.readyState=3,vr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;sl(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function sl(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?wr(this):vr(this),this.readyState==3&&sl(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,wr(this))},r.Qa=function(o){this.g&&(this.response=o,wr(this))},r.ga=function(){this.g&&wr(this)};function wr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,vr(o)}r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],l=this.h.entries();for(var h=l.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=l.next();return o.join(`\r
`)};function vr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Si.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function ol(o){let l="";return $(o,function(h,m){l+=m,l+=":",l+=h,l+=`\r
`}),l}function Ro(o,l,h){t:{for(m in h){var m=!1;break t}m=!0}m||(h=ol(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):it(o,l,h))}function ut(o){Rt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}N(ut,Rt);var hm=/^https?$/i,dm=["POST","PUT"];r=ut.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,l,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():wo.g(),this.v=this.o?Fc(this.o):Fc(wo),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(P){al(this,P);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var E in m)h.set(E,m[E]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())h.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(P=>P.toLowerCase()=="content-type"),E=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(dm,l,void 0))||m||E||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,M]of h)this.g.setRequestHeader(P,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ll(this),this.u=!0,this.g.send(o),this.u=!1}catch(P){al(this,P)}};function al(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,ul(o),Ri(o)}function ul(o){o.A||(o.A=!0,Nt(o,"complete"),Nt(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Nt(this,"complete"),Nt(this,"abort"),Ri(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ri(this,!0)),ut.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?cl(this):this.bb())},r.bb=function(){cl(this)};function cl(o){if(o.h&&typeof a<"u"&&(!o.v[1]||re(o)!=4||o.Z()!=2)){if(o.u&&re(o)==4)Cc(o.Ea,0,o);else if(Nt(o,"readystatechange"),re(o)==4){o.h=!1;try{let M=o.Z();t:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break t;default:l=!1}var h;if(!(h=l)){var m;if(m=M===0){var E=String(o.D).match(Zc)[1]||null;!E&&u.self&&u.self.location&&(E=u.self.location.protocol.slice(0,-1)),m=!hm.test(E?E.toLowerCase():"")}h=m}if(h)Nt(o,"complete"),Nt(o,"success");else{o.m=6;try{var P=2<re(o)?o.g.statusText:""}catch{P=""}o.l=P+" ["+o.Z()+"]",ul(o)}}finally{Ri(o)}}}}function Ri(o,l){if(o.g){ll(o);let h=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Nt(o,"ready");try{h.onreadystatechange=m}catch{}}}function ll(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function re(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<re(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),jf(l)}};function hl(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function fm(o){let l={};o=(o.g&&2<=re(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(z(o[m]))continue;var h=I(o[m]);let E=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let P=l[E]||[];l[E]=P,P.push(h)}v(l,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Tr(o,l,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||l}function dl(o){this.Aa=0,this.i=[],this.j=new fr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Tr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Tr("baseRetryDelayMs",5e3,o),this.cb=Tr("retryDelaySeedMs",1e4,o),this.Wa=Tr("forwardChannelMaxRetries",2,o),this.wa=Tr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Qc(o&&o.concurrentRequestLimit),this.Da=new cm,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=dl.prototype,r.la=8,r.G=1,r.connect=function(o,l,h,m){kt(0),this.W=o,this.H=l||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.I=Tl(this,null,this.W),Pi(this)};function bo(o){if(fl(o),o.G==3){var l=o.U++,h=ne(o.I);if(it(h,"SID",o.K),it(h,"RID",l),it(h,"TYPE","terminate"),Ir(o,h),l=new pe(o,o.j,l),l.L=2,l.v=Ai(ne(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=l.v,h=!0),h||(l.g=Il(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Ti(l)}vl(o)}function bi(o){o.g&&(Vo(o),o.g.cancel(),o.g=null)}function fl(o){bi(o),o.u&&(u.clearTimeout(o.u),o.u=null),Vi(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function Pi(o){if(!Wc(o.h)&&!o.s){o.s=!0;var l=o.Ga;sr||Sc(),or||(sr(),or=!0),so.add(l,o),o.B=0}}function mm(o,l){return Hc(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=l.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=dr(_(o.Ga,o,l),wl(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let E=new pe(this,this.j,o),P=this.o;if(this.S&&(P?(P=p(P),T(P,this.S)):P=this.S),this.m!==null||this.O||(E.H=P,P=null),this.P)t:{for(var l=0,h=0;h<this.i.length;h++){e:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(l+=m,4096<l){l=h;break t}if(l===4096||h===this.i.length-1){l=h+1;break t}}l=1e3}else l=1e3;l=gl(this,E,l),h=ne(this.I),it(h,"RID",o),it(h,"CVER",22),this.D&&it(h,"X-HTTP-Session-Id",this.D),Ir(this,h),P&&(this.O?l="headers="+encodeURIComponent(String(ol(P)))+"&"+l:this.m&&Ro(h,this.m,P)),So(this.h,E),this.Ua&&it(h,"TYPE","init"),this.P?(it(h,"$req",l),it(h,"SID","null"),E.T=!0,To(E,h,null)):To(E,h,l),this.G=2}}else this.G==3&&(o?ml(this,o):this.i.length==0||Wc(this.h)||ml(this))};function ml(o,l){var h;l?h=l.l:h=o.U++;let m=ne(o.I);it(m,"SID",o.K),it(m,"RID",h),it(m,"AID",o.T),Ir(o,m),o.m&&o.o&&Ro(m,o.m,o.o),h=new pe(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),l&&(o.i=l.D.concat(o.i)),l=gl(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),So(o.h,h),To(h,m,l)}function Ir(o,l){o.H&&$(o.H,function(h,m){it(l,m,h)}),o.l&&Yc({},function(h,m){it(l,m,h)})}function gl(o,l,h){h=Math.min(o.i.length,h);var m=o.l?_(o.l.Na,o.l,o):null;t:{var E=o.i;let P=-1;for(;;){let M=["count="+h];P==-1?0<h?(P=E[0].g,M.push("ofs="+P)):P=0:M.push("ofs="+P);let rt=!0;for(let Et=0;Et<h;Et++){let Y=E[Et].g,bt=E[Et].map;if(Y-=P,0>Y)P=Math.max(0,E[Et].g-100),rt=!1;else try{lm(bt,M,"req"+Y+"_")}catch{m&&m(bt)}}if(rt){m=M.join("&");break t}}}return o=o.i.splice(0,h),l.D=o,m}function pl(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;sr||Sc(),or||(sr(),or=!0),so.add(l,o),o.v=0}}function Po(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=dr(_(o.Fa,o),wl(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,_l(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=dr(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,kt(10),bi(this),_l(this))};function Vo(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function _l(o){o.g=new pe(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var l=ne(o.qa);it(l,"RID","rpc"),it(l,"SID",o.K),it(l,"AID",o.T),it(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&it(l,"TO",o.ja),it(l,"TYPE","xmlhttp"),Ir(o,l),o.m&&o.o&&Ro(l,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Ai(ne(l)),h.m=null,h.P=!0,jc(h,o)}r.Za=function(){this.C!=null&&(this.C=null,bi(this),Po(this),kt(19))};function Vi(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function yl(o,l){var h=null;if(o.g==l){Vi(o),Vo(o),o.g=null;var m=2}else if(Ao(o.h,l))h=l.D,Jc(o.h,l),m=1;else return;if(o.G!=0){if(l.o)if(m==1){h=l.m?l.m.length:0,l=Date.now()-l.F;var E=o.B;m=yi(),Nt(m,new Uc(m,h)),Pi(o)}else pl(o);else if(E=l.s,E==3||E==0&&0<l.X||!(m==1&&mm(o,l)||m==2&&Po(o)))switch(h&&0<h.length&&(l=o.h,l.i=l.i.concat(h)),E){case 1:Ke(o,5);break;case 4:Ke(o,10);break;case 3:Ke(o,6);break;default:Ke(o,2)}}}function wl(o,l){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*l}function Ke(o,l){if(o.j.info("Error code "+l),l==2){var h=_(o.fb,o),m=o.Xa;let E=!m;m=new je(m||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Ii(m,"https"),Ai(m),E?am(m.toString(),h):um(m.toString(),h)}else kt(2);o.G=0,o.l&&o.l.sa(l),vl(o),fl(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),kt(2)):(this.j.info("Failed to ping google.com"),kt(1))};function vl(o){if(o.G=0,o.ka=[],o.l){let l=Xc(o.h);(l.length!=0||o.i.length!=0)&&(x(o.ka,l),x(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function Tl(o,l,h){var m=h instanceof je?ne(h):new je(h);if(m.g!="")l&&(m.g=l+"."+m.g),Ei(m,m.s);else{var E=u.location;m=E.protocol,l=l?l+"."+E.hostname:E.hostname,E=+E.port;var P=new je(null);m&&Ii(P,m),l&&(P.g=l),E&&Ei(P,E),h&&(P.l=h),m=P}return h=o.D,l=o.ya,h&&l&&it(m,h,l),it(m,"VER",o.la),Ir(o,m),m}function Il(o,l,h){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Ca&&!o.pa?new ut(new yr({eb:h})):new ut(o.pa),l.Ha(o.J),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function El(){}r=El.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function xi(){}xi.prototype.g=function(o,l){return new Lt(o,l)};function Lt(o,l){Rt.call(this),this.g=new dl(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!z(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!z(l)&&(this.g.D=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new gn(this)}N(Lt,Rt),Lt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Lt.prototype.close=function(){bo(this.g)},Lt.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=go(o),o=h);l.i.push(new Xf(l.Ya++,o)),l.G==3&&Pi(l)},Lt.prototype.N=function(){this.g.l=null,delete this.j,bo(this.g),delete this.g,Lt.aa.N.call(this)};function Al(o){_o.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){t:{for(let h in l){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}N(Al,_o);function Sl(){yo.call(this),this.status=1}N(Sl,yo);function gn(o){this.g=o}N(gn,El),gn.prototype.ua=function(){Nt(this.g,"a")},gn.prototype.ta=function(o){Nt(this.g,new Al(o))},gn.prototype.sa=function(o){Nt(this.g,new Sl)},gn.prototype.ra=function(){Nt(this.g,"b")},xi.prototype.createWebChannel=xi.prototype.g,Lt.prototype.send=Lt.prototype.o,Lt.prototype.open=Lt.prototype.m,Lt.prototype.close=Lt.prototype.close,Uo=ie.createWebChannelTransport=function(){return new xi},qo=ie.getStatEventTarget=function(){return yi()},Oo=ie.Event=Ge,Ni=ie.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},wi.NO_ERROR=0,wi.TIMEOUT=8,wi.HTTP_ERROR=6,Sr=ie.ErrorCode=wi,Bc.COMPLETE="complete",Lo=ie.EventType=Bc,Mc.EventType=lr,lr.OPEN="a",lr.CLOSE="b",lr.ERROR="c",lr.MESSAGE="d",Rt.prototype.listen=Rt.prototype.K,_n=ie.WebChannel=Mc,gm=ie.FetchXmlHttpFactory=yr,ut.prototype.listenOnce=ut.prototype.L,ut.prototype.getLastError=ut.prototype.Ka,ut.prototype.getLastErrorCode=ut.prototype.Ba,ut.prototype.getStatus=ut.prototype.Z,ut.prototype.getResponseJson=ut.prototype.Oa,ut.prototype.getResponseText=ut.prototype.oa,ut.prototype.send=ut.prototype.ea,ut.prototype.setWithCredentials=ut.prototype.Ha,Mo=ie.XhrIo=ut}).apply(typeof Di<"u"?Di:typeof self<"u"?self:typeof window<"u"?window:{});var Ol="@firebase/firestore";var _t=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};_t.UNAUTHENTICATED=new _t(null),_t.GOOGLE_CREDENTIALS=new _t("google-credentials-uid"),_t.FIRST_PARTY=new _t("first-party-uid"),_t.MOCK_USER=new _t("mock-user");var Jn="11.0.2";var Re=new Cl("@firebase/firestore");function In(){return Re.logLevel}function xp(r){Re.setLogLevel(r)}function D(r,...t){if(Re.logLevel<=$t.DEBUG){let e=t.map(Hu);Re.debug(`Firestore (${Jn}): ${r}`,...e)}}function lt(r,...t){if(Re.logLevel<=$t.ERROR){let e=t.map(Hu);Re.error(`Firestore (${Jn}): ${r}`,...e)}}function Ut(r,...t){if(Re.logLevel<=$t.WARN){let e=t.map(Hu);Re.warn(`Firestore (${Jn}): ${r}`,...e)}}function Hu(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function O(r="Unexpected state"){let t=`FIRESTORE (${Jn}) INTERNAL ASSERTION FAILED: `+r;throw lt(t),new Error(t)}function q(r,t){r||O()}function Cp(r,t){r||O()}function F(r,t){return r}var b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},C=class extends Vl{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var yt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var $i=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},$o=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(_t.UNAUTHENTICATED))}shutdown(){}},Qo=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Wo=class{constructor(t){this.t=t,this.currentUser=_t.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){q(this.o===void 0);let n=this.i,i=c=>this.i!==n?(n=this.i,e(c)):Promise.resolve(),s=new yt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new yt,t.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let c=s;t.enqueueRetryable(()=>V(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},u=c=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new yt)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(q(typeof n.accessToken=="string"),new $i(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return q(t===null||typeof t=="string"),new _t(t)}},Ho=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=_t.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);let t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}},Jo=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Ho(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(_t.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Qi=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Xo=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){q(this.o===void 0);let n=s=>{s.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.R;return this.R=s.token,D("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>n(s))};let i=s=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(q(typeof e.token=="string"),this.R=e.token,new Qi(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}},ql=class{getToken(){return Promise.resolve(new Qi(""))}invalidateToken(){}start(t,e){}shutdown(){}};function pm(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}var Wi=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";for(;n.length<20;){let i=pm(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%t.length))}return n}};function j(r,t){return r<t?-1:r>t?1:0}function xn(r,t,e){return r.length===t.length&&r.every((n,i)=>e(n,t[i]))}function zh(r){return r+"\0"}var ht=class r{static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new r(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new C(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new C(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new C(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new C(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?j(this.nanoseconds,t.nanoseconds):j(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var B=class r{static fromTimestamp(t){return new r(t)}static min(){return new r(new ht(0,0))}static max(){return new r(new ht(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Hi=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&O(),n===void 0?n=t.length-e:n>t.length-e&&O(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let i=0;i<n;i++){let s=t.get(i),a=e.get(i);if(s<a)return-1;if(s>a)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},X=class r extends Hi{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new C(b.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(i=>i.length>0))}return new r(e)}static emptyPath(){return new r([])}},_m=/^[_a-zA-Z][_a-zA-Z0-9]*$/,wt=class r extends Hi{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return _m.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(t){let e=[],n="",i=0,s=()=>{if(n.length===0)throw new C(b.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;i<t.length;){let u=t[i];if(u==="\\"){if(i+1===t.length)throw new C(b.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let c=t[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new C(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=c,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new C(b.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var L=class r{constructor(t){this.path=t}static fromPath(t){return new r(X.fromString(t))}static fromName(t){return new r(X.fromString(t).popFirst(5))}static empty(){return new r(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&X.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return X.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new X(t.slice()))}};var be=class{constructor(t,e,n,i){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=i}};function Yo(r){return r.fields.find(t=>t.kind===2)}function Qe(r){return r.fields.filter(t=>t.kind!==2)}function ym(r,t){let e=j(r.collectionGroup,t.collectionGroup);if(e!==0)return e;for(let n=0;n<Math.min(r.fields.length,t.fields.length);++n)if(e=wm(r.fields[n],t.fields[n]),e!==0)return e;return j(r.fields.length,t.fields.length)}be.UNKNOWN_ID=-1;var ae=class{constructor(t,e){this.fieldPath=t,this.kind=e}};function wm(r,t){let e=wt.comparator(r.fieldPath,t.fieldPath);return e!==0?e:j(r.kind,t.kind)}var Cn=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,Bt.min())}};function jh(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=B.fromTimestamp(n===1e9?new ht(e+1,0):new ht(e,n));return new Bt(i,L.empty(),t)}function Kh(r){return new Bt(r.readTime,r.key,-1)}var Bt=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(B.min(),L.empty(),-1)}static max(){return new r(B.max(),L.empty(),-1)}};function Ju(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=L.comparator(r.documentKey,t.documentKey),e!==0?e:j(r.largestBatchId,t.largestBatchId))}var $h="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ji=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Oe(r){return V(this,null,function*(){if(r.code!==b.FAILED_PRECONDITION||r.message!==$h)throw r;D("LocalStore","Unexpectedly lost primary lease")})}var S=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&O(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(n,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let i=0,s=0,a=!1;t.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&e()},c=>n(c))}),a=!0,s===i&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(i=>i?r.resolve(i):n());return e}static forEach(t,e){let n=[];return t.forEach((i,s)=>{n.push(e.call(this,i,s))}),this.waitFor(n)}static mapArray(t,e){return new r((n,i)=>{let s=t.length,a=new Array(s),u=0;for(let c=0;c<s;c++){let d=c;e(t[d]).next(f=>{a[d]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(t,e){return new r((n,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):n()};s()})}};var Xi=class r{static open(t,e,n,i){try{return new r(e,t.transaction(i,n))}catch(s){throw new Ze(e,s)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new yt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new Ze(t,e.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=Xu(n.target.error);this.V.reject(new Ze(t,i))}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(D("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new ta(e)}},Pe=class r{static delete(t){return D("SimpleDb","Removing database:",t),We(window.indexedDB.deleteDatabase(t)).toPromise()}static p(){if(!Pl())return!1;if(r.S())return!0;let t=Er(),e=r.D(t),n=0<e&&e<10,i=Qh(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static S(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.v)==="YES"}static C(t,e){return t.store(e)}static D(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.F=n,r.D(Er())===12.2&&lt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}M(t){return V(this,null,function*(){return this.db||(D("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;e(a)},i.onblocked=()=>{n(new Ze(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?n(new C(b.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new C(b.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new Ze(t,a))},i.onupgradeneeded=s=>{D("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;this.F.O(a,i.transaction,s.oldVersion,this.version).next(()=>{D("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db})}L(t){this.N=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,n,i){return V(this,null,function*(){let s=e==="readonly",a=0;for(;;){++a;try{this.db=yield this.M(t);let u=Xi.open(this.db,t,s?"readonly":"readwrite",n),c=i(u).next(d=>(u.g(),d)).catch(d=>(u.abort(d),S.reject(d))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){let c=u,d=c.name!=="FirebaseError"&&a<3;if(D("SimpleDb","Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Qh(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var Zo=class{constructor(t){this.B=t,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(t){this.B=t}done(){this.k=!0}$(t){this.q=t}delete(){return We(this.B.delete())}},Ze=class extends C{constructor(t,e){super(b.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function qe(r){return r.name==="IndexedDbTransactionError"}var ta=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(D("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(D("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),We(n)}add(t){return D("SimpleDb","ADD",this.store.name,t,t),We(this.store.add(t))}get(t){return We(this.store.get(t)).next(e=>(e===void 0&&(e=null),D("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return D("SimpleDb","DELETE",this.store.name,t),We(this.store.delete(t))}count(){return D("SimpleDb","COUNT",this.store.name),We(this.store.count())}U(t,e){let n=this.options(t,e),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new S((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{let s=this.cursor(n),a=[];return this.W(s,(u,c)=>{a.push(c)}).next(()=>a)}}G(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new S((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(t,e){D("SimpleDb","DELETE ALL",this.store.name);let n=this.options(t,e);n.H=!1;let i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(t,e){let n;e?n=t:(n={},e=t);let i=this.cursor(n);return this.W(i,e)}Y(t){let e=this.cursor({});return new S((n,i)=>{e.onerror=s=>{let a=Xu(s.target.error);i(a)},e.onsuccess=s=>{let a=s.target.result;a?t(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(t,e){let n=[];return new S((i,s)=>{t.onerror=a=>{s(a.target.error)},t.onsuccess=a=>{let u=a.target.result;if(!u)return void i();let c=new Zo(u),d=e(u.primaryKey,u.value,c);if(d instanceof S){let f=d.catch(g=>(c.done(),S.reject(g)));n.push(f)}c.isDone?i():c.K===null?u.continue():u.continue(c.K)}}).next(()=>S.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.H?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function We(r){return new S((t,e)=>{r.onsuccess=n=>{let i=n.target.result;t(i)},r.onerror=n=>{let i=Xu(n.target.error);e(i)}})}var Ul=!1;function Xu(r){let t=Pe.D(Er());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ul||(Ul=!0,setTimeout(()=>{throw n},0)),n}}return r}var ea=class{constructor(t,e){this.asyncQueue=t,this.Z=e,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(t){D("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>V(this,null,function*(){this.task=null;try{D("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(e){qe(e)?D("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):yield Oe(e)}yield this.X(6e4)}))}},na=class{constructor(t,e){this.localStore=t,this.persistence=e}ee(t=50){return V(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.te(e,t))})}te(t,e){let n=new Set,i=e,s=!0;return S.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return D("IndexBackfiller",`Processing collection: ${a}`),this.ne(t,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>e-i)}ne(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,n).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this.re(i,s)).next(u=>(D("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>a.size)}))}re(t,e){let n=t;return e.changes.forEach((i,s)=>{let a=Kh(s);Ju(a,n)>0&&(n=a)}),new Bt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Ot=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return r.oe=-1,r})();function ui(r){return r==null}function Lr(r){return r===0&&1/r==-1/0}function Wh(r){return typeof r=="number"&&Number.isInteger(r)&&!Lr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Ct(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=Bl(t)),t=vm(r.get(e),t);return Bl(t)}function vm(r,t){let e=t,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function Bl(r){return r+""}function Qt(r){let t=r.length;if(q(t>=2),t===2)return q(r.charAt(0)===""&&r.charAt(1)===""),X.emptyPath();let e=t-2,n=[],i="";for(let s=0;s<t;){let a=r.indexOf("",s);switch((a<0||a>e)&&O(),r.charAt(a+1)){case"":let u=r.substring(s,a),c;i.length===0?c=u:(i+=u,c=i,i=""),n.push(c);break;case"":i+=r.substring(s,a),i+="\0";break;case"":i+=r.substring(s,a+1);break;default:O()}s=a+2}return new X(n)}var Gl=["userId","batchId"];function Ui(r,t){return[r,Ct(t)]}function Hh(r,t,e){return[r,Ct(t),e]}var Tm={},Im=["prefixPath","collectionGroup","readTime","documentId"],Em=["prefixPath","collectionGroup","documentId"],Am=["collectionGroup","readTime","prefixPath","documentId"],Sm=["canonicalId","targetId"],Rm=["targetId","path"],bm=["path","targetId"],Pm=["collectionId","parent"],Vm=["indexId","uid"],xm=["uid","sequenceNumber"],Cm=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Dm=["indexId","uid","orderedDocumentKey"],Nm=["userId","collectionPath","documentId"],km=["userId","collectionPath","largestBatchId"],Fm=["userId","collectionGroup","largestBatchId"],Jh=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Mm=[...Jh,"documentOverlays"],Xh=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Yh=Xh,Yu=[...Yh,"indexConfiguration","indexState","indexEntries"],Lm=Yu,Om=[...Yu,"globals"];var Or=class extends Ji{constructor(t,e){super(),this._e=t,this.currentSequenceNumber=e}};function It(r,t){let e=F(r);return Pe.C(e._e,t)}function zl(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function Ue(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Zh(r,t){let e=[];for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.push(t(r[n],n,r));return e}function td(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var st=class r{constructor(t,e){this.comparator=t,this.root=e||Ht.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ht.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ht.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(t,n.key);if(i===0)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Rn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Rn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Rn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Rn(this.root,t,this.comparator,!0)}},Rn=class{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},Ht=class r{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new r(t??this.key,e??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this,s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw O();let t=this.left.check();if(t!==this.right.check())throw O();return t+(this.isRed()?0:1)}};Ht.EMPTY=null,Ht.RED=!0,Ht.BLACK=!1;Ht.EMPTY=new class{constructor(){this.size=0}get key(){throw O()}get value(){throw O()}get color(){throw O()}get left(){throw O()}get right(){throw O()}copy(t,e,n,i,s){return this}insert(t,e,n){return new Ht(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var nt=class r{constructor(t){this.comparator=t,this.data=new st(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Yi(this.data.getIterator())}getIteratorFrom(t){return new Yi(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},Yi=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function yn(r){return r.hasNext()?r.getNext():void 0}var qt=class r{constructor(t){this.fields=t,t.sort(wt.comparator)}static empty(){return new r([])}unionWith(t){let e=new nt(wt.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return xn(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var Zi=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function Np(){return typeof atob<"u"}var mt=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Zi("Invalid base64 string: "+s):s}}(t);return new r(e)}static fromUint8Array(t){let e=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return j(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};mt.EMPTY_BYTE_STRING=new mt("");var qm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ue(r){if(q(!!r),typeof r=="string"){let t=0,e=qm.exec(r);if(q(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:ot(r.seconds),nanos:ot(r.nanos)}}function ot(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function ce(r){return typeof r=="string"?mt.fromBase64String(r):mt.fromUint8Array(r)}function $s(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function Qs(r){let t=r.mapValue.fields.__previous_value__;return $s(t)?Qs(t):t}function qr(r){let t=ue(r.mapValue.fields.__local_write_time__.timestampValue);return new ht(t.seconds,t.nanos)}var ra=class{constructor(t,e,n,i,s,a,u,c,d){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=d}},Dn=class r{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var Se={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Bi={nullValue:"NULL_VALUE"};function Ve(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?$s(r)?4:ed(r)?9007199254740991:Ws(r)?10:11:O()}function Yt(r,t){if(r===t)return!0;let e=Ve(r);if(e!==Ve(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return qr(r).isEqual(qr(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=ue(i.timestampValue),u=ue(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(i,s){return ce(i.bytesValue).isEqual(ce(s.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(i,s){return ot(i.geoPointValue.latitude)===ot(s.geoPointValue.latitude)&&ot(i.geoPointValue.longitude)===ot(s.geoPointValue.longitude)}(r,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ot(i.integerValue)===ot(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=ot(i.doubleValue),u=ot(s.doubleValue);return a===u?Lr(a)===Lr(u):isNaN(a)&&isNaN(u)}return!1}(r,t);case 9:return xn(r.arrayValue.values||[],t.arrayValue.values||[],Yt);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(zl(a)!==zl(u))return!1;for(let c in a)if(a.hasOwnProperty(c)&&(u[c]===void 0||!Yt(a[c],u[c])))return!1;return!0}(r,t);default:return O()}}function Ur(r,t){return(r.values||[]).find(e=>Yt(e,t))!==void 0}function xe(r,t){if(r===t)return 0;let e=Ve(r),n=Ve(t);if(e!==n)return j(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return j(r.booleanValue,t.booleanValue);case 2:return function(s,a){let u=ot(s.integerValue||s.doubleValue),c=ot(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,t);case 3:return jl(r.timestampValue,t.timestampValue);case 4:return jl(qr(r),qr(t));case 5:return j(r.stringValue,t.stringValue);case 6:return function(s,a){let u=ce(s),c=ce(a);return u.compareTo(c)}(r.bytesValue,t.bytesValue);case 7:return function(s,a){let u=s.split("/"),c=a.split("/");for(let d=0;d<u.length&&d<c.length;d++){let f=j(u[d],c[d]);if(f!==0)return f}return j(u.length,c.length)}(r.referenceValue,t.referenceValue);case 8:return function(s,a){let u=j(ot(s.latitude),ot(a.latitude));return u!==0?u:j(ot(s.longitude),ot(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return Kl(r.arrayValue,t.arrayValue);case 10:return function(s,a){var u,c,d,f;let g=s.fields||{},_=a.fields||{},R=(u=g.value)===null||u===void 0?void 0:u.arrayValue,N=(c=_.value)===null||c===void 0?void 0:c.arrayValue,k=j(((d=R?.values)===null||d===void 0?void 0:d.length)||0,((f=N?.values)===null||f===void 0?void 0:f.length)||0);return k!==0?k:Kl(R,N)}(r.mapValue,t.mapValue);case 11:return function(s,a){if(s===Se.mapValue&&a===Se.mapValue)return 0;if(s===Se.mapValue)return 1;if(a===Se.mapValue)return-1;let u=s.fields||{},c=Object.keys(u),d=a.fields||{},f=Object.keys(d);c.sort(),f.sort();for(let g=0;g<c.length&&g<f.length;++g){let _=j(c[g],f[g]);if(_!==0)return _;let R=xe(u[c[g]],d[f[g]]);if(R!==0)return R}return j(c.length,f.length)}(r.mapValue,t.mapValue);default:throw O()}}function jl(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return j(r,t);let e=ue(r),n=ue(t),i=j(e.seconds,n.seconds);return i!==0?i:j(e.nanos,n.nanos)}function Kl(r,t){let e=r.values||[],n=t.values||[];for(let i=0;i<e.length&&i<n.length;++i){let s=xe(e[i],n[i]);if(s)return s}return j(e.length,n.length)}function Nn(r){return ia(r)}function ia(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=ue(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return ce(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return L.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",i=!0;for(let s of e.values||[])i?i=!1:n+=",",n+=ia(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${ia(e.fields[a])}`;return i+"}"}(r.mapValue):O()}function Gi(r){switch(Ve(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=Qs(r);return t?16+Gi(t):16;case 5:return 2*r.stringValue.length;case 6:return ce(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((i,s)=>i+Gi(s),0)}(r.arrayValue);case 10:case 11:return function(n){let i=0;return Ue(n.fields,(s,a)=>{i+=s.length+Gi(a)}),i}(r.mapValue);default:throw O()}}function tn(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function sa(r){return!!r&&"integerValue"in r}function Br(r){return!!r&&"arrayValue"in r}function $l(r){return!!r&&"nullValue"in r}function Ql(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function zi(r){return!!r&&"mapValue"in r}function Ws(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="__vector__"}function Dr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return Ue(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Dr(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Dr(r.arrayValue.values[e]);return t}return Object.assign({},r)}function ed(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var nd={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Um(r){return"nullValue"in r?Bi:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?tn(Dn.empty(),L.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Ws(r)?nd:{mapValue:{}}:O()}function Bm(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?tn(Dn.empty(),L.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?nd:"mapValue"in r?Ws(r)?{mapValue:{}}:Se:O()}function Wl(r,t){let e=xe(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function Hl(r,t){let e=xe(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var xt=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!zi(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Dr(e)}setAll(t){let e=wt.emptyPath(),n={},i=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){let c=this.getFieldsMap(e);this.applyChanges(c,n,i),n={},i=[],e=u.popLast()}a?n[u.lastSegment()]=Dr(a):i.push(u.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){let e=this.field(t.popLast());zi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Yt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];zi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){Ue(e,(i,s)=>t[i]=s);for(let i of n)delete t[i]}clone(){return new r(Dr(this.value))}};function rd(r){let t=[];return Ue(r.fields,(e,n)=>{let i=new wt([e]);if(zi(n)){let s=rd(n.mapValue).fields;if(s.length===0)t.push(i);else for(let a of s)t.push(i.child(a))}else t.push(i)}),new qt(t)}var vt=class r{constructor(t,e,n,i,s,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(t){return new r(t,0,B.min(),B.min(),B.min(),xt.empty(),0)}static newFoundDocument(t,e,n,i){return new r(t,1,e,B.min(),n,i,0)}static newNoDocument(t,e){return new r(t,2,e,B.min(),B.min(),xt.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,B.min(),B.min(),xt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=xt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=xt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Zt=class{constructor(t,e){this.position=t,this.inclusive=e}};function Jl(r,t,e){let n=0;for(let i=0;i<r.position.length;i++){let s=t[i],a=r.position[i];if(s.field.isKeyField()?n=L.comparator(L.fromName(a.referenceValue),e.key):n=xe(a,e.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function Xl(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!Yt(r.position[e],t.position[e]))return!1;return!0}var en=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function Gm(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var ts=class{},H=class r extends ts{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new ua(t,e,n):e==="array-contains"?new ha(t,n):e==="in"?new es(t,n):e==="not-in"?new da(t,n):e==="array-contains-any"?new fa(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new ca(t,n):new la(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(xe(e,this.value)):e!==null&&Ve(this.value)===Ve(e)&&this.matchesComparison(xe(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return O()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},tt=class r extends ts{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new r(t,e)}matches(t){return kn(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function kn(r){return r.op==="and"}function oa(r){return r.op==="or"}function Zu(r){return id(r)&&kn(r)}function id(r){for(let t of r.filters)if(t instanceof tt)return!1;return!0}function aa(r){if(r instanceof H)return r.field.canonicalString()+r.op.toString()+Nn(r.value);if(Zu(r))return r.filters.map(t=>aa(t)).join(",");{let t=r.filters.map(e=>aa(e)).join(",");return`${r.op}(${t})`}}function sd(r,t){return r instanceof H?function(n,i){return i instanceof H&&n.op===i.op&&n.field.isEqual(i.field)&&Yt(n.value,i.value)}(r,t):r instanceof tt?function(n,i){return i instanceof tt&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,u)=>s&&sd(a,i.filters[u]),!0):!1}(r,t):void O()}function od(r,t){let e=r.filters.concat(t);return tt.create(e,r.op)}function ad(r){return r instanceof H?function(e){return`${e.field.canonicalString()} ${e.op} ${Nn(e.value)}`}(r):r instanceof tt?function(e){return e.op.toString()+" {"+e.getFilters().map(ad).join(" ,")+"}"}(r):"Filter"}var ua=class extends H{constructor(t,e,n){super(t,e,n),this.key=L.fromName(n.referenceValue)}matches(t){let e=L.comparator(t.key,this.key);return this.matchesComparison(e)}},ca=class extends H{constructor(t,e){super(t,"in",e),this.keys=ud("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},la=class extends H{constructor(t,e){super(t,"not-in",e),this.keys=ud("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function ud(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>L.fromName(n.referenceValue))}var ha=class extends H{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return Br(e)&&Ur(e.arrayValue,this.value)}},es=class extends H{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Ur(this.value.arrayValue,e)}},da=class extends H{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ur(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!Ur(this.value.arrayValue,e)}},fa=class extends H{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!Br(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>Ur(this.value.arrayValue,n))}};var ma=class{constructor(t,e=null,n=[],i=[],s=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}};function ga(r,t=null,e=[],n=[],i=null,s=null,a=null){return new ma(r,t,e,n,i,s,a)}function nn(r){let t=F(r);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>aa(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),ui(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>Nn(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>Nn(n)).join(",")),t.ue=e}return t.ue}function ci(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!Gm(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!sd(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!Xl(r.startAt,t.startAt)&&Xl(r.endAt,t.endAt)}function ns(r){return L.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function rs(r,t){return r.filters.filter(e=>e instanceof H&&e.field.isEqual(t))}function Yl(r,t,e){let n=Bi,i=!0;for(let s of rs(r,t)){let a=Bi,u=!0;switch(s.op){case"<":case"<=":a=Um(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=Bi}Wl({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];Wl({value:n,inclusive:i},{value:a,inclusive:e.inclusive})<0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}function Zl(r,t,e){let n=Se,i=!0;for(let s of rs(r,t)){let a=Se,u=!0;switch(s.op){case">=":case">":a=Bm(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=Se}Hl({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];Hl({value:n,inclusive:i},{value:a,inclusive:e.inclusive})>0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}var zt=class{constructor(t,e=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function cd(r,t,e,n,i,s,a,u){return new zt(r,t,e,n,i,s,a,u)}function Xn(r){return new zt(r)}function th(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function tc(r){return r.collectionGroup!==null}function bn(r){let t=F(r);if(t.ce===null){t.ce=[];let e=new Set;for(let s of t.explicitOrderBy)t.ce.push(s),e.add(s.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new nt(wt.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.ce.push(new en(s,n))}),e.has(wt.keyField().canonicalString())||t.ce.push(new en(wt.keyField(),n))}return t.ce}function Dt(r){let t=F(r);return t.le||(t.le=hd(t,bn(r))),t.le}function ld(r){let t=F(r);return t.he||(t.he=hd(t,r.explicitOrderBy)),t.he}function hd(r,t){if(r.limitType==="F")return ga(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new en(i.field,s)});let e=r.endAt?new Zt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Zt(r.startAt.position,r.startAt.inclusive):null;return ga(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function pa(r,t){let e=r.filters.concat([t]);return new zt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function is(r,t,e){return new zt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function li(r,t){return ci(Dt(r),Dt(t))&&r.limitType===t.limitType}function dd(r){return`${nn(Dt(r))}|lt:${r.limitType}`}function En(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(i=>ad(i)).join(", ")}]`),ui(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(i=>Nn(i)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(i=>Nn(i)).join(",")),`Target(${n})`}(Dt(r))}; limitType=${r.limitType})`}function hi(r,t){return t.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):L.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,t)&&function(n,i){for(let s of bn(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,t)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,t)&&function(n,i){return!(n.startAt&&!function(a,u,c){let d=Jl(a,u,c);return a.inclusive?d<=0:d<0}(n.startAt,bn(n),i)||n.endAt&&!function(a,u,c){let d=Jl(a,u,c);return a.inclusive?d>=0:d>0}(n.endAt,bn(n),i))}(r,t)}function fd(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function md(r){return(t,e)=>{let n=!1;for(let i of bn(r)){let s=zm(i,t,e);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function zm(r,t,e){let n=r.field.isKeyField()?L.comparator(t.key,e.key):function(s,a,u){let c=a.data.field(s),d=u.data.field(s);return c!==null&&d!==null?xe(c,d):O()}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return O()}}var jt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),i=this.inner[n];if(i===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return n.length===1?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){Ue(this.inner,(e,n)=>{for(let[i,s]of n)t(i,s)})}isEmpty(){return td(this.inner)}size(){return this.innerSize}};var jm=new st(L.comparator);function Mt(){return jm}var gd=new st(L.comparator);function xr(...r){let t=gd;for(let e of r)t=t.insert(e.key,e);return t}function pd(r){let t=gd;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Wt(){return Nr()}function _d(){return Nr()}function Nr(){return new jt(r=>r.toString(),(r,t)=>r.isEqual(t))}var Km=new st(L.comparator),$m=new nt(L.comparator);function K(...r){let t=$m;for(let e of r)t=t.add(e);return t}var Qm=new nt(j);function ec(){return Qm}function nc(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Lr(t)?"-0":t}}function yd(r){return{integerValue:""+r}}function wd(r,t){return Wh(t)?yd(t):nc(r,t)}var Fn=class{constructor(){this._=void 0}};function Wm(r,t,e){return r instanceof Ce?function(i,s){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&$s(s)&&(s=Qs(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(e,t):r instanceof le?Td(r,t):r instanceof he?Id(r,t):function(i,s){let a=vd(i,s),u=eh(a)+eh(i.Pe);return sa(a)&&sa(i.Pe)?yd(u):nc(i.serializer,u)}(r,t)}function Hm(r,t,e){return r instanceof le?Td(r,t):r instanceof he?Id(r,t):e}function vd(r,t){return r instanceof De?function(n){return sa(n)||function(s){return!!s&&"doubleValue"in s}(n)}(t)?t:{integerValue:0}:null}var Ce=class extends Fn{},le=class extends Fn{constructor(t){super(),this.elements=t}};function Td(r,t){let e=Ed(t);for(let n of r.elements)e.some(i=>Yt(i,n))||e.push(n);return{arrayValue:{values:e}}}var he=class extends Fn{constructor(t){super(),this.elements=t}};function Id(r,t){let e=Ed(t);for(let n of r.elements)e=e.filter(i=>!Yt(i,n));return{arrayValue:{values:e}}}var De=class extends Fn{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function eh(r){return ot(r.integerValue||r.doubleValue)}function Ed(r){return Br(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var rn=class{constructor(t,e){this.field=t,this.transform=e}};function Jm(r,t){return r.field.isEqual(t.field)&&function(n,i){return n instanceof le&&i instanceof le||n instanceof he&&i instanceof he?xn(n.elements,i.elements,Yt):n instanceof De&&i instanceof De?Yt(n.Pe,i.Pe):n instanceof Ce&&i instanceof Ce}(r.transform,t.transform)}var _a=class{constructor(t,e){this.version=t,this.transformResults=e}},ct=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function ji(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var Mn=class{};function Ad(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new ke(r.key,ct.none()):new Ne(r.key,r.data,ct.none());{let e=r.data,n=xt.empty(),i=new nt(wt.comparator);for(let s of t.fields)if(!i.has(s)){let a=e.field(s);a===null&&s.length>1&&(s=s.popLast(),a=e.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new Kt(r.key,n,new qt(i.toArray()),ct.none())}}function Xm(r,t,e){r instanceof Ne?function(i,s,a){let u=i.value.clone(),c=rh(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):r instanceof Kt?function(i,s,a){if(!ji(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=rh(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(Sd(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,t,e):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function kr(r,t,e,n){return r instanceof Ne?function(s,a,u,c){if(!ji(s.precondition,a))return u;let d=s.value.clone(),f=ih(s.fieldTransforms,c,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,t,e,n):r instanceof Kt?function(s,a,u,c){if(!ji(s.precondition,a))return u;let d=ih(s.fieldTransforms,c,a),f=a.data;return f.setAll(Sd(s)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,t,e,n):function(s,a,u){return ji(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,t,e)}function Ym(r,t){let e=null;for(let n of r.fieldTransforms){let i=t.data.field(n.field),s=vd(n.transform,i||null);s!=null&&(e===null&&(e=xt.empty()),e.set(n.field,s))}return e||null}function nh(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&xn(n,i,(s,a)=>Jm(s,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var Ne=class extends Mn{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Kt=class extends Mn{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Sd(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function rh(r,t,e){let n=new Map;q(r.length===e.length);for(let i=0;i<e.length;i++){let s=r[i],a=s.transform,u=t.data.field(s.field);n.set(s.field,Hm(a,u,e[i]))}return n}function ih(r,t,e){let n=new Map;for(let i of r){let s=i.transform,a=e.data.field(i.field);n.set(i.field,Wm(s,a,t))}return n}var ke=class extends Mn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Gr=class extends Mn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var zr=class{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&Xm(s,t,n[i])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=kr(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=kr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=_d();return this.mutations.forEach(i=>{let s=t.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=e.has(i.key)?null:u;let c=Ad(a,u);c!==null&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(B.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),K())}isEqual(t){return this.batchId===t.batchId&&xn(this.mutations,t.mutations,(e,n)=>nh(e,n))&&xn(this.baseMutations,t.baseMutations,(e,n)=>nh(e,n))}},ya=class r{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){q(t.mutations.length===n.length);let i=function(){return Km}(),s=t.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(t,e,n,i)}};var jr=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ss=class{constructor(t,e,n){this.alias=t,this.aggregateType=e,this.fieldPath=n}};var wa=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var gt,J;function Rd(r){switch(r){default:return O();case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0}}function bd(r){if(r===void 0)return lt("GRPC error has no .code"),b.UNKNOWN;switch(r){case gt.OK:return b.OK;case gt.CANCELLED:return b.CANCELLED;case gt.UNKNOWN:return b.UNKNOWN;case gt.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case gt.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case gt.INTERNAL:return b.INTERNAL;case gt.UNAVAILABLE:return b.UNAVAILABLE;case gt.UNAUTHENTICATED:return b.UNAUTHENTICATED;case gt.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case gt.NOT_FOUND:return b.NOT_FOUND;case gt.ALREADY_EXISTS:return b.ALREADY_EXISTS;case gt.PERMISSION_DENIED:return b.PERMISSION_DENIED;case gt.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case gt.ABORTED:return b.ABORTED;case gt.OUT_OF_RANGE:return b.OUT_OF_RANGE;case gt.UNIMPLEMENTED:return b.UNIMPLEMENTED;case gt.DATA_LOSS:return b.DATA_LOSS;default:return O()}}(J=gt||(gt={}))[J.OK=0]="OK",J[J.CANCELLED=1]="CANCELLED",J[J.UNKNOWN=2]="UNKNOWN",J[J.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",J[J.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",J[J.NOT_FOUND=5]="NOT_FOUND",J[J.ALREADY_EXISTS=6]="ALREADY_EXISTS",J[J.PERMISSION_DENIED=7]="PERMISSION_DENIED",J[J.UNAUTHENTICATED=16]="UNAUTHENTICATED",J[J.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",J[J.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",J[J.ABORTED=10]="ABORTED",J[J.OUT_OF_RANGE=11]="OUT_OF_RANGE",J[J.UNIMPLEMENTED=12]="UNIMPLEMENTED",J[J.INTERNAL=13]="INTERNAL",J[J.UNAVAILABLE=14]="UNAVAILABLE",J[J.DATA_LOSS=15]="DATA_LOSS";var os=null;function Pd(){return new TextEncoder}var Zm=new we([4294967295,4294967295],0);function sh(r){let t=Pd().encode(r),e=new Fo;return e.update(t),new Uint8Array(e.digest())}function oh(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new we([e,n],0),new we([i,s],0)]}var va=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Ye(`Invalid padding: ${e}`);if(n<0)throw new Ye(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new Ye(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new Ye(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ie=we.fromNumber(this.Te)}Ee(t,e,n){let i=t.add(e.multiply(we.fromNumber(n)));return i.compare(Zm)===1&&(i=new we([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ie).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;let e=sh(t),[n,i]=oh(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(t,e,n){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),a=new r(s,i,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(this.Te===0)return;let e=sh(t),[n,i]=oh(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);this.Ae(a)}}Ae(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},Ye=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Kr=class r{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let i=new Map;return i.set(t,$r.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(B.min(),i,new st(j),Mt(),K())}},$r=class r{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,K(),K(),K())}};var Pn=class{constructor(t,e,n,i){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=i}},as=class{constructor(t,e){this.targetId=t,this.me=e}},us=class{constructor(t,e,n=mt.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}},cs=class{constructor(){this.fe=0,this.ge=ah(),this.pe=mt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=K(),e=K(),n=K();return this.ge.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:O()}}),new $r(this.pe,this.ye,t,e,n)}Ce(){this.we=!1,this.ge=ah()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,q(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Ta=class{constructor(t){this.Le=t,this.Be=new Map,this.ke=Mt(),this.qe=ki(),this.Qe=ki(),this.Ke=new st(j)}$e(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.Ue(e,t.Ve):this.We(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.We(e,t.key,t.Ve)}Ge(t){this.forEachTarget(t,e=>{let n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.je(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.De(t.resumeToken));break;default:O()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach((n,i)=>{this.je(i)&&e(i)})}Je(t){let e=t.targetId,n=t.me.count,i=this.Ye(e);if(i){let s=i.target;if(ns(s))if(n===0){let a=new L(s.path);this.We(e,a,vt.newNoDocument(a,B.min()))}else q(n===1);else{let a=this.Ze(e);if(a!==n){let u=this.Xe(t),c=u?this.et(u,t,a):1;if(c!==0){this.He(e);let d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,d)}os?.tt(function(f,g,_,R,N){var k,x,G,z,U,Q;let Z={localCacheCount:f,existenceFilterCount:g.count,databaseId:_.database,projectId:_.projectId},$=g.unchangedNames;return $&&(Z.bloomFilter={applied:N===0,hashCount:(k=$?.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(z=(G=(x=$?.bits)===null||x===void 0?void 0:x.bitmap)===null||G===void 0?void 0:G.length)!==null&&z!==void 0?z:0,padding:(Q=(U=$?.bits)===null||U===void 0?void 0:U.padding)!==null&&Q!==void 0?Q:0,mightContain:v=>{var p;return(p=R?.mightContain(v))!==null&&p!==void 0&&p}}),Z}(a,t.me,this.Le.nt(),u,c))}}}}Xe(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=e,a,u;try{a=ce(n).toUint8Array()}catch(c){if(c instanceof Zi)return Ut("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new va(a,i,s)}catch(c){return Ut(c instanceof Ye?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.Te===0?null:u}et(t,e,n){return e.me.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){let n=this.Le.getRemoteKeysForTarget(e),i=0;return n.forEach(s=>{let a=this.Le.nt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;t.mightContain(u)||(this.We(e,s,null),i++)}),i}it(t){let e=new Map;this.Be.forEach((s,a)=>{let u=this.Ye(a);if(u){if(s.current&&ns(u.target)){let c=new L(u.target.path);this.st(c).has(a)||this.ot(a,c)||this.We(a,c,vt.newNoDocument(c,t))}s.be&&(e.set(a,s.ve()),s.Ce())}});let n=K();this.Qe.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{let d=this.Ye(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(t));let i=new Kr(t,e,this.Ke,this.ke,n);return this.ke=Mt(),this.qe=ki(),this.Qe=ki(),this.Ke=new st(j),i}Ue(t,e){if(!this.je(t))return;let n=this.ot(t,e.key)?2:0;this.ze(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t)),this.Qe=this.Qe.insert(e.key,this._t(e.key).add(t))}We(t,e,n){if(!this.je(t))return;let i=this.ze(t);this.ot(t,e)?i.Fe(e,1):i.Me(e),this.Qe=this.Qe.insert(e,this._t(e).delete(t)),this.Qe=this.Qe.insert(e,this._t(e).add(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ze(t){let e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.ze(t).xe()}ze(t){let e=this.Be.get(t);return e||(e=new cs,this.Be.set(t,e)),e}_t(t){let e=this.Qe.get(t);return e||(e=new nt(j),this.Qe=this.Qe.insert(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new nt(j),this.qe=this.qe.insert(t,e)),e}je(t){let e=this.Ye(t)!==null;return e||D("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){let e=this.Be.get(t);return e&&e.Se?null:this.Le.ut(t)}He(t){this.Be.set(t,new cs),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}ot(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function ki(){return new st(L.comparator)}function ah(){return new st(L.comparator)}var tg={asc:"ASCENDING",desc:"DESCENDING"},eg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ng={and:"AND",or:"OR"},Ia=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function Ea(r,t){return r.useProto3Json||ui(t)?t:{value:t}}function Ln(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Vd(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function rg(r,t){return Ln(r,t.toTimestamp())}function dt(r){return q(!!r),B.fromTimestamp(function(e){let n=ue(e);return new ht(n.seconds,n.nanos)}(r))}function rc(r,t){return Aa(r,t).canonicalString()}function Aa(r,t){let e=function(i){return new X(["projects",i.projectId,"databases",i.database])}(r).child("documents");return t===void 0?e:e.child(t)}function xd(r){let t=X.fromString(r);return q(Ud(t)),t}function Qr(r,t){return rc(r.databaseId,t.path)}function Jt(r,t){let e=xd(t);if(e.get(1)!==r.databaseId.projectId)throw new C(b.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new C(b.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new L(Nd(e))}function Cd(r,t){return rc(r.databaseId,t)}function Dd(r){let t=xd(r);return t.length===4?X.emptyPath():Nd(t)}function Sa(r){return new X(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Nd(r){return q(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function uh(r,t,e){return{name:Qr(r,t),fields:e.value.mapValue.fields}}function kd(r,t,e){let n=Jt(r,t.name),i=dt(t.updateTime),s=t.createTime?dt(t.createTime):B.min(),a=new xt({mapValue:{fields:t.fields}}),u=vt.newFoundDocument(n,i,s,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function ig(r,t){return"found"in t?function(n,i){q(!!i.found),i.found.name,i.found.updateTime;let s=Jt(n,i.found.name),a=dt(i.found.updateTime),u=i.found.createTime?dt(i.found.createTime):B.min(),c=new xt({mapValue:{fields:i.found.fields}});return vt.newFoundDocument(s,a,u,c)}(r,t):"missing"in t?function(n,i){q(!!i.missing),q(!!i.readTime);let s=Jt(n,i.missing),a=dt(i.readTime);return vt.newNoDocument(s,a)}(r,t):O()}function sg(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:O()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(d,f){return d.useProto3Json?(q(f===void 0||typeof f=="string"),mt.fromBase64String(f||"")):(q(f===void 0||f instanceof Buffer||f instanceof Uint8Array),mt.fromUint8Array(f||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&function(d){let f=d.code===void 0?b.UNKNOWN:bd(d.code);return new C(f,d.message||"")}(a);e=new us(n,i,s,u||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=Jt(r,n.document.name),s=dt(n.document.updateTime),a=n.document.createTime?dt(n.document.createTime):B.min(),u=new xt({mapValue:{fields:n.document.fields}}),c=vt.newFoundDocument(i,s,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];e=new Pn(d,f,c.key,c)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=Jt(r,n.document),s=n.readTime?dt(n.readTime):B.min(),a=vt.newNoDocument(i,s),u=n.removedTargetIds||[];e=new Pn([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=Jt(r,n.document),s=n.removedTargetIds||[];e=new Pn([],s,i,null)}else{if(!("filter"in t))return O();{t.filter;let n=t.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new wa(i,s),u=n.targetId;e=new as(u,a)}}return e}function Wr(r,t){let e;if(t instanceof Ne)e={update:uh(r,t.key,t.value)};else if(t instanceof ke)e={delete:Qr(r,t.key)};else if(t instanceof Kt)e={update:uh(r,t.key,t.data),updateMask:hg(t.fieldMask)};else{if(!(t instanceof Gr))return O();e={verify:Qr(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(s,a){let u=a.transform;if(u instanceof Ce)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof le)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof he)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof De)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw O()}(0,n))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:rg(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:O()}(r,t.precondition)),e}function Ra(r,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?ct.updateTime(dt(s.updateTime)):s.exists!==void 0?ct.exists(s.exists):ct.none()}(t.currentDocument):ct.none(),n=t.updateTransforms?t.updateTransforms.map(i=>function(a,u){let c=null;if("setToServerValue"in u)q(u.setToServerValue==="REQUEST_TIME"),c=new Ce;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];c=new le(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];c=new he(f)}else"increment"in u?c=new De(a,u.increment):O();let d=wt.fromServerFormat(u.fieldPath);return new rn(d,c)}(r,i)):[];if(t.update){t.update.name;let i=Jt(r,t.update.name),s=new xt({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=function(c){let d=c.fieldPaths||[];return new qt(d.map(f=>wt.fromServerFormat(f)))}(t.updateMask);return new Kt(i,s,a,e,n)}return new Ne(i,s,e,n)}if(t.delete){let i=Jt(r,t.delete);return new ke(i,e)}if(t.verify){let i=Jt(r,t.verify);return new Gr(i,e)}return O()}function og(r,t){return r&&r.length>0?(q(t!==void 0),r.map(e=>function(i,s){let a=i.updateTime?dt(i.updateTime):dt(s);return a.isEqual(B.min())&&(a=dt(s)),new _a(a,i.transformResults||[])}(e,t))):[]}function Fd(r,t){return{documents:[Cd(r,t.path)]}}function Hs(r,t){let e={structuredQuery:{}},n=t.path,i;t.collectionGroup!==null?(i=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=Cd(r,i);let s=function(d){if(d.length!==0)return qd(tt.create(d,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(f=>function(_){return{field:Ie(_.field),direction:ug(_.dir)}}(f))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let u=Ea(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{ct:e,parent:i}}function Md(r,t,e,n){let{ct:i,parent:s}=Hs(r,t),a={},u=[],c=0;return e.forEach(d=>{let f=n?d.alias:"aggregate_"+c++;a[f]=d.alias,d.aggregateType==="count"?u.push({alias:f,count:{}}):d.aggregateType==="avg"?u.push({alias:f,avg:{field:Ie(d.fieldPath)}}):d.aggregateType==="sum"&&u.push({alias:f,sum:{field:Ie(d.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:u,structuredQuery:i.structuredQuery},parent:i.parent},lt:a,parent:s}}function Ld(r){let t=Dd(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,i=null;if(n>0){q(n===1);let f=e.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];e.where&&(s=function(g){let _=Od(g);return _ instanceof tt&&Zu(_)?_.getFilters():[_]}(e.where));let a=[];e.orderBy&&(a=function(g){return g.map(_=>function(N){return new en(An(N.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction))}(_))}(e.orderBy));let u=null;e.limit&&(u=function(g){let _;return _=typeof g=="object"?g.value:g,ui(_)?null:_}(e.limit));let c=null;e.startAt&&(c=function(g){let _=!!g.before,R=g.values||[];return new Zt(R,_)}(e.startAt));let d=null;return e.endAt&&(d=function(g){let _=!g.before,R=g.values||[];return new Zt(R,_)}(e.endAt)),cd(t,i,a,s,u,"F",c,d)}function ag(r,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return O()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Od(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=An(e.unaryFilter.field);return H.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=An(e.unaryFilter.field);return H.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=An(e.unaryFilter.field);return H.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=An(e.unaryFilter.field);return H.create(a,"!=",{nullValue:"NULL_VALUE"});default:return O()}}(r):r.fieldFilter!==void 0?function(e){return H.create(An(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return O()}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return tt.create(e.compositeFilter.filters.map(n=>Od(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return O()}}(e.compositeFilter.op))}(r):O()}function ug(r){return tg[r]}function cg(r){return eg[r]}function lg(r){return ng[r]}function Ie(r){return{fieldPath:r.canonicalString()}}function An(r){return wt.fromServerFormat(r.fieldPath)}function qd(r){return r instanceof H?function(e){if(e.op==="=="){if(Ql(e.value))return{unaryFilter:{field:Ie(e.field),op:"IS_NAN"}};if($l(e.value))return{unaryFilter:{field:Ie(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Ql(e.value))return{unaryFilter:{field:Ie(e.field),op:"IS_NOT_NAN"}};if($l(e.value))return{unaryFilter:{field:Ie(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ie(e.field),op:cg(e.op),value:e.value}}}(r):r instanceof tt?function(e){let n=e.getFilters().map(i=>qd(i));return n.length===1?n[0]:{compositeFilter:{op:lg(e.op),filters:n}}}(r):O()}function hg(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Ud(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var On=class r{constructor(t,e,n,i,s=B.min(),a=B.min(),u=mt.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var ls=class{constructor(t){this.ht=t}};function dg(r,t){let e;if(t.document)e=kd(r.ht,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=L.fromSegments(t.noDocument.path),i=on(t.noDocument.readTime);e=vt.newNoDocument(n,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return O();{let n=L.fromSegments(t.unknownDocument.path),i=on(t.unknownDocument.version);e=vt.newUnknownDocument(n,i)}}return t.readTime&&e.setReadTime(function(i){let s=new ht(i[0],i[1]);return B.fromTimestamp(s)}(t.readTime)),e}function ch(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:hs(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(s,a){return{name:Qr(s,a.key),fields:a.data.value.mapValue.fields,updateTime:Ln(s,a.version.toTimestamp()),createTime:Ln(s,a.createTime.toTimestamp())}}(r.ht,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:sn(t.version)};else{if(!t.isUnknownDocument())return O();n.unknownDocument={path:e.path.toArray(),version:sn(t.version)}}return n}function hs(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function sn(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function on(r){let t=new ht(r.seconds,r.nanoseconds);return B.fromTimestamp(t)}function He(r,t){let e=(t.baseMutations||[]).map(s=>Ra(r.ht,s));for(let s=0;s<t.mutations.length-1;++s){let a=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let u=t.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let n=t.mutations.map(s=>Ra(r.ht,s)),i=ht.fromMillis(t.localWriteTimeMs);return new zr(t.batchId,i,e,n)}function Cr(r){let t=on(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?on(r.lastLimboFreeSnapshotVersion):B.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){return q(s.documents.length===1),Dt(Xn(Dd(s.documents[0])))}(r.query):function(s){return Dt(Ld(s))}(r.query),new On(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,mt.fromBase64String(r.resumeToken))}function Bd(r,t){let e=sn(t.snapshotVersion),n=sn(t.lastLimboFreeSnapshotVersion),i;i=ns(t.target)?Fd(r.ht,t.target):Hs(r.ht,t.target).ct;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:nn(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function ic(r){let t=Ld({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?is(t,t.limit,"L"):t}function Bo(r,t){return new jr(t.largestBatchId,Ra(r.ht,t.overlayMutation))}function lh(r,t){let e=t.path.lastSegment();return[r,Ct(t.path.popLast()),e]}function hh(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:sn(n.readTime),documentKey:Ct(n.documentKey.path),largestBatchId:n.largestBatchId}}var ba=class{getBundleMetadata(t,e){return dh(t).get(e).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:on(s.createTime),version:s.version}}(n)})}saveBundleMetadata(t,e){return dh(t).put(function(i){return{bundleId:i.id,createTime:sn(dt(i.createTime)),version:i.version}}(e))}getNamedQuery(t,e){return fh(t).get(e).next(n=>{if(n)return function(s){return{name:s.name,query:ic(s.bundledQuery),readTime:on(s.readTime)}}(n)})}saveNamedQuery(t,e){return fh(t).put(function(i){return{name:i.name,readTime:sn(dt(i.readTime)),bundledQuery:i.bundledQuery}}(e))}};function dh(r){return It(r,"bundles")}function fh(r){return It(r,"namedQueries")}var ds=class r{constructor(t,e){this.serializer=t,this.userId=e}static Pt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return Rr(t).get(lh(this.userId,e)).next(n=>n?Bo(this.serializer,n):null)}getOverlays(t,e){let n=Wt();return S.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){let i=[];return n.forEach((s,a)=>{let u=new jr(e,a);i.push(this.Tt(t,u))}),S.waitFor(i)}removeOverlaysForBatchId(t,e,n){let i=new Set;e.forEach(a=>i.add(Ct(a.getCollectionPath())));let s=[];return i.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(Rr(t).j("collectionPathOverlayIndex",u))}),S.waitFor(s)}getOverlaysForCollection(t,e,n){let i=Wt(),s=Ct(e),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Rr(t).U("collectionPathOverlayIndex",a).next(u=>{for(let c of u){let d=Bo(this.serializer,c);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(t,e,n,i){let s=Wt(),a,u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Rr(t).J({index:"collectionGroupOverlayIndex",range:u},(c,d,f)=>{let g=Bo(this.serializer,d);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}Tt(t,e){return Rr(t).put(function(i,s,a){let[u,c,d]=lh(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Wr(i.ht,a.mutation)}}(this.serializer,this.userId,e))}};function Rr(r){return It(r,"documentOverlays")}var Pa=class{It(t){return It(t,"globals")}getSessionToken(t){return this.It(t).get("sessionToken").next(e=>{let n=e?.value;return n?mt.fromUint8Array(n):mt.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.It(t).put({name:"sessionToken",value:e.toUint8Array()})}};var se=class{constructor(){}Et(t,e){this.dt(t,e),e.At()}dt(t,e){if("nullValue"in t)this.Rt(e,5);else if("booleanValue"in t)this.Rt(e,10),e.Vt(t.booleanValue?1:0);else if("integerValue"in t)this.Rt(e,15),e.Vt(ot(t.integerValue));else if("doubleValue"in t){let n=ot(t.doubleValue);isNaN(n)?this.Rt(e,13):(this.Rt(e,15),Lr(n)?e.Vt(0):e.Vt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Rt(e,20),typeof n=="string"&&(n=ue(n)),e.ft(`${n.seconds||""}`),e.Vt(n.nanos||0)}else if("stringValue"in t)this.gt(t.stringValue,e),this.yt(e);else if("bytesValue"in t)this.Rt(e,30),e.wt(ce(t.bytesValue)),this.yt(e);else if("referenceValue"in t)this.St(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.Rt(e,45),e.Vt(n.latitude||0),e.Vt(n.longitude||0)}else"mapValue"in t?ed(t)?this.Rt(e,Number.MAX_SAFE_INTEGER):Ws(t)?this.bt(t.mapValue,e):(this.Dt(t.mapValue,e),this.yt(e)):"arrayValue"in t?(this.vt(t.arrayValue,e),this.yt(e)):O()}gt(t,e){this.Rt(e,25),this.Ct(t,e)}Ct(t,e){e.ft(t)}Dt(t,e){let n=t.fields||{};this.Rt(e,55);for(let i of Object.keys(n))this.gt(i,e),this.dt(n[i],e)}bt(t,e){var n,i;let s=t.fields||{};this.Rt(e,53);let a="value",u=((i=(n=s[a].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.Rt(e,15),e.Vt(ot(u)),this.gt(a,e),this.dt(s[a],e)}vt(t,e){let n=t.values||[];this.Rt(e,50);for(let i of n)this.dt(i,e)}St(t,e){this.Rt(e,37),L.fromName(t).path.forEach(n=>{this.Rt(e,60),this.Ct(n,e)})}Rt(t,e){t.Vt(e)}yt(t){t.Vt(2)}};se.Ft=new se;function fg(r){if(r===0)return 8;let t=0;return!(r>>4)&&(t+=4,r<<=4),!(r>>6)&&(t+=2,r<<=2),!(r>>7)&&(t+=1),t}function mh(r){let t=64-function(n){let i=0;for(let s=0;s<8;++s){let a=fg(255&n[s]);if(i+=a,a!==8)break}return i}(r);return Math.ceil(t/8)}var Va=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Mt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.xt(n.value),n=e.next();this.Ot()}Nt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Lt(n.value),n=e.next();this.Bt()}kt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.xt(n);else if(n<2048)this.xt(960|n>>>6),this.xt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.xt(480|n>>>12),this.xt(128|63&n>>>6),this.xt(128|63&n);else{let i=e.codePointAt(0);this.xt(240|i>>>18),this.xt(128|63&i>>>12),this.xt(128|63&i>>>6),this.xt(128|63&i)}}this.Ot()}qt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Lt(n);else if(n<2048)this.Lt(960|n>>>6),this.Lt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Lt(480|n>>>12),this.Lt(128|63&n>>>6),this.Lt(128|63&n);else{let i=e.codePointAt(0);this.Lt(240|i>>>18),this.Lt(128|63&i>>>12),this.Lt(128|63&i>>>6),this.Lt(128|63&i)}}this.Bt()}Qt(t){let e=this.Kt(t),n=mh(e);this.$t(1+n),this.buffer[this.position++]=255&n;for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=255&e[i]}Ut(t){let e=this.Kt(t),n=mh(e);this.$t(1+n),this.buffer[this.position++]=~(255&n);for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}Wt(){this.Gt(255),this.Gt(255)}zt(){this.jt(255),this.jt(255)}reset(){this.position=0}seed(t){this.$t(t.length),this.buffer.set(t,this.position),this.position+=t.length}Ht(){return this.buffer.slice(0,this.position)}Kt(t){let e=function(s){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(t),n=(128&e[0])!=0;e[0]^=n?255:128;for(let i=1;i<e.length;++i)e[i]^=n?255:0;return e}xt(t){let e=255&t;e===0?(this.Gt(0),this.Gt(255)):e===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Lt(t){let e=255&t;e===0?(this.jt(0),this.jt(255)):e===255?(this.jt(255),this.jt(0)):this.jt(t)}Ot(){this.Gt(0),this.Gt(1)}Bt(){this.jt(0),this.jt(1)}Gt(t){this.$t(1),this.buffer[this.position++]=t}jt(t){this.$t(1),this.buffer[this.position++]=~t}$t(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},xa=class{constructor(t){this.Jt=t}wt(t){this.Jt.Mt(t)}ft(t){this.Jt.kt(t)}Vt(t){this.Jt.Qt(t)}At(){this.Jt.Wt()}},Ca=class{constructor(t){this.Jt=t}wt(t){this.Jt.Nt(t)}ft(t){this.Jt.qt(t)}Vt(t){this.Jt.Ut(t)}At(){this.Jt.zt()}},Je=class{constructor(){this.Jt=new Va,this.Yt=new xa(this.Jt),this.Zt=new Ca(this.Jt)}seed(t){this.Jt.seed(t)}Xt(t){return t===0?this.Yt:this.Zt}Ht(){return this.Jt.Ht()}reset(){this.Jt.reset()}};var Xe=class r{constructor(t,e,n,i){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=i}en(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function ve(r,t){let e=r.indexId-t.indexId;return e!==0?e:(e=gh(r.arrayValue,t.arrayValue),e!==0?e:(e=gh(r.directionalValue,t.directionalValue),e!==0?e:L.comparator(r.documentKey,t.documentKey)))}function gh(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}var fs=class{constructor(t){this.tn=new nt((e,n)=>wt.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.nn=t.orderBy,this.rn=[];for(let e of t.filters){let n=e;n.isInequality()?this.tn=this.tn.add(n):this.rn.push(n)}}get sn(){return this.tn.size>1}on(t){if(q(t.collectionGroup===this.collectionId),this.sn)return!1;let e=Yo(t);if(e!==void 0&&!this._n(e))return!1;let n=Qe(t),i=new Set,s=0,a=0;for(;s<n.length&&this._n(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.tn.size>0){let u=this.tn.getIterator().getNext();if(!i.has(u.field.canonicalString())){let c=n[s];if(!this.an(u,c)||!this.un(this.nn[a++],c))return!1}++s}for(;s<n.length;++s){let u=n[s];if(a>=this.nn.length||!this.un(this.nn[a++],u))return!1}return!0}cn(){if(this.sn)return null;let t=new nt(wt.comparator),e=[];for(let n of this.rn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new ae(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new ae(n.field,0))}for(let n of this.nn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new ae(n.field,n.dir==="asc"?0:1)));return new be(be.UNKNOWN_ID,this.collectionId,e,Cn.empty())}_n(t){for(let e of this.rn)if(this.an(e,t))return!0;return!1}an(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}un(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function Gd(r){var t,e;if(q(r instanceof H||r instanceof tt),r instanceof H){if(r instanceof es){let i=((e=(t=r.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>H.create(r.field,"==",s)))||[];return tt.create(i,"or")}return r}let n=r.filters.map(i=>Gd(i));return tt.create(n,r.op)}function mg(r){if(r.getFilters().length===0)return[];let t=ka(Gd(r));return q(zd(t)),Da(t)||Na(t)?[t]:t.getFilters()}function Da(r){return r instanceof H}function Na(r){return r instanceof tt&&Zu(r)}function zd(r){return Da(r)||Na(r)||function(e){if(e instanceof tt&&oa(e)){for(let n of e.getFilters())if(!Da(n)&&!Na(n))return!1;return!0}return!1}(r)}function ka(r){if(q(r instanceof H||r instanceof tt),r instanceof H)return r;if(r.filters.length===1)return ka(r.filters[0]);let t=r.filters.map(n=>ka(n)),e=tt.create(t,r.op);return e=ms(e),zd(e)?e:(q(e instanceof tt),q(kn(e)),q(e.filters.length>1),e.filters.reduce((n,i)=>sc(n,i)))}function sc(r,t){let e;return q(r instanceof H||r instanceof tt),q(t instanceof H||t instanceof tt),e=r instanceof H?t instanceof H?function(i,s){return tt.create([i,s],"and")}(r,t):ph(r,t):t instanceof H?ph(t,r):function(i,s){if(q(i.filters.length>0&&s.filters.length>0),kn(i)&&kn(s))return od(i,s.getFilters());let a=oa(i)?i:s,u=oa(i)?s:i,c=a.filters.map(d=>sc(d,u));return tt.create(c,"or")}(r,t),ms(e)}function ph(r,t){if(kn(t))return od(t,r.getFilters());{let e=t.filters.map(n=>sc(r,n));return tt.create(e,"or")}}function ms(r){if(q(r instanceof H||r instanceof tt),r instanceof H)return r;let t=r.getFilters();if(t.length===1)return ms(t[0]);if(id(r))return r;let e=t.map(i=>ms(i)),n=[];return e.forEach(i=>{i instanceof H?n.push(i):i instanceof tt&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:tt.create(n,r.op)}var Fa=class{constructor(){this.ln=new Hr}addToCollectionParentIndex(t,e){return this.ln.add(e),S.resolve()}getCollectionParents(t,e){return S.resolve(this.ln.getEntries(e))}addFieldIndex(t,e){return S.resolve()}deleteFieldIndex(t,e){return S.resolve()}deleteAllFieldIndexes(t){return S.resolve()}createTargetIndexes(t,e){return S.resolve()}getDocumentsMatchingTarget(t,e){return S.resolve(null)}getIndexType(t,e){return S.resolve(0)}getFieldIndexes(t,e){return S.resolve([])}getNextCollectionGroupToUpdate(t){return S.resolve(null)}getMinOffset(t,e){return S.resolve(Bt.min())}getMinOffsetFromCollectionGroup(t,e){return S.resolve(Bt.min())}updateCollectionGroup(t,e,n){return S.resolve()}updateIndexEntries(t,e){return S.resolve()}},Hr=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new nt(X.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new nt(X.comparator)).toArray()}};var Fi=new Uint8Array(0),Ma=class{constructor(t,e){this.databaseId=e,this.hn=new Hr,this.Pn=new jt(n=>nn(n),(n,i)=>ci(n,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.hn.has(e)){let n=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this.hn.add(e)});let s={collectionId:n,parent:Ct(i)};return _h(t).put(s)}return S.resolve()}getCollectionParents(t,e){let n=[],i=IDBKeyRange.bound([e,""],[zh(e),""],!1,!0);return _h(t).U(i).next(s=>{for(let a of s){if(a.collectionId!==e)break;n.push(Qt(a.parent))}return n})}addFieldIndex(t,e){let n=br(t),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(e);delete i.indexId;let s=n.add(i);if(e.indexState){let a=vn(t);return s.next(u=>{a.put(hh(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let n=br(t),i=vn(t),s=wn(t);return n.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=br(t),n=wn(t),i=vn(t);return e.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(t,e){return S.forEach(this.Tn(e),n=>this.getIndexType(t,n).next(i=>{if(i===0||i===1){let s=new fs(n).cn();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let n=wn(t),i=!0,s=new Map;return S.forEach(this.Tn(e),a=>this.In(t,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=K(),u=[];return S.forEach(s,(c,d)=>{D("IndexedDbIndexManager",`Using index ${function(U){return`id=${U.indexId}|cg=${U.collectionGroup}|f=${U.fields.map(Q=>`${Q.fieldPath}:${Q.kind}`).join(",")}`}(c)} to execute ${nn(e)}`);let f=function(U,Q){let Z=Yo(Q);if(Z===void 0)return null;for(let $ of rs(U,Z.fieldPath))switch($.op){case"array-contains-any":return $.value.arrayValue.values||[];case"array-contains":return[$.value]}return null}(d,c),g=function(U,Q){let Z=new Map;for(let $ of Qe(Q))for(let v of rs(U,$.fieldPath))switch(v.op){case"==":case"in":Z.set($.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return Z.set($.fieldPath.canonicalString(),v.value),Array.from(Z.values())}return null}(d,c),_=function(U,Q){let Z=[],$=!0;for(let v of Qe(Q)){let p=v.kind===0?Yl(U,v.fieldPath,U.startAt):Zl(U,v.fieldPath,U.startAt);Z.push(p.value),$&&($=p.inclusive)}return new Zt(Z,$)}(d,c),R=function(U,Q){let Z=[],$=!0;for(let v of Qe(Q)){let p=v.kind===0?Zl(U,v.fieldPath,U.endAt):Yl(U,v.fieldPath,U.endAt);Z.push(p.value),$&&($=p.inclusive)}return new Zt(Z,$)}(d,c),N=this.En(c,d,_),k=this.En(c,d,R),x=this.dn(c,d,g),G=this.An(c.indexId,f,N,_.inclusive,k,R.inclusive,x);return S.forEach(G,z=>n.G(z,e.limit).next(U=>{U.forEach(Q=>{let Z=L.fromSegments(Q.documentKey);a.has(Z)||(a=a.add(Z),u.push(Z))})}))}).next(()=>u)}return S.resolve(null)})}Tn(t){let e=this.Pn.get(t);return e||(t.filters.length===0?e=[t]:e=mg(tt.create(t.filters,"and")).map(n=>ga(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.Pn.set(t,e),e)}An(t,e,n,i,s,a,u){let c=(e!=null?e.length:1)*Math.max(n.length,s.length),d=c/(e!=null?e.length:1),f=[];for(let g=0;g<c;++g){let _=e?this.Rn(e[g/d]):Fi,R=this.Vn(t,_,n[g%d],i),N=this.mn(t,_,s[g%d],a),k=u.map(x=>this.Vn(t,_,x,!0));f.push(...this.createRange(R,N,k))}return f}Vn(t,e,n,i){let s=new Xe(t,L.empty(),e,n);return i?s:s.en()}mn(t,e,n,i){let s=new Xe(t,L.empty(),e,n);return i?s.en():s}In(t,e){let n=new fs(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let a=null;for(let u of s)n.on(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(t,e){let n=2,i=this.Tn(e);return S.forEach(i,s=>this.In(t,s).next(a=>{a?n!==0&&a.fields.length<function(c){let d=new nt(wt.comparator),f=!1;for(let g of c.filters)for(let _ of g.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:d=d.add(_.field));for(let g of c.orderBy)g.field.isKeyField()||(d=d.add(g.field));return d.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&i.length>1&&n===2?1:n)}fn(t,e){let n=new Je;for(let i of Qe(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let a=n.Xt(i.kind);se.Ft.Et(s,a)}return n.Ht()}Rn(t){let e=new Je;return se.Ft.Et(t,e.Xt(0)),e.Ht()}gn(t,e){let n=new Je;return se.Ft.Et(tn(this.databaseId,e),n.Xt(function(s){let a=Qe(s);return a.length===0?0:a[a.length-1].kind}(t))),n.Ht()}dn(t,e,n){if(n===null)return[];let i=[];i.push(new Je);let s=0;for(let a of Qe(t)){let u=n[s++];for(let c of i)if(this.pn(e,a.fieldPath)&&Br(u))i=this.yn(i,a,u);else{let d=c.Xt(a.kind);se.Ft.Et(u,d)}}return this.wn(i)}En(t,e,n){return this.dn(t,e,n.position)}wn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Ht();return e}yn(t,e,n){let i=[...t],s=[];for(let a of n.arrayValue.values||[])for(let u of i){let c=new Je;c.seed(u.Ht()),se.Ft.Et(a,c.Xt(e.kind)),s.push(c)}return s}pn(t,e){return!!t.filters.find(n=>n instanceof H&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=br(t),i=vn(t);return(e?n.U("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.U()).next(s=>{let a=[];return S.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,g){let _=g?new Cn(g.sequenceNumber,new Bt(on(g.readTime),new L(Qt(g.documentKey)),g.largestBatchId)):Cn.empty(),R=f.fields.map(([N,k])=>new ae(wt.fromServerFormat(N),k));return new be(f.indexId,f.collectionGroup,R,_)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:j(n.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let i=br(t),s=vn(t);return this.Sn(t).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(u=>S.forEach(u,c=>s.put(hh(c.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return S.forEach(e,(i,s)=>{let a=n.get(i.collectionGroup);return(a?S.resolve(a):this.getFieldIndexes(t,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),S.forEach(u,c=>this.bn(t,i,c).next(d=>{let f=this.Dn(s,c);return d.isEqual(f)?S.resolve():this.vn(t,s,c,d,f)}))))})}Cn(t,e,n,i){return wn(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.gn(n,e.key),documentKey:e.key.path.toArray()})}Fn(t,e,n,i){return wn(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.gn(n,e.key),e.key.path.toArray()])}bn(t,e,n){let i=wn(t),s=new nt(ve);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,e)])},(a,u)=>{s=s.add(new Xe(n.indexId,e,u.arrayValue,u.directionalValue))}).next(()=>s)}Dn(t,e){let n=new nt(ve),i=this.fn(e,t);if(i==null)return n;let s=Yo(e);if(s!=null){let a=t.data.field(s.fieldPath);if(Br(a))for(let u of a.arrayValue.values||[])n=n.add(new Xe(e.indexId,t.key,this.Rn(u),i))}else n=n.add(new Xe(e.indexId,t.key,Fi,i));return n}vn(t,e,n,i,s){D("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let a=[];return function(c,d,f,g,_){let R=c.getIterator(),N=d.getIterator(),k=yn(R),x=yn(N);for(;k||x;){let G=!1,z=!1;if(k&&x){let U=f(k,x);U<0?z=!0:U>0&&(G=!0)}else k!=null?z=!0:G=!0;G?(g(x),x=yn(N)):z?(_(k),k=yn(R)):(k=yn(R),x=yn(N))}}(i,s,ve,u=>{a.push(this.Cn(t,e,n,u))},u=>{a.push(this.Fn(t,e,n,u))}),S.waitFor(a)}Sn(t){let e=1;return vn(t).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,u)=>ve(a,u)).filter((a,u,c)=>!u||ve(a,c[u-1])!==0);let i=[];i.push(t);for(let a of n){let u=ve(a,t),c=ve(a,e);if(u===0)i[0]=t.en();else if(u>0&&c<0)i.push(a),i.push(a.en());else if(c>0)break}i.push(e);let s=[];for(let a=0;a<i.length;a+=2){if(this.Mn(i[a],i[a+1]))return[];let u=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Fi,[]],c=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Fi,[]];s.push(IDBKeyRange.bound(u,c))}return s}Mn(t,e){return ve(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(yh)}getMinOffset(t,e){return S.mapArray(this.Tn(e),n=>this.In(t,n).next(i=>i||O())).next(yh)}};function _h(r){return It(r,"collectionParents")}function wn(r){return It(r,"indexEntries")}function br(r){return It(r,"indexConfiguration")}function vn(r){return It(r,"indexState")}function yh(r){q(r.length!==0);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;Ju(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new Bt(t.readTime,t.documentKey,e)}var wh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ft=class r{static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}};function jd(r,t,e){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(e.batchId),u=0,c=n.J({range:a},(f,g,_)=>(u++,_.delete()));s.push(c.next(()=>{q(u===1)}));let d=[];for(let f of e.mutations){let g=Hh(t,f.key.path,e.batchId);s.push(i.delete(g)),d.push(f.key)}return S.waitFor(s).next(()=>d)}function gs(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw O();t=r.noDocument}return JSON.stringify(t).length}Ft.DEFAULT_COLLECTION_PERCENTILE=10,Ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ft.DEFAULT=new Ft(41943040,Ft.DEFAULT_COLLECTION_PERCENTILE,Ft.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ft.DISABLED=new Ft(-1,0,0);var ps=class r{constructor(t,e,n,i){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=i,this.xn={}}static Pt(t,e,n,i){q(t.uid!=="");let s=t.isAuthenticated()?t.uid:"";return new r(s,e,n,i)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Te(t).J({index:"userMutationsIndex",range:n},(i,s,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,i){let s=Sn(t),a=Te(t);return a.add({}).next(u=>{q(typeof u=="number");let c=new zr(u,e,n,i),d=function(R,N,k){let x=k.baseMutations.map(z=>Wr(R.ht,z)),G=k.mutations.map(z=>Wr(R.ht,z));return{userId:N,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:x,mutations:G}}(this.serializer,this.userId,c),f=[],g=new nt((_,R)=>j(_.canonicalString(),R.canonicalString()));for(let _ of i){let R=Hh(this.userId,_.key.path,u);g=g.add(_.key.path.popLast()),f.push(a.put(d)),f.push(s.put(R,Tm))}return g.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(t,_))}),t.addOnCommittedListener(()=>{this.xn[u]=c.keys()}),S.waitFor(f).next(()=>c)})}lookupMutationBatch(t,e){return Te(t).get(e).next(n=>n?(q(n.userId===this.userId),He(this.serializer,n)):null)}On(t,e){return this.xn[e]?S.resolve(this.xn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let i=n.keys();return this.xn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return Te(t).J({index:"userMutationsIndex",range:i},(a,u,c)=>{u.userId===this.userId&&(q(u.batchId>=n),s=He(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Te(t).J({index:"userMutationsIndex",range:e,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Te(t).U("userMutationsIndex",e).next(n=>n.map(i=>He(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=Ui(this.userId,e.path),i=IDBKeyRange.lowerBound(n),s=[];return Sn(t).J({range:i},(a,u,c)=>{let[d,f,g]=a,_=Qt(f);if(d===this.userId&&e.path.isEqual(_))return Te(t).get(g).next(R=>{if(!R)throw O();q(R.userId===this.userId),s.push(He(this.serializer,R))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new nt(j),i=[];return e.forEach(s=>{let a=Ui(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=Sn(t).J({range:u},(d,f,g)=>{let[_,R,N]=d,k=Qt(R);_===this.userId&&s.path.isEqual(k)?n=n.add(N):g.done()});i.push(c)}),S.waitFor(i).next(()=>this.Nn(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=Ui(this.userId,n),a=IDBKeyRange.lowerBound(s),u=new nt(j);return Sn(t).J({range:a},(c,d,f)=>{let[g,_,R]=c,N=Qt(_);g===this.userId&&n.isPrefixOf(N)?N.length===i&&(u=u.add(R)):f.done()}).next(()=>this.Nn(t,u))}Nn(t,e){let n=[],i=[];return e.forEach(s=>{i.push(Te(t).get(s).next(a=>{if(a===null)throw O();q(a.userId===this.userId),n.push(He(this.serializer,a))}))}),S.waitFor(i).next(()=>n)}removeMutationBatch(t,e){return jd(t._e,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.Ln(e.batchId)}),S.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}Ln(t){delete this.xn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return S.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return Sn(t).J({range:n},(s,a,u)=>{if(s[0]===this.userId){let c=Qt(s[1]);i.push(c)}else u.done()}).next(()=>{q(i.length===0)})})}containsKey(t,e){return Kd(t,this.userId,e)}Bn(t){return $d(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function Kd(r,t,e){let n=Ui(t,e.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return Sn(r).J({range:s,H:!0},(u,c,d)=>{let[f,g,_]=u;f===t&&g===i&&(a=!0),d.done()}).next(()=>a)}function Te(r){return It(r,"mutations")}function Sn(r){return It(r,"documentMutations")}function $d(r){return It(r,"mutationQueues")}var qn=class r{constructor(t){this.kn=t}next(){return this.kn+=2,this.kn}static qn(){return new r(0)}static Qn(){return new r(-1)}};var La=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.Kn(t).next(e=>{let n=new qn(e.highestTargetId);return e.highestTargetId=n.next(),this.$n(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Kn(t).next(e=>B.fromTimestamp(new ht(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Kn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.Kn(t).next(i=>(i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.$n(t,i)))}addTargetData(t,e){return this.Un(t,e).next(()=>this.Kn(t).next(n=>(n.targetCount+=1,this.Wn(e,n),this.$n(t,n))))}updateTargetData(t,e){return this.Un(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Tn(t).delete(e.targetId)).next(()=>this.Kn(t)).next(n=>(q(n.targetCount>0),n.targetCount-=1,this.$n(t,n)))}removeTargets(t,e,n){let i=0,s=[];return Tn(t).J((a,u)=>{let c=Cr(u);c.sequenceNumber<=e&&n.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(t,c)))}).next(()=>S.waitFor(s)).next(()=>i)}forEachTarget(t,e){return Tn(t).J((n,i)=>{let s=Cr(i);e(s)})}Kn(t){return vh(t).get("targetGlobalKey").next(e=>(q(e!==null),e))}$n(t,e){return vh(t).put("targetGlobalKey",e)}Un(t,e){return Tn(t).put(Bd(this.serializer,e))}Wn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Kn(t).next(e=>e.targetCount)}getTargetData(t,e){let n=nn(e),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return Tn(t).J({range:i,index:"queryTargetsIndex"},(a,u,c)=>{let d=Cr(u);ci(e,d.target)&&(s=d,c.done())}).next(()=>s)}addMatchingKeys(t,e,n){let i=[],s=Ee(t);return e.forEach(a=>{let u=Ct(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(t,n,a))}),S.waitFor(i)}removeMatchingKeys(t,e,n){let i=Ee(t);return S.forEach(e,s=>{let a=Ct(s.path);return S.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(t,n,s)])})}removeMatchingKeysForTargetId(t,e){let n=Ee(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),i=Ee(t),s=K();return i.J({range:n,H:!0},(a,u,c)=>{let d=Qt(a[1]),f=new L(d);s=s.add(f)}).next(()=>s)}containsKey(t,e){let n=Ct(e.path),i=IDBKeyRange.bound([n],[zh(n)],!1,!0),s=0;return Ee(t).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],c,d)=>{a!==0&&(s++,d.done())}).next(()=>s>0)}ut(t,e){return Tn(t).get(e).next(n=>n?Cr(n):null)}};function Tn(r){return It(r,"targets")}function vh(r){return It(r,"targetGlobal")}function Ee(r){return It(r,"targetDocuments")}function Th([r,t],[e,n]){let i=j(r,e);return i===0?j(t,n):i}var Oa=class{constructor(t){this.Gn=t,this.buffer=new nt(Th),this.zn=0}jn(){return++this.zn}Hn(t){let e=[t,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();Th(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},_s=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return this.Jn!==null}Yn(t){D("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>V(this,null,function*(){this.Jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){qe(e)?D("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield Oe(e)}yield this.Yn(3e5)}))}},qa=class{constructor(t,e){this.Zn=t,this.params=e}calculateTargetCount(t,e){return this.Zn.Xn(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return S.resolve(Ot.oe);let n=new Oa(e);return this.Zn.forEachTarget(t,i=>n.Hn(i.sequenceNumber)).next(()=>this.Zn.er(t,i=>n.Hn(i))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.Zn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Zn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(wh)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),wh):this.tr(t,e))}getCacheSize(t){return this.Zn.getCacheSize(t)}tr(t,e){let n,i,s,a,u,c,d,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(t,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(t,n,e))).next(g=>(s=g,c=Date.now(),this.removeOrphanedDocuments(t,n))).next(g=>(d=Date.now(),In()<=$t.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(c-u)+`ms
	Removed ${g} documents in `+(d-c)+`ms
Total Duration: ${d-f}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}};function Qd(r,t){return new qa(r,t)}var Ua=class{constructor(t,e){this.db=t,this.garbageCollector=Qd(this,e)}Xn(t){let e=this.nr(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}nr(t){let e=0;return this.er(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}er(t,e){return this.rr(t,(n,i)=>e(i))}addReference(t,e,n){return Mi(t,n)}removeReference(t,e,n){return Mi(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Mi(t,e)}ir(t,e){return function(i,s){let a=!1;return $d(i).Y(u=>Kd(i,u,s).next(c=>(c&&(a=!0),S.resolve(!c)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.rr(t,(a,u)=>{if(u<=e){let c=this.ir(t,a).next(d=>{if(!d)return s++,n.getEntry(t,a).next(()=>(n.removeEntry(a,B.min()),Ee(t).delete(function(g){return[0,Ct(g.path)]}(a))))});i.push(c)}}).next(()=>S.waitFor(i)).next(()=>n.apply(t)).next(()=>s)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Mi(t,e)}rr(t,e){let n=Ee(t),i,s=Ot.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:c,sequenceNumber:d})=>{a===0?(s!==Ot.oe&&e(new L(Qt(i)),s),s=d,i=c):s=Ot.oe}).next(()=>{s!==Ot.oe&&e(new L(Qt(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Mi(r,t){return Ee(r).put(function(n,i){return{targetId:0,path:Ct(n.path),sequenceNumber:i}}(t,r.currentSequenceNumber))}var ys=class{constructor(){this.changes=new jt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,vt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?S.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Ba=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return $e(t).put(n)}removeEntry(t,e,n){return $e(t).delete(function(s,a){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],hs(a),u[u.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.sr(t,n)))}getEntry(t,e){let n=vt.newInvalidDocument(e);return $e(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(Pr(e))},(i,s)=>{n=this._r(e,s)}).next(()=>n)}ar(t,e){let n={size:0,document:vt.newInvalidDocument(e)};return $e(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(Pr(e))},(i,s)=>{n={document:this._r(e,s),size:gs(s)}}).next(()=>n)}getEntries(t,e){let n=Mt();return this.ur(t,e,(i,s)=>{let a=this._r(i,s);n=n.insert(i,a)}).next(()=>n)}cr(t,e){let n=Mt(),i=new st(L.comparator);return this.ur(t,e,(s,a)=>{let u=this._r(s,a);n=n.insert(s,u),i=i.insert(s,gs(a))}).next(()=>({documents:n,lr:i}))}ur(t,e,n){if(e.isEmpty())return S.resolve();let i=new nt(Ah);e.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(Pr(i.first()),Pr(i.last())),a=i.getIterator(),u=a.getNext();return $e(t).J({index:"documentKeyIndex",range:s},(c,d,f)=>{let g=L.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&Ah(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.$(Pr(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,i,s){let a=e.path,u=[a.popLast().toArray(),a.lastSegment(),hs(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return $e(t).U(IDBKeyRange.bound(u,c,!0)).next(d=>{s?.incrementDocumentReadCount(d.length);let f=Mt();for(let g of d){let _=this._r(L.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);_.isFoundDocument()&&(hi(e,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(t,e,n,i){let s=Mt(),a=Eh(e,n),u=Eh(e,Bt.max());return $e(t).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(c,d,f)=>{let g=this._r(L.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(t){return new Ga(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Ih(t).get("remoteDocumentGlobalKey").next(e=>(q(!!e),e))}sr(t,e){return Ih(t).put("remoteDocumentGlobalKey",e)}_r(t,e){if(e){let n=dg(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(B.min())))return n}return vt.newInvalidDocument(t)}};function Wd(r){return new Ba(r)}var Ga=class extends ys{constructor(t,e){super(),this.hr=t,this.trackRemovals=e,this.Pr=new jt(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(t){let e=[],n=0,i=new nt((s,a)=>j(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let u=this.Pr.get(s);if(e.push(this.hr.removeEntry(t,s,u.readTime)),a.isValidDocument()){let c=ch(this.hr.serializer,a);i=i.add(s.path.popLast());let d=gs(c);n+=d-u.size,e.push(this.hr.addEntry(t,s,c))}else if(n-=u.size,this.trackRemovals){let c=ch(this.hr.serializer,a.convertToNoDocument(B.min()));e.push(this.hr.addEntry(t,s,c))}}),i.forEach(s=>{e.push(this.hr.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.hr.updateMetadata(t,n)),S.waitFor(e)}getFromCache(t,e){return this.hr.ar(t,e).next(n=>(this.Pr.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.hr.cr(t,e).next(({documents:n,lr:i})=>(i.forEach((s,a)=>{this.Pr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}};function Ih(r){return It(r,"remoteDocumentGlobal")}function $e(r){return It(r,"remoteDocumentsV14")}function Pr(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Eh(r,t){let e=t.documentKey.path.toArray();return[r,hs(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Ah(r,t){let e=r.path.toArray(),n=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<n.length-2;++s)if(i=j(e[s],n[s]),i)return i;return i=j(e.length,n.length),i||(i=j(e[e.length-2],n[n.length-2]),i||j(e[e.length-1],n[n.length-1]))}var za=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var ws=class{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(n=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(n!==null&&kr(n.mutation,i,qt.empty(),ht.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,K()).next(()=>n))}getLocalViewOfDocuments(t,e,n=K()){let i=Wt();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,n).next(s=>{let a=xr();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=Wt();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,K()))}populateOverlays(t,e,n){let i=[];return n.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,i){let s=Mt(),a=Nr(),u=function(){return Nr()}();return e.forEach((c,d)=>{let f=n.get(d.key);i.has(d.key)&&(f===void 0||f.mutation instanceof Kt)?s=s.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),kr(f.mutation,d,f.mutation.getFieldMask(),ht.now())):a.set(d.key,qt.empty())}),this.recalculateAndSaveOverlays(t,s).next(c=>(c.forEach((d,f)=>a.set(d,f)),e.forEach((d,f)=>{var g;return u.set(d,new za(f,(g=a.get(d))!==null&&g!==void 0?g:null))}),u))}recalculateAndSaveOverlays(t,e){let n=Nr(),i=new st((a,u)=>a-u),s=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let u of a)u.keys().forEach(c=>{let d=e.get(c);if(d===null)return;let f=n.get(c)||qt.empty();f=u.applyToLocalView(d,f),n.set(c,f);let g=(i.get(u.batchId)||K()).add(c);i=i.insert(u.batchId,g)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),d=c.key,f=c.value,g=_d();f.forEach(_=>{if(!s.has(_)){let R=Ad(e.get(_),n.get(_));R!==null&&g.set(_,R),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,g))}return S.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,i){return function(a){return L.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):tc(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):S.resolve(Wt()),u=-1,c=s;return a.next(d=>S.forEach(d,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?S.resolve():this.remoteDocumentCache.getEntry(t,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(t,d,s)).next(()=>this.computeViews(t,c,d,K())).next(f=>({batchId:u,changes:pd(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new L(e)).next(n=>{let i=xr();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){let s=e.collectionGroup,a=xr();return this.indexManager.getCollectionParents(t,s).next(u=>S.forEach(u,c=>{let d=function(g,_){return new zt(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(e,c.child(s));return this.getDocumentsMatchingCollectionQuery(t,d,n,i).next(f=>{f.forEach((g,_)=>{a=a.insert(g,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,i))).next(a=>{s.forEach((c,d)=>{let f=d.getKey();a.get(f)===null&&(a=a.insert(f,vt.newInvalidDocument(f)))});let u=xr();return a.forEach((c,d)=>{let f=s.get(c);f!==void 0&&kr(f.mutation,d,qt.empty(),ht.now()),hi(e,d)&&(u=u.insert(c,d))}),u})}};var ja=class{constructor(t){this.serializer=t,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(t,e){return S.resolve(this.Tr.get(e))}saveBundleMetadata(t,e){return this.Tr.set(e.id,function(i){return{id:i.id,version:i.version,createTime:dt(i.createTime)}}(e)),S.resolve()}getNamedQuery(t,e){return S.resolve(this.Ir.get(e))}saveNamedQuery(t,e){return this.Ir.set(e.name,function(i){return{name:i.name,query:ic(i.bundledQuery),readTime:dt(i.readTime)}}(e)),S.resolve()}};var Ka=class{constructor(){this.overlays=new st(L.comparator),this.Er=new Map}getOverlay(t,e){return S.resolve(this.overlays.get(e))}getOverlays(t,e){let n=Wt();return S.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((i,s)=>{this.Tt(t,e,s)}),S.resolve()}removeOverlaysForBatchId(t,e,n){let i=this.Er.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Er.delete(n)),S.resolve()}getOverlaysForCollection(t,e,n){let i=Wt(),s=e.length+1,a=new L(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let c=u.getNext().value,d=c.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return S.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new st((d,f)=>d-f),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let f=s.get(d.largestBatchId);f===null&&(f=Wt(),s=s.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}let u=Wt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,f)=>u.set(d,f)),!(u.size()>=i)););return S.resolve(u)}Tt(t,e,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.Er.get(i.largestBatchId).delete(n.key);this.Er.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new jr(e,n));let s=this.Er.get(e);s===void 0&&(s=K(),this.Er.set(e,s)),this.Er.set(e,s.add(n.key))}};var $a=class{constructor(){this.sessionToken=mt.EMPTY_BYTE_STRING}getSessionToken(t){return S.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,S.resolve()}};var Jr=class{constructor(){this.dr=new nt(pt.Ar),this.Rr=new nt(pt.Vr)}isEmpty(){return this.dr.isEmpty()}addReference(t,e){let n=new pt(t,e);this.dr=this.dr.add(n),this.Rr=this.Rr.add(n)}mr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.gr(new pt(t,e))}pr(t,e){t.forEach(n=>this.removeReference(n,e))}yr(t){let e=new L(new X([])),n=new pt(e,t),i=new pt(e,t+1),s=[];return this.Rr.forEachInRange([n,i],a=>{this.gr(a),s.push(a.key)}),s}wr(){this.dr.forEach(t=>this.gr(t))}gr(t){this.dr=this.dr.delete(t),this.Rr=this.Rr.delete(t)}Sr(t){let e=new L(new X([])),n=new pt(e,t),i=new pt(e,t+1),s=K();return this.Rr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(t){let e=new pt(t,0),n=this.dr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},pt=class{constructor(t,e){this.key=t,this.br=e}static Ar(t,e){return L.comparator(t.key,e.key)||j(t.br,e.br)}static Vr(t,e){return j(t.br,e.br)||L.comparator(t.key,e.key)}};var Qa=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Dr=1,this.vr=new nt(pt.Ar)}checkEmpty(t){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,i){let s=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new zr(s,e,n,i);this.mutationQueue.push(a);for(let u of i)this.vr=this.vr.add(new pt(u.key,s)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return S.resolve(a)}lookupMutationBatch(t,e){return S.resolve(this.Cr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=this.Fr(n),s=i<0?0:i;return S.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?-1:this.Dr-1)}getAllMutationBatches(t){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new pt(e,0),i=new pt(e,Number.POSITIVE_INFINITY),s=[];return this.vr.forEachInRange([n,i],a=>{let u=this.Cr(a.br);s.push(u)}),S.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new nt(j);return e.forEach(i=>{let s=new pt(i,0),a=new pt(i,Number.POSITIVE_INFINITY);this.vr.forEachInRange([s,a],u=>{n=n.add(u.br)})}),S.resolve(this.Mr(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=n;L.isDocumentKey(s)||(s=s.child(""));let a=new pt(new L(s),0),u=new nt(j);return this.vr.forEachWhile(c=>{let d=c.key.path;return!!n.isPrefixOf(d)&&(d.length===i&&(u=u.add(c.br)),!0)},a),S.resolve(this.Mr(u))}Mr(t){let e=[];return t.forEach(n=>{let i=this.Cr(n);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){q(this.Or(e.batchId,"removed")===0),this.mutationQueue.shift();let n=this.vr;return S.forEach(e.mutations,i=>{let s=new pt(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.vr=n})}Ln(t){}containsKey(t,e){let n=new pt(e,0),i=this.vr.firstAfterOrEqual(n);return S.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,S.resolve()}Or(t,e){return this.Fr(t)}Fr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Cr(t){let e=this.Fr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Wa=class{constructor(t){this.Nr=t,this.docs=function(){return new st(L.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,i=this.docs.get(n),s=i?i.size:0,a=this.Nr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return S.resolve(n?n.document.mutableCopy():vt.newInvalidDocument(e))}getEntries(t,e){let n=Mt();return e.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():vt.newInvalidDocument(i))}),S.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=Mt(),a=e.path,u=new L(a.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:d,value:{document:f}}=c.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Ju(Kh(f),n)<=0||(i.has(f.key)||hi(e,f))&&(s=s.insert(f.key,f.mutableCopy()))}return S.resolve(s)}getAllFromCollectionGroup(t,e,n,i){O()}Lr(t,e){return S.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new Ha(this)}getSize(t){return S.resolve(this.size)}},Ha=class extends ys{constructor(t){super(),this.hr=t}applyChanges(t){let e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.hr.addEntry(t,i)):this.hr.removeEntry(n)}),S.waitFor(e)}getFromCache(t,e){return this.hr.getEntry(t,e)}getAllFromCache(t,e){return this.hr.getEntries(t,e)}};var Ja=class{constructor(t){this.persistence=t,this.Br=new jt(e=>nn(e),ci),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.kr=0,this.qr=new Jr,this.targetCount=0,this.Qr=qn.qn()}forEachTarget(t,e){return this.Br.forEach((n,i)=>e(i)),S.resolve()}getLastRemoteSnapshotVersion(t){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return S.resolve(this.kr)}allocateTargetId(t){return this.highestTargetId=this.Qr.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.kr&&(this.kr=e),S.resolve()}Un(t){this.Br.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Qr=new qn(e),this.highestTargetId=e),t.sequenceNumber>this.kr&&(this.kr=t.sequenceNumber)}addTargetData(t,e){return this.Un(e),this.targetCount+=1,S.resolve()}updateTargetData(t,e){return this.Un(e),S.resolve()}removeTargetData(t,e){return this.Br.delete(e.target),this.qr.yr(e.targetId),this.targetCount-=1,S.resolve()}removeTargets(t,e,n){let i=0,s=[];return this.Br.forEach((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.Br.delete(a),s.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),S.waitFor(s).next(()=>i)}getTargetCount(t){return S.resolve(this.targetCount)}getTargetData(t,e){let n=this.Br.get(e)||null;return S.resolve(n)}addMatchingKeys(t,e,n){return this.qr.mr(e,n),S.resolve()}removeMatchingKeys(t,e,n){this.qr.pr(e,n);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(a=>{s.push(i.markPotentiallyOrphaned(t,a))}),S.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.qr.yr(e),S.resolve()}getMatchingKeysForTargetId(t,e){let n=this.qr.Sr(e);return S.resolve(n)}containsKey(t,e){return S.resolve(this.qr.containsKey(e))}};var Xr=class{constructor(t,e){this.Kr={},this.overlays={},this.$r=new Ot(0),this.Ur=!1,this.Ur=!0,this.Wr=new $a,this.referenceDelegate=t(this),this.Gr=new Ja(this),this.indexManager=new Fa,this.remoteDocumentCache=function(i){return new Wa(i)}(n=>this.referenceDelegate.zr(n)),this.serializer=new ls(e),this.jr=new ja(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Ka,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Kr[t.toKey()];return n||(n=new Qa(e,this.referenceDelegate),this.Kr[t.toKey()]=n),n}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(t,e,n){D("MemoryPersistence","Starting transaction:",t);let i=new Xa(this.$r.next());return this.referenceDelegate.Hr(),n(i).next(s=>this.referenceDelegate.Jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Yr(t,e){return S.or(Object.values(this.Kr).map(n=>()=>n.containsKey(t,e)))}},Xa=class extends Ji{constructor(t){super(),this.currentSequenceNumber=t}},vs=class r{constructor(t){this.persistence=t,this.Zr=new Jr,this.Xr=null}static ei(t){return new r(t)}get ti(){if(this.Xr)return this.Xr;throw O()}addReference(t,e,n){return this.Zr.addReference(n,e),this.ti.delete(n.toString()),S.resolve()}removeReference(t,e,n){return this.Zr.removeReference(n,e),this.ti.add(n.toString()),S.resolve()}markPotentiallyOrphaned(t,e){return this.ti.add(e.toString()),S.resolve()}removeTarget(t,e){this.Zr.yr(e.targetId).forEach(i=>this.ti.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.ti.add(s.toString()))}).next(()=>n.removeTargetData(t,e))}Hr(){this.Xr=new Set}Jr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.ti,n=>{let i=L.fromPath(n);return this.ni(t,i).next(s=>{s||e.removeEntry(i,B.min())})}).next(()=>(this.Xr=null,e.apply(t)))}updateLimboDocument(t,e){return this.ni(t,e).next(n=>{n?this.ti.delete(e.toString()):this.ti.add(e.toString())})}zr(t){return 0}ni(t,e){return S.or([()=>S.resolve(this.Zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Yr(t,e)])}},Ts=class r{constructor(t,e){this.persistence=t,this.ri=new jt(n=>Ct(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=Qd(this,e)}static ei(t,e){return new r(t,e)}Hr(){}Jr(t){return S.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}Xn(t){let e=this.nr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}nr(t){let e=0;return this.er(t,n=>{e++}).next(()=>e)}er(t,e){return S.forEach(this.ri,(n,i)=>this.ir(t,n,i).next(s=>s?S.resolve():e(i)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.Lr(t,a=>this.ir(t,a,e).next(u=>{u||(n++,s.removeEntry(a,B.min()))})).next(()=>s.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.ri.set(e,t.currentSequenceNumber),S.resolve()}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.ri.set(n,t.currentSequenceNumber),S.resolve()}removeReference(t,e,n){return this.ri.set(n,t.currentSequenceNumber),S.resolve()}updateLimboDocument(t,e){return this.ri.set(e,t.currentSequenceNumber),S.resolve()}zr(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Gi(t.data.value)),e}ir(t,e,n){return S.or([()=>this.persistence.Yr(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let i=this.ri.get(e);return S.resolve(i!==void 0&&i>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var Ya=class{constructor(t){this.serializer=t}O(t,e,n,i){let s=new Xi("createOrUpgrade",e);n<1&&i>=1&&(function(c){c.createObjectStore("owner")}(t),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Gl,{unique:!0}),c.createObjectStore("documentMutations")}(t),Sh(t),function(c){c.createObjectStore("remoteDocuments")}(t));let a=S.resolve();return n<3&&i>=3&&(n!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(t),Sh(t)),a=a.next(()=>function(c){let d=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:B.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(n!==0&&(a=a.next(()=>function(c,d){return d.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Gl,{unique:!0});let g=d.store("mutations"),_=f.map(R=>g.put(R));return S.waitFor(_)})}(t,s))),a=a.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),n<5&&i>=5&&(a=a.next(()=>this.ii(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(t),this.si(s)))),n<7&&i>=7&&(a=a.next(()=>this.oi(s))),n<8&&i>=8&&(a=a.next(()=>this._i(t,s))),n<9&&i>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&i>=10&&(a=a.next(()=>this.ai(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),n<12&&i>=12&&(a=a.next(()=>{(function(c){let d=c.createObjectStore("documentOverlays",{keyPath:Nm});d.createIndex("collectionPathOverlayIndex",km,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",Fm,{unique:!1})})(t)})),n<13&&i>=13&&(a=a.next(()=>function(c){let d=c.createObjectStore("remoteDocumentsV14",{keyPath:Im});d.createIndex("documentKeyIndex",Em),d.createIndex("collectionGroupIndex",Am)}(t)).next(()=>this.ui(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.ci(t,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:Vm}).createIndex("sequenceNumberIndex",xm,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:Cm}).createIndex("documentKeyIndex",Dm,{unique:!1})}(t))),n<16&&i>=16&&(a=a.next(()=>{e.objectStore("indexState").clear()}).next(()=>{e.objectStore("indexEntries").clear()})),n<17&&i>=17&&(a=a.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(t)})),a}si(t){let e=0;return t.store("remoteDocuments").J((n,i)=>{e+=gs(i)}).next(()=>{let n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ii(t){let e=t.store("mutationQueues"),n=t.store("mutations");return e.U().next(i=>S.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>S.forEach(u,c=>{q(c.userId===s.userId);let d=He(this.serializer,c);return jd(t,s.userId,d).next(()=>{})}))}))}oi(t){let e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((a,u)=>{let c=new X(a),d=function(g){return[0,Ct(g)]}(c);s.push(e.get(d).next(f=>f?S.resolve():(g=>e.put({targetId:0,path:Ct(g),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>S.waitFor(s))})}_i(t,e){t.createObjectStore("collectionParents",{keyPath:Pm});let n=e.store("collectionParents"),i=new Hr,s=a=>{if(i.add(a)){let u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:Ct(c)})}};return e.store("remoteDocuments").J({H:!0},(a,u)=>{let c=new X(a);return s(c.popLast())}).next(()=>e.store("documentMutations").J({H:!0},([a,u,c],d)=>{let f=Qt(u);return s(f.popLast())}))}ai(t){let e=t.store("targets");return e.J((n,i)=>{let s=Cr(i),a=Bd(this.serializer,s);return e.put(a)})}ui(t,e){let n=e.store("remoteDocuments"),i=[];return n.J((s,a)=>{let u=e.store("remoteDocumentsV14"),c=function(g){return g.document?new L(X.fromString(g.document.name).popFirst(5)):g.noDocument?L.fromSegments(g.noDocument.path):g.unknownDocument?L.fromSegments(g.unknownDocument.path):O()}(a).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(d))}).next(()=>S.waitFor(i))}ci(t,e){let n=e.store("mutations"),i=Wd(this.serializer),s=new Xr(vs.ei,this.serializer.ht);return n.U().next(a=>{let u=new Map;return a.forEach(c=>{var d;let f=(d=u.get(c.userId))!==null&&d!==void 0?d:K();He(this.serializer,c).keys().forEach(g=>f=f.add(g)),u.set(c.userId,f)}),S.forEach(u,(c,d)=>{let f=new _t(d),g=ds.Pt(this.serializer,f),_=s.getIndexManager(f),R=ps.Pt(f,this.serializer,_,s.referenceDelegate);return new ws(i,R,g,_).recalculateAndSaveOverlaysForDocumentKeys(new Or(e,Ot.oe),c).next()})})}};function Sh(r){r.createObjectStore("targetDocuments",{keyPath:Rm}).createIndex("documentTargetsIndex",bm,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Sm,{unique:!0}),r.createObjectStore("targetGlobal")}var Go="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Za=class r{constructor(t,e,n,i,s,a,u,c,d,f,g=17){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.li=s,this.window=a,this.document=u,this.hi=d,this.Pi=f,this.Ti=g,this.$r=null,this.Ur=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ii=null,this.inForeground=!1,this.Ei=null,this.di=null,this.Ai=Number.NEGATIVE_INFINITY,this.Ri=_=>Promise.resolve(),!r.p())throw new C(b.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ua(this,i),this.Vi=e+"main",this.serializer=new ls(c),this.mi=new Pe(this.Vi,this.Ti,new Ya(this.serializer)),this.Wr=new Pa,this.Gr=new La(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Wd(this.serializer),this.jr=new ba,this.window&&this.window.localStorage?this.fi=this.window.localStorage:(this.fi=null,f===!1&&lt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.gi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(b.FAILED_PRECONDITION,Go);return this.pi(),this.yi(),this.wi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Gr.getHighestSequenceNumber(t))}).then(t=>{this.$r=new Ot(t,this.hi)}).then(()=>{this.Ur=!0}).catch(t=>(this.mi&&this.mi.close(),Promise.reject(t)))}Si(t){return this.Ri=e=>V(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.mi.L(e=>V(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.li.enqueueAndForget(()=>V(this,null,function*(){this.started&&(yield this.gi())})))}gi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Li(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.bi(t).next(e=>{e||(this.isPrimary=!1,this.li.enqueueRetryable(()=>this.Ri(!1)))})}).next(()=>this.Di(t)).next(e=>this.isPrimary&&!e?this.vi(t).next(()=>!1):!!e&&this.Ci(t).next(()=>!0))).catch(t=>{if(qe(t))return D("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return D("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.li.enqueueRetryable(()=>this.Ri(t)),this.isPrimary=t})}bi(t){return Vr(t).get("owner").next(e=>S.resolve(this.Fi(e)))}Mi(t){return Li(t).delete(this.clientId)}xi(){return V(this,null,function*(){if(this.isPrimary&&!this.Oi(this.Ai,18e5)){this.Ai=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=It(e,"clientMetadata");return n.U().next(i=>{let s=this.Ni(i,18e5),a=i.filter(u=>s.indexOf(u)===-1);return S.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.fi)for(let e of t)this.fi.removeItem(this.Li(e.clientId))}})}wi(){this.di=this.li.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.gi().then(()=>this.xi()).then(()=>this.wi()))}Fi(t){return!!t&&t.ownerId===this.clientId}Di(t){return this.Pi?S.resolve(!0):Vr(t).get("owner").next(e=>{if(e!==null&&this.Oi(e.leaseTimestampMs,5e3)&&!this.Bi(e.ownerId)){if(this.Fi(e)&&this.networkEnabled)return!0;if(!this.Fi(e)){if(!e.allowTabSynchronization)throw new C(b.FAILED_PRECONDITION,Go);return!1}}return!(!this.networkEnabled||!this.inForeground)||Li(t).U().next(n=>this.Ni(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&D("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return V(this,null,function*(){this.Ur=!1,this.ki(),this.di&&(this.di.cancel(),this.di=null),this.qi(),this.Qi(),yield this.mi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new Or(t,Ot.oe);return this.vi(e).next(()=>this.Mi(e))}),this.mi.close(),this.Ki()})}Ni(t,e){return t.filter(n=>this.Oi(n.updateTimeMs,e)&&!this.Bi(n.clientId))}$i(){return this.runTransaction("getActiveClients","readonly",t=>Li(t).U().next(e=>this.Ni(e,18e5).map(n=>n.clientId)))}get started(){return this.Ur}getGlobalsCache(){return this.Wr}getMutationQueue(t,e){return ps.Pt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Ma(t,this.serializer.ht.databaseId)}getDocumentOverlayCache(t){return ds.Pt(this.serializer,t)}getBundleCache(){return this.jr}runTransaction(t,e,n){D("IndexedDbPersistence","Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=function(c){return c===17?Om:c===16?Lm:c===15?Yu:c===14?Yh:c===13?Xh:c===12?Mm:c===11?Jh:void O()}(this.Ti),a;return this.mi.runTransaction(t,i,s,u=>(a=new Or(u,this.$r?this.$r.next():Ot.oe),e==="readwrite-primary"?this.bi(a).next(c=>!!c||this.Di(a)).next(c=>{if(!c)throw lt(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.li.enqueueRetryable(()=>this.Ri(!1)),new C(b.FAILED_PRECONDITION,$h);return n(a)}).next(c=>this.Ci(a).next(()=>c)):this.Ui(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ui(t){return Vr(t).get("owner").next(e=>{if(e!==null&&this.Oi(e.leaseTimestampMs,5e3)&&!this.Bi(e.ownerId)&&!this.Fi(e)&&!(this.Pi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new C(b.FAILED_PRECONDITION,Go)})}Ci(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Vr(t).put("owner",e)}static p(){return Pe.p()}vi(t){let e=Vr(t);return e.get("owner").next(n=>this.Fi(n)?(D("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):S.resolve())}Oi(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(lt(`Detected an update time that is in the future: ${t} > ${n}`),!1))}pi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ei=()=>{this.li.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.gi()))},this.document.addEventListener("visibilitychange",this.Ei),this.inForeground=this.document.visibilityState==="visible")}qi(){this.Ei&&(this.document.removeEventListener("visibilitychange",this.Ei),this.Ei=null)}yi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Ii=()=>{this.ki();let e=/(?:Version|Mobile)\/1[456]/;Do()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.li.enterRestrictedMode(!0),this.li.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ii))}Qi(){this.Ii&&(this.window.removeEventListener("pagehide",this.Ii),this.Ii=null)}Bi(t){var e;try{let n=((e=this.fi)===null||e===void 0?void 0:e.getItem(this.Li(t)))!==null;return D("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return lt("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}ki(){if(this.fi)try{this.fi.setItem(this.Li(this.clientId),String(Date.now()))}catch(t){lt("Failed to set zombie client id.",t)}}Ki(){if(this.fi)try{this.fi.removeItem(this.Li(this.clientId))}catch{}}Li(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function Vr(r){return It(r,"owner")}function Li(r){return It(r,"clientMetadata")}function oc(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var tu=class r{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Wi=n,this.Gi=i}static zi(t,e){let n=K(),i=K();for(let s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(t,e.fromCache,n,i)}};var eu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Is=class{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return Do()?8:Qh(Er())>0?6:4}()}initialize(t,e){this.Zi=t,this.indexManager=e,this.ji=!0}getDocumentsMatchingQuery(t,e,n,i){let s={result:null};return this.Xi(t,e).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.es(t,e,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new eu;return this.ts(t,e,a).next(u=>{if(s.result=u,this.Hi)return this.ns(t,e,a,u.size)})}).next(()=>s.result)}ns(t,e,n,i){return n.documentReadCount<this.Ji?(In()<=$t.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",En(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),S.resolve()):(In()<=$t.DEBUG&&D("QueryEngine","Query:",En(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Yi*i?(In()<=$t.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",En(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Dt(e))):S.resolve())}Xi(t,e){if(th(e))return S.resolve(null);let n=Dt(e);return this.indexManager.getIndexType(t,n).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=is(e,null,"F"),n=Dt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(s=>{let a=K(...s);return this.Zi.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(c=>{let d=this.rs(e,u);return this.ss(e,d,a,c.readTime)?this.Xi(t,is(e,null,"F")):this.os(t,d,e,c)}))})))}es(t,e,n,i){return th(e)||i.isEqual(B.min())?S.resolve(null):this.Zi.getDocuments(t,n).next(s=>{let a=this.rs(e,s);return this.ss(e,a,n,i)?S.resolve(null):(In()<=$t.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),En(e)),this.os(t,a,e,jh(i,-1)).next(u=>u))})}rs(t,e){let n=new nt(md(t));return e.forEach((i,s)=>{hi(t,s)&&(n=n.add(s))}),n}ss(t,e,n,i){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ts(t,e,n){return In()<=$t.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",En(e)),this.Zi.getDocumentsMatchingQuery(t,e,Bt.min(),n)}os(t,e,n,i){return this.Zi.getDocumentsMatchingQuery(t,n,i).next(s=>(e.forEach(a=>{s=s.insert(a.key,a)}),s))}};var nu=class{constructor(t,e,n,i){this.persistence=t,this._s=e,this.serializer=i,this.us=new st(j),this.cs=new jt(s=>nn(s),ci),this.ls=new Map,this.hs=t.getRemoteDocumentCache(),this.Gr=t.getTargetCache(),this.jr=t.getBundleCache(),this.Ps(n)}Ps(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new ws(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.us))}};function Hd(r,t,e,n){return new nu(r,t,e,n)}function Jd(r,t){return V(this,null,function*(){let e=F(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,e.Ps(t),e.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],u=[],c=K();for(let d of i){a.push(d.batchId);for(let f of d.mutations)c=c.add(f.key)}for(let d of s){u.push(d.batchId);for(let f of d.mutations)c=c.add(f.key)}return e.localDocuments.getDocuments(n,c).next(d=>({Ts:d,removedBatchIds:a,addedBatchIds:u}))})})})}function gg(r,t){let e=F(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=t.batch.keys(),s=e.hs.newChangeBuffer({trackRemovals:!0});return function(u,c,d,f){let g=d.batch,_=g.keys(),R=S.resolve();return _.forEach(N=>{R=R.next(()=>f.getEntry(c,N)).next(k=>{let x=d.docVersions.get(N);q(x!==null),k.version.compareTo(x)<0&&(g.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),f.addEntry(k)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(c,g))}(e,n,t,s).next(()=>s.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=K();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(c=c.add(u.batch.mutations[d].key));return c}(t))).next(()=>e.localDocuments.getDocuments(n,i))})}function Xd(r){let t=F(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Gr.getLastRemoteSnapshotVersion(e))}function pg(r,t){let e=F(r),n=t.snapshotVersion,i=e.us;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=e.hs.newChangeBuffer({trackRemovals:!0});i=e.us;let u=[];t.targetChanges.forEach((f,g)=>{let _=i.get(g);if(!_)return;u.push(e.Gr.removeMatchingKeys(s,f.removedDocuments,g).next(()=>e.Gr.addMatchingKeys(s,f.addedDocuments,g)));let R=_.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(g)!==null?R=R.withResumeToken(mt.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):f.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(f.resumeToken,n)),i=i.insert(g,R),function(k,x,G){return k.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0}(_,R,f)&&u.push(e.Gr.updateTargetData(s,R))});let c=Mt(),d=K();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(Yd(s,a,t.documentUpdates).next(f=>{c=f.Is,d=f.Es})),!n.isEqual(B.min())){let f=e.Gr.getLastRemoteSnapshotVersion(s).next(g=>e.Gr.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return S.waitFor(u).next(()=>a.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,c,d)).next(()=>c)}).then(s=>(e.us=i,s))}function Yd(r,t,e){let n=K(),i=K();return e.forEach(s=>n=n.add(s)),t.getEntries(r,n).next(s=>{let a=Mt();return e.forEach((u,c)=>{let d=s.get(u);c.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(B.min())?(t.removeEntry(u,c.readTime),a=a.insert(u,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(c),a=a.insert(u,c)):D("LocalStore","Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",c.version)}),{Is:a,Es:i}})}function _g(r,t){let e=F(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function Un(r,t){let e=F(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return e.Gr.getTargetData(n,t).next(s=>s?(i=s,S.resolve(i)):e.Gr.allocateTargetId(n).next(a=>(i=new On(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Gr.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=e.us.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.us=e.us.insert(n.targetId,n),e.cs.set(t,n.targetId)),n})}function Bn(r,t,e){return V(this,null,function*(){let n=F(r),i=n.us.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!qe(a))throw a;D("LocalStore",`Failed to update sequence numbers for target ${t}: ${a}`)}n.us=n.us.remove(t),n.cs.delete(i.target)})}function Es(r,t,e){let n=F(r),i=B.min(),s=K();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,d,f){let g=F(c),_=g.cs.get(f);return _!==void 0?S.resolve(g.us.get(_)):g.Gr.getTargetData(d,f)}(n,a,Dt(t)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Gr.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n._s.getDocumentsMatchingQuery(a,t,e?i:B.min(),e?s:K())).next(u=>(ef(n,fd(t),u),{documents:u,ds:s})))}function Zd(r,t){let e=F(r),n=F(e.Gr),i=e.us.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>n.ut(s,t).next(a=>a?a.target:null))}function tf(r,t){let e=F(r),n=e.ls.get(t)||B.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.hs.getAllFromCollectionGroup(i,t,jh(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(ef(e,t,i),i))}function ef(r,t,e){let n=r.ls.get(t)||B.min();e.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.ls.set(t,n)}function yg(r,t,e,n){return V(this,null,function*(){let i=F(r),s=K(),a=Mt();for(let d of e){let f=t.As(d.metadata.name);d.document&&(s=s.add(f));let g=t.Rs(d);g.setReadTime(t.Vs(d.metadata.readTime)),a=a.insert(f,g)}let u=i.hs.newChangeBuffer({trackRemovals:!0}),c=yield Un(i,function(f){return Dt(Xn(X.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",d=>Yd(d,u,a).next(f=>(u.apply(d),f)).next(f=>i.Gr.removeMatchingKeysForTargetId(d,c.targetId).next(()=>i.Gr.addMatchingKeys(d,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,f.Is,f.Es)).next(()=>f.Is)))})}function wg(n,i){return V(this,arguments,function*(r,t,e=K()){let s=yield Un(r,Dt(ic(t.bundledQuery))),a=F(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let c=dt(t.readTime);if(s.snapshotVersion.compareTo(c)>=0)return a.jr.saveNamedQuery(u,t);let d=s.withResumeToken(mt.EMPTY_BYTE_STRING,c);return a.us=a.us.insert(d.targetId,d),a.Gr.updateTargetData(u,d).next(()=>a.Gr.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>a.Gr.addMatchingKeys(u,e,s.targetId)).next(()=>a.jr.saveNamedQuery(u,t))})})}function Rh(r,t){return`firestore_clients_${r}_${t}`}function bh(r,t,e){let n=`firestore_mutations_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}function zo(r,t){return`firestore_targets_${r}_${t}`}var As=class r{constructor(t,e,n,i){this.user=t,this.batchId=e,this.state=n,this.error=i}static fs(t,e,n){let i=JSON.parse(n),s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new C(i.error.code,i.error.message))),a?new r(t,e,i.state,s):(lt("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}gs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Fr=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static fs(t,e){let n=JSON.parse(e),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new C(n.error.code,n.error.message))),s?new r(t,n.state,i):(lt("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}gs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Ss=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static fs(t,e){let n=JSON.parse(e),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=ec();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=Wh(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new r(t,s):(lt("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},ru=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static fs(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(lt("SharedClientState",`Failed to parse online state: ${t}`),null)}},Yr=class{constructor(){this.activeTargetIds=ec()}ps(t){this.activeTargetIds=this.activeTargetIds.add(t)}ys(t){this.activeTargetIds=this.activeTargetIds.delete(t)}gs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},Mr=class{constructor(t,e,n,i,s){this.window=t,this.li=e,this.persistenceKey=n,this.ws=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ss=this.bs.bind(this),this.Ds=new st(j),this.started=!1,this.vs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Cs=Rh(this.persistenceKey,this.ws),this.Fs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ds=this.Ds.insert(this.ws,new Yr),this.Ms=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.xs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Os=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.Ns=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Ls=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.Ss)}static p(t){return!(!t||!t.localStorage)}start(){return V(this,null,function*(){let t=yield this.syncEngine.$i();for(let n of t){if(n===this.ws)continue;let i=this.getItem(Rh(this.persistenceKey,n));if(i){let s=Ss.fs(n,i);s&&(this.Ds=this.Ds.insert(s.clientId,s))}}this.Bs();let e=this.storage.getItem(this.Ns);if(e){let n=this.ks(e);n&&this.qs(n)}for(let n of this.vs)this.bs(n);this.vs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.Fs,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Qs(this.Ds)}isActiveQueryTarget(t){let e=!1;return this.Ds.forEach((n,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.Ks(t,"pending")}updateMutationState(t,e,n){this.Ks(t,e,n),this.$s(t)}addLocalQueryTarget(t,e=!0){let n="not-current";if(this.isActiveQueryTarget(t)){let i=this.storage.getItem(zo(this.persistenceKey,t));if(i){let s=Fr.fs(t,i);s&&(n=s.state)}}return e&&this.Us.ps(t),this.Bs(),n}removeLocalQueryTarget(t){this.Us.ys(t),this.Bs()}isLocalQueryTarget(t){return this.Us.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(zo(this.persistenceKey,t))}updateQueryState(t,e,n){this.Ws(t,e,n)}handleUserChange(t,e,n){e.forEach(i=>{this.$s(i)}),this.currentUser=t,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.Gs(t)}notifyBundleLoaded(t){this.zs(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ss),this.removeItem(this.Cs),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return D("SharedClientState","READ",t,e),e}setItem(t,e){D("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){D("SharedClientState","REMOVE",t),this.storage.removeItem(t)}bs(t){let e=t;if(e.storageArea===this.storage){if(D("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Cs)return void lt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.li.enqueueRetryable(()=>V(this,null,function*(){if(this.started){if(e.key!==null){if(this.Ms.test(e.key)){if(e.newValue==null){let n=this.js(e.key);return this.Hs(n,null)}{let n=this.Js(e.key,e.newValue);if(n)return this.Hs(n.clientId,n)}}else if(this.xs.test(e.key)){if(e.newValue!==null){let n=this.Ys(e.key,e.newValue);if(n)return this.Zs(n)}}else if(this.Os.test(e.key)){if(e.newValue!==null){let n=this.Xs(e.key,e.newValue);if(n)return this.eo(n)}}else if(e.key===this.Ns){if(e.newValue!==null){let n=this.ks(e.newValue);if(n)return this.qs(n)}}else if(e.key===this.Fs){let n=function(s){let a=Ot.oe;if(s!=null)try{let u=JSON.parse(s);q(typeof u=="number"),a=u}catch(u){lt("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(e.newValue);n!==Ot.oe&&this.sequenceNumberHandler(n)}else if(e.key===this.Ls){let n=this.no(e.newValue);yield Promise.all(n.map(i=>this.syncEngine.ro(i)))}}}else this.vs.push(e)}))}}get Us(){return this.Ds.get(this.ws)}Bs(){this.setItem(this.Cs,this.Us.gs())}Ks(t,e,n){let i=new As(this.currentUser,t,e,n),s=bh(this.persistenceKey,this.currentUser,t);this.setItem(s,i.gs())}$s(t){let e=bh(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Gs(t){let e={clientId:this.ws,onlineState:t};this.storage.setItem(this.Ns,JSON.stringify(e))}Ws(t,e,n){let i=zo(this.persistenceKey,t),s=new Fr(t,e,n);this.setItem(i,s.gs())}zs(t){let e=JSON.stringify(Array.from(t));this.setItem(this.Ls,e)}js(t){let e=this.Ms.exec(t);return e?e[1]:null}Js(t,e){let n=this.js(t);return Ss.fs(n,e)}Ys(t,e){let n=this.xs.exec(t),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return As.fs(new _t(s),i,e)}Xs(t,e){let n=this.Os.exec(t),i=Number(n[1]);return Fr.fs(i,e)}ks(t){return ru.fs(t)}no(t){return JSON.parse(t)}Zs(t){return V(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.io(t.batchId,t.state,t.error);D("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}eo(t){return this.syncEngine.so(t.targetId,t.state,t.error)}Hs(t,e){let n=e?this.Ds.insert(t,e):this.Ds.remove(t),i=this.Qs(this.Ds),s=this.Qs(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.oo(a,u).then(()=>{this.Ds=n})}qs(t){this.Ds.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Qs(t){let e=ec();return t.forEach((n,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},Rs=class{constructor(){this._o=new Yr,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this._o.ps(t),this.ao[t]||"not-current"}updateQueryState(t,e,n){this.ao[t]=e}removeLocalQueryTarget(t){this._o.ys(t)}isLocalQueryTarget(t){return this._o.activeTargetIds.has(t)}clearQueryState(t){delete this.ao[t]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(t){return this._o.activeTargetIds.has(t)}start(){return this._o=new Yr,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var iu=class{uo(t){}shutdown(){}};var bs=class{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(t){this.To.push(t)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){D("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.To)t(0)}Po(){D("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.To)t(1)}static p(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Oi=null;function jo(){return Oi===null?Oi=function(){return 268435456+Math.round(2147483648*Math.random())}():Oi++,"0x"+Oi.toString(16)}var vg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var su=class{constructor(t){this.Eo=t.Eo,this.Ao=t.Ao}Ro(t){this.Vo=t}mo(t){this.fo=t}po(t){this.yo=t}onMessage(t){this.wo=t}close(){this.Ao()}send(t){this.Eo(t)}So(){this.Vo()}bo(){this.fo()}Do(t){this.yo(t)}vo(t){this.wo(t)}};var Vt="WebChannelConnection",ou=class extends class{get Co(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let n=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Fo=n+"://"+e.host,this.Mo=`projects/${i}/databases/${s}`,this.xo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}Oo(e,n,i,s,a){let u=jo(),c=this.No(e,n.toUriEncodedString());D("RestConnection",`Sending RPC '${e}' ${u}:`,c,i);let d={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Lo(d,s,a),this.Bo(e,c,d,i).then(f=>(D("RestConnection",`Received RPC '${e}' ${u}: `,f),f),f=>{throw Ut("RestConnection",`RPC '${e}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}ko(e,n,i,s,a,u){return this.Oo(e,n,i,s,a)}Lo(e,n,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Jn}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>e[a]=s),i&&i.headers.forEach((s,a)=>e[a]=s)}No(e,n){let i=vg[e];return`${this.Fo}/v1/${n}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Bo(t,e,n,i){let s=jo();return new Promise((a,u)=>{let c=new Mo;c.setWithCredentials(!0),c.listenOnce(Lo.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Sr.NO_ERROR:let f=c.getResponseJson();D(Vt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(f)),a(f);break;case Sr.TIMEOUT:D(Vt,`RPC '${t}' ${s} timed out`),u(new C(b.DEADLINE_EXCEEDED,"Request time out"));break;case Sr.HTTP_ERROR:let g=c.getStatus();if(D(Vt,`RPC '${t}' ${s} failed with status:`,g,"response text:",c.getResponseText()),g>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);let R=_?.error;if(R&&R.status&&R.message){let N=function(x){let G=x.toLowerCase().replace(/_/g,"-");return Object.values(b).indexOf(G)>=0?G:b.UNKNOWN}(R.status);u(new C(N,R.message))}else u(new C(b.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new C(b.UNAVAILABLE,"Connection failed."));break;default:O()}}finally{D(Vt,`RPC '${t}' ${s} completed.`)}});let d=JSON.stringify(i);D(Vt,`RPC '${t}' ${s} sending request:`,i),c.send(e,"POST",d,n,15)})}qo(t,e,n){let i=jo(),s=[this.Fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Uo(),u=qo(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Lo(c.initMessageHeaders,e,n),c.encodeInitMessageHeaders=!0;let f=s.join("");D(Vt,`Creating RPC '${t}' stream ${i}: ${f}`,c);let g=a.createWebChannel(f,c),_=!1,R=!1,N=new su({Eo:x=>{R?D(Vt,`Not sending because RPC '${t}' stream ${i} is closed:`,x):(_||(D(Vt,`Opening RPC '${t}' stream ${i} transport.`),g.open(),_=!0),D(Vt,`RPC '${t}' stream ${i} sending:`,x),g.send(x))},Ao:()=>g.close()}),k=(x,G,z)=>{x.listen(G,U=>{try{z(U)}catch(Q){setTimeout(()=>{throw Q},0)}})};return k(g,_n.EventType.OPEN,()=>{R||(D(Vt,`RPC '${t}' stream ${i} transport opened.`),N.So())}),k(g,_n.EventType.CLOSE,()=>{R||(R=!0,D(Vt,`RPC '${t}' stream ${i} transport closed`),N.Do())}),k(g,_n.EventType.ERROR,x=>{R||(R=!0,Ut(Vt,`RPC '${t}' stream ${i} transport errored:`,x),N.Do(new C(b.UNAVAILABLE,"The operation could not be completed")))}),k(g,_n.EventType.MESSAGE,x=>{var G;if(!R){let z=x.data[0];q(!!z);let U=z,Q=U?.error||((G=U[0])===null||G===void 0?void 0:G.error);if(Q){D(Vt,`RPC '${t}' stream ${i} received error:`,Q);let Z=Q.status,$=function(w){let T=gt[w];if(T!==void 0)return bd(T)}(Z),v=Q.message;$===void 0&&($=b.INTERNAL,v="Unknown error status: "+Z+" with message "+Q.message),R=!0,N.Do(new C($,v)),g.close()}else D(Vt,`RPC '${t}' stream ${i} received:`,z),N.vo(z)}}),k(u,Oo.STAT_EVENT,x=>{x.stat===Ni.PROXY?D(Vt,`RPC '${t}' stream ${i} detected buffering proxy`):x.stat===Ni.NOPROXY&&D(Vt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{N.bo()},0),N}};function nf(){return typeof window<"u"?window:null}function Ki(){return typeof document<"u"?document:null}function di(r){return new Ia(r,!0)}var Zr=class{constructor(t,e,n=1e3,i=1.5,s=6e4){this.li=t,this.timerId=e,this.Qo=n,this.Ko=i,this.$o=s,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(t){this.cancel();let e=Math.floor(this.Uo+this.Ho()),n=Math.max(0,Date.now()-this.Go),i=Math.max(0,e-n);i>0&&D("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Uo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,i,()=>(this.Go=Date.now(),t())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}};var Ps=class{constructor(t,e,n,i,s,a,u,c){this.li=t,this.Yo=n,this.Zo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new Zr(t,e)}i_(){return this.state===1||this.state===5||this.s_()}s_(){return this.state===2||this.state===3}start(){this.n_=0,this.state!==4?this.auth():this.o_()}stop(){return V(this,null,function*(){this.i_()&&(yield this.close(0))})}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&this.e_===null&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(t){this.l_(),this.stream.send(t)}u_(){return V(this,null,function*(){if(this.s_())return this.close(0)})}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}close(t,e){return V(this,null,function*(){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,t!==4?this.r_.reset():e&&e.code===b.RESOURCE_EXHAUSTED?(lt(e.toString()),lt("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):e&&e.code===b.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.P_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.po(e)})}P_(){}auth(){this.state=1;let t=this.T_(this.Xo),e=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Xo===e&&this.I_(n,i)},n=>{t(()=>{let i=new C(b.UNKNOWN,"Fetching auth token failed: "+n.message);return this.E_(i)})})}I_(t,e){let n=this.T_(this.Xo);this.stream=this.d_(t,e),this.stream.Ro(()=>{n(()=>this.listener.Ro())}),this.stream.mo(()=>{n(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(i=>{n(()=>this.E_(i))}),this.stream.onMessage(i=>{n(()=>++this.n_==1?this.A_(i):this.onNext(i))})}o_(){this.state=5,this.r_.jo(()=>V(this,null,function*(){this.state=0,this.start()}))}E_(t){return D("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}T_(t){return e=>{this.li.enqueueAndForget(()=>this.Xo===t?e():(D("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},au=class extends Ps{constructor(t,e,n,i,s,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}d_(t,e){return this.connection.qo("Listen",t,e)}A_(t){return this.onNext(t)}onNext(t){this.r_.reset();let e=sg(this.serializer,t),n=function(s){if(!("targetChange"in s))return B.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?dt(a.readTime):B.min()}(t);return this.listener.R_(e,n)}V_(t){let e={};e.database=Sa(this.serializer),e.addTarget=function(s,a){let u,c=a.target;if(u=ns(c)?{documents:Fd(s,c)}:{query:Hs(s,c).ct},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Vd(s,a.resumeToken);let d=Ea(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(B.min())>0){u.readTime=Ln(s,a.snapshotVersion.toTimestamp());let d=Ea(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,t);let n=ag(this.serializer,t);n&&(e.labels=n),this.c_(e)}m_(t){let e={};e.database=Sa(this.serializer),e.removeTarget=t,this.c_(e)}},uu=class extends Ps{constructor(t,e,n,i,s,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}d_(t,e){return this.connection.qo("Write",t,e)}A_(t){return q(!!t.streamToken),this.lastStreamToken=t.streamToken,q(!t.writeResults||t.writeResults.length===0),this.listener.p_()}onNext(t){q(!!t.streamToken),this.lastStreamToken=t.streamToken,this.r_.reset();let e=og(t.writeResults,t.commitTime),n=dt(t.commitTime);return this.listener.y_(n,e)}w_(){let t={};t.database=Sa(this.serializer),this.c_(t)}g_(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>Wr(this.serializer,n))};this.c_(e)}};var cu=class extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.S_=!1}b_(){if(this.S_)throw new C(b.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(t,e,n,i){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Oo(t,Aa(e,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new C(b.UNKNOWN,s.toString())})}ko(t,e,n,i,s){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.ko(t,Aa(e,n),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new C(b.UNKNOWN,a.toString())})}terminate(){this.S_=!0,this.connection.terminate()}},lu=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){this.D_===0&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(t){this.state==="Online"?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.M_("Offline")))}set(t){this.N_(),this.D_=0,t==="Online"&&(this.C_=!1),this.M_(t)}M_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}x_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(lt(e),this.C_=!1):D("OnlineStateTracker",e)}N_(){this.v_!==null&&(this.v_.cancel(),this.v_=null)}};var hu=class{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.L_=[],this.B_=new Map,this.k_=new Set,this.q_=[],this.Q_=s,this.Q_.uo(a=>{n.enqueueAndForget(()=>V(this,null,function*(){Be(this)&&(D("RemoteStore","Restarting streams for network reachability change."),yield function(c){return V(this,null,function*(){let d=F(c);d.k_.add(4),yield Yn(d),d.K_.set("Unknown"),d.k_.delete(4),yield fi(d)})}(this))}))}),this.K_=new lu(n,i)}};function fi(r){return V(this,null,function*(){if(Be(r))for(let t of r.q_)yield t(!0)})}function Yn(r){return V(this,null,function*(){for(let t of r.q_)yield t(!1)})}function Js(r,t){let e=F(r);e.B_.has(t.targetId)||(e.B_.set(t.targetId,t),cc(e)?uc(e):tr(e).s_()&&ac(e,t))}function Gn(r,t){let e=F(r),n=tr(e);e.B_.delete(t),n.s_()&&rf(e,t),e.B_.size===0&&(n.s_()?n.a_():Be(e)&&e.K_.set("Unknown"))}function ac(r,t){if(r.U_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(B.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}tr(r).V_(t)}function rf(r,t){r.U_.xe(t),tr(r).m_(t)}function uc(r){r.U_=new Ta({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),ut:t=>r.B_.get(t)||null,nt:()=>r.datastore.serializer.databaseId}),tr(r).start(),r.K_.F_()}function cc(r){return Be(r)&&!tr(r).i_()&&r.B_.size>0}function Be(r){return F(r).k_.size===0}function sf(r){r.U_=void 0}function Tg(r){return V(this,null,function*(){r.K_.set("Online")})}function Ig(r){return V(this,null,function*(){r.B_.forEach((t,e)=>{ac(r,t)})})}function Eg(r,t){return V(this,null,function*(){sf(r),cc(r)?(r.K_.O_(t),uc(r)):r.K_.set("Unknown")})}function Ag(r,t,e){return V(this,null,function*(){if(r.K_.set("Online"),t instanceof us&&t.state===2&&t.cause)try{yield function(i,s){return V(this,null,function*(){let a=s.cause;for(let u of s.targetIds)i.B_.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.B_.delete(u),i.U_.removeTarget(u))})}(r,t)}catch(n){D("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield Vs(r,n)}else if(t instanceof Pn?r.U_.$e(t):t instanceof as?r.U_.Je(t):r.U_.Ge(t),!e.isEqual(B.min()))try{let n=yield Xd(r.localStore);e.compareTo(n)>=0&&(yield function(s,a){let u=s.U_.it(a);return u.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){let f=s.B_.get(d);f&&s.B_.set(d,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,d)=>{let f=s.B_.get(c);if(!f)return;s.B_.set(c,f.withResumeToken(mt.EMPTY_BYTE_STRING,f.snapshotVersion)),rf(s,c);let g=new On(f.target,c,d,f.sequenceNumber);ac(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,e))}catch(n){D("RemoteStore","Failed to raise snapshot:",n),yield Vs(r,n)}})}function Vs(r,t,e){return V(this,null,function*(){if(!qe(t))throw t;r.k_.add(1),yield Yn(r),r.K_.set("Offline"),e||(e=()=>Xd(r.localStore)),r.asyncQueue.enqueueRetryable(()=>V(this,null,function*(){D("RemoteStore","Retrying IndexedDB access"),yield e(),r.k_.delete(1),yield fi(r)}))})}function of(r,t){return t().catch(e=>Vs(r,e,t))}function Zn(r){return V(this,null,function*(){let t=F(r),e=Fe(t),n=t.L_.length>0?t.L_[t.L_.length-1].batchId:-1;for(;Sg(t);)try{let i=yield _g(t.localStore,n);if(i===null){t.L_.length===0&&e.a_();break}n=i.batchId,Rg(t,i)}catch(i){yield Vs(t,i)}af(t)&&uf(t)})}function Sg(r){return Be(r)&&r.L_.length<10}function Rg(r,t){r.L_.push(t);let e=Fe(r);e.s_()&&e.f_&&e.g_(t.mutations)}function af(r){return Be(r)&&!Fe(r).i_()&&r.L_.length>0}function uf(r){Fe(r).start()}function bg(r){return V(this,null,function*(){Fe(r).w_()})}function Pg(r){return V(this,null,function*(){let t=Fe(r);for(let e of r.L_)t.g_(e.mutations)})}function Vg(r,t,e){return V(this,null,function*(){let n=r.L_.shift(),i=ya.from(n,t,e);yield of(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Zn(r)})}function xg(r,t){return V(this,null,function*(){t&&Fe(r).f_&&(yield function(n,i){return V(this,null,function*(){if(function(a){return Rd(a)&&a!==b.ABORTED}(i.code)){let s=n.L_.shift();Fe(n).__(),yield of(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Zn(n)}})}(r,t)),af(r)&&uf(r)})}function Ph(r,t){return V(this,null,function*(){let e=F(r);e.asyncQueue.verifyOperationInProgress(),D("RemoteStore","RemoteStore received new credentials");let n=Be(e);e.k_.add(3),yield Yn(e),n&&e.K_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.k_.delete(3),yield fi(e)})}function du(r,t){return V(this,null,function*(){let e=F(r);t?(e.k_.delete(2),yield fi(e)):t||(e.k_.add(2),yield Yn(e),e.K_.set("Unknown"))})}function tr(r){return r.W_||(r.W_=function(e,n,i){let s=F(e);return s.b_(),new au(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Ro:Tg.bind(null,r),mo:Ig.bind(null,r),po:Eg.bind(null,r),R_:Ag.bind(null,r)}),r.q_.push(t=>V(this,null,function*(){t?(r.W_.__(),cc(r)?uc(r):r.K_.set("Unknown")):(yield r.W_.stop(),sf(r))}))),r.W_}function Fe(r){return r.G_||(r.G_=function(e,n,i){let s=F(e);return s.b_(),new uu(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Ro:()=>Promise.resolve(),mo:bg.bind(null,r),po:xg.bind(null,r),p_:Pg.bind(null,r),y_:Vg.bind(null,r)}),r.q_.push(t=>V(this,null,function*(){t?(r.G_.__(),yield Zn(r)):(yield r.G_.stop(),r.L_.length>0&&(D("RemoteStore",`Stopping write stream with ${r.L_.length} pending writes`),r.L_=[]))}))),r.G_}var fu=class r{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new yt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,s){let a=Date.now()+n,u=new r(t,e,a,i,s);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new C(b.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function er(r,t){if(lt("AsyncQueue",`${t}: ${r}`),qe(r))return new C(b.UNAVAILABLE,`${t}: ${r}`);throw r}var xs=class r{static emptySet(t){return new r(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||L.comparator(e.key,n.key):(e,n)=>L.comparator(e.key,n.key),this.keyedMap=xr(),this.sortedSet=new st(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var Cs=class{constructor(){this.z_=new st(L.comparator)}track(t){let e=t.doc.key,n=this.z_.get(e);n?t.type!==0&&n.type===3?this.z_=this.z_.insert(e,t):t.type===3&&n.type!==1?this.z_=this.z_.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.z_=this.z_.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.z_=this.z_.remove(e):t.type===1&&n.type===2?this.z_=this.z_.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):O():this.z_=this.z_.insert(e,t)}j_(){let t=[];return this.z_.inorderTraversal((e,n)=>{t.push(n)}),t}},zn=class r{constructor(t,e,n,i,s,a,u,c,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,i,s){let a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new r(t,e,xs.emptySet(e),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&li(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==n[i].type||!e[i].doc.isEqual(n[i].doc))return!1;return!0}};var mu=class{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(t=>t.Z_())}},gu=class{constructor(){this.queries=Vh(),this.onlineState="Unknown",this.X_=new Set}terminate(){(function(e,n){let i=F(e),s=i.queries;i.queries=Vh(),s.forEach((a,u)=>{for(let c of u.J_)c.onError(n)})})(this,new C(b.ABORTED,"Firestore shutting down"))}};function Vh(){return new jt(r=>dd(r),li)}function lc(r,t){return V(this,null,function*(){let e=F(r),n=3,i=t.query,s=e.queries.get(i);s?!s.Y_()&&t.Z_()&&(n=2):(s=new mu,n=t.Z_()?0:1);try{switch(n){case 0:s.H_=yield e.onListen(i,!0);break;case 1:s.H_=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(a){let u=er(a,`Initialization of query '${En(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,s),s.J_.push(t),t.ea(e.onlineState),s.H_&&t.ta(s.H_)&&dc(e)})}function hc(r,t){return V(this,null,function*(){let e=F(r),n=t.query,i=3,s=e.queries.get(n);if(s){let a=s.J_.indexOf(t);a>=0&&(s.J_.splice(a,1),s.J_.length===0?i=t.Z_()?0:1:!s.Y_()&&t.Z_()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function Cg(r,t){let e=F(r),n=!1;for(let i of t){let s=i.query,a=e.queries.get(s);if(a){for(let u of a.J_)u.ta(i)&&(n=!0);a.H_=i}}n&&dc(e)}function Dg(r,t,e){let n=F(r),i=n.queries.get(t);if(i)for(let s of i.J_)s.onError(e);n.queries.delete(t)}function dc(r){r.X_.forEach(t=>{t.next()})}var pu,xh;(xh=pu||(pu={})).na="default",xh.Cache="cache";var ti=class{constructor(t,e,n){this.query=t,this.ra=e,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=n||{}}ta(t){if(!this.options.includeMetadataChanges){let n=[];for(let i of t.docChanges)i.type!==3&&n.push(i);t=new zn(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.ia?this.oa(t)&&(this.ra.next(t),e=!0):this._a(t,this.onlineState)&&(this.aa(t),e=!0),this.sa=t,e}onError(t){this.ra.error(t)}ea(t){this.onlineState=t;let e=!1;return this.sa&&!this.ia&&this._a(this.sa,t)&&(this.aa(this.sa),e=!0),e}_a(t,e){if(!t.fromCache||!this.Z_())return!0;let n=e!=="Offline";return(!this.options.ua||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}oa(t){if(t.docChanges.length>0)return!0;let e=this.sa&&this.sa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}aa(t){t=zn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ia=!0,this.ra.next(t)}Z_(){return this.options.source!==pu.Cache}};var _u=class{constructor(t,e){this.ca=t,this.byteLength=e}la(){return"metadata"in this.ca}};var Ds=class{constructor(t){this.serializer=t}As(t){return Jt(this.serializer,t)}Rs(t){return t.metadata.exists?kd(this.serializer,t.document,!1):vt.newNoDocument(this.As(t.metadata.name),this.Vs(t.metadata.readTime))}Vs(t){return dt(t)}},yu=class{constructor(t,e,n){this.ha=t,this.localStore=e,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=cf(t)}Pa(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.ca.namedQuery)this.queries.push(t.ca.namedQuery);else if(t.ca.documentMetadata){this.documents.push({metadata:t.ca.documentMetadata}),t.ca.documentMetadata.exists||++e;let n=X.fromString(t.ca.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.ca.document&&(this.documents[this.documents.length-1].document=t.ca.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}Ta(t){let e=new Map,n=new Ds(this.serializer);for(let i of t)if(i.metadata.queries){let s=n.As(i.metadata.name);for(let a of i.metadata.queries){let u=(e.get(a)||K()).add(s);e.set(a,u)}}return e}complete(){return V(this,null,function*(){let t=yield yg(this.localStore,new Ds(this.serializer),this.documents,this.ha.id),e=this.Ta(this.documents);for(let n of this.queries)yield wg(this.localStore,n,e.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Ia:this.collectionGroups,Ea:t}})}};function cf(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var Ns=class{constructor(t){this.key=t}},ks=class{constructor(t){this.key=t}},Fs=class{constructor(t,e){this.query=t,this.da=e,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=K(),this.mutatedKeys=K(),this.Va=md(t),this.ma=new xs(this.Va)}get fa(){return this.da}ga(t,e){let n=e?e.pa:new Cs,i=e?e.ma:this.ma,s=e?e.mutatedKeys:this.mutatedKeys,a=i,u=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((f,g)=>{let _=i.get(f),R=hi(this.query,g)?g:null,N=!!_&&this.mutatedKeys.has(_.key),k=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),x=!1;_&&R?_.data.isEqual(R.data)?N!==k&&(n.track({type:3,doc:R}),x=!0):this.ya(_,R)||(n.track({type:2,doc:R}),x=!0,(c&&this.Va(R,c)>0||d&&this.Va(R,d)<0)&&(u=!0)):!_&&R?(n.track({type:0,doc:R}),x=!0):_&&!R&&(n.track({type:1,doc:_}),x=!0,(c||d)&&(u=!0)),x&&(R?(a=a.add(R),s=k?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{ma:a,pa:n,ss:u,mutatedKeys:s}}ya(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,i){let s=this.ma;this.ma=t.ma,this.mutatedKeys=t.mutatedKeys;let a=t.pa.j_();a.sort((f,g)=>function(R,N){let k=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return O()}};return k(R)-k(N)}(f.type,g.type)||this.Va(f.doc,g.doc)),this.wa(n),i=i!=null&&i;let u=e&&!i?this.Sa():[],c=this.Ra.size===0&&this.current&&!i?1:0,d=c!==this.Aa;return this.Aa=c,a.length!==0||d?{snapshot:new zn(this.query,t.ma,s,a,t.mutatedKeys,c===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),ba:u}:{ba:u}}ea(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({ma:this.ma,pa:new Cs,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(t){return!this.da.has(t)&&!!this.ma.has(t)&&!this.ma.get(t).hasLocalMutations}wa(t){t&&(t.addedDocuments.forEach(e=>this.da=this.da.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.da=this.da.delete(e)),this.current=t.current)}Sa(){if(!this.current)return[];let t=this.Ra;this.Ra=K(),this.ma.forEach(n=>{this.Da(n.key)&&(this.Ra=this.Ra.add(n.key))});let e=[];return t.forEach(n=>{this.Ra.has(n)||e.push(new ks(n))}),this.Ra.forEach(n=>{t.has(n)||e.push(new Ns(n))}),e}va(t){this.da=t.ds,this.Ra=K();let e=this.ga(t.documents);return this.applyChanges(e,!0)}Ca(){return zn.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,this.Aa===0,this.hasCachedResults)}},wu=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},vu=class{constructor(t){this.key=t,this.Fa=!1}},Tu=class{constructor(t,e,n,i,s,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ma={},this.xa=new jt(u=>dd(u),li),this.Oa=new Map,this.Na=new Set,this.La=new st(L.comparator),this.Ba=new Map,this.ka=new Jr,this.qa={},this.Qa=new Map,this.Ka=qn.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return this.$a===!0}};function Ng(r,t,e=!0){return V(this,null,function*(){let n=Xs(r),i,s=n.xa.get(t);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Ca()):i=yield lf(n,t,e,!0),i})}function kg(r,t){return V(this,null,function*(){let e=Xs(r);yield lf(e,t,!0,!1)})}function lf(r,t,e,n){return V(this,null,function*(){let i=yield Un(r.localStore,Dt(t)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,e),u;return n&&(u=yield fc(r,t,s,a==="current",i.resumeToken)),r.isPrimaryClient&&e&&Js(r.remoteStore,i),u})}function fc(r,t,e,n,i){return V(this,null,function*(){r.Ua=(g,_,R)=>function(k,x,G,z){return V(this,null,function*(){let U=x.view.ga(G);U.ss&&(U=yield Es(k.localStore,x.query,!1).then(({documents:v})=>x.view.ga(v,U)));let Q=z&&z.targetChanges.get(x.targetId),Z=z&&z.targetMismatches.get(x.targetId)!=null,$=x.view.applyChanges(U,k.isPrimaryClient,Q,Z);return Iu(k,x.targetId,$.ba),$.snapshot})}(r,g,_,R);let s=yield Es(r.localStore,t,!0),a=new Fs(t,s.ds),u=a.ga(s.documents),c=$r.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",i),d=a.applyChanges(u,r.isPrimaryClient,c);Iu(r,e,d.ba);let f=new wu(t,e,a);return r.xa.set(t,f),r.Oa.has(e)?r.Oa.get(e).push(t):r.Oa.set(e,[t]),d.snapshot})}function Fg(r,t,e){return V(this,null,function*(){let n=F(r),i=n.xa.get(t),s=n.Oa.get(i.targetId);if(s.length>1)return n.Oa.set(i.targetId,s.filter(a=>!li(a,t))),void n.xa.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Bn(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),e&&Gn(n.remoteStore,i.targetId),jn(n,i.targetId)}).catch(Oe))):(jn(n,i.targetId),yield Bn(n.localStore,i.targetId,!0))})}function Mg(r,t){return V(this,null,function*(){let e=F(r),n=e.xa.get(t),i=e.Oa.get(n.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),Gn(e.remoteStore,n.targetId))})}function Lg(r,t,e){return V(this,null,function*(){let n=_c(r);try{let i=yield function(a,u){let c=F(a),d=ht.now(),f=u.reduce((R,N)=>R.add(N.key),K()),g,_;return c.persistence.runTransaction("Locally write mutations","readwrite",R=>{let N=Mt(),k=K();return c.hs.getEntries(R,f).next(x=>{N=x,N.forEach((G,z)=>{z.isValidDocument()||(k=k.add(G))})}).next(()=>c.localDocuments.getOverlayedDocuments(R,N)).next(x=>{g=x;let G=[];for(let z of u){let U=Ym(z,g.get(z.key).overlayedDocument);U!=null&&G.push(new Kt(z.key,U,rd(U.value.mapValue),ct.exists(!0)))}return c.mutationQueue.addMutationBatch(R,d,G,u)}).next(x=>{_=x;let G=x.applyToLocalDocumentSet(g,k);return c.documentOverlayCache.saveOverlays(R,x.batchId,G)})}).then(()=>({batchId:_.batchId,changes:pd(g)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let d=a.qa[a.currentUser.toKey()];d||(d=new st(j)),d=d.insert(u,c),a.qa[a.currentUser.toKey()]=d}(n,i.batchId,e),yield me(n,i.changes),yield Zn(n.remoteStore)}catch(i){let s=er(i,"Failed to persist write");e.reject(s)}})}function hf(r,t){return V(this,null,function*(){let e=F(r);try{let n=yield pg(e.localStore,t);t.targetChanges.forEach((i,s)=>{let a=e.Ba.get(s);a&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Fa=!0:i.modifiedDocuments.size>0?q(a.Fa):i.removedDocuments.size>0&&(q(a.Fa),a.Fa=!1))}),yield me(e,n,t)}catch(n){yield Oe(n)}})}function Ch(r,t,e){let n=F(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let i=[];n.xa.forEach((s,a)=>{let u=a.view.ea(t);u.snapshot&&i.push(u.snapshot)}),function(a,u){let c=F(a);c.onlineState=u;let d=!1;c.queries.forEach((f,g)=>{for(let _ of g.J_)_.ea(u)&&(d=!0)}),d&&dc(c)}(n.eventManager,t),i.length&&n.Ma.R_(i),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function Og(r,t,e){return V(this,null,function*(){let n=F(r);n.sharedClientState.updateQueryState(t,"rejected",e);let i=n.Ba.get(t),s=i&&i.key;if(s){let a=new st(L.comparator);a=a.insert(s,vt.newNoDocument(s,B.min()));let u=K().add(s),c=new Kr(B.min(),new Map,new st(j),a,u);yield hf(n,c),n.La=n.La.remove(s),n.Ba.delete(t),pc(n)}else yield Bn(n.localStore,t,!1).then(()=>jn(n,t,e)).catch(Oe)})}function qg(r,t){return V(this,null,function*(){let e=F(r),n=t.batch.batchId;try{let i=yield gg(e.localStore,t);gc(e,n,null),mc(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield me(e,i)}catch(i){yield Oe(i)}})}function Ug(r,t,e){return V(this,null,function*(){let n=F(r);try{let i=yield function(a,u){let c=F(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return c.mutationQueue.lookupMutationBatch(d,u).next(g=>(q(g!==null),f=g.keys(),c.mutationQueue.removeMutationBatch(d,g))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>c.localDocuments.getDocuments(d,f))})}(n.localStore,t);gc(n,t,e),mc(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield me(n,i)}catch(i){yield Oe(i)}})}function Bg(r,t){return V(this,null,function*(){let e=F(r);Be(e.remoteStore)||D("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(a){let u=F(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(e.localStore);if(n===-1)return void t.resolve();let i=e.Qa.get(n)||[];i.push(t),e.Qa.set(n,i)}catch(n){let i=er(n,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}})}function mc(r,t){(r.Qa.get(t)||[]).forEach(e=>{e.resolve()}),r.Qa.delete(t)}function gc(r,t,e){let n=F(r),i=n.qa[n.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),n.qa[n.currentUser.toKey()]=i}}function jn(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Oa.get(t))r.xa.delete(n),e&&r.Ma.Wa(n,e);r.Oa.delete(t),r.isPrimaryClient&&r.ka.yr(t).forEach(n=>{r.ka.containsKey(n)||df(r,n)})}function df(r,t){r.Na.delete(t.path.canonicalString());let e=r.La.get(t);e!==null&&(Gn(r.remoteStore,e),r.La=r.La.remove(t),r.Ba.delete(e),pc(r))}function Iu(r,t,e){for(let n of e)n instanceof Ns?(r.ka.addReference(n.key,t),Gg(r,n)):n instanceof ks?(D("SyncEngine","Document no longer in limbo: "+n.key),r.ka.removeReference(n.key,t),r.ka.containsKey(n.key)||df(r,n.key)):O()}function Gg(r,t){let e=t.key,n=e.path.canonicalString();r.La.get(e)||r.Na.has(n)||(D("SyncEngine","New document in limbo: "+e),r.Na.add(n),pc(r))}function pc(r){for(;r.Na.size>0&&r.La.size<r.maxConcurrentLimboResolutions;){let t=r.Na.values().next().value;r.Na.delete(t);let e=new L(X.fromString(t)),n=r.Ka.next();r.Ba.set(n,new vu(e)),r.La=r.La.insert(e,n),Js(r.remoteStore,new On(Dt(Xn(e.path)),n,"TargetPurposeLimboResolution",Ot.oe))}}function me(r,t,e){return V(this,null,function*(){let n=F(r),i=[],s=[],a=[];n.xa.isEmpty()||(n.xa.forEach((u,c)=>{a.push(n.Ua(c,t,e).then(d=>{var f;if((d||e)&&n.isPrimaryClient){let g=d?!d.fromCache:(f=e?.targetChanges.get(c.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,g?"current":"not-current")}if(d){i.push(d);let g=tu.zi(c.targetId,d);s.push(g)}}))}),yield Promise.all(a),n.Ma.R_(i),yield function(c,d){return V(this,null,function*(){let f=F(c);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>S.forEach(d,_=>S.forEach(_.Wi,R=>f.persistence.referenceDelegate.addReference(g,_.targetId,R)).next(()=>S.forEach(_.Gi,R=>f.persistence.referenceDelegate.removeReference(g,_.targetId,R)))))}catch(g){if(!qe(g))throw g;D("LocalStore","Failed to update sequence numbers: "+g)}for(let g of d){let _=g.targetId;if(!g.fromCache){let R=f.us.get(_),N=R.snapshotVersion,k=R.withLastLimboFreeSnapshotVersion(N);f.us=f.us.insert(_,k)}}})}(n.localStore,s))})}function zg(r,t){return V(this,null,function*(){let e=F(r);if(!e.currentUser.isEqual(t)){D("SyncEngine","User change. New user:",t.toKey());let n=yield Jd(e.localStore,t);e.currentUser=t,function(s,a){s.Qa.forEach(u=>{u.forEach(c=>{c.reject(new C(b.CANCELLED,a))})}),s.Qa.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield me(e,n.Ts)}})}function jg(r,t){let e=F(r),n=e.Ba.get(t);if(n&&n.Fa)return K().add(n.key);{let i=K(),s=e.Oa.get(t);if(!s)return i;for(let a of s){let u=e.xa.get(a);i=i.unionWith(u.view.fa)}return i}}function Kg(r,t){return V(this,null,function*(){let e=F(r),n=yield Es(e.localStore,t.query,!0),i=t.view.va(n);return e.isPrimaryClient&&Iu(e,t.targetId,i.ba),i})}function $g(r,t){return V(this,null,function*(){let e=F(r);return tf(e.localStore,t).then(n=>me(e,n))})}function Qg(r,t,e,n){return V(this,null,function*(){let i=F(r),s=yield function(u,c){let d=F(u),f=F(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.On(g,c).next(_=>_?d.localDocuments.getDocuments(g,_):S.resolve(null)))}(i.localStore,t);s!==null?(e==="pending"?yield Zn(i.remoteStore):e==="acknowledged"||e==="rejected"?(gc(i,t,n||null),mc(i,t),function(u,c){F(F(u).mutationQueue).Ln(c)}(i.localStore,t)):O(),yield me(i,s)):D("SyncEngine","Cannot apply mutation batch with id: "+t)})}function Wg(r,t){return V(this,null,function*(){let e=F(r);if(Xs(e),_c(e),t===!0&&e.$a!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),i=yield Dh(e,n.toArray());e.$a=!0,yield du(e.remoteStore,!0);for(let s of i)Js(e.remoteStore,s)}else if(t===!1&&e.$a!==!1){let n=[],i=Promise.resolve();e.Oa.forEach((s,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(jn(e,a),Bn(e.localStore,a,!0))),Gn(e.remoteStore,a)}),yield i,yield Dh(e,n),function(a){let u=F(a);u.Ba.forEach((c,d)=>{Gn(u.remoteStore,d)}),u.ka.wr(),u.Ba=new Map,u.La=new st(L.comparator)}(e),e.$a=!1,yield du(e.remoteStore,!1)}})}function Dh(r,t,e){return V(this,null,function*(){let n=F(r),i=[],s=[];for(let a of t){let u,c=n.Oa.get(a);if(c&&c.length!==0){u=yield Un(n.localStore,Dt(c[0]));for(let d of c){let f=n.xa.get(d),g=yield Kg(n,f);g.snapshot&&s.push(g.snapshot)}}else{let d=yield Zd(n.localStore,a);u=yield Un(n.localStore,d),yield fc(n,ff(d),a,!1,u.resumeToken)}i.push(u)}return n.Ma.R_(s),i})}function ff(r){return cd(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Hg(r){return function(e){return F(F(e).persistence).$i()}(F(r).localStore)}function Jg(r,t,e,n){return V(this,null,function*(){let i=F(r);if(i.$a)return void D("SyncEngine","Ignoring unexpected query state notification.");let s=i.Oa.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let a=yield tf(i.localStore,fd(s[0])),u=Kr.createSynthesizedRemoteEventForCurrentChange(t,e==="current",mt.EMPTY_BYTE_STRING);yield me(i,a,u);break}case"rejected":yield Bn(i.localStore,t,!0),jn(i,t,n);break;default:O()}})}function Xg(r,t,e){return V(this,null,function*(){let n=Xs(r);if(n.$a){for(let i of t){if(n.Oa.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){D("SyncEngine","Adding an already active target "+i);continue}let s=yield Zd(n.localStore,i),a=yield Un(n.localStore,s);yield fc(n,ff(s),a.targetId,!1,a.resumeToken),Js(n.remoteStore,a)}for(let i of e)n.Oa.has(i)&&(yield Bn(n.localStore,i,!1).then(()=>{Gn(n.remoteStore,i),jn(n,i)}).catch(Oe))}})}function Xs(r){let t=F(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=hf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=jg.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Og.bind(null,t),t.Ma.R_=Cg.bind(null,t.eventManager),t.Ma.Wa=Dg.bind(null,t.eventManager),t}function _c(r){let t=F(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=qg.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Ug.bind(null,t),t}function Yg(r,t,e){let n=F(r);(function(s,a,u){return V(this,null,function*(){try{let c=yield a.getMetadata();if(yield function(R,N){let k=F(R),x=dt(N.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",G=>k.jr.getBundleMetadata(G,N.id)).then(G=>!!G&&G.createTime.compareTo(x)>=0)}(s.localStore,c))return yield a.close(),u._completeWith(function(R){return{taskState:"Success",documentsLoaded:R.totalDocuments,bytesLoaded:R.totalBytes,totalDocuments:R.totalDocuments,totalBytes:R.totalBytes}}(c)),Promise.resolve(new Set);u._updateProgress(cf(c));let d=new yu(c,s.localStore,a.serializer),f=yield a.Ga();for(;f;){let _=yield d.Pa(f);_&&u._updateProgress(_),f=yield a.Ga()}let g=yield d.complete();return yield me(s,g.Ea,void 0),yield function(R,N){let k=F(R);return k.persistence.runTransaction("Save bundle","readwrite",x=>k.jr.saveBundleMetadata(x,N))}(s.localStore,c),u._completeWith(g.progress),Promise.resolve(g.Ia)}catch(c){return Ut("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}})})(n,t,e).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var Ys=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return V(this,null,function*(){this.serializer=di(e.databaseInfo.databaseId),this.sharedClientState=this.za(e),this.persistence=this.ja(e),yield this.persistence.start(),this.localStore=this.Ha(e),this.gcScheduler=this.Ja(e,this.localStore),this.indexBackfillerScheduler=this.Ya(e,this.localStore)})}Ja(e,n){return null}Ya(e,n){return null}Ha(e){return Hd(this.persistence,new Is,e.initialUser,this.serializer)}ja(e){return new Xr(vs.ei,this.serializer)}za(e){return new Rs}terminate(){return V(this,null,function*(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})(),ei=class extends Ys{constructor(t){super(),this.cacheSizeBytes=t}Ja(t,e){q(this.persistence.referenceDelegate instanceof Ts);let n=this.persistence.referenceDelegate.garbageCollector;return new _s(n,t.asyncQueue,e)}ja(t){let e=this.cacheSizeBytes!==void 0?Ft.withCacheSize(this.cacheSizeBytes):Ft.DEFAULT;return new Xr(n=>Ts.ei(n,e),this.serializer)}},ni=class r extends Ys{constructor(t,e,n){super(),this.Za=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(t){return V(this,null,function*(){yield Co(r.prototype,this,"initialize").call(this,t),yield this.Za.initialize(this,t),yield _c(this.Za.syncEngine),yield Zn(this.Za.remoteStore),yield this.persistence.Si(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}Ha(t){return Hd(this.persistence,new Is,t.initialUser,this.serializer)}Ja(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new _s(n,t.asyncQueue,e)}Ya(t,e){let n=new na(e,this.persistence);return new ea(t.asyncQueue,n)}ja(t){let e=oc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Ft.withCacheSize(this.cacheSizeBytes):Ft.DEFAULT;return new Za(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,nf(),Ki(),this.serializer,this.sharedClientState,!!this.forceOwnership)}za(t){return new Rs}},Ms=class r extends ni{constructor(t,e){super(t,e,!1),this.Za=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return V(this,null,function*(){yield Co(r.prototype,this,"initialize").call(this,t);let e=this.Za.syncEngine;this.sharedClientState instanceof Mr&&(this.sharedClientState.syncEngine={io:Qg.bind(null,e),so:Jg.bind(null,e),oo:Xg.bind(null,e),$i:Hg.bind(null,e),ro:$g.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.Si(n=>V(this,null,function*(){yield Wg(this.Za.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}za(t){let e=nf();if(!Mr.p(e))throw new C(b.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=oc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Mr(e,t.asyncQueue,n,t.clientId,t.initialUser)}},nr=(()=>{class r{initialize(e,n){return V(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Ch(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=zg.bind(null,this.syncEngine),yield du(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new gu}()}createDatastore(e){let n=di(e.databaseInfo.databaseId),i=function(a){return new ou(a)}(e.databaseInfo);return function(a,u,c,d){return new cu(a,u,c,d)}(e.authCredentials,e.appCheckCredentials,i,n)}createRemoteStore(e){return function(i,s,a,u,c){return new hu(i,s,a,u,c)}(this.localStore,this.datastore,e.asyncQueue,n=>Ch(this.syncEngine,n,0),function(){return bs.p()?new bs:new iu}())}createSyncEngine(e,n){return function(s,a,u,c,d,f,g){let _=new Tu(s,a,u,c,d,f);return g&&(_.$a=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return V(this,null,function*(){var e,n;yield function(s){return V(this,null,function*(){let a=F(s);D("RemoteStore","RemoteStore shutting down."),a.k_.add(5),yield Yn(a),a.Q_.shutdown(),a.K_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();function Nh(r,t=10240){let e=0;return{read(){return V(this,null,function*(){if(e<r.byteLength){let i={value:r.slice(e,e+t),done:!1};return e+=t,i}return{done:!0}})},cancel(){return V(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Kn=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Xa(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Xa(this.observer.error,t):lt("Uncaught Error in snapshot listener:",t.toString()))}eu(){this.muted=!0}Xa(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var Eu=class{constructor(t,e){this.tu=t,this.serializer=e,this.metadata=new yt,this.buffer=new Uint8Array,this.nu=function(){return new TextDecoder("utf-8")}(),this.ru().then(n=>{n&&n.la()?this.metadata.resolve(n.ca.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.ca)}`))},n=>this.metadata.reject(n))}close(){return this.tu.cancel()}getMetadata(){return V(this,null,function*(){return this.metadata.promise})}Ga(){return V(this,null,function*(){return yield this.getMetadata(),this.ru()})}ru(){return V(this,null,function*(){let t=yield this.iu();if(t===null)return null;let e=this.nu.decode(t),n=Number(e);isNaN(n)&&this.su(`length string (${e}) is not valid number`);let i=yield this.ou(n);return new _u(JSON.parse(i),t.length+n)})}_u(){return this.buffer.findIndex(t=>t===123)}iu(){return V(this,null,function*(){for(;this._u()<0&&!(yield this.au()););if(this.buffer.length===0)return null;let t=this._u();t<0&&this.su("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}ou(t){return V(this,null,function*(){for(;this.buffer.length<t;)(yield this.au())&&this.su("Reached the end of bundle when more is expected.");let e=this.nu.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}su(t){throw this.tu.cancel(),new Error(`Invalid bundle format: ${t}`)}au(){return V(this,null,function*(){let t=yield this.tu.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var Au=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new C(b.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(i,s){return V(this,null,function*(){let a=F(i),u={documents:s.map(g=>Qr(a.serializer,g))},c=yield a.ko("BatchGetDocuments",a.serializer.databaseId,X.emptyPath(),u,s.length),d=new Map;c.forEach(g=>{let _=ig(a.serializer,g);d.set(_.key.toString(),_)});let f=[];return s.forEach(g=>{let _=d.get(g.toString());q(!!_),f.push(_)}),f})}(this.datastore,t);return e.forEach(n=>this.recordVersion(n)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(t.toString())}delete(t){this.write(new ke(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,n)=>{let i=L.fromPath(n);this.mutations.push(new Gr(i,this.precondition(i)))}),yield function(n,i){return V(this,null,function*(){let s=F(n),a={writes:i.map(u=>Wr(s.serializer,u))};yield s.Oo("Commit",s.serializer.databaseId,X.emptyPath(),a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw O();e=B.min()}let n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new C(b.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(B.min())?ct.exists(!1):ct.updateTime(e):ct.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(B.min()))throw new C(b.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ct.updateTime(e)}return ct.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var Su=class{constructor(t,e,n,i,s){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=i,this.deferred=s,this.uu=n.maxAttempts,this.r_=new Zr(this.asyncQueue,"transaction_retry")}cu(){this.uu-=1,this.lu()}lu(){this.r_.jo(()=>V(this,null,function*(){let t=new Au(this.datastore),e=this.hu(t);e&&e.then(n=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.Pu(i)}))}).catch(n=>{this.Pu(n)})}))}hu(t){try{let e=this.updateFunction(t);return!ui(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Pu(t){this.uu>0&&this.Tu(t)?(this.uu-=1,this.asyncQueue.enqueueAndForget(()=>(this.lu(),Promise.resolve()))):this.deferred.reject(t)}Tu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Rd(e)}return!1}};var Ru=class{constructor(t,e,n,i,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=_t.UNAUTHENTICATED,this.clientId=Wi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,a=>V(this,null,function*(){D("FirestoreClient","Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,a=>(D("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new yt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>V(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=er(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};function Ko(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),D("FirestoreClient","Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(i=>V(this,null,function*(){n.isEqual(i)||(yield Jd(t.localStore,i),n=i)})),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t})}function kh(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield yc(r);D("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>Ph(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Ph(t.remoteStore,i)),r._onlineComponents=t})}function yc(r){return V(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){D("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ko(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(i){return i.name==="FirebaseError"?i.code===b.FAILED_PRECONDITION||i.code===b.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(e))throw e;Ut("Error using user provided cache. Falling back to memory cache: "+e),yield Ko(r,new Ys)}}else D("FirestoreClient","Using default OfflineComponentProvider"),yield Ko(r,new ei(void 0));return r._offlineComponents})}function Zs(r){return V(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(D("FirestoreClient","Using user provided OnlineComponentProvider"),yield kh(r,r._uninitializedComponentsProvider._online)):(D("FirestoreClient","Using default OnlineComponentProvider"),yield kh(r,new nr))),r._onlineComponents})}function mf(r){return yc(r).then(t=>t.persistence)}function rr(r){return yc(r).then(t=>t.localStore)}function gf(r){return Zs(r).then(t=>t.remoteStore)}function wc(r){return Zs(r).then(t=>t.syncEngine)}function pf(r){return Zs(r).then(t=>t.datastore)}function $n(r){return V(this,null,function*(){let t=yield Zs(r),e=t.eventManager;return e.onListen=Ng.bind(null,t.syncEngine),e.onUnlisten=Fg.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=kg.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Mg.bind(null,t.syncEngine),e})}function Zg(r){return r.asyncQueue.enqueue(()=>V(this,null,function*(){let t=yield mf(r),e=yield gf(r);return t.setNetworkEnabled(!0),function(i){let s=F(i);return s.k_.delete(0),fi(s)}(e)}))}function tp(r){return r.asyncQueue.enqueue(()=>V(this,null,function*(){let t=yield mf(r),e=yield gf(r);return t.setNetworkEnabled(!1),function(i){return V(this,null,function*(){let s=F(i);s.k_.add(0),yield Yn(s),s.K_.set("Offline")})}(e)}))}function ep(r,t){let e=new yt;return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(i,s,a){return V(this,null,function*(){try{let u=yield function(d,f){let g=F(d);return g.persistence.runTransaction("read document","readonly",_=>g.localDocuments.getDocument(_,f))}(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new C(b.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let c=er(u,`Failed to get document '${s} from cache`);a.reject(c)}})}(yield rr(r),t,e)})),e.promise}function _f(r,t,e={}){let n=new yt;return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(s,a,u,c,d){let f=new Kn({next:_=>{f.eu(),a.enqueueAndForget(()=>hc(s,g));let R=_.docs.has(u);!R&&_.fromCache?d.reject(new C(b.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&_.fromCache&&c&&c.source==="server"?d.reject(new C(b.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new ti(Xn(u.path),f,{includeMetadataChanges:!0,ua:!0});return lc(s,g)}(yield $n(r),r.asyncQueue,t,e,n)})),n.promise}function np(r,t){let e=new yt;return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(i,s,a){return V(this,null,function*(){try{let u=yield Es(i,s,!0),c=new Fs(s,u.ds),d=c.ga(u.documents),f=c.applyChanges(d,!1);a.resolve(f.snapshot)}catch(u){let c=er(u,`Failed to execute query '${s} against cache`);a.reject(c)}})}(yield rr(r),t,e)})),e.promise}function yf(r,t,e={}){let n=new yt;return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(s,a,u,c,d){let f=new Kn({next:_=>{f.eu(),a.enqueueAndForget(()=>hc(s,g)),_.fromCache&&c.source==="server"?d.reject(new C(b.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new ti(u,f,{includeMetadataChanges:!0,ua:!0});return lc(s,g)}(yield $n(r),r.asyncQueue,t,e,n)})),n.promise}function rp(r,t,e){let n=new yt;return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){try{let i=yield pf(r);n.resolve(function(a,u,c){return V(this,null,function*(){var d;let f=F(a),{request:g,lt:_,parent:R}=Md(f.serializer,ld(u),c);f.connection.Co||delete g.parent;let N=(yield f.ko("RunAggregationQuery",f.serializer.databaseId,R,g,1)).filter(x=>!!x.result);q(N.length===1);let k=(d=N[0].result)===null||d===void 0?void 0:d.aggregateFields;return Object.keys(k).reduce((x,G)=>(x[_[G]]=k[G],x),{})})}(i,t,e))}catch(i){n.reject(i)}})),n.promise}function ip(r,t){let e=new Kn(t);return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(i,s){F(i).X_.add(s),s.next()}(yield $n(r),e)})),()=>{e.eu(),r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(i,s){F(i).X_.delete(s)}(yield $n(r),e)}))}}function sp(r,t,e,n){let i=function(a,u){let c;return c=typeof a=="string"?Pd().encode(a):a,function(f,g){return new Eu(f,g)}(function(f,g){if(f instanceof Uint8Array)return Nh(f,g);if(f instanceof ArrayBuffer)return Nh(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),u)}(e,di(t));r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){Yg(yield wc(r),i,n)}))}function op(r,t){return r.asyncQueue.enqueue(()=>V(this,null,function*(){return function(n,i){let s=F(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.jr.getNamedQuery(a,i))}(yield rr(r),t)}))}function ap(r,t){return r.asyncQueue.enqueue(()=>V(this,null,function*(){return function(n,i){return V(this,null,function*(){let s=F(n),a=s.indexManager,u=[];return s.persistence.runTransaction("Configure indexes","readwrite",c=>a.getFieldIndexes(c).next(d=>function(g,_,R,N,k){g=[...g],_=[..._],g.sort(R),_.sort(R);let x=g.length,G=_.length,z=0,U=0;for(;z<G&&U<x;){let Q=R(g[U],_[z]);Q<0?k(g[U++]):Q>0?N(_[z++]):(z++,U++)}for(;z<G;)N(_[z++]);for(;U<x;)k(g[U++])}(d,i,ym,f=>{u.push(a.addFieldIndex(c,f))},f=>{u.push(a.deleteFieldIndex(c,f))})).next(()=>S.waitFor(u)))})}(yield rr(r),t)}))}function up(r,t){return r.asyncQueue.enqueue(()=>V(this,null,function*(){return function(n,i){F(n)._s.Hi=i}(yield rr(r),t)}))}function cp(r){return r.asyncQueue.enqueue(()=>V(this,null,function*(){return function(e){let n=F(e),i=n.indexManager;return n.persistence.runTransaction("Delete All Indexes","readwrite",s=>i.deleteAllFieldIndexes(s))}(yield rr(r))}))}function wf(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var Fh=new Map;function vc(r,t,e){if(!e)throw new C(b.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function lp(r,t,e,n){if(t===!0&&n===!0)throw new C(b.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function Mh(r){if(!L.isDocumentKey(r))throw new C(b.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Lh(r){if(L.isDocumentKey(r))throw new C(b.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function to(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":O()}function W(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new C(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=to(r);throw new C(b.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function vf(r,t){if(t<=0)throw new C(b.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}var Ls=class{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new C(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new C(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}lp("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=wf((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new C(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new C(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new C(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},an=class{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ls({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new C(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new C(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ls(t),t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new $o;switch(n.type){case"firstParty":return new Jo(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new C(b.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return V(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=Fh.get(e);n&&(D("ComponentProvider","Removing Datastore"),Fh.delete(e),n.terminate())}(this),Promise.resolve()}};function hp(r,t,e,n={}){var i;let s=(r=W(r,an))._getSettings(),a=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&Ut("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,c;if(typeof n.mockUserToken=="string")u=n.mockUserToken,c=_t.MOCK_USER;else{u=bl(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let d=n.mockUserToken.sub||n.mockUserToken.user_id;if(!d)throw new C(b.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new _t(d)}r._authCredentials=new Qo(new $i(u,c))}}var At=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},ft=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xt(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}},Xt=class r extends At{constructor(t,e,n){super(t,e,Xn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new ft(this.firestore,null,new L(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function Mp(r,t,...e){if(r=Tt(r),vc("collection","path",t),r instanceof an){let n=X.fromString(t,...e);return Lh(n),new Xt(r,null,n)}{if(!(r instanceof ft||r instanceof Xt))throw new C(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(X.fromString(t,...e));return Lh(n),new Xt(r.firestore,null,n)}}function Lp(r,t){if(r=W(r,an),vc("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new C(b.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new At(r,null,function(n){return new zt(X.emptyPath(),n)}(t))}function dp(r,t,...e){if(r=Tt(r),arguments.length===1&&(t=Wi.newId()),vc("doc","path",t),r instanceof an){let n=X.fromString(t,...e);return Mh(n),new ft(r,null,new L(n))}{if(!(r instanceof ft||r instanceof Xt))throw new C(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(X.fromString(t,...e));return Mh(n),new ft(r.firestore,r instanceof Xt?r.converter:null,new L(n))}}function Op(r,t){return r=Tt(r),t=Tt(t),(r instanceof ft||r instanceof Xt)&&(t instanceof ft||t instanceof Xt)&&r.firestore===t.firestore&&r.path===t.path&&r.converter===t.converter}function Tf(r,t){return r=Tt(r),t=Tt(t),r instanceof At&&t instanceof At&&r.firestore===t.firestore&&li(r._query,t._query)&&r.converter===t.converter}var Os=class{constructor(t=Promise.resolve()){this.Iu=[],this.Eu=!1,this.du=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new Zr(this,"async_queue_retry"),this.fu=()=>{let n=Ki();n&&D("AsyncQueue","Visibility state changed to "+n.visibilityState),this.r_.Jo()},this.gu=t;let e=Ki();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.Eu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.pu(),this.yu(t)}enterRestrictedMode(t){if(!this.Eu){this.Eu=!0,this.Vu=t||!1;let e=Ki();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.fu)}}enqueue(t){if(this.pu(),this.Eu)return new Promise(()=>{});let e=new yt;return this.yu(()=>this.Eu&&this.Vu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Iu.push(t),this.wu()))}wu(){return V(this,null,function*(){if(this.Iu.length!==0){try{yield this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(t){if(!qe(t))throw t;D("AsyncQueue","Operation failed with retryable error: "+t)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}})}yu(t){let e=this.gu.then(()=>(this.Ru=!0,t().catch(n=>{this.Au=n,this.Ru=!1;let i=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(n);throw lt("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.Ru=!1,n))));return this.gu=e,e}enqueueAfterDelay(t,e,n){this.pu(),this.mu.indexOf(t)>-1&&(e=0);let i=fu.createAndSchedule(this,t,e,n,s=>this.Su(s));return this.du.push(i),i}pu(){this.Au&&O()}verifyOperationInProgress(){}bu(){return V(this,null,function*(){let t;do t=this.gu,yield t;while(t!==this.gu)})}Du(t){for(let e of this.du)if(e.timerId===t)return!0;return!1}vu(t){return this.bu().then(()=>{this.du.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.du)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.bu()})}Cu(t){this.mu.push(t)}Su(t){let e=this.du.indexOf(t);this.du.splice(e,1)}};function bu(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var Pu=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new yt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var qp=-1,et=class extends an{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new Os,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return V(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new Os(t),this._firestoreClient=void 0,yield t}})}};function Up(r,t,e){e||(e="(default)");let n=No(r,"firestore");if(n.isInitialized(e)){let i=n.getImmediate({identifier:e}),s=n.getOptions(e);if(Ar(s,t))return i;throw new C(b.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(t.cacheSizeBytes!==void 0&&t.localCache!==void 0)throw new C(b.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(t.cacheSizeBytes!==void 0&&t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new C(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:t,instanceIdentifier:e})}function Bp(r,t){let e=typeof r=="object"?r:Fl(),n=typeof r=="string"?r:t||"(default)",i=No(e,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=Rl("firestore");s&&hp(i,...s)}return i}function at(r){if(r._terminated)throw new C(b.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||If(r),r._firestoreClient}function If(r){var t,e,n;let i=r._freezeSettings(),s=function(u,c,d,f){return new ra(u,c,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,wf(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new Ru(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(u){let c=u?._online.build();return{_offline:u?._offline.build(c),_online:c}}(r._componentsProvider))}function Gp(r,t){Ut("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();return Ef(r,nr.provider,{build:n=>new ni(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}function zp(r){return V(this,null,function*(){Ut("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings();Ef(r,nr.provider,{build:e=>new Ms(e,t.cacheSizeBytes)})})}function Ef(r,t,e){if((r=W(r,et))._firestoreClient||r._terminated)throw new C(b.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new C(b.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},If(r)}function jp(r){if(r._initialized&&!r._terminated)throw new C(b.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new yt;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>V(this,null,function*(){try{yield function(n){return V(this,null,function*(){if(!Pe.p())return Promise.resolve();let i=n+"main";yield Pe.delete(i)})}(oc(r._databaseId,r._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function Kp(r){return function(e){let n=new yt;return e.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return Bg(yield wc(e),n)})),n.promise}(at(r=W(r,et)))}function $p(r){return Zg(at(r=W(r,et)))}function Qp(r){return tp(at(r=W(r,et)))}function Wp(r){return Nl(r.app,"firestore",r._databaseId.database),r._delete()}function Hp(r,t){let e=at(r=W(r,et)),n=new Pu;return sp(e,r._databaseId,t,n),n}function Jp(r,t){return op(at(r=W(r,et)),t).then(e=>e?new At(r,null,e.query):null)}var un=class{constructor(t="count",e){this._internalFieldPath=e,this.type="AggregateField",this.aggregateType=t}},Vu=class{constructor(t,e,n){this._userDataWriter=e,this._data=n,this.type="AggregateQuerySnapshot",this.query=t}data(){return this._userDataWriter.convertObjectMap(this._data)}};var Qn=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(mt.fromBase64String(t))}catch(e){throw new C(b.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(mt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var de=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new C(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};function Xp(){return new de("__name__")}var fe=class{constructor(t){this._methodName=t}};var ri=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new C(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new C(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return j(this._lat,t._lat)||j(this._long,t._long)}};var Wn=class{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,t._values)}};var fp=/^__.*__$/,xu=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new Kt(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ne(t,this.data,e,this.fieldTransforms)}},qs=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Kt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function Af(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw O()}}var Us=class r{constructor(t,e,n,i,s,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.Fu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(t){return new r(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.xu({path:n,Nu:!1});return i.Lu(t),i}Bu(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.xu({path:n,Nu:!1});return i.Fu(),i}ku(t){return this.xu({path:void 0,Nu:!0})}qu(t){return Bs(t,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Fu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Lu(this.path.get(t))}Lu(t){if(t.length===0)throw this.qu("Document fields must not be empty");if(Af(this.Mu)&&fp.test(t))throw this.qu('Document fields cannot begin and end with "__"')}},Cu=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||di(t)}$u(t,e,n,i=!1){return new Us({Mu:t,methodName:e,Ku:n,path:wt.emptyPath(),Nu:!1,Qu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function hn(r){let t=r._freezeSettings(),e=di(r._databaseId);return new Cu(r._databaseId,!!t.ignoreUndefinedProperties,e)}function eo(r,t,e,n,i,s={}){let a=r.$u(s.merge||s.mergeFields?2:0,t,e,i);Ec("Data must be an object, but it was:",a,n);let u=bf(n,a),c,d;if(s.merge)c=new qt(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let g of s.mergeFields){let _=si(t,g,e);if(!a.contains(_))throw new C(b.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);Vf(f,_)||f.push(_)}c=new qt(f),d=a.fieldTransforms.filter(g=>c.covers(g.field))}else c=null,d=a.fieldTransforms;return new xu(new xt(u),c,d)}var ii=class r extends fe{_toFieldTransform(t){if(t.Mu!==2)throw t.Mu===1?t.qu(`${this._methodName}() can only appear at the top level of your update data`):t.qu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};function Sf(r,t,e){return new Us({Mu:3,Ku:t.settings.Ku,methodName:r._methodName,Nu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var Du=class r extends fe{_toFieldTransform(t){return new rn(t.path,new Ce)}isEqual(t){return t instanceof r}},Nu=class r extends fe{constructor(t,e){super(t),this.Uu=e}_toFieldTransform(t){let e=Sf(this,t,!0),n=this.Uu.map(s=>dn(s,e)),i=new le(n);return new rn(t.path,i)}isEqual(t){return t instanceof r&&Ar(this.Uu,t.Uu)}},ku=class r extends fe{constructor(t,e){super(t),this.Uu=e}_toFieldTransform(t){let e=Sf(this,t,!0),n=this.Uu.map(s=>dn(s,e)),i=new he(n);return new rn(t.path,i)}isEqual(t){return t instanceof r&&Ar(this.Uu,t.Uu)}},Fu=class r extends fe{constructor(t,e){super(t),this.Wu=e}_toFieldTransform(t){let e=new De(t.serializer,wd(t.serializer,this.Wu));return new rn(t.path,e)}isEqual(t){return t instanceof r&&this.Wu===t.Wu}};function Tc(r,t,e,n){let i=r.$u(1,t,e);Ec("Data must be an object, but it was:",i,n);let s=[],a=xt.empty();Ue(n,(c,d)=>{let f=no(t,c,e);d=Tt(d);let g=i.Bu(f);if(d instanceof ii)s.push(f);else{let _=dn(d,g);_!=null&&(s.push(f),a.set(f,_))}});let u=new qt(s);return new qs(a,u,i.fieldTransforms)}function Ic(r,t,e,n,i,s){let a=r.$u(1,t,e),u=[si(t,n,e)],c=[i];if(s.length%2!=0)throw new C(b.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(si(t,s[_])),c.push(s[_+1]);let d=[],f=xt.empty();for(let _=u.length-1;_>=0;--_)if(!Vf(d,u[_])){let R=u[_],N=c[_];N=Tt(N);let k=a.Bu(R);if(N instanceof ii)d.push(R);else{let x=dn(N,k);x!=null&&(d.push(R),f.set(R,x))}}let g=new qt(d);return new qs(f,g,a.fieldTransforms)}function Rf(r,t,e,n=!1){return dn(e,r.$u(n?4:3,t))}function dn(r,t){if(Pf(r=Tt(r)))return Ec("Unsupported field value:",t,r),bf(r,t);if(r instanceof fe)return function(n,i){if(!Af(i.Mu))throw i.qu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.qu(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.Nu&&t.Mu!==4)throw t.qu("Nested arrays are not supported");return function(n,i){let s=[],a=0;for(let u of n){let c=dn(u,i.ku(a));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,t)}return function(n,i){if((n=Tt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return wd(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=ht.fromDate(n);return{timestampValue:Ln(i.serializer,s)}}if(n instanceof ht){let s=new ht(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Ln(i.serializer,s)}}if(n instanceof ri)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Qn)return{bytesValue:Vd(i.serializer,n._byteString)};if(n instanceof ft){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.qu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:rc(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof Wn)return function(a,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(c=>{if(typeof c!="number")throw u.qu("VectorValues must only contain numeric values.");return nc(u.serializer,c)})}}}}}}(n,i);throw i.qu(`Unsupported field value: ${to(n)}`)}(r,t)}function bf(r,t){let e={};return td(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ue(r,(n,i)=>{let s=dn(i,t.Ou(n));s!=null&&(e[n]=s)}),{mapValue:{fields:e}}}function Pf(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof ht||r instanceof ri||r instanceof Qn||r instanceof ft||r instanceof fe||r instanceof Wn)}function Ec(r,t,e){if(!Pf(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){let n=to(e);throw n==="an object"?t.qu(r+" a custom object"):t.qu(r+" "+n)}}function si(r,t,e){if((t=Tt(t))instanceof de)return t._internalPath;if(typeof t=="string")return no(r,t);throw Bs("Field path arguments must be of type string or ",r,!1,void 0,e)}var mp=new RegExp("[~\\*/\\[\\]]");function no(r,t,e){if(t.search(mp)>=0)throw Bs(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new de(...t.split("."))._internalPath}catch{throw Bs(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function Bs(r,t,e,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new C(b.INVALID_ARGUMENT,u+r+c)}function Vf(r,t){return r.some(e=>e.isEqual(t))}var cn=class{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ft(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Mu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(ro("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Mu=class extends cn{data(){return super.data()}};function ro(r,t){return typeof t=="string"?no(r,t):t instanceof de?t._internalPath:t._delegate._internalPath}function xf(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new C(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var oi=class{},ln=class extends oi{};function Yp(r,t,...e){let n=[];t instanceof oi&&n.push(t),n=n.concat(e),function(s){let a=s.filter(c=>c instanceof Hn).length,u=s.filter(c=>c instanceof ai).length;if(a>1||a>0&&u>0)throw new C(b.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var ai=class r extends ln{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return Df(t._query,e),new At(t.firestore,t.converter,pa(t._query,e))}_parse(t){let e=hn(t.firestore);return function(s,a,u,c,d,f,g){let _;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new C(b.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){qh(g,f);let R=[];for(let N of g)R.push(Oh(c,s,N));_={arrayValue:{values:R}}}else _=Oh(c,s,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||qh(g,f),_=Rf(u,a,g,f==="in"||f==="not-in");return H.create(d,f,_)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function Zp(r,t,e){let n=t,i=ro("where",r);return ai._create(i,n,e)}var Hn=class r extends oi{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:tt.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let a=i,u=s.getFlattenedFilters();for(let c of u)Df(a,c),a=pa(a,c)}(t._query,e),new At(t.firestore,t.converter,pa(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};function t_(...r){return r.forEach(t=>Nf("or",t)),Hn._create("or",r)}function e_(...r){return r.forEach(t=>Nf("and",t)),Hn._create("and",r)}var Lu=class r extends ln{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=function(i,s,a){if(i.startAt!==null)throw new C(b.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new C(b.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new en(s,a)}(t._query,this._field,this._direction);return new At(t.firestore,t.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new zt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}};function n_(r,t="asc"){let e=t,n=ro("orderBy",r);return Lu._create(n,e)}var Gs=class r extends ln{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new At(t.firestore,t.converter,is(t._query,this._limit,this._limitType))}};function r_(r){return vf("limit",r),Gs._create("limit",r,"F")}function i_(r){return vf("limitToLast",r),Gs._create("limitToLast",r,"L")}var zs=class r extends ln{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Cf(t,this.type,this._docOrFields,this._inclusive);return new At(t.firestore,t.converter,function(i,s){return new zt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(t._query,e))}};function s_(...r){return zs._create("startAt",r,!0)}function o_(...r){return zs._create("startAfter",r,!1)}var js=class r extends ln{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Cf(t,this.type,this._docOrFields,this._inclusive);return new At(t.firestore,t.converter,function(i,s){return new zt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(t._query,e))}};function a_(...r){return js._create("endBefore",r,!1)}function u_(...r){return js._create("endAt",r,!0)}function Cf(r,t,e,n){if(e[0]=Tt(e[0]),e[0]instanceof cn)return function(s,a,u,c,d){if(!c)throw new C(b.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let g of bn(s))if(g.field.isKeyField())f.push(tn(a,c.key));else{let _=c.data.field(g.field);if($s(_))throw new C(b.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let R=g.field.canonicalString();throw new C(b.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${R}' (used as the orderBy) does not exist.`)}f.push(_)}return new Zt(f,d)}(r._query,r.firestore._databaseId,t,e[0]._document,n);{let i=hn(r.firestore);return function(a,u,c,d,f,g){let _=a.explicitOrderBy;if(f.length>_.length)throw new C(b.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let R=[];for(let N=0;N<f.length;N++){let k=f[N];if(_[N].field.isKeyField()){if(typeof k!="string")throw new C(b.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof k}`);if(!tc(a)&&k.indexOf("/")!==-1)throw new C(b.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${k}' contains a slash.`);let x=a.path.child(X.fromString(k));if(!L.isDocumentKey(x))throw new C(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${x}' is not because it contains an odd number of segments.`);let G=new L(x);R.push(tn(u,G))}else{let x=Rf(c,d,k);R.push(x)}}return new Zt(R,g)}(r._query,r.firestore._databaseId,i,t,e,n)}}function Oh(r,t,e){if(typeof(e=Tt(e))=="string"){if(e==="")throw new C(b.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!tc(t)&&e.indexOf("/")!==-1)throw new C(b.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(X.fromString(e));if(!L.isDocumentKey(n))throw new C(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return tn(r,new L(n))}if(e instanceof ft)return tn(r,e._key);throw new C(b.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${to(e)}.`)}function qh(r,t){if(!Array.isArray(r)||r.length===0)throw new C(b.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Df(r,t){let e=function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new C(b.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new C(b.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}function Nf(r,t){if(!(t instanceof ai||t instanceof Hn))throw new C(b.INVALID_ARGUMENT,`Function ${r}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}var Ks=class{convertValue(t,e="none"){switch(Ve(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ot(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ce(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw O()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return Ue(t,(i,s)=>{n[i]=this.convertValue(s,e)}),n}convertVectorValue(t){var e,n,i;let s=(i=(n=(e=t.fields)===null||e===void 0?void 0:e.value.arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(a=>ot(a.doubleValue));return new Wn(s)}convertGeoPoint(t){return new ri(ot(t.latitude),ot(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=Qs(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(qr(t));default:return null}}convertTimestamp(t){let e=ue(t);return new ht(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=X.fromString(t);q(Ud(n));let i=new Dn(n.get(1),n.get(3)),s=new L(n.popFirst(5));return i.isEqual(e)||lt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function io(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var Ou=class extends Ks{constructor(t){super(),this.firestore=t}convertBytes(t){return new Qn(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ft(this.firestore,null,e)}};function c_(r){return new un("sum",si("sum",r))}function l_(r){return new un("avg",si("average",r))}function gp(){return new un("count")}function h_(r,t){var e,n;return r instanceof un&&t instanceof un&&r.aggregateType===t.aggregateType&&((e=r._internalFieldPath)===null||e===void 0?void 0:e.canonicalString())===((n=t._internalFieldPath)===null||n===void 0?void 0:n.canonicalString())}function d_(r,t){return Tf(r.query,t.query)&&Ar(r.data(),t.data())}var oe=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Me=class extends cn{constructor(t,e,n,i,s,a){super(t,e,n,i,a),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Vn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(ro("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}},Vn=class extends Me{data(t={}){return super.data(t)}},Le=class{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new oe(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Vn(this._firestore,this._userDataWriter,n.key,n,new oe(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new C(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let c=new Vn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new oe(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let c=new Vn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new oe(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:pp(u.type),doc:c,oldIndex:d,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function pp(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return O()}}function f_(r,t){return r instanceof Me&&t instanceof Me?r._firestore===t._firestore&&r._key.isEqual(t._key)&&(r._document===null?t._document===null:r._document.isEqual(t._document))&&r._converter===t._converter:r instanceof Le&&t instanceof Le&&r._firestore===t._firestore&&Tf(r.query,t.query)&&r.metadata.isEqual(t.metadata)&&r._snapshot.isEqual(t._snapshot)}function m_(r){r=W(r,ft);let t=W(r.firestore,et);return _f(at(t),r._key).then(e=>Ac(t,r,e))}var te=class extends Ks{constructor(t){super(),this.firestore=t}convertBytes(t){return new Qn(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ft(this.firestore,null,e)}};function g_(r){r=W(r,ft);let t=W(r.firestore,et),e=at(t),n=new te(t);return ep(e,r._key).then(i=>new Me(t,n,r._key,i,new oe(i!==null&&i.hasLocalMutations,!0),r.converter))}function p_(r){r=W(r,ft);let t=W(r.firestore,et);return _f(at(t),r._key,{source:"server"}).then(e=>Ac(t,r,e))}function __(r){r=W(r,At);let t=W(r.firestore,et),e=at(t),n=new te(t);return xf(r._query),yf(e,r._query).then(i=>new Le(t,n,r,i))}function y_(r){r=W(r,At);let t=W(r.firestore,et),e=at(t),n=new te(t);return np(e,r._query).then(i=>new Le(t,n,r,i))}function w_(r){r=W(r,At);let t=W(r.firestore,et),e=at(t),n=new te(t);return yf(e,r._query,{source:"server"}).then(i=>new Le(t,n,r,i))}function v_(r,t,e){r=W(r,ft);let n=W(r.firestore,et),i=io(r.converter,t,e);return mi(n,[eo(hn(n),"setDoc",r._key,i,r.converter!==null,e).toMutation(r._key,ct.none())])}function T_(r,t,e,...n){r=W(r,ft);let i=W(r.firestore,et),s=hn(i),a;return a=typeof(t=Tt(t))=="string"||t instanceof de?Ic(s,"updateDoc",r._key,t,e,n):Tc(s,"updateDoc",r._key,t),mi(i,[a.toMutation(r._key,ct.exists(!0))])}function I_(r){return mi(W(r.firestore,et),[new ke(r._key,ct.none())])}function E_(r,t){let e=W(r.firestore,et),n=dp(r),i=io(r.converter,t);return mi(e,[eo(hn(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,ct.exists(!1))]).then(()=>n)}function A_(r,...t){var e,n,i;r=Tt(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||bu(t[a])||(s=t[a],a++);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(bu(t[a])){let g=t[a];t[a]=(e=g.next)===null||e===void 0?void 0:e.bind(g),t[a+1]=(n=g.error)===null||n===void 0?void 0:n.bind(g),t[a+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let c,d,f;if(r instanceof ft)d=W(r.firestore,et),f=Xn(r._key.path),c={next:g=>{t[a]&&t[a](Ac(d,r,g))},error:t[a+1],complete:t[a+2]};else{let g=W(r,At);d=W(g.firestore,et),f=g._query;let _=new te(d);c={next:R=>{t[a]&&t[a](new Le(d,_,g,R))},error:t[a+1],complete:t[a+2]},xf(r._query)}return function(_,R,N,k){let x=new Kn(k),G=new ti(R,x,N);return _.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return lc(yield $n(_),G)})),()=>{x.eu(),_.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return hc(yield $n(_),G)}))}}(at(d),f,u,c)}function S_(r,t){return ip(at(r=W(r,et)),bu(t)?t:{next:t})}function mi(r,t){return function(n,i){let s=new yt;return n.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return Lg(yield wc(n),i,s)})),s.promise}(at(r),t)}function Ac(r,t,e){let n=e.docs.get(t._key),i=new te(r);return new Me(r,i,t._key,n,new oe(e.hasPendingWrites,e.fromCache),t.converter)}function R_(r){return _p(r,{count:gp()})}function _p(r,t){let e=W(r.firestore,et),n=at(e),i=Zh(t,(s,a)=>new ss(a,s.aggregateType,s._internalFieldPath));return rp(n,r._query,i).then(s=>function(u,c,d){let f=new te(u);return new Vu(c,f,d)}(e,r,s))}var qu=class{constructor(t){this.kind="memory",this._onlineComponentProvider=nr.provider,t?.garbageCollector?this._offlineComponentProvider=t.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new ei(void 0)}}toJSON(){return{kind:this.kind}}},Uu=class{constructor(t){let e;this.kind="persistent",t?.tabManager?(t.tabManager._initialize(t),e=t.tabManager):(e=yp(void 0),e._initialize(t)),this._onlineComponentProvider=e._onlineComponentProvider,this._offlineComponentProvider=e._offlineComponentProvider}toJSON(){return{kind:this.kind}}},Bu=class{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Ys.provider}toJSON(){return{kind:this.kind}}},Gu=class{constructor(t){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new ei(t)}}toJSON(){return{kind:this.kind}}};function b_(){return new Bu}function P_(r){return new Gu(r?.cacheSizeBytes)}function V_(r){return new qu(r)}function x_(r){return new Uu(r)}var zu=class{constructor(t){this.forceOwnership=t,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=nr.provider,this._offlineComponentProvider={build:e=>new ni(e,t?.cacheSizeBytes,this.forceOwnership)}}},ju=class{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=nr.provider,this._offlineComponentProvider={build:e=>new Ms(e,t?.cacheSizeBytes)}}};function yp(r){return new zu(r?.forceOwnership)}function C_(){return new ju}var wp={maxAttempts:5};var Ku=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=hn(t)}set(t,e,n){this._verifyNotCommitted();let i=Ae(t,this._firestore),s=io(i.converter,e,n),a=eo(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,ct.none())),this}update(t,e,n,...i){this._verifyNotCommitted();let s=Ae(t,this._firestore),a;return a=typeof(e=Tt(e))=="string"||e instanceof de?Ic(this._dataReader,"WriteBatch.update",s._key,e,n,i):Tc(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(a.toMutation(s._key,ct.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Ae(t,this._firestore);return this._mutations=this._mutations.concat(new ke(e._key,ct.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(b.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ae(r,t){if((r=Tt(r)).firestore!==t)throw new C(b.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var $u=class extends class{constructor(e,n){this._firestore=e,this._transaction=n,this._dataReader=hn(e)}get(e){let n=Ae(e,this._firestore),i=new Ou(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return O();let a=s[0];if(a.isFoundDocument())return new cn(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new cn(this._firestore,i,n._key,null,n.converter);throw O()})}set(e,n,i){let s=Ae(e,this._firestore),a=io(s.converter,n,i),u=eo(this._dataReader,"Transaction.set",s._key,a,s.converter!==null,i);return this._transaction.set(s._key,u),this}update(e,n,i,...s){let a=Ae(e,this._firestore),u;return u=typeof(n=Tt(n))=="string"||n instanceof de?Ic(this._dataReader,"Transaction.update",a._key,n,i,s):Tc(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(e){let n=Ae(e,this._firestore);return this._transaction.delete(n._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=Ae(t,this._firestore),n=new te(this._firestore);return super.get(t).then(i=>new Me(this._firestore,n,e._key,i._document,new oe(!1,!1),e.converter))}};function N_(r,t,e){r=W(r,et);let n=Object.assign(Object.assign({},wp),e);return function(s){if(s.maxAttempts<1)throw new C(b.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){let c=new yt;return s.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){let d=yield pf(s);new Su(s.asyncQueue,d,u,a,c).cu()})),c.promise}(at(r),i=>t(new $u(r,i)),n)}function k_(){return new ii("deleteField")}function F_(){return new Du("serverTimestamp")}function M_(...r){return new Nu("arrayUnion",r)}function L_(...r){return new ku("arrayRemove",r)}function O_(r){return new Fu("increment",r)}function q_(r){return new Wn(r)}function U_(r){return at(r=W(r,et)),new Ku(r,t=>mi(r,t))}function B_(r,t){let e=at(r=W(r,et));if(!e._uninitializedComponentsProvider||e._uninitializedComponentsProvider._offline.kind==="memory")return Ut("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(s){let a=typeof s=="string"?function(d){try{return JSON.parse(d)}catch(f){throw new C(b.INVALID_ARGUMENT,"Failed to parse JSON: "+f?.message)}}(s):s,u=[];if(Array.isArray(a.indexes))for(let c of a.indexes){let d=Uh(c,"collectionGroup"),f=[];if(Array.isArray(c.fields))for(let g of c.fields){let _=no("setIndexConfiguration",Uh(g,"fieldPath"));g.arrayConfig==="CONTAINS"?f.push(new ae(_,2)):g.order==="ASCENDING"?f.push(new ae(_,0)):g.order==="DESCENDING"&&f.push(new ae(_,1))}u.push(new be(be.UNKNOWN_ID,d,f,Cn.empty()))}return u}(t);return ap(e,n)}function Uh(r,t){if(typeof r[t]!="string")throw new C(b.INVALID_ARGUMENT,"Missing string value for: "+t);return r[t]}var Qu=class{constructor(t){this._firestore=t,this.type="PersistentCacheIndexManager"}};function G_(r){var t;r=W(r,et);let e=Bh.get(r);if(e)return e;if(((t=at(r)._uninitializedComponentsProvider)===null||t===void 0?void 0:t._offline.kind)!=="persistent")return null;let n=new Qu(r);return Bh.set(r,n),n}function z_(r){kf(r,!0)}function j_(r){kf(r,!1)}function K_(r){cp(at(r._firestore)).then(t=>D("deleting all persistent cache indexes succeeded")).catch(t=>Ut("deleting all persistent cache indexes failed",t))}function kf(r,t){up(at(r._firestore),t).then(e=>D(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>Ut(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}var Bh=new WeakMap;function $_(r){var t;let e=(t=at(W(r.firestore,et))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return e===void 0?null:Hs(e,Dt(r._query)).ct}function Q_(r,t){var e;let n=Zh(t,(s,a)=>new ss(a,s.aggregateType,s._internalFieldPath)),i=(e=at(W(r.firestore,et))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return i===void 0?null:Md(i,ld(r._query),n,!0).request}var Gh=class{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(t){return Wu.instance.onExistenceFilterMismatch(t)}},Wu=class r{constructor(){this.Gu=new Map}static get instance(){return qi||(qi=new r,function(e){if(os)throw new Error("a TestingHooksSpi instance is already set");os=e}(qi)),qi}tt(t){this.Gu.forEach(e=>e(t))}onExistenceFilterMismatch(t){let e=Symbol(),n=this.Gu;return n.set(e,t),()=>n.delete(e)}},qi=null;(function(t,e=!0){(function(i){Jn=i})(kl),Dl(new xl("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),u=new et(new Wo(n.getProvider("auth-internal")),new Xo(n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new C(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Dn(d.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:e},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),ko(Ol,"4.7.5",t),ko(Ol,"4.7.5","esm2017")})();export{xp as a,Ut as b,Cp as c,C as d,$o as e,ql as f,Wi as g,ht as h,wt as i,L as j,Np as k,mt as l,Dn as m,lp as n,W as o,hp as p,At as q,ft as r,Xt as s,Mp as t,Lp as u,dp as v,Op as w,Tf as x,Pu as y,qp as z,et as A,Up as B,Bp as C,at as D,Gp as E,zp as F,jp as G,Kp as H,$p as I,Qp as J,Wp as K,Hp as L,Jp as M,un as N,Vu as O,Qn as P,de as Q,Xp as R,fe as S,ri as T,Wn as U,ln as V,Yp as W,ai as X,Zp as Y,Hn as Z,t_ as _,e_ as $,Lu as aa,n_ as ba,Gs as ca,r_ as da,i_ as ea,zs as fa,s_ as ga,o_ as ha,js as ia,a_ as ja,u_ as ka,Ks as la,c_ as ma,l_ as na,gp as oa,h_ as pa,d_ as qa,oe as ra,Me as sa,Vn as ta,Le as ua,f_ as va,m_ as wa,g_ as xa,p_ as ya,__ as za,y_ as Aa,w_ as Ba,v_ as Ca,T_ as Da,I_ as Ea,E_ as Fa,A_ as Ga,S_ as Ha,mi as Ia,R_ as Ja,_p as Ka,b_ as La,P_ as Ma,V_ as Na,x_ as Oa,yp as Pa,C_ as Qa,Ku as Ra,$u as Sa,N_ as Ta,k_ as Ua,F_ as Va,M_ as Wa,L_ as Xa,O_ as Ya,q_ as Za,U_ as _a,B_ as $a,Qu as ab,G_ as bb,z_ as cb,j_ as db,K_ as eb,$_ as fb,Q_ as gb,Gh as hb};
