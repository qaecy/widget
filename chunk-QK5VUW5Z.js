import{a as A}from"./chunk-22TYSVVA.js";import{O as o,S as a,Ta as n,bc as S,cc as R,ec as L}from"./chunk-C37SL542.js";import{Da as M,N as G,ea as k,ja as B,ka as H,l as P,sa as V,v as F}from"./chunk-LOUWY4NJ.js";import{Ca as E,W as Z,Y as q,t as w,v as h,wa as O,za as W}from"./chunk-RIETPOXV.js";import{d as J}from"./chunk-5W727OWZ.js";import{O as z}from"./chunk-I7PEP2DU.js";import{a as g,h as i}from"./chunk-TJICSKBO.js";var T=function(t){return t.AUTH_USER_INPUT_NEEDED="'Your setup requires input from the user either because one than one SSO provider is set or because user/pw is required. User input is therefore needed'",t.LAST_VISIT_SET="Last visit updated",t.NO_FILES_NO_SYNC_RIGHTS="The project has no files and you do not have sync rights. Therefore, there is nothing to search. Please reach out to a project admin.",t.ORGANIZATIONS_NONE="The user is not assosiated with an organization.",t.ORGANIZATIONS_SINGLE="The user is assosiated with exactly one organization.",t.ORGANIZATIONS_MULTIPLE="The user is assosiated with more than one organization.",t.PROJECT_HAS_DATA="Received project data",t.PROJECT_NO_DATA="No data found for the specified project",t}(T||{});var K=class{id;name;created=new Date().toISOString();admins=[];members=[];alternativeIDs=[];constructor(u=A(),e="ABC"){this.id=u,this.name=e,this.alternativeIDs=[u]}},Y=class{organizationID;id;name;created=new Date().toISOString();lastSync=null;isPublic=!1;members=[];syncers=[];admins=[];alternativeIDs=[];syncDetails={};constructor(u,e=A(),r="ABC"){this.organizationID=u,this.id=e,this.name=r,this.alternativeIDs=[e]}},b=class{id;projectId;userId;created=new Date().toISOString();updated=new Date().toISOString();constructor(u=A(),e,r){this.id=u,this.projectId=e,this.userId=r}};var Q=class extends b{entries=[]};var C=class{auth=new U;menuAlwaysVisible=!1;menuOptions=[j.ASSISTANT,j.SYNC_OVERVIEW,j.SIGN_OUT];hostApp=$.SHAREPOINT;config},U=class{providers=[I.MICROSOFT];persistence=m.LOCAL},j=function(t){return t.ASSISTANT="ASSISTANT",t.SYNC_OVERVIEW="SYNC_OVERVIEW",t.SIGN_OUT="SIGN_OUT",t}(j||{}),I=function(t){return t.GOOGLE="GOOGLE",t.MICROSOFT="microsoft.com",t.USER_PW="USER_PW",t.NO_AUTH="NO_AUTH",t}(I||{}),m=function(t){return t.LOCAL="LOCAL",t.SESSION="SESSION",t.NONE="NONE",t}(m||{}),$=function(t){return t.SHAREPOINT="SharePoint",t.QAECY="QAECY",t}($||{});var y=(()=>{class t{_auth;_persistence=m.NONE;_user=n(void 0);_selectedProvider=n(void 0);constructor(){this._auth=M(z()),this._auth.onAuthStateChanged(e=>{e?this._user.update(()=>Object.assign({},e)):this._user.update(()=>{})})}get user(){return this._user}setPersistence(e){return i(this,null,function*(){if(this._persistence!==e){switch(this._persistence=e,e){case m.LOCAL:yield this._auth.setPersistence(B);break;case m.SESSION:yield this._auth.setPersistence(H);break;case m.NONE:yield this._auth.setPersistence(P);break;default:yield this._auth.setPersistence(P)}console.info(`New persistence setting: ${e}`)}})}set providers(e){if(e.length===1){let r=e[0];r!==I.USER_PW&&r!==I.NO_AUTH&&this._selectedProvider.set(e[0])}}set selectedProvider(e){this._selectedProvider.set(e),this._user()===void 0&&this.getUserOrRequestSignIn()}signOut(){return i(this,null,function*(){yield k(this._auth)})}getUserOrRequestSignIn(){return i(this,null,function*(){let e=this._auth.currentUser,r=this._selectedProvider();if(!e)if(r!==void 0){let s=new F(r);e=(yield V(this._auth,s)).user}else console.info(T.AUTH_USER_INPUT_NEEDED);return e})}userPWSignIn(e,r){return i(this,null,function*(){return(yield G(this._auth,e,r)).user})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var X="chat_sessions_eu_west6",tt="spaces_raw_eu_west6",et="spaces_processed_eu_west6",rt="chatSessions",st="organizations",it="projects",ot="users",nt="assistant",at="europe-west6";var N=(()=>{class t{_app;_functionAssistant;_storageProcessed;_storageRaw;_storageChatSessions;_collectionChatSessions;_collectionOrganizations;_collectionProjects;_collectionUsers;_ready=n(!1);get app(){return this._app}get functionAssistant(){return this._functionAssistant}get storageProcessed(){return this._storageProcessed}get storageRaw(){return this._storageRaw}get storageChatSessions(){return this._storageChatSessions}get collectionChatSessions(){return this._collectionChatSessions}get collectionOrganizations(){return this._collectionOrganizations}get collectionProjects(){return this._collectionProjects}get collectionUsers(){return this._collectionUsers}get ready(){return this._ready}init(e){return i(this,null,function*(){let{initializeApp:r}=yield import("./chunk-T55IXFYO.js"),{connectAuthEmulator:s,getAuth:c}=yield import("./chunk-FSR74QIJ.js"),{connectFirestoreEmulator:d,getFirestore:p}=yield import("./chunk-L47NBMHW.js"),{connectFunctionsEmulator:_t,getFunctions:It}=yield import("./chunk-VYPQH4FX.js"),{connectStorageEmulator:D,getStorage:v}=yield import("./chunk-4H5XM4KJ.js"),mt=Object.assign(e,{authDomain:"qaecy-widget.firebaseapp.com",projectId:"qaecy-widget",messagingSenderId:"734737865998"}),_=r(mt),x=It(_,at);this._functionAssistant=J(x,nt),this._storageProcessed=v(_,et),this._storageRaw=v(_,tt),this._storageChatSessions=v(_,X),this._collectionChatSessions=w(p(),rt),this._collectionOrganizations=w(p(),st),this._collectionProjects=w(p(),it),this._collectionUsers=w(p(),ot),e.useEmulator&&(s(c(_),"http://localhost:9099"),d(p(_),"localhost",8080),_t(x,"localhost",5001),D(this._storageProcessed,"localhost",9199),D(this._storageRaw,"localhost",9199),D(this._storageChatSessions,"localhost",9199),console.info("Firebase emulators attached")),this._app=_,this._ready.set(!0)})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var f=function(t){return t.FIREBASE_NOT_INITIALIZED="Firebase has not been initialized",t.MISSING_CONFIG='"Please provide config using init() method!"',t.MISSING_PROJECT_DATA="Project data is not available",t.MISSING_PROJECT_ID='No project id is defined. Please specify using the "pid" attribute',t.MISSING_USER_ID="User id is not available.",t.ORG_NO_ADMINS_SELECTED="An organization must have at least one admin",t.ORG_NO_MEMBERS_SELECTED="An organization must have at least one member",t.PROJ_NO_ADMINS_SELECTED="A project must have at least one admin",t.PROJ_NO_MEMBERS_SELECTED="A project must have at least one member",t}(f||{});var ct=(()=>{class t{_firebase=a(N);_collection=this._firebase.collectionProjects;getProjectData(e){return i(this,null,function*(){if(this._collection===void 0)throw new Error(f.FIREBASE_NOT_INITIALIZED);let r=h(this._collection,e);try{return(yield O(r)).data()}catch(s){console.warn(s);return}})}createProjectIfNotExists(e){return i(this,null,function*(){if(this._collection===void 0)throw new Error(f.FIREBASE_NOT_INITIALIZED);let r=h(this._collection,e.id);try{yield E(r,g({},e))}catch(s){console.warn(s)}})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var ut=(()=>{class t{_repo=a(ct);_projectId=n(void 0);_projectData=n(void 0);hostInfo=n(void 0);set projectId(e){e!==this._projectId()&&(this._projectId.set(e),this._fetchProjectData())}get projectData(){return this._projectData}createProject(e){return i(this,null,function*(){yield this._repo.createProjectIfNotExists(e),yield this._fetchProjectData()})}_fetchProjectData(){return i(this,null,function*(){let e=this._projectId();if(e===void 0)throw new Error("Project not set");let r=yield this._repo.getProjectData(e);r===void 0?this._projectData.set(null):this._projectData.update(()=>Object.assign({},r))})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var dt=(()=>{class t{_firebase=a(N);_collection=this._firebase.collectionOrganizations;getUserOrganizations(e){return i(this,null,function*(){if(this._collection===void 0)throw new Error(f.FIREBASE_NOT_INITIALIZED);try{let r=[];for(let s of e){let d=(yield W(Z(this._collection,q("members","array-contains",s)))).docs.map(p=>p.data());if(d.length){r=d;break}}return r}catch(r){return console.warn(r),[]}})}createOrganizationIfNotExists(e){return i(this,null,function*(){if(this._collection===void 0)throw new Error(f.FIREBASE_NOT_INITIALIZED);let r=h(this._collection,e.id);try{if((yield O(r)).exists())return;let c=yield E(r,g({},e));console.log(c)}catch(s){console.warn(s)}})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var ft=(()=>{class t{_firebase=a(N);_collection=this._firebase.collectionUsers;getUserData(e,r=!0){return i(this,null,function*(){if(this._collection===void 0)throw new Error(f.FIREBASE_NOT_INITIALIZED);let s=h(this._collection,e),d=(yield O(s)).data();return r&&d!==void 0&&this._setLastVisit(d),d})}_setLastVisit(e){return i(this,null,function*(){if(this._collection===void 0)throw new Error(f.FIREBASE_NOT_INITIALIZED);let r=h(this._collection,e.id);e.lastVisit=new Date().toISOString(),yield E(r,g({},e)),console.info(T.LAST_VISIT_SET)})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var ht=(t,u)=>t===u?!0:t===void 0||u===void 0||t.length!==u.length?!1:t.every((e,r)=>e===u[r]);var lt=(()=>{class t{_repo=a(ft);_auth=a(y);_organizationRepo=a(dt);organizations=n(void 0,{equal:(e,r)=>e!==void 0&&r!==void 0&&ht(e,r)});_userData=n(void 0);isOrgAdmin=n(!1);_userIds=n([]);onUserChange=L(()=>i(this,null,function*(){if(this._auth.user()===void 0){this.organizations.update(()=>{});return}this.fetchUserOrganizations(),this._fetchUserData()}));get userIds(){return this._userIds}get userData(){return this._userData}fetchUserOrganizations(){return i(this,null,function*(){let e=this._auth.user();if(e===void 0)throw new Error("Can't fetch organizations when user is not signed in");let r=e.providerData.map(d=>d.uid),s=[e.uid,...r];if(e===void 0)throw new Error("User not set");let c=yield this._organizationRepo.getUserOrganizations(s);this._userIds.set(s),this.organizations.update(()=>[...c])})}_fetchUserData(){return i(this,null,function*(){let e=this._auth.user();if(e===void 0)throw new Error("Can't fetch user data when user is not signed in");let r=yield this._repo.getUserData(e.uid);this._userData.update(()=>Object.assign({},r))})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var pt=(()=>{class t{options=n(new C);static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Fe=(()=>{class t{_optionsService=a(pt);_auth=a(y);_user=a(lt);_project=a(ut);view=n("sync");_selectedOrganization=R(()=>{let e=this._user.organizations();if(!(e===void 0||!e.length)&&e.length===1)return e[0]});_userIsOrgAdmin=S(()=>{let e=this._selectedOrganization();return e===void 0?!1:this._isCurrentUserOrgAdmin(e)});_userCanSync=S(()=>{let e=this._project.projectData();return!e||e===void 0?!1:this._isCurrentUserSyncer(e)});authDisabled=S(()=>this._optionsService.options().auth.providers.length===1&&this._optionsService.options().auth.providers[0]===I.NO_AUTH);userOrganizations=this._user.organizations;projectData=this._project.projectData;projectExists=S(()=>this.projectData()!==null);userHasOrgs=S(()=>{let e=this.userOrganizations();return!(e===void 0||e.length===0)});set options(e){this._optionsService.options.set(e),this._auth.providers=e.auth.providers,this._auth.setPersistence(e.auth.persistence).then(()=>{this._auth.getUserOrRequestSignIn()}).catch(r=>{console.error(r)})}get options(){return this._optionsService.options}get user(){return this._auth.user}set projectId(e){this._project.projectId=e}get selectedOrganization(){return this._selectedOrganization}set selectedOrganization(e){this._selectedOrganization.set(e)}get userIsOrgAdmin(){return this._userIsOrgAdmin}get userCanSync(){return this._userCanSync}_isCurrentUserOrgAdmin(e){let r=this._user.userIds(),s=!1;for(let c of r)if(e.admins.includes(c)){s=!0;break}return s}_isCurrentUserSyncer(e){let r=this._user.userIds(),s=!1;for(let c of r)if(e.syncers.includes(c)||e.admins.includes(c)){s=!0;break}return s}static \u0275fac=function(r){return new(r||t)};static \u0275prov=o({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();export{K as a,Y as b,Q as c,C as d,j as e,I as f,T as g,y as h,N as i,f as j,ut as k,dt as l,lt as m,pt as n,Fe as o};
