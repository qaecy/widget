import{a as j}from"./chunk-22TYSVVA.js";import{O as n,S as i,Ta as a,bc as m,cc as G,ec as C}from"./chunk-SUJ2ERSS.js";import{Da as J,N as B,ea as W,ja as Z,ka as V,l as P,sa as q,v as k}from"./chunk-GSV7GFVO.js";import{Ca as O,Ga as Q,W as Y,Y as K,t as g,v as p,wa as T,za as $}from"./chunk-QWYGOFBQ.js";import{d as X}from"./chunk-VNCJOYNM.js";import{O as M}from"./chunk-36JE2O54.js";import{a as l}from"./chunk-DAQOROHW.js";var N=function(e){return e.AUTH_USER_INPUT_NEEDED="'Your setup requires input from the user either because one than one SSO provider is set or because user/pw is required. User input is therefore needed'",e.CHAT_SESSION_CREATED="A new chat session was created",e.CREATING_CHAT_SESSION="Creating chat session...",e.LAST_VISIT_SET="Last visit updated",e.NO_FILES_NO_SYNC_RIGHTS="The project has no files and you do not have sync rights. Therefore, there is nothing to search. Please reach out to a project admin.",e.ORGANIZATIONS_NONE="The user is not assosiated with an organization.",e.ORGANIZATIONS_SINGLE="The user is assosiated with exactly one organization.",e.ORGANIZATIONS_MULTIPLE="The user is assosiated with more than one organization.",e.PROJECT_HAS_DATA="Received project data",e.PROJECT_NO_DATA="No data found for the specified project",e}(N||{});var ee=class{id;name;created=new Date().toISOString();admins=[];members=[];alternativeIDs=[];constructor(d=j(),t="ABC"){this.id=d,this.name=t,this.alternativeIDs=[d]}},te=class{organizationID;id;name;created=new Date().toISOString();lastSync=null;isPublic=!1;members=[];syncers=[];admins=[];alternativeIDs=[];syncDetails={};constructor(d,t=j(),r="ABC"){this.organizationID=d,this.id=t,this.name=r,this.alternativeIDs=[t]}},v=class{id;projectId;userId;created=new Date().toISOString();updated=new Date().toISOString();constructor(d=j(),t,r){this.id=d,this.projectId=t,this.userId=r}};var re=class extends v{entries=[]};var D=class{auth=new x;menuAlwaysVisible=!1;menuOptions=[R.ASSISTANT,R.SYNC_OVERVIEW,R.SIGN_OUT];hostApp=se.SHAREPOINT;config},x=class{providers=[S.MICROSOFT];persistence=E.LOCAL},R=function(e){return e.ASSISTANT="ASSISTANT",e.SYNC_OVERVIEW="SYNC_OVERVIEW",e.SIGN_OUT="SIGN_OUT",e}(R||{}),S=function(e){return e.GOOGLE="GOOGLE",e.MICROSOFT="microsoft.com",e.USER_PW="USER_PW",e.NO_AUTH="NO_AUTH",e}(S||{}),E=function(e){return e.LOCAL="LOCAL",e.SESSION="SESSION",e.NONE="NONE",e}(E||{}),se=function(e){return e.SHAREPOINT="SharePoint",e.QAECY="QAECY",e}(se||{});var A=(()=>{class e{_auth;_persistence=E.NONE;_user=a(void 0);_selectedProvider=a(void 0);constructor(){this._auth=J(M()),this._auth.onAuthStateChanged(t=>{t?this._user.update(()=>Object.assign({},t)):this._user.update(()=>{})})}get user(){return this._user}async setPersistence(t){if(this._persistence!==t){switch(this._persistence=t,t){case E.LOCAL:await this._auth.setPersistence(Z);break;case E.SESSION:await this._auth.setPersistence(V);break;case E.NONE:await this._auth.setPersistence(P);break;default:await this._auth.setPersistence(P)}console.info(`New persistence setting: ${t}`)}}set providers(t){if(t.length===1){let r=t[0];r!==S.USER_PW&&r!==S.NO_AUTH&&this._selectedProvider.set(t[0])}}set selectedProvider(t){this._selectedProvider.set(t),this._user()===void 0&&this.getUserOrRequestSignIn()}async signOut(){await W(this._auth)}async getUserOrRequestSignIn(){let t=this._auth.currentUser,r=this._selectedProvider();if(!t)if(r!==void 0){let s=new k(r);t=(await q(this._auth,s)).user}else console.info(N.AUTH_USER_INPUT_NEEDED);return t}async userPWSignIn(t,r){return(await B(this._auth,t,r)).user}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var L="qaecy-mvp-406413";var oe="spaces_chats_eu_west6",ie="spaces_raw_eu_west6",ne="spaces_processed_eu_west6",ae="europe-west6",ce="chatSessions",ue="organizations",de="projects",fe="users",pe="userTermsAcceptance",he="acceptTerms",z="https://accessors-api-gateway-ueyeemwf2a-oa.a.run.app",_e="http://localhost:8093",ke="assistant/chat-session",Be="https://www.qaecy.com/termsofuse",F="567369dcf855a9c0330ea01cc0f98fab";var _=(()=>{class e{_app;_auth;_functionAcceptTerms;_storageProcessed;_storageRaw;_storageChatSessions;_collectionChatSessions;_collectionOrganizations;_collectionProjects;_collectionUsers;_collectionUserTermsAcceptance;_baseURL=z;_ready=a(!1);get app(){return this._app}get functionAcceptTerms(){return this._functionAcceptTerms}get storageProcessed(){return this._storageProcessed}get storageRaw(){return this._storageRaw}get storageChatSessions(){return this._storageChatSessions}get collectionChatSessions(){return this._collectionChatSessions}get collectionOrganizations(){return this._collectionOrganizations}get collectionProjects(){return this._collectionProjects}get collectionUsers(){return this._collectionUsers}get collectionUserTermsAcceptance(){return this._collectionUserTermsAcceptance}get ready(){return this._ready}async init(t){let{initializeApp:r}=await import("./chunk-ZICKP5DU.js"),{connectAuthEmulator:s,getAuth:o}=await import("./chunk-SLAVO63I.js"),{connectFirestoreEmulator:c,getFirestore:f}=await import("./chunk-UCUTNQLC.js"),{connectFunctionsEmulator:y,getFunctions:w}=await import("./chunk-SOGWAEGZ.js"),{connectStorageEmulator:b,getStorage:U}=await import("./chunk-KLWV5IKU.js"),we=Object.assign(t,{authDomain:`${L}.firebaseapp.com`,projectId:L,messagingSenderId:"734737865998"}),I=r(we),H=w(I,ae);this._functionAcceptTerms=X(H,he),this._storageProcessed=U(I,ne),this._storageRaw=U(I,ie),this._storageChatSessions=U(I,oe),this._collectionChatSessions=g(f(),ce),this._collectionOrganizations=g(f(),ue),this._collectionProjects=g(f(),de),this._collectionUsers=g(f(),fe),this._collectionUserTermsAcceptance=g(f(),pe),this._auth=o(I),t.useEmulator?(this._baseURL=_e,s(this._auth,"http://localhost:9099"),c(f(I),"localhost",8080),y(H,"localhost",5001),b(this._storageProcessed,"localhost",9199),b(this._storageRaw,"localhost",9199),b(this._storageChatSessions,"localhost",9199),console.info("Firebase emulators attached")):this._baseURL=z,this._app=I,this._ready.set(!0)}async sendRequest(t,r,s,o={}){let c={"Content-Type":"application/json"};if(this._auth===void 0)throw new Error("Auth not set");let f=await this._auth.currentUser?.getIdToken();f&&(c.Authorization=`Bearer ${f}`),o.method=r,o.headers=o.headers===void 0?c:l(l({},o.headers),c),s!==void 0&&(o.body=JSON.stringify(s)),r!=="POST"&&delete o.body;let y=`${this._baseURL}/${t}`,w=await fetch(y,o);if(w.status===500)throw console.error(w),new Error("Query failed");return w}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var u=function(e){return e.FIREBASE_NOT_INITIALIZED="Firebase has not been initialized",e.MISSING_CONFIG='"Please provide config using init() method!"',e.MISSING_PROJECT_DATA="Project data is not available",e.MISSING_PROJECT_ID='No project id is defined. Please specify using the "pid" attribute',e.MISSING_USER_ID="User id is not available.",e.ORG_NO_ADMINS_SELECTED="An organization must have at least one admin",e.ORG_NO_MEMBERS_SELECTED="An organization must have at least one member",e.PROJ_NO_ADMINS_SELECTED="A project must have at least one admin",e.PROJ_NO_MEMBERS_SELECTED="A project must have at least one member",e}(u||{});var le=(()=>{class e{_firebase=i(_);_collection=this._firebase.collectionProjects;async getProjectData(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=p(this._collection,t);try{return(await T(r)).data()}catch(s){console.warn(s);return}}async createProjectIfNotExists(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=p(this._collection,t.id);try{await O(r,l({},t))}catch(s){console.warn(s)}}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var me=(()=>{class e{_repo=i(le);_projectId=a(void 0);_projectData=a(void 0);hostInfo=a(void 0);set projectId(t){t!==this._projectId()&&(this._projectId.set(t),this._fetchProjectData())}get projectData(){return this._projectData}async createProject(t){await this._repo.createProjectIfNotExists(t),await this._fetchProjectData()}async _fetchProjectData(){let t=this._projectId();if(t===void 0)throw new Error("Project not set");let r=await this._repo.getProjectData(t);r===void 0?this._projectData.set(null):this._projectData.update(()=>Object.assign({},r))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Ie=(()=>{class e{_firebase=i(_);_collection=this._firebase.collectionOrganizations;async getUserOrganizations(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);try{let r=[];for(let s of t){let c=(await $(Y(this._collection,K("members","array-contains",s)))).docs.map(f=>f.data());if(c.length){r=c;break}}return r}catch(r){return console.warn(r),[]}}async createOrganizationIfNotExists(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=p(this._collection,t.id);try{let s=await T(r);if(console.log("AA"),s.exists())return;let o=await O(r,l({},t));console.log(o)}catch(s){console.warn(s)}}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Se=(()=>{class e{_firebase=i(_);_collection=this._firebase.collectionUsers;async getUserData(t,r=!0){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let s=p(this._collection,t),c=(await T(s)).data();return r&&c!==void 0&&this._setLastVisit(c),c}async _setLastVisit(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=p(this._collection,t.id);t.lastVisit=new Date().toISOString(),await O(r,l({},t)),console.info(N.LAST_VISIT_SET)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Ee=(e,d)=>e===d?!0:e===void 0||d===void 0||e.length!==d.length?!1:e.every((t,r)=>t===d[r]);var ge=(()=>{class e{_repo=i(Se);_auth=i(A);_organizationRepo=i(Ie);organizations=a(void 0,{equal:(t,r)=>t!==void 0&&r!==void 0&&Ee(t,r)});_userData=a(void 0);isOrgAdmin=a(!1);_userIds=a([]);onUserChange=C(async()=>{if(this._auth.user()===void 0){this.organizations.update(()=>{});return}this.fetchUserOrganizations(),this._fetchUserData()});get userIds(){return this._userIds}get userData(){return this._userData}async fetchUserOrganizations(){let t=this._auth.user();if(t===void 0)throw new Error("Can't fetch organizations when user is not signed in");let r=t.providerData.map(c=>c.uid),s=[t.uid,...r];if(t===void 0)throw new Error("User not set");let o=await this._organizationRepo.getUserOrganizations(s);this._userIds.set(s),this.organizations.update(()=>[...o])}async _fetchUserData(){let t=this._auth.user();if(t===void 0)throw new Error("Can't fetch user data when user is not signed in");let r=await this._repo.getUserData(t.uid);this._userData.update(()=>Object.assign({},r))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Te=(()=>{class e{options=a(new D);static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Oe=(()=>{class e{_firebase=i(_);_collection=this._firebase.collectionUserTermsAcceptance;_termsAcceptanceData=a(void 0);get termsAcceptanceData(){return this._termsAcceptanceData}subscribeToUserTermsAcceptance(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=p(this._collection,t);return Q(r,async s=>{if(s.exists()){let o=s.data();this._termsAcceptanceData.update(()=>Object.assign({},o))}})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Ae=(()=>{class e{_firebase=i(_);_auth=i(A);_repo=i(Oe);userHasAcceptedTerms=m(()=>this._repo.termsAcceptanceData()!==void 0);userHasAcceptedOutdatedTerms=m(()=>{let t=this._repo.termsAcceptanceData();return t===void 0?!1:t.documentHash!==F});subscribeToUserTermsAcceptanceOnUserChange=C(async()=>{let t=this._auth.user();t!==void 0&&this._repo.subscribeToUserTermsAcceptance(t.uid)});async setTermsAndConditionsAccept(){let t=this._firebase.functionAcceptTerms;if(t===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let s=await(await fetch("https://api.ipify.org?format=json")).json();await t({documentHash:F,ip:s.ip})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var ir=(()=>{class e{_optionsService=i(Te);_auth=i(A);_user=i(ge);_terms=i(Ae);_project=i(me);view=a("sync");_selectedOrganization=G(()=>{let t=this._user.organizations();if(!(t===void 0||!t.length)&&t.length===1)return t[0]});_userIsOrgAdmin=m(()=>{let t=this._selectedOrganization();return t===void 0?!1:this._isCurrentUserOrgAdmin(t)});_userCanSync=m(()=>{let t=this._project.projectData();return!t||t===void 0?!1:this._isCurrentUserSyncer(t)});authDisabled=m(()=>this._optionsService.options().auth.providers.length===1&&this._optionsService.options().auth.providers[0]===S.NO_AUTH);userOrganizations=this._user.organizations;projectData=this._project.projectData;projectExists=m(()=>this.projectData()!==null);userHasOrgs=m(()=>{let t=this.userOrganizations();return!(t===void 0||t.length===0)});userHasAgreedToTerms=this._terms.userHasAcceptedTerms;userHasAgreedToOutdatedTerms=this._terms.userHasAcceptedOutdatedTerms;set options(t){this._optionsService.options.set(t),this._auth.providers=t.auth.providers,this._auth.setPersistence(t.auth.persistence).then(()=>{this._auth.getUserOrRequestSignIn()}).catch(r=>{console.error(r)})}get options(){return this._optionsService.options}get user(){return this._auth.user}set projectId(t){this._project.projectId=t}get selectedOrganization(){return this._selectedOrganization}set selectedOrganization(t){this._selectedOrganization.set(t)}get userIsOrgAdmin(){return this._userIsOrgAdmin}get userCanSync(){return this._userCanSync}_isCurrentUserOrgAdmin(t){let r=this._user.userIds(),s=!1;for(let o of r)if(t.admins.includes(o)){s=!0;break}return s}_isCurrentUserSyncer(t){let r=this._user.userIds(),s=!1;for(let o of r)if(t.syncers.includes(o)||t.admins.includes(o)){s=!0;break}return s}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();export{ee as a,te as b,re as c,D as d,R as e,S as f,N as g,A as h,ke as i,Be as j,_ as k,u as l,me as m,Ie as n,ge as o,Te as p,Ae as q,ir as r};
