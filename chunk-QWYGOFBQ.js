import{F as xl,G as Co,H as Cl,L as Dl,O as Nl,R as Do,c as Al,e as Sl,f as Ir,l as xo,m as Rl,n as bl,q as Er,v as vt,w as Pl,x as Kt,y as Vl}from"./chunk-36JE2O54.js";var kl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Fl={};var ye,No;(function(){var r;function t(v,p){function w(){}w.prototype=p.prototype,v.D=p.prototype,v.prototype=new w,v.prototype.constructor=v,v.C=function(T,I,A){for(var y=Array(arguments.length-2),te=2;te<arguments.length;te++)y[te-2]=arguments[te];return p.prototype[I].apply(T,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,p,w){w||(w=0);var T=Array(16);if(typeof p=="string")for(var I=0;16>I;++I)T[I]=p.charCodeAt(w++)|p.charCodeAt(w++)<<8|p.charCodeAt(w++)<<16|p.charCodeAt(w++)<<24;else for(I=0;16>I;++I)T[I]=p[w++]|p[w++]<<8|p[w++]<<16|p[w++]<<24;p=v.g[0],w=v.g[1],I=v.g[2];var A=v.g[3],y=p+(A^w&(I^A))+T[0]+3614090360&4294967295;p=w+(y<<7&4294967295|y>>>25),y=A+(I^p&(w^I))+T[1]+3905402710&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(w^A&(p^w))+T[2]+606105819&4294967295,I=A+(y<<17&4294967295|y>>>15),y=w+(p^I&(A^p))+T[3]+3250441966&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(A^w&(I^A))+T[4]+4118548399&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(I^p&(w^I))+T[5]+1200080426&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(w^A&(p^w))+T[6]+2821735955&4294967295,I=A+(y<<17&4294967295|y>>>15),y=w+(p^I&(A^p))+T[7]+4249261313&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(A^w&(I^A))+T[8]+1770035416&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(I^p&(w^I))+T[9]+2336552879&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(w^A&(p^w))+T[10]+4294925233&4294967295,I=A+(y<<17&4294967295|y>>>15),y=w+(p^I&(A^p))+T[11]+2304563134&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(A^w&(I^A))+T[12]+1804603682&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(I^p&(w^I))+T[13]+4254626195&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(w^A&(p^w))+T[14]+2792965006&4294967295,I=A+(y<<17&4294967295|y>>>15),y=w+(p^I&(A^p))+T[15]+1236535329&4294967295,w=I+(y<<22&4294967295|y>>>10),y=p+(I^A&(w^I))+T[1]+4129170786&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^I&(p^w))+T[6]+3225465664&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(A^p))+T[11]+643717713&4294967295,I=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(I^A))+T[0]+3921069994&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(w^I))+T[5]+3593408605&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^I&(p^w))+T[10]+38016083&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(A^p))+T[15]+3634488961&4294967295,I=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(I^A))+T[4]+3889429448&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(w^I))+T[9]+568446438&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^I&(p^w))+T[14]+3275163606&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(A^p))+T[3]+4107603335&4294967295,I=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(I^A))+T[8]+1163531501&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(w^I))+T[13]+2850285829&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^I&(p^w))+T[2]+4243563512&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^w&(A^p))+T[7]+1735328473&4294967295,I=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(I^A))+T[12]+2368359562&4294967295,w=I+(y<<20&4294967295|y>>>12),y=p+(w^I^A)+T[5]+4294588738&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^I)+T[8]+2272392833&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^w)+T[11]+1839030562&4294967295,I=A+(y<<16&4294967295|y>>>16),y=w+(I^A^p)+T[14]+4259657740&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(w^I^A)+T[1]+2763975236&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^I)+T[4]+1272893353&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^w)+T[7]+4139469664&4294967295,I=A+(y<<16&4294967295|y>>>16),y=w+(I^A^p)+T[10]+3200236656&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(w^I^A)+T[13]+681279174&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^I)+T[0]+3936430074&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^w)+T[3]+3572445317&4294967295,I=A+(y<<16&4294967295|y>>>16),y=w+(I^A^p)+T[6]+76029189&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(w^I^A)+T[9]+3654602809&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^I)+T[12]+3873151461&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^w)+T[15]+530742520&4294967295,I=A+(y<<16&4294967295|y>>>16),y=w+(I^A^p)+T[2]+3299628645&4294967295,w=I+(y<<23&4294967295|y>>>9),y=p+(I^(w|~A))+T[0]+4096336452&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~I))+T[7]+1126891415&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~w))+T[14]+2878612391&4294967295,I=A+(y<<15&4294967295|y>>>17),y=w+(A^(I|~p))+T[5]+4237533241&4294967295,w=I+(y<<21&4294967295|y>>>11),y=p+(I^(w|~A))+T[12]+1700485571&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~I))+T[3]+2399980690&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~w))+T[10]+4293915773&4294967295,I=A+(y<<15&4294967295|y>>>17),y=w+(A^(I|~p))+T[1]+2240044497&4294967295,w=I+(y<<21&4294967295|y>>>11),y=p+(I^(w|~A))+T[8]+1873313359&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~I))+T[15]+4264355552&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~w))+T[6]+2734768916&4294967295,I=A+(y<<15&4294967295|y>>>17),y=w+(A^(I|~p))+T[13]+1309151649&4294967295,w=I+(y<<21&4294967295|y>>>11),y=p+(I^(w|~A))+T[4]+4149444226&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~I))+T[11]+3174756917&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~w))+T[2]+718787259&4294967295,I=A+(y<<15&4294967295|y>>>17),y=w+(A^(I|~p))+T[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,v.g[2]=v.g[2]+I&4294967295,v.g[3]=v.g[3]+A&4294967295}n.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var w=p-this.blockSize,T=this.B,I=this.h,A=0;A<p;){if(I==0)for(;A<=w;)i(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<p;)if(T[I++]=v.charCodeAt(A++),I==this.blockSize){i(this,T),I=0;break}}else for(;A<p;)if(T[I++]=v[A++],I==this.blockSize){i(this,T),I=0;break}}this.h=I,this.o+=p},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var w=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=w&255,w/=256;for(this.u(v),v=Array(16),p=w=0;4>p;++p)for(var T=0;32>T;T+=8)v[w++]=this.g[p]>>>T&255;return v};function s(v,p){var w=u;return Object.prototype.hasOwnProperty.call(w,v)?w[v]:w[v]=p(v)}function a(v,p){this.h=p;for(var w=[],T=!0,I=v.length-1;0<=I;I--){var A=v[I]|0;T&&A==p||(w[I]=A,T=!1)}this.g=w}var u={};function c(v){return-128<=v&&128>v?s(v,function(p){return new a([p|0],0>p?-1:0)}):new a([v|0],0>v?-1:0)}function d(v){if(isNaN(v)||!isFinite(v))return g;if(0>v)return V(d(-v));for(var p=[],w=1,T=0;v>=w;T++)p[T]=v/w|0,w*=4294967296;return new a(p,0)}function f(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return V(f(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=d(Math.pow(p,8)),T=g,I=0;I<v.length;I+=8){var A=Math.min(8,v.length-I),y=parseInt(v.substring(I,I+A),p);8>A?(A=d(Math.pow(p,A)),T=T.j(A).add(d(y))):(T=T.j(w),T=T.add(d(y)))}return T}var g=c(0),_=c(1),R=c(16777216);r=a.prototype,r.m=function(){if(N(this))return-V(this).m();for(var v=0,p=1,w=0;w<this.g.length;w++){var T=this.i(w);v+=(0<=T?T:4294967296+T)*p,p*=4294967296}return v},r.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(D(this))return"0";if(N(this))return"-"+V(this).toString(v);for(var p=d(Math.pow(v,6)),w=this,T="";;){var I=$(w,p).g;w=B(w,I.j(p));var A=((0<w.g.length?w.g[0]:w.h)>>>0).toString(v);if(w=I,D(w))return A+T;for(;6>A.length;)A="0"+A;T=A+T}},r.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function D(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function N(v){return v.h==-1}r.l=function(v){return v=B(this,v),N(v)?-1:D(v)?0:1};function V(v){for(var p=v.g.length,w=[],T=0;T<p;T++)w[T]=~v.g[T];return new a(w,~v.h).add(_)}r.abs=function(){return N(this)?V(this):this},r.add=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0,I=0;I<=p;I++){var A=T+(this.i(I)&65535)+(v.i(I)&65535),y=(A>>>16)+(this.i(I)>>>16)+(v.i(I)>>>16);T=y>>>16,A&=65535,y&=65535,w[I]=y<<16|A}return new a(w,w[w.length-1]&-2147483648?-1:0)};function B(v,p){return v.add(V(p))}r.j=function(v){if(D(this)||D(v))return g;if(N(this))return N(v)?V(this).j(V(v)):V(V(this).j(v));if(N(v))return V(this.j(V(v)));if(0>this.l(R)&&0>v.l(R))return d(this.m()*v.m());for(var p=this.g.length+v.g.length,w=[],T=0;T<2*p;T++)w[T]=0;for(T=0;T<this.g.length;T++)for(var I=0;I<v.g.length;I++){var A=this.i(T)>>>16,y=this.i(T)&65535,te=v.i(I)>>>16,rr=v.i(I)&65535;w[2*T+2*I]+=y*rr,G(w,2*T+2*I),w[2*T+2*I+1]+=A*rr,G(w,2*T+2*I+1),w[2*T+2*I+1]+=y*te,G(w,2*T+2*I+1),w[2*T+2*I+2]+=A*te,G(w,2*T+2*I+2)}for(T=0;T<p;T++)w[T]=w[2*T+1]<<16|w[2*T];for(T=p;T<2*p;T++)w[T]=0;return new a(w,0)};function G(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function q(v,p){this.g=v,this.h=p}function $(v,p){if(D(p))throw Error("division by zero");if(D(v))return new q(g,g);if(N(v))return p=$(V(v),p),new q(V(p.g),V(p.h));if(N(p))return p=$(v,V(p)),new q(V(p.g),p.h);if(30<v.g.length){if(N(v)||N(p))throw Error("slowDivide_ only works with positive integers.");for(var w=_,T=p;0>=T.l(v);)w=Y(w),T=Y(T);var I=K(w,1),A=K(T,1);for(T=K(T,2),w=K(w,2);!D(T);){var y=A.add(T);0>=y.l(v)&&(I=I.add(w),A=y),T=K(T,1),w=K(w,1)}return p=B(v,I.j(p)),new q(I,p)}for(I=g;0<=v.l(p);){for(w=Math.max(1,Math.floor(v.m()/p.m())),T=Math.ceil(Math.log(w)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),A=d(w),y=A.j(p);N(y)||0<y.l(v);)w-=T,A=d(w),y=A.j(p);D(A)&&(A=_),I=I.add(A),v=B(v,y)}return new q(I,v)}r.A=function(v){return $(this,v).h},r.and=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0;T<p;T++)w[T]=this.i(T)&v.i(T);return new a(w,this.h&v.h)},r.or=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0;T<p;T++)w[T]=this.i(T)|v.i(T);return new a(w,this.h|v.h)},r.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0;T<p;T++)w[T]=this.i(T)^v.i(T);return new a(w,this.h^v.h)};function Y(v){for(var p=v.g.length+1,w=[],T=0;T<p;T++)w[T]=v.i(T)<<1|v.i(T-1)>>>31;return new a(w,v.h)}function K(v,p){var w=p>>5;p%=32;for(var T=v.g.length-w,I=[],A=0;A<T;A++)I[A]=0<p?v.i(A+w)>>>p|v.i(A+w+1)<<32-p:v.i(A+w);return new a(I,v.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,No=Fl.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,ye=Fl.Integer=a}).apply(typeof kl<"u"?kl:typeof self<"u"?self:typeof window<"u"?window:{});var Ci=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},re={};var ko,fm,pn,Fo,Ar,Di,Mo,Lo,Oo;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,l,h){return o==Array.prototype||o==Object.prototype||(o[l]=h.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ci=="object"&&Ci];for(var l=0;l<o.length;++l){var h=o[l];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function i(o,l){if(l)t:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var E=o[m];if(!(E in h))break t;h=h[E]}o=o[o.length-1],m=h[o],l=l(m),l!=m&&l!=null&&t(h,o,{configurable:!0,writable:!0,value:l})}}function s(o,l){o instanceof String&&(o+="");var h=0,m=!1,E={next:function(){if(!m&&h<o.length){var P=h++;return{value:l(P,o[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}i("Array.prototype.values",function(o){return o||function(){return s(this,function(l,h){return h})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return l=l!="object"?l:o?Array.isArray(o)?"array":l:"null",l=="array"||l=="object"&&typeof o.length=="number"}function d(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function f(o,l,h){return o.call.apply(o.bind,arguments)}function g(o,l,h){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,m),o.apply(l,E)}}return function(){return o.apply(l,arguments)}}function _(o,l,h){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,_.apply(null,arguments)}function R(o,l){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function D(o,l){function h(){}h.prototype=l.prototype,o.aa=l.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(m,E,P){for(var F=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)F[nt-2]=arguments[nt];return l.prototype[E].apply(m,F)}}function N(o){let l=o.length;if(0<l){let h=Array(l);for(let m=0;m<l;m++)h[m]=o[m];return h}return[]}function V(o,l){for(let h=1;h<arguments.length;h++){let m=arguments[h];if(c(m)){let E=o.length||0,P=m.length||0;o.length=E+P;for(let F=0;F<P;F++)o[E+F]=m[F]}else o.push(m)}}class B{constructor(l,h){this.i=l,this.j=h,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function G(o){return/^[\s\xa0]*$/.test(o)}function q(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function $(o){return $[" "](o),o}$[" "]=function(){};var Y=q().indexOf("Gecko")!=-1&&!(q().toLowerCase().indexOf("webkit")!=-1&&q().indexOf("Edge")==-1)&&!(q().indexOf("Trident")!=-1||q().indexOf("MSIE")!=-1)&&q().indexOf("Edge")==-1;function K(o,l,h){for(let m in o)l.call(h,o[m],m,o)}function v(o,l){for(let h in o)l.call(void 0,o[h],h,o)}function p(o){let l={};for(let h in o)l[h]=o[h];return l}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(o,l){let h,m;for(let E=1;E<arguments.length;E++){m=arguments[E];for(h in m)o[h]=m[h];for(let P=0;P<w.length;P++)h=w[P],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function I(o){var l=1;o=o.split(":");let h=[];for(;0<l&&o.length;)h.push(o.shift()),l--;return o.length&&h.push(o.join(":")),h}function A(o){u.setTimeout(()=>{throw o},0)}function y(){var o=io;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class te{constructor(){this.h=this.g=null}add(l,h){let m=rr.get();m.set(l,h),this.h?this.h.next=m:this.g=m,this.h=m}}var rr=new B(()=>new Nf,o=>o.reset());class Nf{constructor(){this.next=this.g=this.h=null}set(l,h){this.h=l,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let ir,sr=!1,io=new te,Ec=()=>{let o=u.Promise.resolve(void 0);ir=()=>{o.then(kf)}};var kf=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){A(h)}var l=rr;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}sr=!1};function me(){this.s=this.s,this.C=this.C}me.prototype.s=!1,me.prototype.ma=function(){this.s||(this.s=!0,this.N())},me.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function At(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}At.prototype.h=function(){this.defaultPrevented=!0};var Ff=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,l),u.removeEventListener("test",h,l)}catch{}return o}();function or(o,l){if(At.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(Y){t:{try{$(l.nodeName);var E=!0;break t}catch{}E=!1}E||(l=null)}}else h=="mouseover"?l=o.fromElement:h=="mouseout"&&(l=o.toElement);this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:Mf[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&or.aa.h.call(this)}}D(or,At);var Mf={2:"touch",3:"pen",4:"mouse"};or.prototype.h=function(){or.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var ar="closure_listenable_"+(1e6*Math.random()|0),Lf=0;function Of(o,l,h,m,E){this.listener=o,this.proxy=null,this.src=l,this.type=h,this.capture=!!m,this.ha=E,this.key=++Lf,this.da=this.fa=!1}function mi(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function gi(o){this.src=o,this.g={},this.h=0}gi.prototype.add=function(o,l,h,m,E){var P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);var F=oo(o,l,m,E);return-1<F?(l=o[F],h||(l.fa=!1)):(l=new Of(l,this.src,P,!!m,E),l.fa=h,o.push(l)),l};function so(o,l){var h=l.type;if(h in o.g){var m=o.g[h],E=Array.prototype.indexOf.call(m,l,void 0),P;(P=0<=E)&&Array.prototype.splice.call(m,E,1),P&&(mi(l),o.g[h].length==0&&(delete o.g[h],o.h--))}}function oo(o,l,h,m){for(var E=0;E<o.length;++E){var P=o[E];if(!P.da&&P.listener==l&&P.capture==!!h&&P.ha==m)return E}return-1}var ao="closure_lm_"+(1e6*Math.random()|0),uo={};function Ac(o,l,h,m,E){if(m&&m.once)return Rc(o,l,h,m,E);if(Array.isArray(l)){for(var P=0;P<l.length;P++)Ac(o,l[P],h,m,E);return null}return h=fo(h),o&&o[ar]?o.K(l,h,d(m)?!!m.capture:!!m,E):Sc(o,l,h,!1,m,E)}function Sc(o,l,h,m,E,P){if(!l)throw Error("Invalid event type");var F=d(E)?!!E.capture:!!E,nt=lo(o);if(nt||(o[ao]=nt=new gi(o)),h=nt.add(l,h,m,F,P),h.proxy)return h;if(m=qf(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)Ff||(E=F),E===void 0&&(E=!1),o.addEventListener(l.toString(),m,E);else if(o.attachEvent)o.attachEvent(Pc(l.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function qf(){function o(h){return l.call(o.src,o.listener,h)}let l=Uf;return o}function Rc(o,l,h,m,E){if(Array.isArray(l)){for(var P=0;P<l.length;P++)Rc(o,l[P],h,m,E);return null}return h=fo(h),o&&o[ar]?o.L(l,h,d(m)?!!m.capture:!!m,E):Sc(o,l,h,!0,m,E)}function bc(o,l,h,m,E){if(Array.isArray(l))for(var P=0;P<l.length;P++)bc(o,l[P],h,m,E);else m=d(m)?!!m.capture:!!m,h=fo(h),o&&o[ar]?(o=o.i,l=String(l).toString(),l in o.g&&(P=o.g[l],h=oo(P,h,m,E),-1<h&&(mi(P[h]),Array.prototype.splice.call(P,h,1),P.length==0&&(delete o.g[l],o.h--)))):o&&(o=lo(o))&&(l=o.g[l.toString()],o=-1,l&&(o=oo(l,h,m,E)),(h=-1<o?l[o]:null)&&co(h))}function co(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[ar])so(l.i,o);else{var h=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(h,m,o.capture):l.detachEvent?l.detachEvent(Pc(h),m):l.addListener&&l.removeListener&&l.removeListener(m),(h=lo(l))?(so(h,o),h.h==0&&(h.src=null,l[ao]=null)):mi(o)}}}function Pc(o){return o in uo?uo[o]:uo[o]="on"+o}function Uf(o,l){if(o.da)o=!0;else{l=new or(l,this);var h=o.listener,m=o.ha||o.src;o.fa&&co(o),o=h.call(m,l)}return o}function lo(o){return o=o[ao],o instanceof gi?o:null}var ho="__closure_events_fn_"+(1e9*Math.random()>>>0);function fo(o){return typeof o=="function"?o:(o[ho]||(o[ho]=function(l){return o.handleEvent(l)}),o[ho])}function St(){me.call(this),this.i=new gi(this),this.M=this,this.F=null}D(St,me),St.prototype[ar]=!0,St.prototype.removeEventListener=function(o,l,h,m){bc(this,o,l,h,m)};function Dt(o,l){var h,m=o.F;if(m)for(h=[];m;m=m.F)h.push(m);if(o=o.M,m=l.type||l,typeof l=="string")l=new At(l,o);else if(l instanceof At)l.target=l.target||o;else{var E=l;l=new At(m,o),T(l,E)}if(E=!0,h)for(var P=h.length-1;0<=P;P--){var F=l.g=h[P];E=pi(F,m,!0,l)&&E}if(F=l.g=o,E=pi(F,m,!0,l)&&E,E=pi(F,m,!1,l)&&E,h)for(P=0;P<h.length;P++)F=l.g=h[P],E=pi(F,m,!1,l)&&E}St.prototype.N=function(){if(St.aa.N.call(this),this.i){var o=this.i,l;for(l in o.g){for(var h=o.g[l],m=0;m<h.length;m++)mi(h[m]);delete o.g[l],o.h--}}this.F=null},St.prototype.K=function(o,l,h,m){return this.i.add(String(o),l,!1,h,m)},St.prototype.L=function(o,l,h,m){return this.i.add(String(o),l,!0,h,m)};function pi(o,l,h,m){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();for(var E=!0,P=0;P<l.length;++P){var F=l[P];if(F&&!F.da&&F.capture==h){var nt=F.listener,It=F.ha||F.src;F.fa&&so(o.i,F),E=nt.call(It,m)!==!1&&E}}return E&&!m.defaultPrevented}function Vc(o,l,h){if(typeof o=="function")h&&(o=_(o,h));else if(o&&typeof o.handleEvent=="function")o=_(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function xc(o){o.g=Vc(()=>{o.g=null,o.i&&(o.i=!1,xc(o))},o.l);let l=o.h;o.h=null,o.m.apply(null,l)}class Bf extends me{constructor(l,h){super(),this.m=l,this.l=h,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:xc(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ur(o){me.call(this),this.h=o,this.g={}}D(ur,me);var Cc=[];function Dc(o){K(o.g,function(l,h){this.g.hasOwnProperty(h)&&co(l)},o),o.g={}}ur.prototype.N=function(){ur.aa.N.call(this),Dc(this)},ur.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var mo=u.JSON.stringify,Gf=u.JSON.parse,zf=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function go(){}go.prototype.h=null;function Nc(o){return o.h||(o.h=o.i())}function kc(){}var cr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function po(){At.call(this,"d")}D(po,At);function _o(){At.call(this,"c")}D(_o,At);var Be={},Fc=null;function _i(){return Fc=Fc||new St}Be.La="serverreachability";function Mc(o){At.call(this,Be.La,o)}D(Mc,At);function lr(o){let l=_i();Dt(l,new Mc(l))}Be.STAT_EVENT="statevent";function Lc(o,l){At.call(this,Be.STAT_EVENT,o),this.stat=l}D(Lc,At);function Nt(o){let l=_i();Dt(l,new Lc(l,o))}Be.Ma="timingevent";function Oc(o,l){At.call(this,Be.Ma,o),this.size=l}D(Oc,At);function hr(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function dr(){this.g=!0}dr.prototype.xa=function(){this.g=!1};function jf(o,l,h,m,E,P){o.info(function(){if(o.g)if(P)for(var F="",nt=P.split("&"),It=0;It<nt.length;It++){var X=nt[It].split("=");if(1<X.length){var Rt=X[0];X=X[1];var bt=Rt.split("_");F=2<=bt.length&&bt[1]=="type"?F+(Rt+"="+X+"&"):F+(Rt+"=redacted&")}}else F=null;else F=P;return"XMLHTTP REQ ("+m+") [attempt "+E+"]: "+l+`
`+h+`
`+F})}function Kf(o,l,h,m,E,P,F){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+E+"]: "+l+`
`+h+`
`+P+" "+F})}function dn(o,l,h,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+Qf(o,h)+(m?" "+m:"")})}function $f(o,l){o.info(function(){return"TIMEOUT: "+l})}dr.prototype.info=function(){};function Qf(o,l){if(!o.g)return l;if(!l)return null;try{var h=JSON.parse(l);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var m=h[o];if(!(2>m.length)){var E=m[1];if(Array.isArray(E)&&!(1>E.length)){var P=E[0];if(P!="noop"&&P!="stop"&&P!="close")for(var F=1;F<E.length;F++)E[F]=""}}}}return mo(h)}catch{return l}}var yi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},qc={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},yo;function wi(){}D(wi,go),wi.prototype.g=function(){return new XMLHttpRequest},wi.prototype.i=function(){return{}},yo=new wi;function ge(o,l,h,m){this.j=o,this.i=l,this.l=h,this.R=m||1,this.U=new ur(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Uc}function Uc(){this.i=null,this.g="",this.h=!1}var Bc={},wo={};function vo(o,l,h){o.L=1,o.v=Ei(ee(l)),o.m=h,o.P=!0,Gc(o,null)}function Gc(o,l){o.F=Date.now(),vi(o),o.A=ee(o.v);var h=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),nl(h.i,"t",m),o.C=0,h=o.j.J,o.h=new Uc,o.g=vl(o.j,h?l:null,!o.m),0<o.O&&(o.M=new Bf(_(o.Y,o,o.g),o.O)),l=o.U,h=o.g,m=o.ca;var E="readystatechange";Array.isArray(E)||(E&&(Cc[0]=E.toString()),E=Cc);for(var P=0;P<E.length;P++){var F=Ac(h,E[P],m||l.handleEvent,!1,l.h||l);if(!F)break;l.g[F.key]=F}l=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),lr(),jf(o.i,o.u,o.A,o.l,o.R,o.m)}ge.prototype.ca=function(o){o=o.target;let l=this.M;l&&ne(o)==3?l.j():this.Y(o)},ge.prototype.Y=function(o){try{if(o==this.g)t:{let bt=ne(this.g);var l=this.g.Ba();let gn=this.g.Z();if(!(3>bt)&&(bt!=3||this.g&&(this.h.h||this.g.oa()||cl(this.g)))){this.J||bt!=4||l==7||(l==8||0>=gn?lr(3):lr(2)),To(this);var h=this.g.Z();this.X=h;e:if(zc(this)){var m=cl(this.g);o="";var E=m.length,P=ne(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ge(this),fr(this);var F="";break e}this.h.i=new u.TextDecoder}for(l=0;l<E;l++)this.h.h=!0,o+=this.h.i.decode(m[l],{stream:!(P&&l==E-1)});m.length=0,this.h.g+=o,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=h==200,Kf(this.i,this.u,this.A,this.l,this.R,bt,h),this.o){if(this.T&&!this.K){e:{if(this.g){var nt,It=this.g;if((nt=It.g?It.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(nt)){var X=nt;break e}}X=null}if(h=X)dn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Io(this,h);else{this.o=!1,this.s=3,Nt(12),Ge(this),fr(this);break t}}if(this.P){h=!0;let Bt;for(;!this.J&&this.C<F.length;)if(Bt=Wf(this,F),Bt==wo){bt==4&&(this.s=4,Nt(14),h=!1),dn(this.i,this.l,null,"[Incomplete Response]");break}else if(Bt==Bc){this.s=4,Nt(15),dn(this.i,this.l,F,"[Invalid Chunk]"),h=!1;break}else dn(this.i,this.l,Bt,null),Io(this,Bt);if(zc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),bt!=4||F.length!=0||this.h.h||(this.s=1,Nt(16),h=!1),this.o=this.o&&h,!h)dn(this.i,this.l,F,"[Invalid Chunked Response]"),Ge(this),fr(this);else if(0<F.length&&!this.W){this.W=!0;var Rt=this.j;Rt.g==this&&Rt.ba&&!Rt.M&&(Rt.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Po(Rt),Rt.M=!0,Nt(11))}}else dn(this.i,this.l,F,null),Io(this,F);bt==4&&Ge(this),this.o&&!this.J&&(bt==4?pl(this.j,this):(this.o=!1,vi(this)))}else hm(this.g),h==400&&0<F.indexOf("Unknown SID")?(this.s=3,Nt(12)):(this.s=0,Nt(13)),Ge(this),fr(this)}}}catch{}finally{}};function zc(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Wf(o,l){var h=o.C,m=l.indexOf(`
`,h);return m==-1?wo:(h=Number(l.substring(h,m)),isNaN(h)?Bc:(m+=1,m+h>l.length?wo:(l=l.slice(m,m+h),o.C=m+h,l)))}ge.prototype.cancel=function(){this.J=!0,Ge(this)};function vi(o){o.S=Date.now()+o.I,jc(o,o.I)}function jc(o,l){if(o.B!=null)throw Error("WatchDog timer not null");o.B=hr(_(o.ba,o),l)}function To(o){o.B&&(u.clearTimeout(o.B),o.B=null)}ge.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?($f(this.i,this.A),this.L!=2&&(lr(),Nt(17)),Ge(this),this.s=2,fr(this)):jc(this,this.S-o)};function fr(o){o.j.G==0||o.J||pl(o.j,o)}function Ge(o){To(o);var l=o.M;l&&typeof l.ma=="function"&&l.ma(),o.M=null,Dc(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function Io(o,l){try{var h=o.j;if(h.G!=0&&(h.g==o||Eo(h.h,o))){if(!o.K&&Eo(h.h,o)&&h.G==3){try{var m=h.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var E=m;if(E[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)Pi(h),Ri(h);else break t;bo(h),Nt(18)}}else h.za=E[1],0<h.za-h.T&&37500>E[2]&&h.F&&h.v==0&&!h.C&&(h.C=hr(_(h.Za,h),6e3));if(1>=Qc(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else je(h,11)}else if((o.K||h.g==o)&&Pi(h),!G(l))for(E=h.Da.g.parse(l),l=0;l<E.length;l++){let X=E[l];if(h.T=X[0],X=X[1],h.G==2)if(X[0]=="c"){h.K=X[1],h.ia=X[2];let Rt=X[3];Rt!=null&&(h.la=Rt,h.j.info("VER="+h.la));let bt=X[4];bt!=null&&(h.Aa=bt,h.j.info("SVER="+h.Aa));let gn=X[5];gn!=null&&typeof gn=="number"&&0<gn&&(m=1.5*gn,h.L=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;let Bt=o.g;if(Bt){let xi=Bt.g?Bt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(xi){var P=m.h;P.g||xi.indexOf("spdy")==-1&&xi.indexOf("quic")==-1&&xi.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(Ao(P,P.h),P.h=null))}if(m.D){let Vo=Bt.g?Bt.g.getResponseHeader("X-HTTP-Session-Id"):null;Vo&&(m.ya=Vo,rt(m.I,m.D,Vo))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),m=h;var F=o;if(m.qa=wl(m,m.J?m.ia:null,m.W),F.K){Wc(m.h,F);var nt=F,It=m.L;It&&(nt.I=It),nt.B&&(To(nt),vi(nt)),m.g=F}else ml(m);0<h.i.length&&bi(h)}else X[0]!="stop"&&X[0]!="close"||je(h,7);else h.G==3&&(X[0]=="stop"||X[0]=="close"?X[0]=="stop"?je(h,7):Ro(h):X[0]!="noop"&&h.l&&h.l.ta(X),h.v=0)}}lr(4)}catch{}}var Hf=class{constructor(o,l){this.g=o,this.map=l}};function Kc(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function $c(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Qc(o){return o.h?1:o.g?o.g.size:0}function Eo(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function Ao(o,l){o.g?o.g.add(l):o.h=l}function Wc(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}Kc.prototype.cancel=function(){if(this.i=Hc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function Hc(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let l=o.i;for(let h of o.g.values())l=l.concat(h.D);return l}return N(o.i)}function Jf(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(c(o)){for(var l=[],h=o.length,m=0;m<h;m++)l.push(o[m]);return l}l=[],h=0;for(m in o)l[h++]=o[m];return l}function Xf(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||typeof o=="string"){var l=[];o=o.length;for(var h=0;h<o;h++)l.push(h);return l}l=[],h=0;for(let m in o)l[h++]=m;return l}}}function Jc(o,l){if(o.forEach&&typeof o.forEach=="function")o.forEach(l,void 0);else if(c(o)||typeof o=="string")Array.prototype.forEach.call(o,l,void 0);else for(var h=Xf(o),m=Jf(o),E=m.length,P=0;P<E;P++)l.call(void 0,m[P],h&&h[P],o)}var Xc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Yf(o,l){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var m=o[h].indexOf("="),E=null;if(0<=m){var P=o[h].substring(0,m);E=o[h].substring(m+1)}else P=o[h];l(P,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function ze(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof ze){this.h=o.h,Ti(this,o.j),this.o=o.o,this.g=o.g,Ii(this,o.s),this.l=o.l;var l=o.i,h=new pr;h.i=l.i,l.g&&(h.g=new Map(l.g),h.h=l.h),Yc(this,h),this.m=o.m}else o&&(l=String(o).match(Xc))?(this.h=!1,Ti(this,l[1]||"",!0),this.o=mr(l[2]||""),this.g=mr(l[3]||"",!0),Ii(this,l[4]),this.l=mr(l[5]||"",!0),Yc(this,l[6]||"",!0),this.m=mr(l[7]||"")):(this.h=!1,this.i=new pr(null,this.h))}ze.prototype.toString=function(){var o=[],l=this.j;l&&o.push(gr(l,Zc,!0),":");var h=this.g;return(h||l=="file")&&(o.push("//"),(l=this.o)&&o.push(gr(l,Zc,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(gr(h,h.charAt(0)=="/"?em:tm,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",gr(h,rm)),o.join("")};function ee(o){return new ze(o)}function Ti(o,l,h){o.j=h?mr(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function Ii(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function Yc(o,l,h){l instanceof pr?(o.i=l,im(o.i,o.h)):(h||(l=gr(l,nm)),o.i=new pr(l,o.h))}function rt(o,l,h){o.i.set(l,h)}function Ei(o){return rt(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function mr(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function gr(o,l,h){return typeof o=="string"?(o=encodeURI(o).replace(l,Zf),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Zf(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Zc=/[#\/\?@]/g,tm=/[#\?:]/g,em=/[#\?]/g,nm=/[#\?@]/g,rm=/#/g;function pr(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function pe(o){o.g||(o.g=new Map,o.h=0,o.i&&Yf(o.i,function(l,h){o.add(decodeURIComponent(l.replace(/\+/g," ")),h)}))}r=pr.prototype,r.add=function(o,l){pe(this),this.i=null,o=fn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(l),this.h+=1,this};function tl(o,l){pe(o),l=fn(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function el(o,l){return pe(o),l=fn(o,l),o.g.has(l)}r.forEach=function(o,l){pe(this),this.g.forEach(function(h,m){h.forEach(function(E){o.call(l,E,m,this)},this)},this)},r.na=function(){pe(this);let o=Array.from(this.g.values()),l=Array.from(this.g.keys()),h=[];for(let m=0;m<l.length;m++){let E=o[m];for(let P=0;P<E.length;P++)h.push(l[m])}return h},r.V=function(o){pe(this);let l=[];if(typeof o=="string")el(this,o)&&(l=l.concat(this.g.get(fn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)l=l.concat(o[h])}return l},r.set=function(o,l){return pe(this),this.i=null,o=fn(this,o),el(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o?(o=this.V(o),0<o.length?String(o[0]):l):l};function nl(o,l,h){tl(o,l),0<h.length&&(o.i=null,o.g.set(fn(o,l),N(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],l=Array.from(this.g.keys());for(var h=0;h<l.length;h++){var m=l[h];let P=encodeURIComponent(String(m)),F=this.V(m);for(m=0;m<F.length;m++){var E=P;F[m]!==""&&(E+="="+encodeURIComponent(String(F[m]))),o.push(E)}}return this.i=o.join("&")};function fn(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function im(o,l){l&&!o.j&&(pe(o),o.i=null,o.g.forEach(function(h,m){var E=m.toLowerCase();m!=E&&(tl(this,m),nl(this,E,h))},o)),o.j=l}function sm(o,l){let h=new dr;if(u.Image){let m=new Image;m.onload=R(_e,h,"TestLoadImage: loaded",!0,l,m),m.onerror=R(_e,h,"TestLoadImage: error",!1,l,m),m.onabort=R(_e,h,"TestLoadImage: abort",!1,l,m),m.ontimeout=R(_e,h,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}function om(o,l){let h=new dr,m=new AbortController,E=setTimeout(()=>{m.abort(),_e(h,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:m.signal}).then(P=>{clearTimeout(E),P.ok?_e(h,"TestPingServer: ok",!0,l):_e(h,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(E),_e(h,"TestPingServer: error",!1,l)})}function _e(o,l,h,m,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),m(h)}catch{}}function am(){this.g=new zf}function um(o,l,h){let m=h||"";try{Jc(o,function(E,P){let F=E;d(E)&&(F=mo(E)),l.push(m+P+"="+encodeURIComponent(F))})}catch(E){throw l.push(m+"type="+encodeURIComponent("_badmap")),E}}function _r(o){this.l=o.Ub||null,this.j=o.eb||!1}D(_r,go),_r.prototype.g=function(){return new Ai(this.l,this.j)},_r.prototype.i=function(o){return function(){return o}}({});function Ai(o,l){St.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}D(Ai,St),r=Ai.prototype,r.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,wr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,yr(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,wr(this)),this.g&&(this.readyState=3,wr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;rl(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function rl(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?yr(this):wr(this),this.readyState==3&&rl(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,yr(this))},r.Qa=function(o){this.g&&(this.response=o,yr(this))},r.ga=function(){this.g&&yr(this)};function yr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,wr(o)}r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],l=this.h.entries();for(var h=l.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=l.next();return o.join(`\r
`)};function wr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Ai.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function il(o){let l="";return K(o,function(h,m){l+=m,l+=":",l+=h,l+=`\r
`}),l}function So(o,l,h){t:{for(m in h){var m=!1;break t}m=!0}m||(h=il(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):rt(o,l,h))}function at(o){St.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}D(at,St);var cm=/^https?$/i,lm=["POST","PUT"];r=at.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,l,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():yo.g(),this.v=this.o?Nc(this.o):Nc(yo),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(P){sl(this,P);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var E in m)h.set(E,m[E]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())h.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(P=>P.toLowerCase()=="content-type"),E=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(lm,l,void 0))||m||E||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,F]of h)this.g.setRequestHeader(P,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ul(this),this.u=!0,this.g.send(o),this.u=!1}catch(P){sl(this,P)}};function sl(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,ol(o),Si(o)}function ol(o){o.A||(o.A=!0,Dt(o,"complete"),Dt(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Dt(this,"complete"),Dt(this,"abort"),Si(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Si(this,!0)),at.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?al(this):this.bb())},r.bb=function(){al(this)};function al(o){if(o.h&&typeof a<"u"&&(!o.v[1]||ne(o)!=4||o.Z()!=2)){if(o.u&&ne(o)==4)Vc(o.Ea,0,o);else if(Dt(o,"readystatechange"),ne(o)==4){o.h=!1;try{let F=o.Z();t:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break t;default:l=!1}var h;if(!(h=l)){var m;if(m=F===0){var E=String(o.D).match(Xc)[1]||null;!E&&u.self&&u.self.location&&(E=u.self.location.protocol.slice(0,-1)),m=!cm.test(E?E.toLowerCase():"")}h=m}if(h)Dt(o,"complete"),Dt(o,"success");else{o.m=6;try{var P=2<ne(o)?o.g.statusText:""}catch{P=""}o.l=P+" ["+o.Z()+"]",ol(o)}}finally{Si(o)}}}}function Si(o,l){if(o.g){ul(o);let h=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Dt(o,"ready");try{h.onreadystatechange=m}catch{}}}function ul(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function ne(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<ne(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),Gf(l)}};function cl(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function hm(o){let l={};o=(o.g&&2<=ne(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(G(o[m]))continue;var h=I(o[m]);let E=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let P=l[E]||[];l[E]=P,P.push(h)}v(l,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function vr(o,l,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||l}function ll(o){this.Aa=0,this.i=[],this.j=new dr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=vr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=vr("baseRetryDelayMs",5e3,o),this.cb=vr("retryDelaySeedMs",1e4,o),this.Wa=vr("forwardChannelMaxRetries",2,o),this.wa=vr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Kc(o&&o.concurrentRequestLimit),this.Da=new am,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=ll.prototype,r.la=8,r.G=1,r.connect=function(o,l,h,m){Nt(0),this.W=o,this.H=l||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.I=wl(this,null,this.W),bi(this)};function Ro(o){if(hl(o),o.G==3){var l=o.U++,h=ee(o.I);if(rt(h,"SID",o.K),rt(h,"RID",l),rt(h,"TYPE","terminate"),Tr(o,h),l=new ge(o,o.j,l),l.L=2,l.v=Ei(ee(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=l.v,h=!0),h||(l.g=vl(l.j,null),l.g.ea(l.v)),l.F=Date.now(),vi(l)}yl(o)}function Ri(o){o.g&&(Po(o),o.g.cancel(),o.g=null)}function hl(o){Ri(o),o.u&&(u.clearTimeout(o.u),o.u=null),Pi(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function bi(o){if(!$c(o.h)&&!o.s){o.s=!0;var l=o.Ga;ir||Ec(),sr||(ir(),sr=!0),io.add(l,o),o.B=0}}function dm(o,l){return Qc(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=l.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=hr(_(o.Ga,o,l),_l(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let E=new ge(this,this.j,o),P=this.o;if(this.S&&(P?(P=p(P),T(P,this.S)):P=this.S),this.m!==null||this.O||(E.H=P,P=null),this.P)t:{for(var l=0,h=0;h<this.i.length;h++){e:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(l+=m,4096<l){l=h;break t}if(l===4096||h===this.i.length-1){l=h+1;break t}}l=1e3}else l=1e3;l=fl(this,E,l),h=ee(this.I),rt(h,"RID",o),rt(h,"CVER",22),this.D&&rt(h,"X-HTTP-Session-Id",this.D),Tr(this,h),P&&(this.O?l="headers="+encodeURIComponent(String(il(P)))+"&"+l:this.m&&So(h,this.m,P)),Ao(this.h,E),this.Ua&&rt(h,"TYPE","init"),this.P?(rt(h,"$req",l),rt(h,"SID","null"),E.T=!0,vo(E,h,null)):vo(E,h,l),this.G=2}}else this.G==3&&(o?dl(this,o):this.i.length==0||$c(this.h)||dl(this))};function dl(o,l){var h;l?h=l.l:h=o.U++;let m=ee(o.I);rt(m,"SID",o.K),rt(m,"RID",h),rt(m,"AID",o.T),Tr(o,m),o.m&&o.o&&So(m,o.m,o.o),h=new ge(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),l&&(o.i=l.D.concat(o.i)),l=fl(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Ao(o.h,h),vo(h,m,l)}function Tr(o,l){o.H&&K(o.H,function(h,m){rt(l,m,h)}),o.l&&Jc({},function(h,m){rt(l,m,h)})}function fl(o,l,h){h=Math.min(o.i.length,h);var m=o.l?_(o.l.Na,o.l,o):null;t:{var E=o.i;let P=-1;for(;;){let F=["count="+h];P==-1?0<h?(P=E[0].g,F.push("ofs="+P)):P=0:F.push("ofs="+P);let nt=!0;for(let It=0;It<h;It++){let X=E[It].g,Rt=E[It].map;if(X-=P,0>X)P=Math.max(0,E[It].g-100),nt=!1;else try{um(Rt,F,"req"+X+"_")}catch{m&&m(Rt)}}if(nt){m=F.join("&");break t}}}return o=o.i.splice(0,h),l.D=o,m}function ml(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;ir||Ec(),sr||(ir(),sr=!0),io.add(l,o),o.v=0}}function bo(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=hr(_(o.Fa,o),_l(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,gl(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=hr(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Nt(10),Ri(this),gl(this))};function Po(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function gl(o){o.g=new ge(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var l=ee(o.qa);rt(l,"RID","rpc"),rt(l,"SID",o.K),rt(l,"AID",o.T),rt(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&rt(l,"TO",o.ja),rt(l,"TYPE","xmlhttp"),Tr(o,l),o.m&&o.o&&So(l,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Ei(ee(l)),h.m=null,h.P=!0,Gc(h,o)}r.Za=function(){this.C!=null&&(this.C=null,Ri(this),bo(this),Nt(19))};function Pi(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function pl(o,l){var h=null;if(o.g==l){Pi(o),Po(o),o.g=null;var m=2}else if(Eo(o.h,l))h=l.D,Wc(o.h,l),m=1;else return;if(o.G!=0){if(l.o)if(m==1){h=l.m?l.m.length:0,l=Date.now()-l.F;var E=o.B;m=_i(),Dt(m,new Oc(m,h)),bi(o)}else ml(o);else if(E=l.s,E==3||E==0&&0<l.X||!(m==1&&dm(o,l)||m==2&&bo(o)))switch(h&&0<h.length&&(l=o.h,l.i=l.i.concat(h)),E){case 1:je(o,5);break;case 4:je(o,10);break;case 3:je(o,6);break;default:je(o,2)}}}function _l(o,l){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*l}function je(o,l){if(o.j.info("Error code "+l),l==2){var h=_(o.fb,o),m=o.Xa;let E=!m;m=new ze(m||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Ti(m,"https"),Ei(m),E?sm(m.toString(),h):om(m.toString(),h)}else Nt(2);o.G=0,o.l&&o.l.sa(l),yl(o),hl(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Nt(2)):(this.j.info("Failed to ping google.com"),Nt(1))};function yl(o){if(o.G=0,o.ka=[],o.l){let l=Hc(o.h);(l.length!=0||o.i.length!=0)&&(V(o.ka,l),V(o.ka,o.i),o.h.i.length=0,N(o.i),o.i.length=0),o.l.ra()}}function wl(o,l,h){var m=h instanceof ze?ee(h):new ze(h);if(m.g!="")l&&(m.g=l+"."+m.g),Ii(m,m.s);else{var E=u.location;m=E.protocol,l=l?l+"."+E.hostname:E.hostname,E=+E.port;var P=new ze(null);m&&Ti(P,m),l&&(P.g=l),E&&Ii(P,E),h&&(P.l=h),m=P}return h=o.D,l=o.ya,h&&l&&rt(m,h,l),rt(m,"VER",o.la),Tr(o,m),m}function vl(o,l,h){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Ca&&!o.pa?new at(new _r({eb:h})):new at(o.pa),l.Ha(o.J),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Tl(){}r=Tl.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Vi(){}Vi.prototype.g=function(o,l){return new Mt(o,l)};function Mt(o,l){St.call(this),this.g=new ll(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!G(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!G(l)&&(this.g.D=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new mn(this)}D(Mt,St),Mt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Mt.prototype.close=function(){Ro(this.g)},Mt.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=mo(o),o=h);l.i.push(new Hf(l.Ya++,o)),l.G==3&&bi(l)},Mt.prototype.N=function(){this.g.l=null,delete this.j,Ro(this.g),delete this.g,Mt.aa.N.call(this)};function Il(o){po.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){t:{for(let h in l){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}D(Il,po);function El(){_o.call(this),this.status=1}D(El,_o);function mn(o){this.g=o}D(mn,Tl),mn.prototype.ua=function(){Dt(this.g,"a")},mn.prototype.ta=function(o){Dt(this.g,new Il(o))},mn.prototype.sa=function(o){Dt(this.g,new El)},mn.prototype.ra=function(){Dt(this.g,"b")},Vi.prototype.createWebChannel=Vi.prototype.g,Mt.prototype.send=Mt.prototype.o,Mt.prototype.open=Mt.prototype.m,Mt.prototype.close=Mt.prototype.close,Oo=re.createWebChannelTransport=function(){return new Vi},Lo=re.getStatEventTarget=function(){return _i()},Mo=re.Event=Be,Di=re.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},yi.NO_ERROR=0,yi.TIMEOUT=8,yi.HTTP_ERROR=6,Ar=re.ErrorCode=yi,qc.COMPLETE="complete",Fo=re.EventType=qc,kc.EventType=cr,cr.OPEN="a",cr.CLOSE="b",cr.ERROR="c",cr.MESSAGE="d",St.prototype.listen=St.prototype.K,pn=re.WebChannel=kc,fm=re.FetchXmlHttpFactory=_r,at.prototype.listenOnce=at.prototype.L,at.prototype.getLastError=at.prototype.Ka,at.prototype.getLastErrorCode=at.prototype.Ba,at.prototype.getStatus=at.prototype.Z,at.prototype.getResponseJson=at.prototype.Oa,at.prototype.getResponseText=at.prototype.oa,at.prototype.send=at.prototype.ea,at.prototype.setWithCredentials=at.prototype.Ha,ko=re.XhrIo=at}).apply(typeof Ci<"u"?Ci:typeof self<"u"?self:typeof window<"u"?window:{});var Ml="@firebase/firestore";var pt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};pt.UNAUTHENTICATED=new pt(null),pt.GOOGLE_CREDENTIALS=new pt("google-credentials-uid"),pt.FIRST_PARTY=new pt("first-party-uid"),pt.MOCK_USER=new pt("mock-user");var Hn="11.0.2";var Se=new Vl("@firebase/firestore");function Tn(){return Se.logLevel}function Pp(r){Se.setLogLevel(r)}function C(r,...t){if(Se.logLevel<=Kt.DEBUG){let e=t.map(Qu);Se.debug(`Firestore (${Hn}): ${r}`,...e)}}function ct(r,...t){if(Se.logLevel<=Kt.ERROR){let e=t.map(Qu);Se.error(`Firestore (${Hn}): ${r}`,...e)}}function qt(r,...t){if(Se.logLevel<=Kt.WARN){let e=t.map(Qu);Se.warn(`Firestore (${Hn}): ${r}`,...e)}}function Qu(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function L(r="Unexpected state"){let t=`FIRESTORE (${Hn}) INTERNAL ASSERTION FAILED: `+r;throw ct(t),new Error(t)}function O(r,t){r||L()}function Vp(r,t){r||L()}function k(r,t){return r}var b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends bl{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var _t=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Ki=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},jo=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(pt.UNAUTHENTICATED))}shutdown(){}},Ko=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},$o=class{constructor(t){this.t=t,this.currentUser=pt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){O(this.o===void 0);let n=this.i,i=c=>this.i!==n?(n=this.i,e(c)):Promise.resolve(),s=new _t;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new _t,t.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let c=s;t.enqueueRetryable(async()=>{await c.promise,await i(this.currentUser)})},u=c=>{C("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(C("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new _t)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(C("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(O(typeof n.accessToken=="string"),new Ki(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return O(t===null||typeof t=="string"),new pt(t)}},Qo=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=pt.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);let t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}},Wo=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Qo(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(pt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},$i=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Ho=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){O(this.o===void 0);let n=s=>{s.error!=null&&C("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.R;return this.R=s.token,C("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>n(s))};let i=s=>{C("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):C("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(O(typeof e.token=="string"),this.R=e.token,new $i(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}},Ll=class{getToken(){return Promise.resolve(new $i(""))}invalidateToken(){}start(t,e){}shutdown(){}};function mm(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}var Qi=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";for(;n.length<20;){let i=mm(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%t.length))}return n}};function z(r,t){return r<t?-1:r>t?1:0}function Vn(r,t,e){return r.length===t.length&&r.every((n,i)=>e(n,t[i]))}function Bh(r){return r+"\0"}var lt=class r{static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new r(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new x(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new x(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new x(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new x(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?z(this.nanoseconds,t.nanoseconds):z(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var U=class r{static fromTimestamp(t){return new r(t)}static min(){return new r(new lt(0,0))}static max(){return new r(new lt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Wi=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&L(),n===void 0?n=t.length-e:n>t.length-e&&L(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let i=0;i<n;i++){let s=t.get(i),a=e.get(i);if(s<a)return-1;if(s>a)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},J=class r extends Wi{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new x(b.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(i=>i.length>0))}return new r(e)}static emptyPath(){return new r([])}},gm=/^[_a-zA-Z][_a-zA-Z0-9]*$/,yt=class r extends Wi{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return gm.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(t){let e=[],n="",i=0,s=()=>{if(n.length===0)throw new x(b.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;i<t.length;){let u=t[i];if(u==="\\"){if(i+1===t.length)throw new x(b.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let c=t[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new x(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=c,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new x(b.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var M=class r{constructor(t){this.path=t}static fromPath(t){return new r(J.fromString(t))}static fromName(t){return new r(J.fromString(t).popFirst(5))}static empty(){return new r(J.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&J.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return J.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new J(t.slice()))}};var Re=class{constructor(t,e,n,i){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=i}};function Jo(r){return r.fields.find(t=>t.kind===2)}function $e(r){return r.fields.filter(t=>t.kind!==2)}function pm(r,t){let e=z(r.collectionGroup,t.collectionGroup);if(e!==0)return e;for(let n=0;n<Math.min(r.fields.length,t.fields.length);++n)if(e=_m(r.fields[n],t.fields[n]),e!==0)return e;return z(r.fields.length,t.fields.length)}Re.UNKNOWN_ID=-1;var oe=class{constructor(t,e){this.fieldPath=t,this.kind=e}};function _m(r,t){let e=yt.comparator(r.fieldPath,t.fieldPath);return e!==0?e:z(r.kind,t.kind)}var xn=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,Ut.min())}};function Gh(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=U.fromTimestamp(n===1e9?new lt(e+1,0):new lt(e,n));return new Ut(i,M.empty(),t)}function zh(r){return new Ut(r.readTime,r.key,-1)}var Ut=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(U.min(),M.empty(),-1)}static max(){return new r(U.max(),M.empty(),-1)}};function Wu(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(r.documentKey,t.documentKey),e!==0?e:z(r.largestBatchId,t.largestBatchId))}var jh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Hi=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};async function Le(r){if(r.code!==b.FAILED_PRECONDITION||r.message!==jh)throw r;C("LocalStore","Unexpectedly lost primary lease")}var S=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(n,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let i=0,s=0,a=!1;t.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&e()},c=>n(c))}),a=!0,s===i&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(i=>i?r.resolve(i):n());return e}static forEach(t,e){let n=[];return t.forEach((i,s)=>{n.push(e.call(this,i,s))}),this.waitFor(n)}static mapArray(t,e){return new r((n,i)=>{let s=t.length,a=new Array(s),u=0;for(let c=0;c<s;c++){let d=c;e(t[d]).next(f=>{a[d]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(t,e){return new r((n,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):n()};s()})}};var Ji=class r{static open(t,e,n,i){try{return new r(e,t.transaction(i,n))}catch(s){throw new Ye(e,s)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new _t,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new Ye(t,e.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=Hu(n.target.error);this.V.reject(new Ye(t,i))}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(C("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new Yo(e)}},be=class r{static delete(t){return C("SimpleDb","Removing database:",t),Qe(window.indexedDB.deleteDatabase(t)).toPromise()}static p(){if(!Rl())return!1;if(r.S())return!0;let t=Ir(),e=r.D(t),n=0<e&&e<10,i=Kh(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static S(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.v)==="YES"}static C(t,e){return t.store(e)}static D(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.F=n,r.D(Ir())===12.2&&ct("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async M(t){return this.db||(C("SimpleDb","Opening database:",this.name),this.db=await new Promise((e,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;e(a)},i.onblocked=()=>{n(new Ye(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?n(new x(b.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new x(b.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new Ye(t,a))},i.onupgradeneeded=s=>{C("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;this.F.O(a,i.transaction,s.oldVersion,this.version).next(()=>{C("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db}L(t){this.N=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,i){let s=e==="readonly",a=0;for(;;){++a;try{this.db=await this.M(t);let u=Ji.open(this.db,t,s?"readonly":"readwrite",n),c=i(u).next(d=>(u.g(),d)).catch(d=>(u.abort(d),S.reject(d))).toPromise();return c.catch(()=>{}),await u.m,c}catch(u){let c=u,d=c.name!=="FirebaseError"&&a<3;if(C("SimpleDb","Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}};function Kh(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var Xo=class{constructor(t){this.B=t,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(t){this.B=t}done(){this.k=!0}$(t){this.q=t}delete(){return Qe(this.B.delete())}},Ye=class extends x{constructor(t,e){super(b.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function Oe(r){return r.name==="IndexedDbTransactionError"}var Yo=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(C("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(C("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Qe(n)}add(t){return C("SimpleDb","ADD",this.store.name,t,t),Qe(this.store.add(t))}get(t){return Qe(this.store.get(t)).next(e=>(e===void 0&&(e=null),C("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return C("SimpleDb","DELETE",this.store.name,t),Qe(this.store.delete(t))}count(){return C("SimpleDb","COUNT",this.store.name),Qe(this.store.count())}U(t,e){let n=this.options(t,e),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new S((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{let s=this.cursor(n),a=[];return this.W(s,(u,c)=>{a.push(c)}).next(()=>a)}}G(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new S((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(t,e){C("SimpleDb","DELETE ALL",this.store.name);let n=this.options(t,e);n.H=!1;let i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(t,e){let n;e?n=t:(n={},e=t);let i=this.cursor(n);return this.W(i,e)}Y(t){let e=this.cursor({});return new S((n,i)=>{e.onerror=s=>{let a=Hu(s.target.error);i(a)},e.onsuccess=s=>{let a=s.target.result;a?t(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(t,e){let n=[];return new S((i,s)=>{t.onerror=a=>{s(a.target.error)},t.onsuccess=a=>{let u=a.target.result;if(!u)return void i();let c=new Xo(u),d=e(u.primaryKey,u.value,c);if(d instanceof S){let f=d.catch(g=>(c.done(),S.reject(g)));n.push(f)}c.isDone?i():c.K===null?u.continue():u.continue(c.K)}}).next(()=>S.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.H?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function Qe(r){return new S((t,e)=>{r.onsuccess=n=>{let i=n.target.result;t(i)},r.onerror=n=>{let i=Hu(n.target.error);e(i)}})}var Ol=!1;function Hu(r){let t=be.D(Ir());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ol||(Ol=!0,setTimeout(()=>{throw n},0)),n}}return r}var Zo=class{constructor(t,e){this.asyncQueue=t,this.Z=e,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(t){C("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,async()=>{this.task=null;try{C("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(e){Oe(e)?C("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):await Le(e)}await this.X(6e4)})}},ta=class{constructor(t,e){this.localStore=t,this.persistence=e}async ee(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.te(e,t))}te(t,e){let n=new Set,i=e,s=!0;return S.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return C("IndexBackfiller",`Processing collection: ${a}`),this.ne(t,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>e-i)}ne(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,n).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this.re(i,s)).next(u=>(C("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>a.size)}))}re(t,e){let n=t;return e.changes.forEach((i,s)=>{let a=zh(s);Wu(a,n)>0&&(n=a)}),new Ut(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Lt=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return r.oe=-1,r})();function ai(r){return r==null}function Mr(r){return r===0&&1/r==-1/0}function $h(r){return typeof r=="number"&&Number.isInteger(r)&&!Mr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function xt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=ql(t)),t=ym(r.get(e),t);return ql(t)}function ym(r,t){let e=t,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function ql(r){return r+""}function $t(r){let t=r.length;if(O(t>=2),t===2)return O(r.charAt(0)===""&&r.charAt(1)===""),J.emptyPath();let e=t-2,n=[],i="";for(let s=0;s<t;){let a=r.indexOf("",s);switch((a<0||a>e)&&L(),r.charAt(a+1)){case"":let u=r.substring(s,a),c;i.length===0?c=u:(i+=u,c=i,i=""),n.push(c);break;case"":i+=r.substring(s,a),i+="\0";break;case"":i+=r.substring(s,a+1);break;default:L()}s=a+2}return new J(n)}var Ul=["userId","batchId"];function qi(r,t){return[r,xt(t)]}function Qh(r,t,e){return[r,xt(t),e]}var wm={},vm=["prefixPath","collectionGroup","readTime","documentId"],Tm=["prefixPath","collectionGroup","documentId"],Im=["collectionGroup","readTime","prefixPath","documentId"],Em=["canonicalId","targetId"],Am=["targetId","path"],Sm=["path","targetId"],Rm=["collectionId","parent"],bm=["indexId","uid"],Pm=["uid","sequenceNumber"],Vm=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],xm=["indexId","uid","orderedDocumentKey"],Cm=["userId","collectionPath","documentId"],Dm=["userId","collectionPath","largestBatchId"],Nm=["userId","collectionGroup","largestBatchId"],Wh=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],km=[...Wh,"documentOverlays"],Hh=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Jh=Hh,Ju=[...Jh,"indexConfiguration","indexState","indexEntries"],Fm=Ju,Mm=[...Ju,"globals"];var Lr=class extends Hi{constructor(t,e){super(),this._e=t,this.currentSequenceNumber=e}};function Tt(r,t){let e=k(r);return be.C(e._e,t)}function Bl(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function qe(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Xh(r,t){let e=[];for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.push(t(r[n],n,r));return e}function Yh(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var it=class r{constructor(t,e){this.comparator=t,this.root=e||Wt.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Wt.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Wt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(t,n.key);if(i===0)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Sn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Sn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Sn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Sn(this.root,t,this.comparator,!0)}},Sn=class{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},Wt=class r{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new r(t??this.key,e??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this,s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();let t=this.left.check();if(t!==this.right.check())throw L();return t+(this.isRed()?0:1)}};Wt.EMPTY=null,Wt.RED=!0,Wt.BLACK=!1;Wt.EMPTY=new class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(t,e,n,i,s){return this}insert(t,e,n){return new Wt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var et=class r{constructor(t){this.comparator=t,this.data=new it(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Xi(this.data.getIterator())}getIteratorFrom(t){return new Xi(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},Xi=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function _n(r){return r.hasNext()?r.getNext():void 0}var Ot=class r{constructor(t){this.fields=t,t.sort(yt.comparator)}static empty(){return new r([])}unionWith(t){let e=new et(yt.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Vn(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var Yi=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function Cp(){return typeof atob<"u"}var ft=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Yi("Invalid base64 string: "+s):s}}(t);return new r(e)}static fromUint8Array(t){let e=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return z(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};ft.EMPTY_BYTE_STRING=new ft("");var Lm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ae(r){if(O(!!r),typeof r=="string"){let t=0,e=Lm.exec(r);if(O(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:st(r.seconds),nanos:st(r.nanos)}}function st(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function ue(r){return typeof r=="string"?ft.fromBase64String(r):ft.fromUint8Array(r)}function Ks(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function $s(r){let t=r.mapValue.fields.__previous_value__;return Ks(t)?$s(t):t}function Or(r){let t=ae(r.mapValue.fields.__local_write_time__.timestampValue);return new lt(t.seconds,t.nanos)}var ea=class{constructor(t,e,n,i,s,a,u,c,d){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=d}},Cn=class r{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var Ae={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ui={nullValue:"NULL_VALUE"};function Pe(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Ks(r)?4:Zh(r)?9007199254740991:Qs(r)?10:11:L()}function Xt(r,t){if(r===t)return!0;let e=Pe(r);if(e!==Pe(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Or(r).isEqual(Or(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=ae(i.timestampValue),u=ae(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(i,s){return ue(i.bytesValue).isEqual(ue(s.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(i,s){return st(i.geoPointValue.latitude)===st(s.geoPointValue.latitude)&&st(i.geoPointValue.longitude)===st(s.geoPointValue.longitude)}(r,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return st(i.integerValue)===st(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=st(i.doubleValue),u=st(s.doubleValue);return a===u?Mr(a)===Mr(u):isNaN(a)&&isNaN(u)}return!1}(r,t);case 9:return Vn(r.arrayValue.values||[],t.arrayValue.values||[],Xt);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(Bl(a)!==Bl(u))return!1;for(let c in a)if(a.hasOwnProperty(c)&&(u[c]===void 0||!Xt(a[c],u[c])))return!1;return!0}(r,t);default:return L()}}function qr(r,t){return(r.values||[]).find(e=>Xt(e,t))!==void 0}function Ve(r,t){if(r===t)return 0;let e=Pe(r),n=Pe(t);if(e!==n)return z(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return z(r.booleanValue,t.booleanValue);case 2:return function(s,a){let u=st(s.integerValue||s.doubleValue),c=st(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,t);case 3:return Gl(r.timestampValue,t.timestampValue);case 4:return Gl(Or(r),Or(t));case 5:return z(r.stringValue,t.stringValue);case 6:return function(s,a){let u=ue(s),c=ue(a);return u.compareTo(c)}(r.bytesValue,t.bytesValue);case 7:return function(s,a){let u=s.split("/"),c=a.split("/");for(let d=0;d<u.length&&d<c.length;d++){let f=z(u[d],c[d]);if(f!==0)return f}return z(u.length,c.length)}(r.referenceValue,t.referenceValue);case 8:return function(s,a){let u=z(st(s.latitude),st(a.latitude));return u!==0?u:z(st(s.longitude),st(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return zl(r.arrayValue,t.arrayValue);case 10:return function(s,a){var u,c,d,f;let g=s.fields||{},_=a.fields||{},R=(u=g.value)===null||u===void 0?void 0:u.arrayValue,D=(c=_.value)===null||c===void 0?void 0:c.arrayValue,N=z(((d=R?.values)===null||d===void 0?void 0:d.length)||0,((f=D?.values)===null||f===void 0?void 0:f.length)||0);return N!==0?N:zl(R,D)}(r.mapValue,t.mapValue);case 11:return function(s,a){if(s===Ae.mapValue&&a===Ae.mapValue)return 0;if(s===Ae.mapValue)return 1;if(a===Ae.mapValue)return-1;let u=s.fields||{},c=Object.keys(u),d=a.fields||{},f=Object.keys(d);c.sort(),f.sort();for(let g=0;g<c.length&&g<f.length;++g){let _=z(c[g],f[g]);if(_!==0)return _;let R=Ve(u[c[g]],d[f[g]]);if(R!==0)return R}return z(c.length,f.length)}(r.mapValue,t.mapValue);default:throw L()}}function Gl(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return z(r,t);let e=ae(r),n=ae(t),i=z(e.seconds,n.seconds);return i!==0?i:z(e.nanos,n.nanos)}function zl(r,t){let e=r.values||[],n=t.values||[];for(let i=0;i<e.length&&i<n.length;++i){let s=Ve(e[i],n[i]);if(s)return s}return z(e.length,n.length)}function Dn(r){return na(r)}function na(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=ae(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return ue(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return M.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",i=!0;for(let s of e.values||[])i?i=!1:n+=",",n+=na(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${na(e.fields[a])}`;return i+"}"}(r.mapValue):L()}function Bi(r){switch(Pe(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=$s(r);return t?16+Bi(t):16;case 5:return 2*r.stringValue.length;case 6:return ue(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((i,s)=>i+Bi(s),0)}(r.arrayValue);case 10:case 11:return function(n){let i=0;return qe(n.fields,(s,a)=>{i+=s.length+Bi(a)}),i}(r.mapValue);default:throw L()}}function Ze(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function ra(r){return!!r&&"integerValue"in r}function Ur(r){return!!r&&"arrayValue"in r}function jl(r){return!!r&&"nullValue"in r}function Kl(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Gi(r){return!!r&&"mapValue"in r}function Qs(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="__vector__"}function Cr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return qe(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Cr(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Cr(r.arrayValue.values[e]);return t}return Object.assign({},r)}function Zh(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var td={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Om(r){return"nullValue"in r?Ui:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Ze(Cn.empty(),M.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Qs(r)?td:{mapValue:{}}:L()}function qm(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Ze(Cn.empty(),M.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?td:"mapValue"in r?Qs(r)?{mapValue:{}}:Ae:L()}function $l(r,t){let e=Ve(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function Ql(r,t){let e=Ve(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var Vt=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Gi(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Cr(e)}setAll(t){let e=yt.emptyPath(),n={},i=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){let c=this.getFieldsMap(e);this.applyChanges(c,n,i),n={},i=[],e=u.popLast()}a?n[u.lastSegment()]=Cr(a):i.push(u.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){let e=this.field(t.popLast());Gi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Xt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];Gi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){qe(e,(i,s)=>t[i]=s);for(let i of n)delete t[i]}clone(){return new r(Cr(this.value))}};function ed(r){let t=[];return qe(r.fields,(e,n)=>{let i=new yt([e]);if(Gi(n)){let s=ed(n.mapValue).fields;if(s.length===0)t.push(i);else for(let a of s)t.push(i.child(a))}else t.push(i)}),new Ot(t)}var wt=class r{constructor(t,e,n,i,s,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(t){return new r(t,0,U.min(),U.min(),U.min(),Vt.empty(),0)}static newFoundDocument(t,e,n,i){return new r(t,1,e,U.min(),n,i,0)}static newNoDocument(t,e){return new r(t,2,e,U.min(),U.min(),Vt.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,U.min(),U.min(),Vt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Vt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Vt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Yt=class{constructor(t,e){this.position=t,this.inclusive=e}};function Wl(r,t,e){let n=0;for(let i=0;i<r.position.length;i++){let s=t[i],a=r.position[i];if(s.field.isKeyField()?n=M.comparator(M.fromName(a.referenceValue),e.key):n=Ve(a,e.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function Hl(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!Xt(r.position[e],t.position[e]))return!1;return!0}var tn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function Um(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var Zi=class{},W=class r extends Zi{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new oa(t,e,n):e==="array-contains"?new ca(t,n):e==="in"?new ts(t,n):e==="not-in"?new la(t,n):e==="array-contains-any"?new ha(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new aa(t,n):new ua(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Ve(e,this.value)):e!==null&&Pe(this.value)===Pe(e)&&this.matchesComparison(Ve(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Z=class r extends Zi{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new r(t,e)}matches(t){return Nn(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Nn(r){return r.op==="and"}function ia(r){return r.op==="or"}function Xu(r){return nd(r)&&Nn(r)}function nd(r){for(let t of r.filters)if(t instanceof Z)return!1;return!0}function sa(r){if(r instanceof W)return r.field.canonicalString()+r.op.toString()+Dn(r.value);if(Xu(r))return r.filters.map(t=>sa(t)).join(",");{let t=r.filters.map(e=>sa(e)).join(",");return`${r.op}(${t})`}}function rd(r,t){return r instanceof W?function(n,i){return i instanceof W&&n.op===i.op&&n.field.isEqual(i.field)&&Xt(n.value,i.value)}(r,t):r instanceof Z?function(n,i){return i instanceof Z&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,u)=>s&&rd(a,i.filters[u]),!0):!1}(r,t):void L()}function id(r,t){let e=r.filters.concat(t);return Z.create(e,r.op)}function sd(r){return r instanceof W?function(e){return`${e.field.canonicalString()} ${e.op} ${Dn(e.value)}`}(r):r instanceof Z?function(e){return e.op.toString()+" {"+e.getFilters().map(sd).join(" ,")+"}"}(r):"Filter"}var oa=class extends W{constructor(t,e,n){super(t,e,n),this.key=M.fromName(n.referenceValue)}matches(t){let e=M.comparator(t.key,this.key);return this.matchesComparison(e)}},aa=class extends W{constructor(t,e){super(t,"in",e),this.keys=od("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},ua=class extends W{constructor(t,e){super(t,"not-in",e),this.keys=od("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function od(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>M.fromName(n.referenceValue))}var ca=class extends W{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return Ur(e)&&qr(e.arrayValue,this.value)}},ts=class extends W{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&qr(this.value.arrayValue,e)}},la=class extends W{constructor(t,e){super(t,"not-in",e)}matches(t){if(qr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!qr(this.value.arrayValue,e)}},ha=class extends W{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!Ur(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>qr(this.value.arrayValue,n))}};var da=class{constructor(t,e=null,n=[],i=[],s=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}};function fa(r,t=null,e=[],n=[],i=null,s=null,a=null){return new da(r,t,e,n,i,s,a)}function en(r){let t=k(r);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>sa(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),ai(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>Dn(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>Dn(n)).join(",")),t.ue=e}return t.ue}function ui(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!Um(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!rd(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!Hl(r.startAt,t.startAt)&&Hl(r.endAt,t.endAt)}function es(r){return M.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function ns(r,t){return r.filters.filter(e=>e instanceof W&&e.field.isEqual(t))}function Jl(r,t,e){let n=Ui,i=!0;for(let s of ns(r,t)){let a=Ui,u=!0;switch(s.op){case"<":case"<=":a=Om(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=Ui}$l({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];$l({value:n,inclusive:i},{value:a,inclusive:e.inclusive})<0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}function Xl(r,t,e){let n=Ae,i=!0;for(let s of ns(r,t)){let a=Ae,u=!0;switch(s.op){case">=":case">":a=qm(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=Ae}Ql({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];Ql({value:n,inclusive:i},{value:a,inclusive:e.inclusive})>0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}var Gt=class{constructor(t,e=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function ad(r,t,e,n,i,s,a,u){return new Gt(r,t,e,n,i,s,a,u)}function Jn(r){return new Gt(r)}function Yl(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Yu(r){return r.collectionGroup!==null}function Rn(r){let t=k(r);if(t.ce===null){t.ce=[];let e=new Set;for(let s of t.explicitOrderBy)t.ce.push(s),e.add(s.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new et(yt.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.ce.push(new tn(s,n))}),e.has(yt.keyField().canonicalString())||t.ce.push(new tn(yt.keyField(),n))}return t.ce}function Ct(r){let t=k(r);return t.le||(t.le=cd(t,Rn(r))),t.le}function ud(r){let t=k(r);return t.he||(t.he=cd(t,r.explicitOrderBy)),t.he}function cd(r,t){if(r.limitType==="F")return fa(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new tn(i.field,s)});let e=r.endAt?new Yt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Yt(r.startAt.position,r.startAt.inclusive):null;return fa(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function ma(r,t){let e=r.filters.concat([t]);return new Gt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function rs(r,t,e){return new Gt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function ci(r,t){return ui(Ct(r),Ct(t))&&r.limitType===t.limitType}function ld(r){return`${en(Ct(r))}|lt:${r.limitType}`}function In(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(i=>sd(i)).join(", ")}]`),ai(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(i=>Dn(i)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(i=>Dn(i)).join(",")),`Target(${n})`}(Ct(r))}; limitType=${r.limitType})`}function li(r,t){return t.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):M.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,t)&&function(n,i){for(let s of Rn(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,t)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,t)&&function(n,i){return!(n.startAt&&!function(a,u,c){let d=Wl(a,u,c);return a.inclusive?d<=0:d<0}(n.startAt,Rn(n),i)||n.endAt&&!function(a,u,c){let d=Wl(a,u,c);return a.inclusive?d>=0:d>0}(n.endAt,Rn(n),i))}(r,t)}function hd(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function dd(r){return(t,e)=>{let n=!1;for(let i of Rn(r)){let s=Bm(i,t,e);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function Bm(r,t,e){let n=r.field.isKeyField()?M.comparator(t.key,e.key):function(s,a,u){let c=a.data.field(s),d=u.data.field(s);return c!==null&&d!==null?Ve(c,d):L()}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L()}}var zt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),i=this.inner[n];if(i===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return n.length===1?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){qe(this.inner,(e,n)=>{for(let[i,s]of n)t(i,s)})}isEmpty(){return Yh(this.inner)}size(){return this.innerSize}};var Gm=new it(M.comparator);function Ft(){return Gm}var fd=new it(M.comparator);function Vr(...r){let t=fd;for(let e of r)t=t.insert(e.key,e);return t}function md(r){let t=fd;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Qt(){return Dr()}function gd(){return Dr()}function Dr(){return new zt(r=>r.toString(),(r,t)=>r.isEqual(t))}var zm=new it(M.comparator),jm=new et(M.comparator);function j(...r){let t=jm;for(let e of r)t=t.add(e);return t}var Km=new et(z);function Zu(){return Km}function tc(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Mr(t)?"-0":t}}function pd(r){return{integerValue:""+r}}function _d(r,t){return $h(t)?pd(t):tc(r,t)}var kn=class{constructor(){this._=void 0}};function $m(r,t,e){return r instanceof xe?function(i,s){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Ks(s)&&(s=$s(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(e,t):r instanceof ce?wd(r,t):r instanceof le?vd(r,t):function(i,s){let a=yd(i,s),u=Zl(a)+Zl(i.Pe);return ra(a)&&ra(i.Pe)?pd(u):tc(i.serializer,u)}(r,t)}function Qm(r,t,e){return r instanceof ce?wd(r,t):r instanceof le?vd(r,t):e}function yd(r,t){return r instanceof Ce?function(n){return ra(n)||function(s){return!!s&&"doubleValue"in s}(n)}(t)?t:{integerValue:0}:null}var xe=class extends kn{},ce=class extends kn{constructor(t){super(),this.elements=t}};function wd(r,t){let e=Td(t);for(let n of r.elements)e.some(i=>Xt(i,n))||e.push(n);return{arrayValue:{values:e}}}var le=class extends kn{constructor(t){super(),this.elements=t}};function vd(r,t){let e=Td(t);for(let n of r.elements)e=e.filter(i=>!Xt(i,n));return{arrayValue:{values:e}}}var Ce=class extends kn{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function Zl(r){return st(r.integerValue||r.doubleValue)}function Td(r){return Ur(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var nn=class{constructor(t,e){this.field=t,this.transform=e}};function Wm(r,t){return r.field.isEqual(t.field)&&function(n,i){return n instanceof ce&&i instanceof ce||n instanceof le&&i instanceof le?Vn(n.elements,i.elements,Xt):n instanceof Ce&&i instanceof Ce?Xt(n.Pe,i.Pe):n instanceof xe&&i instanceof xe}(r.transform,t.transform)}var ga=class{constructor(t,e){this.version=t,this.transformResults=e}},ut=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function zi(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var Fn=class{};function Id(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new Ne(r.key,ut.none()):new De(r.key,r.data,ut.none());{let e=r.data,n=Vt.empty(),i=new et(yt.comparator);for(let s of t.fields)if(!i.has(s)){let a=e.field(s);a===null&&s.length>1&&(s=s.popLast(),a=e.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new jt(r.key,n,new Ot(i.toArray()),ut.none())}}function Hm(r,t,e){r instanceof De?function(i,s,a){let u=i.value.clone(),c=eh(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):r instanceof jt?function(i,s,a){if(!zi(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=eh(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(Ed(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,t,e):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function Nr(r,t,e,n){return r instanceof De?function(s,a,u,c){if(!zi(s.precondition,a))return u;let d=s.value.clone(),f=nh(s.fieldTransforms,c,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,t,e,n):r instanceof jt?function(s,a,u,c){if(!zi(s.precondition,a))return u;let d=nh(s.fieldTransforms,c,a),f=a.data;return f.setAll(Ed(s)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,t,e,n):function(s,a,u){return zi(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,t,e)}function Jm(r,t){let e=null;for(let n of r.fieldTransforms){let i=t.data.field(n.field),s=yd(n.transform,i||null);s!=null&&(e===null&&(e=Vt.empty()),e.set(n.field,s))}return e||null}function th(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&Vn(n,i,(s,a)=>Wm(s,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var De=class extends Fn{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},jt=class extends Fn{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Ed(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function eh(r,t,e){let n=new Map;O(r.length===e.length);for(let i=0;i<e.length;i++){let s=r[i],a=s.transform,u=t.data.field(s.field);n.set(s.field,Qm(a,u,e[i]))}return n}function nh(r,t,e){let n=new Map;for(let i of r){let s=i.transform,a=e.data.field(i.field);n.set(i.field,$m(s,a,t))}return n}var Ne=class extends Fn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Br=class extends Fn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Gr=class{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&Hm(s,t,n[i])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=Nr(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=Nr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=gd();return this.mutations.forEach(i=>{let s=t.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=e.has(i.key)?null:u;let c=Id(a,u);c!==null&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(U.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),j())}isEqual(t){return this.batchId===t.batchId&&Vn(this.mutations,t.mutations,(e,n)=>th(e,n))&&Vn(this.baseMutations,t.baseMutations,(e,n)=>th(e,n))}},pa=class r{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){O(t.mutations.length===n.length);let i=function(){return zm}(),s=t.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(t,e,n,i)}};var zr=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var is=class{constructor(t,e,n){this.alias=t,this.aggregateType=e,this.fieldPath=n}};var _a=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var mt,H;function Ad(r){switch(r){default:return L();case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0}}function Sd(r){if(r===void 0)return ct("GRPC error has no .code"),b.UNKNOWN;switch(r){case mt.OK:return b.OK;case mt.CANCELLED:return b.CANCELLED;case mt.UNKNOWN:return b.UNKNOWN;case mt.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case mt.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case mt.INTERNAL:return b.INTERNAL;case mt.UNAVAILABLE:return b.UNAVAILABLE;case mt.UNAUTHENTICATED:return b.UNAUTHENTICATED;case mt.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case mt.NOT_FOUND:return b.NOT_FOUND;case mt.ALREADY_EXISTS:return b.ALREADY_EXISTS;case mt.PERMISSION_DENIED:return b.PERMISSION_DENIED;case mt.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case mt.ABORTED:return b.ABORTED;case mt.OUT_OF_RANGE:return b.OUT_OF_RANGE;case mt.UNIMPLEMENTED:return b.UNIMPLEMENTED;case mt.DATA_LOSS:return b.DATA_LOSS;default:return L()}}(H=mt||(mt={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";var ss=null;function Rd(){return new TextEncoder}var Xm=new ye([4294967295,4294967295],0);function rh(r){let t=Rd().encode(r),e=new No;return e.update(t),new Uint8Array(e.digest())}function ih(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new ye([e,n],0),new ye([i,s],0)]}var ya=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Xe(`Invalid padding: ${e}`);if(n<0)throw new Xe(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new Xe(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new Xe(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ie=ye.fromNumber(this.Te)}Ee(t,e,n){let i=t.add(e.multiply(ye.fromNumber(n)));return i.compare(Xm)===1&&(i=new ye([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ie).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;let e=rh(t),[n,i]=ih(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(t,e,n){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),a=new r(s,i,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(this.Te===0)return;let e=rh(t),[n,i]=ih(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);this.Ae(a)}}Ae(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},Xe=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var jr=class r{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let i=new Map;return i.set(t,Kr.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(U.min(),i,new it(z),Ft(),j())}},Kr=class r{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,j(),j(),j())}};var bn=class{constructor(t,e,n,i){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=i}},os=class{constructor(t,e){this.targetId=t,this.me=e}},as=class{constructor(t,e,n=ft.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}},us=class{constructor(){this.fe=0,this.ge=sh(),this.pe=ft.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=j(),e=j(),n=j();return this.ge.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:L()}}),new Kr(this.pe,this.ye,t,e,n)}Ce(){this.we=!1,this.ge=sh()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,O(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},wa=class{constructor(t){this.Le=t,this.Be=new Map,this.ke=Ft(),this.qe=Ni(),this.Qe=Ni(),this.Ke=new it(z)}$e(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.Ue(e,t.Ve):this.We(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.We(e,t.key,t.Ve)}Ge(t){this.forEachTarget(t,e=>{let n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.je(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.De(t.resumeToken));break;default:L()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach((n,i)=>{this.je(i)&&e(i)})}Je(t){let e=t.targetId,n=t.me.count,i=this.Ye(e);if(i){let s=i.target;if(es(s))if(n===0){let a=new M(s.path);this.We(e,a,wt.newNoDocument(a,U.min()))}else O(n===1);else{let a=this.Ze(e);if(a!==n){let u=this.Xe(t),c=u?this.et(u,t,a):1;if(c!==0){this.He(e);let d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,d)}ss?.tt(function(f,g,_,R,D){var N,V,B,G,q,$;let Y={localCacheCount:f,existenceFilterCount:g.count,databaseId:_.database,projectId:_.projectId},K=g.unchangedNames;return K&&(Y.bloomFilter={applied:D===0,hashCount:(N=K?.hashCount)!==null&&N!==void 0?N:0,bitmapLength:(G=(B=(V=K?.bits)===null||V===void 0?void 0:V.bitmap)===null||B===void 0?void 0:B.length)!==null&&G!==void 0?G:0,padding:($=(q=K?.bits)===null||q===void 0?void 0:q.padding)!==null&&$!==void 0?$:0,mightContain:v=>{var p;return(p=R?.mightContain(v))!==null&&p!==void 0&&p}}),Y}(a,t.me,this.Le.nt(),u,c))}}}}Xe(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=e,a,u;try{a=ue(n).toUint8Array()}catch(c){if(c instanceof Yi)return qt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new ya(a,i,s)}catch(c){return qt(c instanceof Xe?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.Te===0?null:u}et(t,e,n){return e.me.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){let n=this.Le.getRemoteKeysForTarget(e),i=0;return n.forEach(s=>{let a=this.Le.nt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;t.mightContain(u)||(this.We(e,s,null),i++)}),i}it(t){let e=new Map;this.Be.forEach((s,a)=>{let u=this.Ye(a);if(u){if(s.current&&es(u.target)){let c=new M(u.target.path);this.st(c).has(a)||this.ot(a,c)||this.We(a,c,wt.newNoDocument(c,t))}s.be&&(e.set(a,s.ve()),s.Ce())}});let n=j();this.Qe.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{let d=this.Ye(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(t));let i=new jr(t,e,this.Ke,this.ke,n);return this.ke=Ft(),this.qe=Ni(),this.Qe=Ni(),this.Ke=new it(z),i}Ue(t,e){if(!this.je(t))return;let n=this.ot(t,e.key)?2:0;this.ze(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t)),this.Qe=this.Qe.insert(e.key,this._t(e.key).add(t))}We(t,e,n){if(!this.je(t))return;let i=this.ze(t);this.ot(t,e)?i.Fe(e,1):i.Me(e),this.Qe=this.Qe.insert(e,this._t(e).delete(t)),this.Qe=this.Qe.insert(e,this._t(e).add(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ze(t){let e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.ze(t).xe()}ze(t){let e=this.Be.get(t);return e||(e=new us,this.Be.set(t,e)),e}_t(t){let e=this.Qe.get(t);return e||(e=new et(z),this.Qe=this.Qe.insert(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new et(z),this.qe=this.qe.insert(t,e)),e}je(t){let e=this.Ye(t)!==null;return e||C("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){let e=this.Be.get(t);return e&&e.Se?null:this.Le.ut(t)}He(t){this.Be.set(t,new us),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.We(t,e,null)})}ot(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function Ni(){return new it(M.comparator)}function sh(){return new it(M.comparator)}var Ym={asc:"ASCENDING",desc:"DESCENDING"},Zm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},tg={and:"AND",or:"OR"},va=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function Ta(r,t){return r.useProto3Json||ai(t)?t:{value:t}}function Mn(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function bd(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function eg(r,t){return Mn(r,t.toTimestamp())}function ht(r){return O(!!r),U.fromTimestamp(function(e){let n=ae(e);return new lt(n.seconds,n.nanos)}(r))}function ec(r,t){return Ia(r,t).canonicalString()}function Ia(r,t){let e=function(i){return new J(["projects",i.projectId,"databases",i.database])}(r).child("documents");return t===void 0?e:e.child(t)}function Pd(r){let t=J.fromString(r);return O(Od(t)),t}function $r(r,t){return ec(r.databaseId,t.path)}function Ht(r,t){let e=Pd(t);if(e.get(1)!==r.databaseId.projectId)throw new x(b.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new x(b.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new M(Cd(e))}function Vd(r,t){return ec(r.databaseId,t)}function xd(r){let t=Pd(r);return t.length===4?J.emptyPath():Cd(t)}function Ea(r){return new J(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Cd(r){return O(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function oh(r,t,e){return{name:$r(r,t),fields:e.value.mapValue.fields}}function Dd(r,t,e){let n=Ht(r,t.name),i=ht(t.updateTime),s=t.createTime?ht(t.createTime):U.min(),a=new Vt({mapValue:{fields:t.fields}}),u=wt.newFoundDocument(n,i,s,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function ng(r,t){return"found"in t?function(n,i){O(!!i.found),i.found.name,i.found.updateTime;let s=Ht(n,i.found.name),a=ht(i.found.updateTime),u=i.found.createTime?ht(i.found.createTime):U.min(),c=new Vt({mapValue:{fields:i.found.fields}});return wt.newFoundDocument(s,a,u,c)}(r,t):"missing"in t?function(n,i){O(!!i.missing),O(!!i.readTime);let s=Ht(n,i.missing),a=ht(i.readTime);return wt.newNoDocument(s,a)}(r,t):L()}function rg(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(d,f){return d.useProto3Json?(O(f===void 0||typeof f=="string"),ft.fromBase64String(f||"")):(O(f===void 0||f instanceof Buffer||f instanceof Uint8Array),ft.fromUint8Array(f||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&function(d){let f=d.code===void 0?b.UNKNOWN:Sd(d.code);return new x(f,d.message||"")}(a);e=new as(n,i,s,u||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=Ht(r,n.document.name),s=ht(n.document.updateTime),a=n.document.createTime?ht(n.document.createTime):U.min(),u=new Vt({mapValue:{fields:n.document.fields}}),c=wt.newFoundDocument(i,s,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];e=new bn(d,f,c.key,c)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=Ht(r,n.document),s=n.readTime?ht(n.readTime):U.min(),a=wt.newNoDocument(i,s),u=n.removedTargetIds||[];e=new bn([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=Ht(r,n.document),s=n.removedTargetIds||[];e=new bn([],s,i,null)}else{if(!("filter"in t))return L();{t.filter;let n=t.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new _a(i,s),u=n.targetId;e=new os(u,a)}}return e}function Qr(r,t){let e;if(t instanceof De)e={update:oh(r,t.key,t.value)};else if(t instanceof Ne)e={delete:$r(r,t.key)};else if(t instanceof jt)e={update:oh(r,t.key,t.data),updateMask:cg(t.fieldMask)};else{if(!(t instanceof Br))return L();e={verify:$r(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(s,a){let u=a.transform;if(u instanceof xe)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ce)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof le)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Ce)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw L()}(0,n))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:eg(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:L()}(r,t.precondition)),e}function Aa(r,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?ut.updateTime(ht(s.updateTime)):s.exists!==void 0?ut.exists(s.exists):ut.none()}(t.currentDocument):ut.none(),n=t.updateTransforms?t.updateTransforms.map(i=>function(a,u){let c=null;if("setToServerValue"in u)O(u.setToServerValue==="REQUEST_TIME"),c=new xe;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];c=new ce(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];c=new le(f)}else"increment"in u?c=new Ce(a,u.increment):L();let d=yt.fromServerFormat(u.fieldPath);return new nn(d,c)}(r,i)):[];if(t.update){t.update.name;let i=Ht(r,t.update.name),s=new Vt({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=function(c){let d=c.fieldPaths||[];return new Ot(d.map(f=>yt.fromServerFormat(f)))}(t.updateMask);return new jt(i,s,a,e,n)}return new De(i,s,e,n)}if(t.delete){let i=Ht(r,t.delete);return new Ne(i,e)}if(t.verify){let i=Ht(r,t.verify);return new Br(i,e)}return L()}function ig(r,t){return r&&r.length>0?(O(t!==void 0),r.map(e=>function(i,s){let a=i.updateTime?ht(i.updateTime):ht(s);return a.isEqual(U.min())&&(a=ht(s)),new ga(a,i.transformResults||[])}(e,t))):[]}function Nd(r,t){return{documents:[Vd(r,t.path)]}}function Ws(r,t){let e={structuredQuery:{}},n=t.path,i;t.collectionGroup!==null?(i=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=Vd(r,i);let s=function(d){if(d.length!==0)return Ld(Z.create(d,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(f=>function(_){return{field:Te(_.field),direction:og(_.dir)}}(f))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let u=Ta(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{ct:e,parent:i}}function kd(r,t,e,n){let{ct:i,parent:s}=Ws(r,t),a={},u=[],c=0;return e.forEach(d=>{let f=n?d.alias:"aggregate_"+c++;a[f]=d.alias,d.aggregateType==="count"?u.push({alias:f,count:{}}):d.aggregateType==="avg"?u.push({alias:f,avg:{field:Te(d.fieldPath)}}):d.aggregateType==="sum"&&u.push({alias:f,sum:{field:Te(d.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:u,structuredQuery:i.structuredQuery},parent:i.parent},lt:a,parent:s}}function Fd(r){let t=xd(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,i=null;if(n>0){O(n===1);let f=e.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];e.where&&(s=function(g){let _=Md(g);return _ instanceof Z&&Xu(_)?_.getFilters():[_]}(e.where));let a=[];e.orderBy&&(a=function(g){return g.map(_=>function(D){return new tn(En(D.field),function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(D.direction))}(_))}(e.orderBy));let u=null;e.limit&&(u=function(g){let _;return _=typeof g=="object"?g.value:g,ai(_)?null:_}(e.limit));let c=null;e.startAt&&(c=function(g){let _=!!g.before,R=g.values||[];return new Yt(R,_)}(e.startAt));let d=null;return e.endAt&&(d=function(g){let _=!g.before,R=g.values||[];return new Yt(R,_)}(e.endAt)),ad(t,i,a,s,u,"F",c,d)}function sg(r,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Md(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=En(e.unaryFilter.field);return W.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=En(e.unaryFilter.field);return W.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=En(e.unaryFilter.field);return W.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=En(e.unaryFilter.field);return W.create(a,"!=",{nullValue:"NULL_VALUE"});default:return L()}}(r):r.fieldFilter!==void 0?function(e){return W.create(En(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return Z.create(e.compositeFilter.filters.map(n=>Md(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L()}}(e.compositeFilter.op))}(r):L()}function og(r){return Ym[r]}function ag(r){return Zm[r]}function ug(r){return tg[r]}function Te(r){return{fieldPath:r.canonicalString()}}function En(r){return yt.fromServerFormat(r.fieldPath)}function Ld(r){return r instanceof W?function(e){if(e.op==="=="){if(Kl(e.value))return{unaryFilter:{field:Te(e.field),op:"IS_NAN"}};if(jl(e.value))return{unaryFilter:{field:Te(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Kl(e.value))return{unaryFilter:{field:Te(e.field),op:"IS_NOT_NAN"}};if(jl(e.value))return{unaryFilter:{field:Te(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Te(e.field),op:ag(e.op),value:e.value}}}(r):r instanceof Z?function(e){let n=e.getFilters().map(i=>Ld(i));return n.length===1?n[0]:{compositeFilter:{op:ug(e.op),filters:n}}}(r):L()}function cg(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Od(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var Ln=class r{constructor(t,e,n,i,s=U.min(),a=U.min(),u=ft.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var cs=class{constructor(t){this.ht=t}};function lg(r,t){let e;if(t.document)e=Dd(r.ht,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=M.fromSegments(t.noDocument.path),i=sn(t.noDocument.readTime);e=wt.newNoDocument(n,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return L();{let n=M.fromSegments(t.unknownDocument.path),i=sn(t.unknownDocument.version);e=wt.newUnknownDocument(n,i)}}return t.readTime&&e.setReadTime(function(i){let s=new lt(i[0],i[1]);return U.fromTimestamp(s)}(t.readTime)),e}function ah(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:ls(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(s,a){return{name:$r(s,a.key),fields:a.data.value.mapValue.fields,updateTime:Mn(s,a.version.toTimestamp()),createTime:Mn(s,a.createTime.toTimestamp())}}(r.ht,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:rn(t.version)};else{if(!t.isUnknownDocument())return L();n.unknownDocument={path:e.path.toArray(),version:rn(t.version)}}return n}function ls(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function rn(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function sn(r){let t=new lt(r.seconds,r.nanoseconds);return U.fromTimestamp(t)}function We(r,t){let e=(t.baseMutations||[]).map(s=>Aa(r.ht,s));for(let s=0;s<t.mutations.length-1;++s){let a=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let u=t.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let n=t.mutations.map(s=>Aa(r.ht,s)),i=lt.fromMillis(t.localWriteTimeMs);return new Gr(t.batchId,i,e,n)}function xr(r){let t=sn(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?sn(r.lastLimboFreeSnapshotVersion):U.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){return O(s.documents.length===1),Ct(Jn(xd(s.documents[0])))}(r.query):function(s){return Ct(Fd(s))}(r.query),new Ln(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,ft.fromBase64String(r.resumeToken))}function qd(r,t){let e=rn(t.snapshotVersion),n=rn(t.lastLimboFreeSnapshotVersion),i;i=es(t.target)?Nd(r.ht,t.target):Ws(r.ht,t.target).ct;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:en(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function nc(r){let t=Fd({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?rs(t,t.limit,"L"):t}function qo(r,t){return new zr(t.largestBatchId,Aa(r.ht,t.overlayMutation))}function uh(r,t){let e=t.path.lastSegment();return[r,xt(t.path.popLast()),e]}function ch(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:rn(n.readTime),documentKey:xt(n.documentKey.path),largestBatchId:n.largestBatchId}}var Sa=class{getBundleMetadata(t,e){return lh(t).get(e).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:sn(s.createTime),version:s.version}}(n)})}saveBundleMetadata(t,e){return lh(t).put(function(i){return{bundleId:i.id,createTime:rn(ht(i.createTime)),version:i.version}}(e))}getNamedQuery(t,e){return hh(t).get(e).next(n=>{if(n)return function(s){return{name:s.name,query:nc(s.bundledQuery),readTime:sn(s.readTime)}}(n)})}saveNamedQuery(t,e){return hh(t).put(function(i){return{name:i.name,readTime:rn(ht(i.readTime)),bundledQuery:i.bundledQuery}}(e))}};function lh(r){return Tt(r,"bundles")}function hh(r){return Tt(r,"namedQueries")}var hs=class r{constructor(t,e){this.serializer=t,this.userId=e}static Pt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return Sr(t).get(uh(this.userId,e)).next(n=>n?qo(this.serializer,n):null)}getOverlays(t,e){let n=Qt();return S.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){let i=[];return n.forEach((s,a)=>{let u=new zr(e,a);i.push(this.Tt(t,u))}),S.waitFor(i)}removeOverlaysForBatchId(t,e,n){let i=new Set;e.forEach(a=>i.add(xt(a.getCollectionPath())));let s=[];return i.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(Sr(t).j("collectionPathOverlayIndex",u))}),S.waitFor(s)}getOverlaysForCollection(t,e,n){let i=Qt(),s=xt(e),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Sr(t).U("collectionPathOverlayIndex",a).next(u=>{for(let c of u){let d=qo(this.serializer,c);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(t,e,n,i){let s=Qt(),a,u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Sr(t).J({index:"collectionGroupOverlayIndex",range:u},(c,d,f)=>{let g=qo(this.serializer,d);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}Tt(t,e){return Sr(t).put(function(i,s,a){let[u,c,d]=uh(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Qr(i.ht,a.mutation)}}(this.serializer,this.userId,e))}};function Sr(r){return Tt(r,"documentOverlays")}var Ra=class{It(t){return Tt(t,"globals")}getSessionToken(t){return this.It(t).get("sessionToken").next(e=>{let n=e?.value;return n?ft.fromUint8Array(n):ft.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.It(t).put({name:"sessionToken",value:e.toUint8Array()})}};var ie=class{constructor(){}Et(t,e){this.dt(t,e),e.At()}dt(t,e){if("nullValue"in t)this.Rt(e,5);else if("booleanValue"in t)this.Rt(e,10),e.Vt(t.booleanValue?1:0);else if("integerValue"in t)this.Rt(e,15),e.Vt(st(t.integerValue));else if("doubleValue"in t){let n=st(t.doubleValue);isNaN(n)?this.Rt(e,13):(this.Rt(e,15),Mr(n)?e.Vt(0):e.Vt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Rt(e,20),typeof n=="string"&&(n=ae(n)),e.ft(`${n.seconds||""}`),e.Vt(n.nanos||0)}else if("stringValue"in t)this.gt(t.stringValue,e),this.yt(e);else if("bytesValue"in t)this.Rt(e,30),e.wt(ue(t.bytesValue)),this.yt(e);else if("referenceValue"in t)this.St(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.Rt(e,45),e.Vt(n.latitude||0),e.Vt(n.longitude||0)}else"mapValue"in t?Zh(t)?this.Rt(e,Number.MAX_SAFE_INTEGER):Qs(t)?this.bt(t.mapValue,e):(this.Dt(t.mapValue,e),this.yt(e)):"arrayValue"in t?(this.vt(t.arrayValue,e),this.yt(e)):L()}gt(t,e){this.Rt(e,25),this.Ct(t,e)}Ct(t,e){e.ft(t)}Dt(t,e){let n=t.fields||{};this.Rt(e,55);for(let i of Object.keys(n))this.gt(i,e),this.dt(n[i],e)}bt(t,e){var n,i;let s=t.fields||{};this.Rt(e,53);let a="value",u=((i=(n=s[a].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.Rt(e,15),e.Vt(st(u)),this.gt(a,e),this.dt(s[a],e)}vt(t,e){let n=t.values||[];this.Rt(e,50);for(let i of n)this.dt(i,e)}St(t,e){this.Rt(e,37),M.fromName(t).path.forEach(n=>{this.Rt(e,60),this.Ct(n,e)})}Rt(t,e){t.Vt(e)}yt(t){t.Vt(2)}};ie.Ft=new ie;function hg(r){if(r===0)return 8;let t=0;return!(r>>4)&&(t+=4,r<<=4),!(r>>6)&&(t+=2,r<<=2),!(r>>7)&&(t+=1),t}function dh(r){let t=64-function(n){let i=0;for(let s=0;s<8;++s){let a=hg(255&n[s]);if(i+=a,a!==8)break}return i}(r);return Math.ceil(t/8)}var ba=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Mt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.xt(n.value),n=e.next();this.Ot()}Nt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Lt(n.value),n=e.next();this.Bt()}kt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.xt(n);else if(n<2048)this.xt(960|n>>>6),this.xt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.xt(480|n>>>12),this.xt(128|63&n>>>6),this.xt(128|63&n);else{let i=e.codePointAt(0);this.xt(240|i>>>18),this.xt(128|63&i>>>12),this.xt(128|63&i>>>6),this.xt(128|63&i)}}this.Ot()}qt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Lt(n);else if(n<2048)this.Lt(960|n>>>6),this.Lt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Lt(480|n>>>12),this.Lt(128|63&n>>>6),this.Lt(128|63&n);else{let i=e.codePointAt(0);this.Lt(240|i>>>18),this.Lt(128|63&i>>>12),this.Lt(128|63&i>>>6),this.Lt(128|63&i)}}this.Bt()}Qt(t){let e=this.Kt(t),n=dh(e);this.$t(1+n),this.buffer[this.position++]=255&n;for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=255&e[i]}Ut(t){let e=this.Kt(t),n=dh(e);this.$t(1+n),this.buffer[this.position++]=~(255&n);for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}Wt(){this.Gt(255),this.Gt(255)}zt(){this.jt(255),this.jt(255)}reset(){this.position=0}seed(t){this.$t(t.length),this.buffer.set(t,this.position),this.position+=t.length}Ht(){return this.buffer.slice(0,this.position)}Kt(t){let e=function(s){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(t),n=(128&e[0])!=0;e[0]^=n?255:128;for(let i=1;i<e.length;++i)e[i]^=n?255:0;return e}xt(t){let e=255&t;e===0?(this.Gt(0),this.Gt(255)):e===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Lt(t){let e=255&t;e===0?(this.jt(0),this.jt(255)):e===255?(this.jt(255),this.jt(0)):this.jt(t)}Ot(){this.Gt(0),this.Gt(1)}Bt(){this.jt(0),this.jt(1)}Gt(t){this.$t(1),this.buffer[this.position++]=t}jt(t){this.$t(1),this.buffer[this.position++]=~t}$t(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},Pa=class{constructor(t){this.Jt=t}wt(t){this.Jt.Mt(t)}ft(t){this.Jt.kt(t)}Vt(t){this.Jt.Qt(t)}At(){this.Jt.Wt()}},Va=class{constructor(t){this.Jt=t}wt(t){this.Jt.Nt(t)}ft(t){this.Jt.qt(t)}Vt(t){this.Jt.Ut(t)}At(){this.Jt.zt()}},He=class{constructor(){this.Jt=new ba,this.Yt=new Pa(this.Jt),this.Zt=new Va(this.Jt)}seed(t){this.Jt.seed(t)}Xt(t){return t===0?this.Yt:this.Zt}Ht(){return this.Jt.Ht()}reset(){this.Jt.reset()}};var Je=class r{constructor(t,e,n,i){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=i}en(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function we(r,t){let e=r.indexId-t.indexId;return e!==0?e:(e=fh(r.arrayValue,t.arrayValue),e!==0?e:(e=fh(r.directionalValue,t.directionalValue),e!==0?e:M.comparator(r.documentKey,t.documentKey)))}function fh(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}var ds=class{constructor(t){this.tn=new et((e,n)=>yt.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.nn=t.orderBy,this.rn=[];for(let e of t.filters){let n=e;n.isInequality()?this.tn=this.tn.add(n):this.rn.push(n)}}get sn(){return this.tn.size>1}on(t){if(O(t.collectionGroup===this.collectionId),this.sn)return!1;let e=Jo(t);if(e!==void 0&&!this._n(e))return!1;let n=$e(t),i=new Set,s=0,a=0;for(;s<n.length&&this._n(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.tn.size>0){let u=this.tn.getIterator().getNext();if(!i.has(u.field.canonicalString())){let c=n[s];if(!this.an(u,c)||!this.un(this.nn[a++],c))return!1}++s}for(;s<n.length;++s){let u=n[s];if(a>=this.nn.length||!this.un(this.nn[a++],u))return!1}return!0}cn(){if(this.sn)return null;let t=new et(yt.comparator),e=[];for(let n of this.rn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new oe(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new oe(n.field,0))}for(let n of this.nn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new oe(n.field,n.dir==="asc"?0:1)));return new Re(Re.UNKNOWN_ID,this.collectionId,e,xn.empty())}_n(t){for(let e of this.rn)if(this.an(e,t))return!0;return!1}an(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}un(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function Ud(r){var t,e;if(O(r instanceof W||r instanceof Z),r instanceof W){if(r instanceof ts){let i=((e=(t=r.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>W.create(r.field,"==",s)))||[];return Z.create(i,"or")}return r}let n=r.filters.map(i=>Ud(i));return Z.create(n,r.op)}function dg(r){if(r.getFilters().length===0)return[];let t=Da(Ud(r));return O(Bd(t)),xa(t)||Ca(t)?[t]:t.getFilters()}function xa(r){return r instanceof W}function Ca(r){return r instanceof Z&&Xu(r)}function Bd(r){return xa(r)||Ca(r)||function(e){if(e instanceof Z&&ia(e)){for(let n of e.getFilters())if(!xa(n)&&!Ca(n))return!1;return!0}return!1}(r)}function Da(r){if(O(r instanceof W||r instanceof Z),r instanceof W)return r;if(r.filters.length===1)return Da(r.filters[0]);let t=r.filters.map(n=>Da(n)),e=Z.create(t,r.op);return e=fs(e),Bd(e)?e:(O(e instanceof Z),O(Nn(e)),O(e.filters.length>1),e.filters.reduce((n,i)=>rc(n,i)))}function rc(r,t){let e;return O(r instanceof W||r instanceof Z),O(t instanceof W||t instanceof Z),e=r instanceof W?t instanceof W?function(i,s){return Z.create([i,s],"and")}(r,t):mh(r,t):t instanceof W?mh(t,r):function(i,s){if(O(i.filters.length>0&&s.filters.length>0),Nn(i)&&Nn(s))return id(i,s.getFilters());let a=ia(i)?i:s,u=ia(i)?s:i,c=a.filters.map(d=>rc(d,u));return Z.create(c,"or")}(r,t),fs(e)}function mh(r,t){if(Nn(t))return id(t,r.getFilters());{let e=t.filters.map(n=>rc(r,n));return Z.create(e,"or")}}function fs(r){if(O(r instanceof W||r instanceof Z),r instanceof W)return r;let t=r.getFilters();if(t.length===1)return fs(t[0]);if(nd(r))return r;let e=t.map(i=>fs(i)),n=[];return e.forEach(i=>{i instanceof W?n.push(i):i instanceof Z&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:Z.create(n,r.op)}var Na=class{constructor(){this.ln=new Wr}addToCollectionParentIndex(t,e){return this.ln.add(e),S.resolve()}getCollectionParents(t,e){return S.resolve(this.ln.getEntries(e))}addFieldIndex(t,e){return S.resolve()}deleteFieldIndex(t,e){return S.resolve()}deleteAllFieldIndexes(t){return S.resolve()}createTargetIndexes(t,e){return S.resolve()}getDocumentsMatchingTarget(t,e){return S.resolve(null)}getIndexType(t,e){return S.resolve(0)}getFieldIndexes(t,e){return S.resolve([])}getNextCollectionGroupToUpdate(t){return S.resolve(null)}getMinOffset(t,e){return S.resolve(Ut.min())}getMinOffsetFromCollectionGroup(t,e){return S.resolve(Ut.min())}updateCollectionGroup(t,e,n){return S.resolve()}updateIndexEntries(t,e){return S.resolve()}},Wr=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new et(J.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new et(J.comparator)).toArray()}};var ki=new Uint8Array(0),ka=class{constructor(t,e){this.databaseId=e,this.hn=new Wr,this.Pn=new zt(n=>en(n),(n,i)=>ui(n,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.hn.has(e)){let n=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this.hn.add(e)});let s={collectionId:n,parent:xt(i)};return gh(t).put(s)}return S.resolve()}getCollectionParents(t,e){let n=[],i=IDBKeyRange.bound([e,""],[Bh(e),""],!1,!0);return gh(t).U(i).next(s=>{for(let a of s){if(a.collectionId!==e)break;n.push($t(a.parent))}return n})}addFieldIndex(t,e){let n=Rr(t),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(e);delete i.indexId;let s=n.add(i);if(e.indexState){let a=wn(t);return s.next(u=>{a.put(ch(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let n=Rr(t),i=wn(t),s=yn(t);return n.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=Rr(t),n=yn(t),i=wn(t);return e.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(t,e){return S.forEach(this.Tn(e),n=>this.getIndexType(t,n).next(i=>{if(i===0||i===1){let s=new ds(n).cn();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let n=yn(t),i=!0,s=new Map;return S.forEach(this.Tn(e),a=>this.In(t,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=j(),u=[];return S.forEach(s,(c,d)=>{C("IndexedDbIndexManager",`Using index ${function(q){return`id=${q.indexId}|cg=${q.collectionGroup}|f=${q.fields.map($=>`${$.fieldPath}:${$.kind}`).join(",")}`}(c)} to execute ${en(e)}`);let f=function(q,$){let Y=Jo($);if(Y===void 0)return null;for(let K of ns(q,Y.fieldPath))switch(K.op){case"array-contains-any":return K.value.arrayValue.values||[];case"array-contains":return[K.value]}return null}(d,c),g=function(q,$){let Y=new Map;for(let K of $e($))for(let v of ns(q,K.fieldPath))switch(v.op){case"==":case"in":Y.set(K.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return Y.set(K.fieldPath.canonicalString(),v.value),Array.from(Y.values())}return null}(d,c),_=function(q,$){let Y=[],K=!0;for(let v of $e($)){let p=v.kind===0?Jl(q,v.fieldPath,q.startAt):Xl(q,v.fieldPath,q.startAt);Y.push(p.value),K&&(K=p.inclusive)}return new Yt(Y,K)}(d,c),R=function(q,$){let Y=[],K=!0;for(let v of $e($)){let p=v.kind===0?Xl(q,v.fieldPath,q.endAt):Jl(q,v.fieldPath,q.endAt);Y.push(p.value),K&&(K=p.inclusive)}return new Yt(Y,K)}(d,c),D=this.En(c,d,_),N=this.En(c,d,R),V=this.dn(c,d,g),B=this.An(c.indexId,f,D,_.inclusive,N,R.inclusive,V);return S.forEach(B,G=>n.G(G,e.limit).next(q=>{q.forEach($=>{let Y=M.fromSegments($.documentKey);a.has(Y)||(a=a.add(Y),u.push(Y))})}))}).next(()=>u)}return S.resolve(null)})}Tn(t){let e=this.Pn.get(t);return e||(t.filters.length===0?e=[t]:e=dg(Z.create(t.filters,"and")).map(n=>fa(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.Pn.set(t,e),e)}An(t,e,n,i,s,a,u){let c=(e!=null?e.length:1)*Math.max(n.length,s.length),d=c/(e!=null?e.length:1),f=[];for(let g=0;g<c;++g){let _=e?this.Rn(e[g/d]):ki,R=this.Vn(t,_,n[g%d],i),D=this.mn(t,_,s[g%d],a),N=u.map(V=>this.Vn(t,_,V,!0));f.push(...this.createRange(R,D,N))}return f}Vn(t,e,n,i){let s=new Je(t,M.empty(),e,n);return i?s:s.en()}mn(t,e,n,i){let s=new Je(t,M.empty(),e,n);return i?s.en():s}In(t,e){let n=new ds(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let a=null;for(let u of s)n.on(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(t,e){let n=2,i=this.Tn(e);return S.forEach(i,s=>this.In(t,s).next(a=>{a?n!==0&&a.fields.length<function(c){let d=new et(yt.comparator),f=!1;for(let g of c.filters)for(let _ of g.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:d=d.add(_.field));for(let g of c.orderBy)g.field.isKeyField()||(d=d.add(g.field));return d.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&i.length>1&&n===2?1:n)}fn(t,e){let n=new He;for(let i of $e(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let a=n.Xt(i.kind);ie.Ft.Et(s,a)}return n.Ht()}Rn(t){let e=new He;return ie.Ft.Et(t,e.Xt(0)),e.Ht()}gn(t,e){let n=new He;return ie.Ft.Et(Ze(this.databaseId,e),n.Xt(function(s){let a=$e(s);return a.length===0?0:a[a.length-1].kind}(t))),n.Ht()}dn(t,e,n){if(n===null)return[];let i=[];i.push(new He);let s=0;for(let a of $e(t)){let u=n[s++];for(let c of i)if(this.pn(e,a.fieldPath)&&Ur(u))i=this.yn(i,a,u);else{let d=c.Xt(a.kind);ie.Ft.Et(u,d)}}return this.wn(i)}En(t,e,n){return this.dn(t,e,n.position)}wn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Ht();return e}yn(t,e,n){let i=[...t],s=[];for(let a of n.arrayValue.values||[])for(let u of i){let c=new He;c.seed(u.Ht()),ie.Ft.Et(a,c.Xt(e.kind)),s.push(c)}return s}pn(t,e){return!!t.filters.find(n=>n instanceof W&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=Rr(t),i=wn(t);return(e?n.U("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.U()).next(s=>{let a=[];return S.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,g){let _=g?new xn(g.sequenceNumber,new Ut(sn(g.readTime),new M($t(g.documentKey)),g.largestBatchId)):xn.empty(),R=f.fields.map(([D,N])=>new oe(yt.fromServerFormat(D),N));return new Re(f.indexId,f.collectionGroup,R,_)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:z(n.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let i=Rr(t),s=wn(t);return this.Sn(t).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(u=>S.forEach(u,c=>s.put(ch(c.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return S.forEach(e,(i,s)=>{let a=n.get(i.collectionGroup);return(a?S.resolve(a):this.getFieldIndexes(t,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),S.forEach(u,c=>this.bn(t,i,c).next(d=>{let f=this.Dn(s,c);return d.isEqual(f)?S.resolve():this.vn(t,s,c,d,f)}))))})}Cn(t,e,n,i){return yn(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.gn(n,e.key),documentKey:e.key.path.toArray()})}Fn(t,e,n,i){return yn(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.gn(n,e.key),e.key.path.toArray()])}bn(t,e,n){let i=yn(t),s=new et(we);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,e)])},(a,u)=>{s=s.add(new Je(n.indexId,e,u.arrayValue,u.directionalValue))}).next(()=>s)}Dn(t,e){let n=new et(we),i=this.fn(e,t);if(i==null)return n;let s=Jo(e);if(s!=null){let a=t.data.field(s.fieldPath);if(Ur(a))for(let u of a.arrayValue.values||[])n=n.add(new Je(e.indexId,t.key,this.Rn(u),i))}else n=n.add(new Je(e.indexId,t.key,ki,i));return n}vn(t,e,n,i,s){C("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let a=[];return function(c,d,f,g,_){let R=c.getIterator(),D=d.getIterator(),N=_n(R),V=_n(D);for(;N||V;){let B=!1,G=!1;if(N&&V){let q=f(N,V);q<0?G=!0:q>0&&(B=!0)}else N!=null?G=!0:B=!0;B?(g(V),V=_n(D)):G?(_(N),N=_n(R)):(N=_n(R),V=_n(D))}}(i,s,we,u=>{a.push(this.Cn(t,e,n,u))},u=>{a.push(this.Fn(t,e,n,u))}),S.waitFor(a)}Sn(t){let e=1;return wn(t).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,u)=>we(a,u)).filter((a,u,c)=>!u||we(a,c[u-1])!==0);let i=[];i.push(t);for(let a of n){let u=we(a,t),c=we(a,e);if(u===0)i[0]=t.en();else if(u>0&&c<0)i.push(a),i.push(a.en());else if(c>0)break}i.push(e);let s=[];for(let a=0;a<i.length;a+=2){if(this.Mn(i[a],i[a+1]))return[];let u=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,ki,[]],c=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,ki,[]];s.push(IDBKeyRange.bound(u,c))}return s}Mn(t,e){return we(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(ph)}getMinOffset(t,e){return S.mapArray(this.Tn(e),n=>this.In(t,n).next(i=>i||L())).next(ph)}};function gh(r){return Tt(r,"collectionParents")}function yn(r){return Tt(r,"indexEntries")}function Rr(r){return Tt(r,"indexConfiguration")}function wn(r){return Tt(r,"indexState")}function ph(r){O(r.length!==0);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;Wu(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new Ut(t.readTime,t.documentKey,e)}var _h={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},kt=class r{static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}};function Gd(r,t,e){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(e.batchId),u=0,c=n.J({range:a},(f,g,_)=>(u++,_.delete()));s.push(c.next(()=>{O(u===1)}));let d=[];for(let f of e.mutations){let g=Qh(t,f.key.path,e.batchId);s.push(i.delete(g)),d.push(f.key)}return S.waitFor(s).next(()=>d)}function ms(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw L();t=r.noDocument}return JSON.stringify(t).length}kt.DEFAULT_COLLECTION_PERCENTILE=10,kt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,kt.DEFAULT=new kt(41943040,kt.DEFAULT_COLLECTION_PERCENTILE,kt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),kt.DISABLED=new kt(-1,0,0);var gs=class r{constructor(t,e,n,i){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=i,this.xn={}}static Pt(t,e,n,i){O(t.uid!=="");let s=t.isAuthenticated()?t.uid:"";return new r(s,e,n,i)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ve(t).J({index:"userMutationsIndex",range:n},(i,s,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,i){let s=An(t),a=ve(t);return a.add({}).next(u=>{O(typeof u=="number");let c=new Gr(u,e,n,i),d=function(R,D,N){let V=N.baseMutations.map(G=>Qr(R.ht,G)),B=N.mutations.map(G=>Qr(R.ht,G));return{userId:D,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:V,mutations:B}}(this.serializer,this.userId,c),f=[],g=new et((_,R)=>z(_.canonicalString(),R.canonicalString()));for(let _ of i){let R=Qh(this.userId,_.key.path,u);g=g.add(_.key.path.popLast()),f.push(a.put(d)),f.push(s.put(R,wm))}return g.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(t,_))}),t.addOnCommittedListener(()=>{this.xn[u]=c.keys()}),S.waitFor(f).next(()=>c)})}lookupMutationBatch(t,e){return ve(t).get(e).next(n=>n?(O(n.userId===this.userId),We(this.serializer,n)):null)}On(t,e){return this.xn[e]?S.resolve(this.xn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let i=n.keys();return this.xn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return ve(t).J({index:"userMutationsIndex",range:i},(a,u,c)=>{u.userId===this.userId&&(O(u.batchId>=n),s=We(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ve(t).J({index:"userMutationsIndex",range:e,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ve(t).U("userMutationsIndex",e).next(n=>n.map(i=>We(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=qi(this.userId,e.path),i=IDBKeyRange.lowerBound(n),s=[];return An(t).J({range:i},(a,u,c)=>{let[d,f,g]=a,_=$t(f);if(d===this.userId&&e.path.isEqual(_))return ve(t).get(g).next(R=>{if(!R)throw L();O(R.userId===this.userId),s.push(We(this.serializer,R))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(z),i=[];return e.forEach(s=>{let a=qi(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=An(t).J({range:u},(d,f,g)=>{let[_,R,D]=d,N=$t(R);_===this.userId&&s.path.isEqual(N)?n=n.add(D):g.done()});i.push(c)}),S.waitFor(i).next(()=>this.Nn(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=qi(this.userId,n),a=IDBKeyRange.lowerBound(s),u=new et(z);return An(t).J({range:a},(c,d,f)=>{let[g,_,R]=c,D=$t(_);g===this.userId&&n.isPrefixOf(D)?D.length===i&&(u=u.add(R)):f.done()}).next(()=>this.Nn(t,u))}Nn(t,e){let n=[],i=[];return e.forEach(s=>{i.push(ve(t).get(s).next(a=>{if(a===null)throw L();O(a.userId===this.userId),n.push(We(this.serializer,a))}))}),S.waitFor(i).next(()=>n)}removeMutationBatch(t,e){return Gd(t._e,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.Ln(e.batchId)}),S.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}Ln(t){delete this.xn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return S.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return An(t).J({range:n},(s,a,u)=>{if(s[0]===this.userId){let c=$t(s[1]);i.push(c)}else u.done()}).next(()=>{O(i.length===0)})})}containsKey(t,e){return zd(t,this.userId,e)}Bn(t){return jd(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function zd(r,t,e){let n=qi(t,e.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return An(r).J({range:s,H:!0},(u,c,d)=>{let[f,g,_]=u;f===t&&g===i&&(a=!0),d.done()}).next(()=>a)}function ve(r){return Tt(r,"mutations")}function An(r){return Tt(r,"documentMutations")}function jd(r){return Tt(r,"mutationQueues")}var On=class r{constructor(t){this.kn=t}next(){return this.kn+=2,this.kn}static qn(){return new r(0)}static Qn(){return new r(-1)}};var Fa=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.Kn(t).next(e=>{let n=new On(e.highestTargetId);return e.highestTargetId=n.next(),this.$n(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Kn(t).next(e=>U.fromTimestamp(new lt(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Kn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.Kn(t).next(i=>(i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.$n(t,i)))}addTargetData(t,e){return this.Un(t,e).next(()=>this.Kn(t).next(n=>(n.targetCount+=1,this.Wn(e,n),this.$n(t,n))))}updateTargetData(t,e){return this.Un(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>vn(t).delete(e.targetId)).next(()=>this.Kn(t)).next(n=>(O(n.targetCount>0),n.targetCount-=1,this.$n(t,n)))}removeTargets(t,e,n){let i=0,s=[];return vn(t).J((a,u)=>{let c=xr(u);c.sequenceNumber<=e&&n.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(t,c)))}).next(()=>S.waitFor(s)).next(()=>i)}forEachTarget(t,e){return vn(t).J((n,i)=>{let s=xr(i);e(s)})}Kn(t){return yh(t).get("targetGlobalKey").next(e=>(O(e!==null),e))}$n(t,e){return yh(t).put("targetGlobalKey",e)}Un(t,e){return vn(t).put(qd(this.serializer,e))}Wn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Kn(t).next(e=>e.targetCount)}getTargetData(t,e){let n=en(e),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return vn(t).J({range:i,index:"queryTargetsIndex"},(a,u,c)=>{let d=xr(u);ui(e,d.target)&&(s=d,c.done())}).next(()=>s)}addMatchingKeys(t,e,n){let i=[],s=Ie(t);return e.forEach(a=>{let u=xt(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(t,n,a))}),S.waitFor(i)}removeMatchingKeys(t,e,n){let i=Ie(t);return S.forEach(e,s=>{let a=xt(s.path);return S.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(t,n,s)])})}removeMatchingKeysForTargetId(t,e){let n=Ie(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),i=Ie(t),s=j();return i.J({range:n,H:!0},(a,u,c)=>{let d=$t(a[1]),f=new M(d);s=s.add(f)}).next(()=>s)}containsKey(t,e){let n=xt(e.path),i=IDBKeyRange.bound([n],[Bh(n)],!1,!0),s=0;return Ie(t).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],c,d)=>{a!==0&&(s++,d.done())}).next(()=>s>0)}ut(t,e){return vn(t).get(e).next(n=>n?xr(n):null)}};function vn(r){return Tt(r,"targets")}function yh(r){return Tt(r,"targetGlobal")}function Ie(r){return Tt(r,"targetDocuments")}function wh([r,t],[e,n]){let i=z(r,e);return i===0?z(t,n):i}var Ma=class{constructor(t){this.Gn=t,this.buffer=new et(wh),this.zn=0}jn(){return++this.zn}Hn(t){let e=[t,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();wh(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},ps=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return this.Jn!==null}Yn(t){C("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Oe(e)?C("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await Le(e)}await this.Yn(3e5)})}},La=class{constructor(t,e){this.Zn=t,this.params=e}calculateTargetCount(t,e){return this.Zn.Xn(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return S.resolve(Lt.oe);let n=new Ma(e);return this.Zn.forEachTarget(t,i=>n.Hn(i.sequenceNumber)).next(()=>this.Zn.er(t,i=>n.Hn(i))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.Zn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Zn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(C("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(_h)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(C("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),_h):this.tr(t,e))}getCacheSize(t){return this.Zn.getCacheSize(t)}tr(t,e){let n,i,s,a,u,c,d,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(C("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(t,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(t,n,e))).next(g=>(s=g,c=Date.now(),this.removeOrphanedDocuments(t,n))).next(g=>(d=Date.now(),Tn()<=Kt.DEBUG&&C("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(c-u)+`ms
	Removed ${g} documents in `+(d-c)+`ms
Total Duration: ${d-f}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}};function Kd(r,t){return new La(r,t)}var Oa=class{constructor(t,e){this.db=t,this.garbageCollector=Kd(this,e)}Xn(t){let e=this.nr(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}nr(t){let e=0;return this.er(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}er(t,e){return this.rr(t,(n,i)=>e(i))}addReference(t,e,n){return Fi(t,n)}removeReference(t,e,n){return Fi(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Fi(t,e)}ir(t,e){return function(i,s){let a=!1;return jd(i).Y(u=>zd(i,u,s).next(c=>(c&&(a=!0),S.resolve(!c)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.rr(t,(a,u)=>{if(u<=e){let c=this.ir(t,a).next(d=>{if(!d)return s++,n.getEntry(t,a).next(()=>(n.removeEntry(a,U.min()),Ie(t).delete(function(g){return[0,xt(g.path)]}(a))))});i.push(c)}}).next(()=>S.waitFor(i)).next(()=>n.apply(t)).next(()=>s)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Fi(t,e)}rr(t,e){let n=Ie(t),i,s=Lt.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:c,sequenceNumber:d})=>{a===0?(s!==Lt.oe&&e(new M($t(i)),s),s=d,i=c):s=Lt.oe}).next(()=>{s!==Lt.oe&&e(new M($t(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Fi(r,t){return Ie(r).put(function(n,i){return{targetId:0,path:xt(n.path),sequenceNumber:i}}(t,r.currentSequenceNumber))}var _s=class{constructor(){this.changes=new zt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,wt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?S.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var qa=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return Ke(t).put(n)}removeEntry(t,e,n){return Ke(t).delete(function(s,a){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],ls(a),u[u.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.sr(t,n)))}getEntry(t,e){let n=wt.newInvalidDocument(e);return Ke(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(br(e))},(i,s)=>{n=this._r(e,s)}).next(()=>n)}ar(t,e){let n={size:0,document:wt.newInvalidDocument(e)};return Ke(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(br(e))},(i,s)=>{n={document:this._r(e,s),size:ms(s)}}).next(()=>n)}getEntries(t,e){let n=Ft();return this.ur(t,e,(i,s)=>{let a=this._r(i,s);n=n.insert(i,a)}).next(()=>n)}cr(t,e){let n=Ft(),i=new it(M.comparator);return this.ur(t,e,(s,a)=>{let u=this._r(s,a);n=n.insert(s,u),i=i.insert(s,ms(a))}).next(()=>({documents:n,lr:i}))}ur(t,e,n){if(e.isEmpty())return S.resolve();let i=new et(Ih);e.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(br(i.first()),br(i.last())),a=i.getIterator(),u=a.getNext();return Ke(t).J({index:"documentKeyIndex",range:s},(c,d,f)=>{let g=M.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&Ih(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.$(br(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,i,s){let a=e.path,u=[a.popLast().toArray(),a.lastSegment(),ls(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ke(t).U(IDBKeyRange.bound(u,c,!0)).next(d=>{s?.incrementDocumentReadCount(d.length);let f=Ft();for(let g of d){let _=this._r(M.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);_.isFoundDocument()&&(li(e,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(t,e,n,i){let s=Ft(),a=Th(e,n),u=Th(e,Ut.max());return Ke(t).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(c,d,f)=>{let g=this._r(M.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(t){return new Ua(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return vh(t).get("remoteDocumentGlobalKey").next(e=>(O(!!e),e))}sr(t,e){return vh(t).put("remoteDocumentGlobalKey",e)}_r(t,e){if(e){let n=lg(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(U.min())))return n}return wt.newInvalidDocument(t)}};function $d(r){return new qa(r)}var Ua=class extends _s{constructor(t,e){super(),this.hr=t,this.trackRemovals=e,this.Pr=new zt(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(t){let e=[],n=0,i=new et((s,a)=>z(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let u=this.Pr.get(s);if(e.push(this.hr.removeEntry(t,s,u.readTime)),a.isValidDocument()){let c=ah(this.hr.serializer,a);i=i.add(s.path.popLast());let d=ms(c);n+=d-u.size,e.push(this.hr.addEntry(t,s,c))}else if(n-=u.size,this.trackRemovals){let c=ah(this.hr.serializer,a.convertToNoDocument(U.min()));e.push(this.hr.addEntry(t,s,c))}}),i.forEach(s=>{e.push(this.hr.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.hr.updateMetadata(t,n)),S.waitFor(e)}getFromCache(t,e){return this.hr.ar(t,e).next(n=>(this.Pr.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.hr.cr(t,e).next(({documents:n,lr:i})=>(i.forEach((s,a)=>{this.Pr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}};function vh(r){return Tt(r,"remoteDocumentGlobal")}function Ke(r){return Tt(r,"remoteDocumentsV14")}function br(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Th(r,t){let e=t.documentKey.path.toArray();return[r,ls(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Ih(r,t){let e=r.path.toArray(),n=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<n.length-2;++s)if(i=z(e[s],n[s]),i)return i;return i=z(e.length,n.length),i||(i=z(e[e.length-2],n[n.length-2]),i||z(e[e.length-1],n[n.length-1]))}var Ba=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var ys=class{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(n=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(n!==null&&Nr(n.mutation,i,Ot.empty(),lt.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,j()).next(()=>n))}getLocalViewOfDocuments(t,e,n=j()){let i=Qt();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,n).next(s=>{let a=Vr();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=Qt();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,j()))}populateOverlays(t,e,n){let i=[];return n.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,i){let s=Ft(),a=Dr(),u=function(){return Dr()}();return e.forEach((c,d)=>{let f=n.get(d.key);i.has(d.key)&&(f===void 0||f.mutation instanceof jt)?s=s.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),Nr(f.mutation,d,f.mutation.getFieldMask(),lt.now())):a.set(d.key,Ot.empty())}),this.recalculateAndSaveOverlays(t,s).next(c=>(c.forEach((d,f)=>a.set(d,f)),e.forEach((d,f)=>{var g;return u.set(d,new Ba(f,(g=a.get(d))!==null&&g!==void 0?g:null))}),u))}recalculateAndSaveOverlays(t,e){let n=Dr(),i=new it((a,u)=>a-u),s=j();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let u of a)u.keys().forEach(c=>{let d=e.get(c);if(d===null)return;let f=n.get(c)||Ot.empty();f=u.applyToLocalView(d,f),n.set(c,f);let g=(i.get(u.batchId)||j()).add(c);i=i.insert(u.batchId,g)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),d=c.key,f=c.value,g=gd();f.forEach(_=>{if(!s.has(_)){let R=Id(e.get(_),n.get(_));R!==null&&g.set(_,R),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,g))}return S.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,i){return function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Yu(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):S.resolve(Qt()),u=-1,c=s;return a.next(d=>S.forEach(d,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?S.resolve():this.remoteDocumentCache.getEntry(t,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(t,d,s)).next(()=>this.computeViews(t,c,d,j())).next(f=>({batchId:u,changes:md(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next(n=>{let i=Vr();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){let s=e.collectionGroup,a=Vr();return this.indexManager.getCollectionParents(t,s).next(u=>S.forEach(u,c=>{let d=function(g,_){return new Gt(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(e,c.child(s));return this.getDocumentsMatchingCollectionQuery(t,d,n,i).next(f=>{f.forEach((g,_)=>{a=a.insert(g,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,i))).next(a=>{s.forEach((c,d)=>{let f=d.getKey();a.get(f)===null&&(a=a.insert(f,wt.newInvalidDocument(f)))});let u=Vr();return a.forEach((c,d)=>{let f=s.get(c);f!==void 0&&Nr(f.mutation,d,Ot.empty(),lt.now()),li(e,d)&&(u=u.insert(c,d))}),u})}};var Ga=class{constructor(t){this.serializer=t,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(t,e){return S.resolve(this.Tr.get(e))}saveBundleMetadata(t,e){return this.Tr.set(e.id,function(i){return{id:i.id,version:i.version,createTime:ht(i.createTime)}}(e)),S.resolve()}getNamedQuery(t,e){return S.resolve(this.Ir.get(e))}saveNamedQuery(t,e){return this.Ir.set(e.name,function(i){return{name:i.name,query:nc(i.bundledQuery),readTime:ht(i.readTime)}}(e)),S.resolve()}};var za=class{constructor(){this.overlays=new it(M.comparator),this.Er=new Map}getOverlay(t,e){return S.resolve(this.overlays.get(e))}getOverlays(t,e){let n=Qt();return S.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((i,s)=>{this.Tt(t,e,s)}),S.resolve()}removeOverlaysForBatchId(t,e,n){let i=this.Er.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Er.delete(n)),S.resolve()}getOverlaysForCollection(t,e,n){let i=Qt(),s=e.length+1,a=new M(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let c=u.getNext().value,d=c.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return S.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new it((d,f)=>d-f),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let f=s.get(d.largestBatchId);f===null&&(f=Qt(),s=s.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}let u=Qt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,f)=>u.set(d,f)),!(u.size()>=i)););return S.resolve(u)}Tt(t,e,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.Er.get(i.largestBatchId).delete(n.key);this.Er.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new zr(e,n));let s=this.Er.get(e);s===void 0&&(s=j(),this.Er.set(e,s)),this.Er.set(e,s.add(n.key))}};var ja=class{constructor(){this.sessionToken=ft.EMPTY_BYTE_STRING}getSessionToken(t){return S.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,S.resolve()}};var Hr=class{constructor(){this.dr=new et(gt.Ar),this.Rr=new et(gt.Vr)}isEmpty(){return this.dr.isEmpty()}addReference(t,e){let n=new gt(t,e);this.dr=this.dr.add(n),this.Rr=this.Rr.add(n)}mr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.gr(new gt(t,e))}pr(t,e){t.forEach(n=>this.removeReference(n,e))}yr(t){let e=new M(new J([])),n=new gt(e,t),i=new gt(e,t+1),s=[];return this.Rr.forEachInRange([n,i],a=>{this.gr(a),s.push(a.key)}),s}wr(){this.dr.forEach(t=>this.gr(t))}gr(t){this.dr=this.dr.delete(t),this.Rr=this.Rr.delete(t)}Sr(t){let e=new M(new J([])),n=new gt(e,t),i=new gt(e,t+1),s=j();return this.Rr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(t){let e=new gt(t,0),n=this.dr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},gt=class{constructor(t,e){this.key=t,this.br=e}static Ar(t,e){return M.comparator(t.key,e.key)||z(t.br,e.br)}static Vr(t,e){return z(t.br,e.br)||M.comparator(t.key,e.key)}};var Ka=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Dr=1,this.vr=new et(gt.Ar)}checkEmpty(t){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,i){let s=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Gr(s,e,n,i);this.mutationQueue.push(a);for(let u of i)this.vr=this.vr.add(new gt(u.key,s)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return S.resolve(a)}lookupMutationBatch(t,e){return S.resolve(this.Cr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=this.Fr(n),s=i<0?0:i;return S.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?-1:this.Dr-1)}getAllMutationBatches(t){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new gt(e,0),i=new gt(e,Number.POSITIVE_INFINITY),s=[];return this.vr.forEachInRange([n,i],a=>{let u=this.Cr(a.br);s.push(u)}),S.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(z);return e.forEach(i=>{let s=new gt(i,0),a=new gt(i,Number.POSITIVE_INFINITY);this.vr.forEachInRange([s,a],u=>{n=n.add(u.br)})}),S.resolve(this.Mr(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=n;M.isDocumentKey(s)||(s=s.child(""));let a=new gt(new M(s),0),u=new et(z);return this.vr.forEachWhile(c=>{let d=c.key.path;return!!n.isPrefixOf(d)&&(d.length===i&&(u=u.add(c.br)),!0)},a),S.resolve(this.Mr(u))}Mr(t){let e=[];return t.forEach(n=>{let i=this.Cr(n);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){O(this.Or(e.batchId,"removed")===0),this.mutationQueue.shift();let n=this.vr;return S.forEach(e.mutations,i=>{let s=new gt(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.vr=n})}Ln(t){}containsKey(t,e){let n=new gt(e,0),i=this.vr.firstAfterOrEqual(n);return S.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,S.resolve()}Or(t,e){return this.Fr(t)}Fr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Cr(t){let e=this.Fr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var $a=class{constructor(t){this.Nr=t,this.docs=function(){return new it(M.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,i=this.docs.get(n),s=i?i.size:0,a=this.Nr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return S.resolve(n?n.document.mutableCopy():wt.newInvalidDocument(e))}getEntries(t,e){let n=Ft();return e.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():wt.newInvalidDocument(i))}),S.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=Ft(),a=e.path,u=new M(a.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:d,value:{document:f}}=c.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Wu(zh(f),n)<=0||(i.has(f.key)||li(e,f))&&(s=s.insert(f.key,f.mutableCopy()))}return S.resolve(s)}getAllFromCollectionGroup(t,e,n,i){L()}Lr(t,e){return S.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new Qa(this)}getSize(t){return S.resolve(this.size)}},Qa=class extends _s{constructor(t){super(),this.hr=t}applyChanges(t){let e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.hr.addEntry(t,i)):this.hr.removeEntry(n)}),S.waitFor(e)}getFromCache(t,e){return this.hr.getEntry(t,e)}getAllFromCache(t,e){return this.hr.getEntries(t,e)}};var Wa=class{constructor(t){this.persistence=t,this.Br=new zt(e=>en(e),ui),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.kr=0,this.qr=new Hr,this.targetCount=0,this.Qr=On.qn()}forEachTarget(t,e){return this.Br.forEach((n,i)=>e(i)),S.resolve()}getLastRemoteSnapshotVersion(t){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return S.resolve(this.kr)}allocateTargetId(t){return this.highestTargetId=this.Qr.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.kr&&(this.kr=e),S.resolve()}Un(t){this.Br.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Qr=new On(e),this.highestTargetId=e),t.sequenceNumber>this.kr&&(this.kr=t.sequenceNumber)}addTargetData(t,e){return this.Un(e),this.targetCount+=1,S.resolve()}updateTargetData(t,e){return this.Un(e),S.resolve()}removeTargetData(t,e){return this.Br.delete(e.target),this.qr.yr(e.targetId),this.targetCount-=1,S.resolve()}removeTargets(t,e,n){let i=0,s=[];return this.Br.forEach((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.Br.delete(a),s.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),S.waitFor(s).next(()=>i)}getTargetCount(t){return S.resolve(this.targetCount)}getTargetData(t,e){let n=this.Br.get(e)||null;return S.resolve(n)}addMatchingKeys(t,e,n){return this.qr.mr(e,n),S.resolve()}removeMatchingKeys(t,e,n){this.qr.pr(e,n);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(a=>{s.push(i.markPotentiallyOrphaned(t,a))}),S.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.qr.yr(e),S.resolve()}getMatchingKeysForTargetId(t,e){let n=this.qr.Sr(e);return S.resolve(n)}containsKey(t,e){return S.resolve(this.qr.containsKey(e))}};var Jr=class{constructor(t,e){this.Kr={},this.overlays={},this.$r=new Lt(0),this.Ur=!1,this.Ur=!0,this.Wr=new ja,this.referenceDelegate=t(this),this.Gr=new Wa(this),this.indexManager=new Na,this.remoteDocumentCache=function(i){return new $a(i)}(n=>this.referenceDelegate.zr(n)),this.serializer=new cs(e),this.jr=new Ga(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new za,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Kr[t.toKey()];return n||(n=new Ka(e,this.referenceDelegate),this.Kr[t.toKey()]=n),n}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(t,e,n){C("MemoryPersistence","Starting transaction:",t);let i=new Ha(this.$r.next());return this.referenceDelegate.Hr(),n(i).next(s=>this.referenceDelegate.Jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Yr(t,e){return S.or(Object.values(this.Kr).map(n=>()=>n.containsKey(t,e)))}},Ha=class extends Hi{constructor(t){super(),this.currentSequenceNumber=t}},ws=class r{constructor(t){this.persistence=t,this.Zr=new Hr,this.Xr=null}static ei(t){return new r(t)}get ti(){if(this.Xr)return this.Xr;throw L()}addReference(t,e,n){return this.Zr.addReference(n,e),this.ti.delete(n.toString()),S.resolve()}removeReference(t,e,n){return this.Zr.removeReference(n,e),this.ti.add(n.toString()),S.resolve()}markPotentiallyOrphaned(t,e){return this.ti.add(e.toString()),S.resolve()}removeTarget(t,e){this.Zr.yr(e.targetId).forEach(i=>this.ti.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.ti.add(s.toString()))}).next(()=>n.removeTargetData(t,e))}Hr(){this.Xr=new Set}Jr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.ti,n=>{let i=M.fromPath(n);return this.ni(t,i).next(s=>{s||e.removeEntry(i,U.min())})}).next(()=>(this.Xr=null,e.apply(t)))}updateLimboDocument(t,e){return this.ni(t,e).next(n=>{n?this.ti.delete(e.toString()):this.ti.add(e.toString())})}zr(t){return 0}ni(t,e){return S.or([()=>S.resolve(this.Zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Yr(t,e)])}},vs=class r{constructor(t,e){this.persistence=t,this.ri=new zt(n=>xt(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=Kd(this,e)}static ei(t,e){return new r(t,e)}Hr(){}Jr(t){return S.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}Xn(t){let e=this.nr(t);return this.persistence.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}nr(t){let e=0;return this.er(t,n=>{e++}).next(()=>e)}er(t,e){return S.forEach(this.ri,(n,i)=>this.ir(t,n,i).next(s=>s?S.resolve():e(i)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.Lr(t,a=>this.ir(t,a,e).next(u=>{u||(n++,s.removeEntry(a,U.min()))})).next(()=>s.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.ri.set(e,t.currentSequenceNumber),S.resolve()}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.ri.set(n,t.currentSequenceNumber),S.resolve()}removeReference(t,e,n){return this.ri.set(n,t.currentSequenceNumber),S.resolve()}updateLimboDocument(t,e){return this.ri.set(e,t.currentSequenceNumber),S.resolve()}zr(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Bi(t.data.value)),e}ir(t,e,n){return S.or([()=>this.persistence.Yr(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let i=this.ri.get(e);return S.resolve(i!==void 0&&i>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var Ja=class{constructor(t){this.serializer=t}O(t,e,n,i){let s=new Ji("createOrUpgrade",e);n<1&&i>=1&&(function(c){c.createObjectStore("owner")}(t),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ul,{unique:!0}),c.createObjectStore("documentMutations")}(t),Eh(t),function(c){c.createObjectStore("remoteDocuments")}(t));let a=S.resolve();return n<3&&i>=3&&(n!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(t),Eh(t)),a=a.next(()=>function(c){let d=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:U.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(n!==0&&(a=a.next(()=>function(c,d){return d.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Ul,{unique:!0});let g=d.store("mutations"),_=f.map(R=>g.put(R));return S.waitFor(_)})}(t,s))),a=a.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),n<5&&i>=5&&(a=a.next(()=>this.ii(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(t),this.si(s)))),n<7&&i>=7&&(a=a.next(()=>this.oi(s))),n<8&&i>=8&&(a=a.next(()=>this._i(t,s))),n<9&&i>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&i>=10&&(a=a.next(()=>this.ai(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),n<12&&i>=12&&(a=a.next(()=>{(function(c){let d=c.createObjectStore("documentOverlays",{keyPath:Cm});d.createIndex("collectionPathOverlayIndex",Dm,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",Nm,{unique:!1})})(t)})),n<13&&i>=13&&(a=a.next(()=>function(c){let d=c.createObjectStore("remoteDocumentsV14",{keyPath:vm});d.createIndex("documentKeyIndex",Tm),d.createIndex("collectionGroupIndex",Im)}(t)).next(()=>this.ui(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.ci(t,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:bm}).createIndex("sequenceNumberIndex",Pm,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:Vm}).createIndex("documentKeyIndex",xm,{unique:!1})}(t))),n<16&&i>=16&&(a=a.next(()=>{e.objectStore("indexState").clear()}).next(()=>{e.objectStore("indexEntries").clear()})),n<17&&i>=17&&(a=a.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(t)})),a}si(t){let e=0;return t.store("remoteDocuments").J((n,i)=>{e+=ms(i)}).next(()=>{let n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ii(t){let e=t.store("mutationQueues"),n=t.store("mutations");return e.U().next(i=>S.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>S.forEach(u,c=>{O(c.userId===s.userId);let d=We(this.serializer,c);return Gd(t,s.userId,d).next(()=>{})}))}))}oi(t){let e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((a,u)=>{let c=new J(a),d=function(g){return[0,xt(g)]}(c);s.push(e.get(d).next(f=>f?S.resolve():(g=>e.put({targetId:0,path:xt(g),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>S.waitFor(s))})}_i(t,e){t.createObjectStore("collectionParents",{keyPath:Rm});let n=e.store("collectionParents"),i=new Wr,s=a=>{if(i.add(a)){let u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:xt(c)})}};return e.store("remoteDocuments").J({H:!0},(a,u)=>{let c=new J(a);return s(c.popLast())}).next(()=>e.store("documentMutations").J({H:!0},([a,u,c],d)=>{let f=$t(u);return s(f.popLast())}))}ai(t){let e=t.store("targets");return e.J((n,i)=>{let s=xr(i),a=qd(this.serializer,s);return e.put(a)})}ui(t,e){let n=e.store("remoteDocuments"),i=[];return n.J((s,a)=>{let u=e.store("remoteDocumentsV14"),c=function(g){return g.document?new M(J.fromString(g.document.name).popFirst(5)):g.noDocument?M.fromSegments(g.noDocument.path):g.unknownDocument?M.fromSegments(g.unknownDocument.path):L()}(a).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(d))}).next(()=>S.waitFor(i))}ci(t,e){let n=e.store("mutations"),i=$d(this.serializer),s=new Jr(ws.ei,this.serializer.ht);return n.U().next(a=>{let u=new Map;return a.forEach(c=>{var d;let f=(d=u.get(c.userId))!==null&&d!==void 0?d:j();We(this.serializer,c).keys().forEach(g=>f=f.add(g)),u.set(c.userId,f)}),S.forEach(u,(c,d)=>{let f=new pt(d),g=hs.Pt(this.serializer,f),_=s.getIndexManager(f),R=gs.Pt(f,this.serializer,_,s.referenceDelegate);return new ys(i,R,g,_).recalculateAndSaveOverlaysForDocumentKeys(new Lr(e,Lt.oe),c).next()})})}};function Eh(r){r.createObjectStore("targetDocuments",{keyPath:Am}).createIndex("documentTargetsIndex",Sm,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Em,{unique:!0}),r.createObjectStore("targetGlobal")}var Uo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Xa=class r{constructor(t,e,n,i,s,a,u,c,d,f,g=17){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.li=s,this.window=a,this.document=u,this.hi=d,this.Pi=f,this.Ti=g,this.$r=null,this.Ur=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ii=null,this.inForeground=!1,this.Ei=null,this.di=null,this.Ai=Number.NEGATIVE_INFINITY,this.Ri=_=>Promise.resolve(),!r.p())throw new x(b.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Oa(this,i),this.Vi=e+"main",this.serializer=new cs(c),this.mi=new be(this.Vi,this.Ti,new Ja(this.serializer)),this.Wr=new Ra,this.Gr=new Fa(this.referenceDelegate,this.serializer),this.remoteDocumentCache=$d(this.serializer),this.jr=new Sa,this.window&&this.window.localStorage?this.fi=this.window.localStorage:(this.fi=null,f===!1&&ct("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.gi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(b.FAILED_PRECONDITION,Uo);return this.pi(),this.yi(),this.wi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Gr.getHighestSequenceNumber(t))}).then(t=>{this.$r=new Lt(t,this.hi)}).then(()=>{this.Ur=!0}).catch(t=>(this.mi&&this.mi.close(),Promise.reject(t)))}Si(t){return this.Ri=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.mi.L(async e=>{e.newVersion===null&&await t()})}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.li.enqueueAndForget(async()=>{this.started&&await this.gi()}))}gi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Mi(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.bi(t).next(e=>{e||(this.isPrimary=!1,this.li.enqueueRetryable(()=>this.Ri(!1)))})}).next(()=>this.Di(t)).next(e=>this.isPrimary&&!e?this.vi(t).next(()=>!1):!!e&&this.Ci(t).next(()=>!0))).catch(t=>{if(Oe(t))return C("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return C("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.li.enqueueRetryable(()=>this.Ri(t)),this.isPrimary=t})}bi(t){return Pr(t).get("owner").next(e=>S.resolve(this.Fi(e)))}Mi(t){return Mi(t).delete(this.clientId)}async xi(){if(this.isPrimary&&!this.Oi(this.Ai,18e5)){this.Ai=Date.now();let t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=Tt(e,"clientMetadata");return n.U().next(i=>{let s=this.Ni(i,18e5),a=i.filter(u=>s.indexOf(u)===-1);return S.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.fi)for(let e of t)this.fi.removeItem(this.Li(e.clientId))}}wi(){this.di=this.li.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.gi().then(()=>this.xi()).then(()=>this.wi()))}Fi(t){return!!t&&t.ownerId===this.clientId}Di(t){return this.Pi?S.resolve(!0):Pr(t).get("owner").next(e=>{if(e!==null&&this.Oi(e.leaseTimestampMs,5e3)&&!this.Bi(e.ownerId)){if(this.Fi(e)&&this.networkEnabled)return!0;if(!this.Fi(e)){if(!e.allowTabSynchronization)throw new x(b.FAILED_PRECONDITION,Uo);return!1}}return!(!this.networkEnabled||!this.inForeground)||Mi(t).U().next(n=>this.Ni(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&C("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ur=!1,this.ki(),this.di&&(this.di.cancel(),this.di=null),this.qi(),this.Qi(),await this.mi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new Lr(t,Lt.oe);return this.vi(e).next(()=>this.Mi(e))}),this.mi.close(),this.Ki()}Ni(t,e){return t.filter(n=>this.Oi(n.updateTimeMs,e)&&!this.Bi(n.clientId))}$i(){return this.runTransaction("getActiveClients","readonly",t=>Mi(t).U().next(e=>this.Ni(e,18e5).map(n=>n.clientId)))}get started(){return this.Ur}getGlobalsCache(){return this.Wr}getMutationQueue(t,e){return gs.Pt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new ka(t,this.serializer.ht.databaseId)}getDocumentOverlayCache(t){return hs.Pt(this.serializer,t)}getBundleCache(){return this.jr}runTransaction(t,e,n){C("IndexedDbPersistence","Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=function(c){return c===17?Mm:c===16?Fm:c===15?Ju:c===14?Jh:c===13?Hh:c===12?km:c===11?Wh:void L()}(this.Ti),a;return this.mi.runTransaction(t,i,s,u=>(a=new Lr(u,this.$r?this.$r.next():Lt.oe),e==="readwrite-primary"?this.bi(a).next(c=>!!c||this.Di(a)).next(c=>{if(!c)throw ct(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.li.enqueueRetryable(()=>this.Ri(!1)),new x(b.FAILED_PRECONDITION,jh);return n(a)}).next(c=>this.Ci(a).next(()=>c)):this.Ui(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ui(t){return Pr(t).get("owner").next(e=>{if(e!==null&&this.Oi(e.leaseTimestampMs,5e3)&&!this.Bi(e.ownerId)&&!this.Fi(e)&&!(this.Pi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new x(b.FAILED_PRECONDITION,Uo)})}Ci(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Pr(t).put("owner",e)}static p(){return be.p()}vi(t){let e=Pr(t);return e.get("owner").next(n=>this.Fi(n)?(C("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):S.resolve())}Oi(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(ct(`Detected an update time that is in the future: ${t} > ${n}`),!1))}pi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ei=()=>{this.li.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.gi()))},this.document.addEventListener("visibilitychange",this.Ei),this.inForeground=this.document.visibilityState==="visible")}qi(){this.Ei&&(this.document.removeEventListener("visibilitychange",this.Ei),this.Ei=null)}yi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Ii=()=>{this.ki();let e=/(?:Version|Mobile)\/1[456]/;xo()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.li.enterRestrictedMode(!0),this.li.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ii))}Qi(){this.Ii&&(this.window.removeEventListener("pagehide",this.Ii),this.Ii=null)}Bi(t){var e;try{let n=((e=this.fi)===null||e===void 0?void 0:e.getItem(this.Li(t)))!==null;return C("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ct("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}ki(){if(this.fi)try{this.fi.setItem(this.Li(this.clientId),String(Date.now()))}catch(t){ct("Failed to set zombie client id.",t)}}Ki(){if(this.fi)try{this.fi.removeItem(this.Li(this.clientId))}catch{}}Li(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function Pr(r){return Tt(r,"owner")}function Mi(r){return Tt(r,"clientMetadata")}function ic(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var Ya=class r{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Wi=n,this.Gi=i}static zi(t,e){let n=j(),i=j();for(let s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(t,e.fromCache,n,i)}};var Za=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Ts=class{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return xo()?8:Kh(Ir())>0?6:4}()}initialize(t,e){this.Zi=t,this.indexManager=e,this.ji=!0}getDocumentsMatchingQuery(t,e,n,i){let s={result:null};return this.Xi(t,e).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.es(t,e,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new Za;return this.ts(t,e,a).next(u=>{if(s.result=u,this.Hi)return this.ns(t,e,a,u.size)})}).next(()=>s.result)}ns(t,e,n,i){return n.documentReadCount<this.Ji?(Tn()<=Kt.DEBUG&&C("QueryEngine","SDK will not create cache indexes for query:",In(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),S.resolve()):(Tn()<=Kt.DEBUG&&C("QueryEngine","Query:",In(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Yi*i?(Tn()<=Kt.DEBUG&&C("QueryEngine","The SDK decides to create cache indexes for query:",In(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ct(e))):S.resolve())}Xi(t,e){if(Yl(e))return S.resolve(null);let n=Ct(e);return this.indexManager.getIndexType(t,n).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=rs(e,null,"F"),n=Ct(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(s=>{let a=j(...s);return this.Zi.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(c=>{let d=this.rs(e,u);return this.ss(e,d,a,c.readTime)?this.Xi(t,rs(e,null,"F")):this.os(t,d,e,c)}))})))}es(t,e,n,i){return Yl(e)||i.isEqual(U.min())?S.resolve(null):this.Zi.getDocuments(t,n).next(s=>{let a=this.rs(e,s);return this.ss(e,a,n,i)?S.resolve(null):(Tn()<=Kt.DEBUG&&C("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),In(e)),this.os(t,a,e,Gh(i,-1)).next(u=>u))})}rs(t,e){let n=new et(dd(t));return e.forEach((i,s)=>{li(t,s)&&(n=n.add(s))}),n}ss(t,e,n,i){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ts(t,e,n){return Tn()<=Kt.DEBUG&&C("QueryEngine","Using full collection scan to execute query:",In(e)),this.Zi.getDocumentsMatchingQuery(t,e,Ut.min(),n)}os(t,e,n,i){return this.Zi.getDocumentsMatchingQuery(t,n,i).next(s=>(e.forEach(a=>{s=s.insert(a.key,a)}),s))}};var tu=class{constructor(t,e,n,i){this.persistence=t,this._s=e,this.serializer=i,this.us=new it(z),this.cs=new zt(s=>en(s),ui),this.ls=new Map,this.hs=t.getRemoteDocumentCache(),this.Gr=t.getTargetCache(),this.jr=t.getBundleCache(),this.Ps(n)}Ps(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new ys(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.us))}};function Qd(r,t,e,n){return new tu(r,t,e,n)}async function Wd(r,t){let e=k(r);return await e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,e.Ps(t),e.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],u=[],c=j();for(let d of i){a.push(d.batchId);for(let f of d.mutations)c=c.add(f.key)}for(let d of s){u.push(d.batchId);for(let f of d.mutations)c=c.add(f.key)}return e.localDocuments.getDocuments(n,c).next(d=>({Ts:d,removedBatchIds:a,addedBatchIds:u}))})})}function fg(r,t){let e=k(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=t.batch.keys(),s=e.hs.newChangeBuffer({trackRemovals:!0});return function(u,c,d,f){let g=d.batch,_=g.keys(),R=S.resolve();return _.forEach(D=>{R=R.next(()=>f.getEntry(c,D)).next(N=>{let V=d.docVersions.get(D);O(V!==null),N.version.compareTo(V)<0&&(g.applyToRemoteDocument(N,d),N.isValidDocument()&&(N.setReadTime(d.commitVersion),f.addEntry(N)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(c,g))}(e,n,t,s).next(()=>s.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=j();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(c=c.add(u.batch.mutations[d].key));return c}(t))).next(()=>e.localDocuments.getDocuments(n,i))})}function Hd(r){let t=k(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Gr.getLastRemoteSnapshotVersion(e))}function mg(r,t){let e=k(r),n=t.snapshotVersion,i=e.us;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=e.hs.newChangeBuffer({trackRemovals:!0});i=e.us;let u=[];t.targetChanges.forEach((f,g)=>{let _=i.get(g);if(!_)return;u.push(e.Gr.removeMatchingKeys(s,f.removedDocuments,g).next(()=>e.Gr.addMatchingKeys(s,f.addedDocuments,g)));let R=_.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(g)!==null?R=R.withResumeToken(ft.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):f.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(f.resumeToken,n)),i=i.insert(g,R),function(N,V,B){return N.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=3e8?!0:B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0}(_,R,f)&&u.push(e.Gr.updateTargetData(s,R))});let c=Ft(),d=j();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(Jd(s,a,t.documentUpdates).next(f=>{c=f.Is,d=f.Es})),!n.isEqual(U.min())){let f=e.Gr.getLastRemoteSnapshotVersion(s).next(g=>e.Gr.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return S.waitFor(u).next(()=>a.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,c,d)).next(()=>c)}).then(s=>(e.us=i,s))}function Jd(r,t,e){let n=j(),i=j();return e.forEach(s=>n=n.add(s)),t.getEntries(r,n).next(s=>{let a=Ft();return e.forEach((u,c)=>{let d=s.get(u);c.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(U.min())?(t.removeEntry(u,c.readTime),a=a.insert(u,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(c),a=a.insert(u,c)):C("LocalStore","Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",c.version)}),{Is:a,Es:i}})}function gg(r,t){let e=k(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function qn(r,t){let e=k(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return e.Gr.getTargetData(n,t).next(s=>s?(i=s,S.resolve(i)):e.Gr.allocateTargetId(n).next(a=>(i=new Ln(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Gr.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=e.us.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.us=e.us.insert(n.targetId,n),e.cs.set(t,n.targetId)),n})}async function Un(r,t,e){let n=k(r),i=n.us.get(t),s=e?"readwrite":"readwrite-primary";try{e||await n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!Oe(a))throw a;C("LocalStore",`Failed to update sequence numbers for target ${t}: ${a}`)}n.us=n.us.remove(t),n.cs.delete(i.target)}function Is(r,t,e){let n=k(r),i=U.min(),s=j();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,d,f){let g=k(c),_=g.cs.get(f);return _!==void 0?S.resolve(g.us.get(_)):g.Gr.getTargetData(d,f)}(n,a,Ct(t)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Gr.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n._s.getDocumentsMatchingQuery(a,t,e?i:U.min(),e?s:j())).next(u=>(Zd(n,hd(t),u),{documents:u,ds:s})))}function Xd(r,t){let e=k(r),n=k(e.Gr),i=e.us.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>n.ut(s,t).next(a=>a?a.target:null))}function Yd(r,t){let e=k(r),n=e.ls.get(t)||U.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.hs.getAllFromCollectionGroup(i,t,Gh(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Zd(e,t,i),i))}function Zd(r,t,e){let n=r.ls.get(t)||U.min();e.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.ls.set(t,n)}async function pg(r,t,e,n){let i=k(r),s=j(),a=Ft();for(let d of e){let f=t.As(d.metadata.name);d.document&&(s=s.add(f));let g=t.Rs(d);g.setReadTime(t.Vs(d.metadata.readTime)),a=a.insert(f,g)}let u=i.hs.newChangeBuffer({trackRemovals:!0}),c=await qn(i,function(f){return Ct(Jn(J.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",d=>Jd(d,u,a).next(f=>(u.apply(d),f)).next(f=>i.Gr.removeMatchingKeysForTargetId(d,c.targetId).next(()=>i.Gr.addMatchingKeys(d,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,f.Is,f.Es)).next(()=>f.Is)))}async function _g(r,t,e=j()){let n=await qn(r,Ct(nc(t.bundledQuery))),i=k(r);return i.persistence.runTransaction("Save named query","readwrite",s=>{let a=ht(t.readTime);if(n.snapshotVersion.compareTo(a)>=0)return i.jr.saveNamedQuery(s,t);let u=n.withResumeToken(ft.EMPTY_BYTE_STRING,a);return i.us=i.us.insert(u.targetId,u),i.Gr.updateTargetData(s,u).next(()=>i.Gr.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>i.Gr.addMatchingKeys(s,e,n.targetId)).next(()=>i.jr.saveNamedQuery(s,t))})}function Ah(r,t){return`firestore_clients_${r}_${t}`}function Sh(r,t,e){let n=`firestore_mutations_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}function Bo(r,t){return`firestore_targets_${r}_${t}`}var Es=class r{constructor(t,e,n,i){this.user=t,this.batchId=e,this.state=n,this.error=i}static fs(t,e,n){let i=JSON.parse(n),s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new x(i.error.code,i.error.message))),a?new r(t,e,i.state,s):(ct("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}gs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},kr=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static fs(t,e){let n=JSON.parse(e),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new x(n.error.code,n.error.message))),s?new r(t,n.state,i):(ct("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}gs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},As=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static fs(t,e){let n=JSON.parse(e),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=Zu();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=$h(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new r(t,s):(ct("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},eu=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static fs(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(ct("SharedClientState",`Failed to parse online state: ${t}`),null)}},Xr=class{constructor(){this.activeTargetIds=Zu()}ps(t){this.activeTargetIds=this.activeTargetIds.add(t)}ys(t){this.activeTargetIds=this.activeTargetIds.delete(t)}gs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},Fr=class{constructor(t,e,n,i,s){this.window=t,this.li=e,this.persistenceKey=n,this.ws=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ss=this.bs.bind(this),this.Ds=new it(z),this.started=!1,this.vs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Cs=Ah(this.persistenceKey,this.ws),this.Fs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ds=this.Ds.insert(this.ws,new Xr),this.Ms=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.xs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Os=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.Ns=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Ls=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.Ss)}static p(t){return!(!t||!t.localStorage)}async start(){let t=await this.syncEngine.$i();for(let n of t){if(n===this.ws)continue;let i=this.getItem(Ah(this.persistenceKey,n));if(i){let s=As.fs(n,i);s&&(this.Ds=this.Ds.insert(s.clientId,s))}}this.Bs();let e=this.storage.getItem(this.Ns);if(e){let n=this.ks(e);n&&this.qs(n)}for(let n of this.vs)this.bs(n);this.vs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(t){this.setItem(this.Fs,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Qs(this.Ds)}isActiveQueryTarget(t){let e=!1;return this.Ds.forEach((n,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.Ks(t,"pending")}updateMutationState(t,e,n){this.Ks(t,e,n),this.$s(t)}addLocalQueryTarget(t,e=!0){let n="not-current";if(this.isActiveQueryTarget(t)){let i=this.storage.getItem(Bo(this.persistenceKey,t));if(i){let s=kr.fs(t,i);s&&(n=s.state)}}return e&&this.Us.ps(t),this.Bs(),n}removeLocalQueryTarget(t){this.Us.ys(t),this.Bs()}isLocalQueryTarget(t){return this.Us.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Bo(this.persistenceKey,t))}updateQueryState(t,e,n){this.Ws(t,e,n)}handleUserChange(t,e,n){e.forEach(i=>{this.$s(i)}),this.currentUser=t,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.Gs(t)}notifyBundleLoaded(t){this.zs(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ss),this.removeItem(this.Cs),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return C("SharedClientState","READ",t,e),e}setItem(t,e){C("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){C("SharedClientState","REMOVE",t),this.storage.removeItem(t)}bs(t){let e=t;if(e.storageArea===this.storage){if(C("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Cs)return void ct("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.li.enqueueRetryable(async()=>{if(this.started){if(e.key!==null){if(this.Ms.test(e.key)){if(e.newValue==null){let n=this.js(e.key);return this.Hs(n,null)}{let n=this.Js(e.key,e.newValue);if(n)return this.Hs(n.clientId,n)}}else if(this.xs.test(e.key)){if(e.newValue!==null){let n=this.Ys(e.key,e.newValue);if(n)return this.Zs(n)}}else if(this.Os.test(e.key)){if(e.newValue!==null){let n=this.Xs(e.key,e.newValue);if(n)return this.eo(n)}}else if(e.key===this.Ns){if(e.newValue!==null){let n=this.ks(e.newValue);if(n)return this.qs(n)}}else if(e.key===this.Fs){let n=function(s){let a=Lt.oe;if(s!=null)try{let u=JSON.parse(s);O(typeof u=="number"),a=u}catch(u){ct("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(e.newValue);n!==Lt.oe&&this.sequenceNumberHandler(n)}else if(e.key===this.Ls){let n=this.no(e.newValue);await Promise.all(n.map(i=>this.syncEngine.ro(i)))}}}else this.vs.push(e)})}}get Us(){return this.Ds.get(this.ws)}Bs(){this.setItem(this.Cs,this.Us.gs())}Ks(t,e,n){let i=new Es(this.currentUser,t,e,n),s=Sh(this.persistenceKey,this.currentUser,t);this.setItem(s,i.gs())}$s(t){let e=Sh(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Gs(t){let e={clientId:this.ws,onlineState:t};this.storage.setItem(this.Ns,JSON.stringify(e))}Ws(t,e,n){let i=Bo(this.persistenceKey,t),s=new kr(t,e,n);this.setItem(i,s.gs())}zs(t){let e=JSON.stringify(Array.from(t));this.setItem(this.Ls,e)}js(t){let e=this.Ms.exec(t);return e?e[1]:null}Js(t,e){let n=this.js(t);return As.fs(n,e)}Ys(t,e){let n=this.xs.exec(t),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return Es.fs(new pt(s),i,e)}Xs(t,e){let n=this.Os.exec(t),i=Number(n[1]);return kr.fs(i,e)}ks(t){return eu.fs(t)}no(t){return JSON.parse(t)}async Zs(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.io(t.batchId,t.state,t.error);C("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}eo(t){return this.syncEngine.so(t.targetId,t.state,t.error)}Hs(t,e){let n=e?this.Ds.insert(t,e):this.Ds.remove(t),i=this.Qs(this.Ds),s=this.Qs(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.oo(a,u).then(()=>{this.Ds=n})}qs(t){this.Ds.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Qs(t){let e=Zu();return t.forEach((n,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},Ss=class{constructor(){this._o=new Xr,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this._o.ps(t),this.ao[t]||"not-current"}updateQueryState(t,e,n){this.ao[t]=e}removeLocalQueryTarget(t){this._o.ys(t)}isLocalQueryTarget(t){return this._o.activeTargetIds.has(t)}clearQueryState(t){delete this.ao[t]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(t){return this._o.activeTargetIds.has(t)}start(){return this._o=new Xr,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var nu=class{uo(t){}shutdown(){}};var Rs=class{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(t){this.To.push(t)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){C("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.To)t(0)}Po(){C("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.To)t(1)}static p(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Li=null;function Go(){return Li===null?Li=function(){return 268435456+Math.round(2147483648*Math.random())}():Li++,"0x"+Li.toString(16)}var yg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var ru=class{constructor(t){this.Eo=t.Eo,this.Ao=t.Ao}Ro(t){this.Vo=t}mo(t){this.fo=t}po(t){this.yo=t}onMessage(t){this.wo=t}close(){this.Ao()}send(t){this.Eo(t)}So(){this.Vo()}bo(){this.fo()}Do(t){this.yo(t)}vo(t){this.wo(t)}};var Pt="WebChannelConnection",iu=class extends class{get Co(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let n=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Fo=n+"://"+e.host,this.Mo=`projects/${i}/databases/${s}`,this.xo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}Oo(e,n,i,s,a){let u=Go(),c=this.No(e,n.toUriEncodedString());C("RestConnection",`Sending RPC '${e}' ${u}:`,c,i);let d={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Lo(d,s,a),this.Bo(e,c,d,i).then(f=>(C("RestConnection",`Received RPC '${e}' ${u}: `,f),f),f=>{throw qt("RestConnection",`RPC '${e}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}ko(e,n,i,s,a,u){return this.Oo(e,n,i,s,a)}Lo(e,n,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Hn}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>e[a]=s),i&&i.headers.forEach((s,a)=>e[a]=s)}No(e,n){let i=yg[e];return`${this.Fo}/v1/${n}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Bo(t,e,n,i){let s=Go();return new Promise((a,u)=>{let c=new ko;c.setWithCredentials(!0),c.listenOnce(Fo.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Ar.NO_ERROR:let f=c.getResponseJson();C(Pt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(f)),a(f);break;case Ar.TIMEOUT:C(Pt,`RPC '${t}' ${s} timed out`),u(new x(b.DEADLINE_EXCEEDED,"Request time out"));break;case Ar.HTTP_ERROR:let g=c.getStatus();if(C(Pt,`RPC '${t}' ${s} failed with status:`,g,"response text:",c.getResponseText()),g>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);let R=_?.error;if(R&&R.status&&R.message){let D=function(V){let B=V.toLowerCase().replace(/_/g,"-");return Object.values(b).indexOf(B)>=0?B:b.UNKNOWN}(R.status);u(new x(D,R.message))}else u(new x(b.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new x(b.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{C(Pt,`RPC '${t}' ${s} completed.`)}});let d=JSON.stringify(i);C(Pt,`RPC '${t}' ${s} sending request:`,i),c.send(e,"POST",d,n,15)})}qo(t,e,n){let i=Go(),s=[this.Fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Oo(),u=Lo(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Lo(c.initMessageHeaders,e,n),c.encodeInitMessageHeaders=!0;let f=s.join("");C(Pt,`Creating RPC '${t}' stream ${i}: ${f}`,c);let g=a.createWebChannel(f,c),_=!1,R=!1,D=new ru({Eo:V=>{R?C(Pt,`Not sending because RPC '${t}' stream ${i} is closed:`,V):(_||(C(Pt,`Opening RPC '${t}' stream ${i} transport.`),g.open(),_=!0),C(Pt,`RPC '${t}' stream ${i} sending:`,V),g.send(V))},Ao:()=>g.close()}),N=(V,B,G)=>{V.listen(B,q=>{try{G(q)}catch($){setTimeout(()=>{throw $},0)}})};return N(g,pn.EventType.OPEN,()=>{R||(C(Pt,`RPC '${t}' stream ${i} transport opened.`),D.So())}),N(g,pn.EventType.CLOSE,()=>{R||(R=!0,C(Pt,`RPC '${t}' stream ${i} transport closed`),D.Do())}),N(g,pn.EventType.ERROR,V=>{R||(R=!0,qt(Pt,`RPC '${t}' stream ${i} transport errored:`,V),D.Do(new x(b.UNAVAILABLE,"The operation could not be completed")))}),N(g,pn.EventType.MESSAGE,V=>{var B;if(!R){let G=V.data[0];O(!!G);let q=G,$=q?.error||((B=q[0])===null||B===void 0?void 0:B.error);if($){C(Pt,`RPC '${t}' stream ${i} received error:`,$);let Y=$.status,K=function(w){let T=mt[w];if(T!==void 0)return Sd(T)}(Y),v=$.message;K===void 0&&(K=b.INTERNAL,v="Unknown error status: "+Y+" with message "+$.message),R=!0,D.Do(new x(K,v)),g.close()}else C(Pt,`RPC '${t}' stream ${i} received:`,G),D.vo(G)}}),N(u,Mo.STAT_EVENT,V=>{V.stat===Di.PROXY?C(Pt,`RPC '${t}' stream ${i} detected buffering proxy`):V.stat===Di.NOPROXY&&C(Pt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{D.bo()},0),D}};function tf(){return typeof window<"u"?window:null}function ji(){return typeof document<"u"?document:null}function hi(r){return new va(r,!0)}var Yr=class{constructor(t,e,n=1e3,i=1.5,s=6e4){this.li=t,this.timerId=e,this.Qo=n,this.Ko=i,this.$o=s,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(t){this.cancel();let e=Math.floor(this.Uo+this.Ho()),n=Math.max(0,Date.now()-this.Go),i=Math.max(0,e-n);i>0&&C("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Uo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,i,()=>(this.Go=Date.now(),t())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}};var bs=class{constructor(t,e,n,i,s,a,u,c){this.li=t,this.Yo=n,this.Zo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new Yr(t,e)}i_(){return this.state===1||this.state===5||this.s_()}s_(){return this.state===2||this.state===3}start(){this.n_=0,this.state!==4?this.auth():this.o_()}async stop(){this.i_()&&await this.close(0)}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&this.e_===null&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(t){this.l_(),this.stream.send(t)}async u_(){if(this.s_())return this.close(0)}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}async close(t,e){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,t!==4?this.r_.reset():e&&e.code===b.RESOURCE_EXHAUSTED?(ct(e.toString()),ct("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):e&&e.code===b.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.P_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.po(e)}P_(){}auth(){this.state=1;let t=this.T_(this.Xo),e=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Xo===e&&this.I_(n,i)},n=>{t(()=>{let i=new x(b.UNKNOWN,"Fetching auth token failed: "+n.message);return this.E_(i)})})}I_(t,e){let n=this.T_(this.Xo);this.stream=this.d_(t,e),this.stream.Ro(()=>{n(()=>this.listener.Ro())}),this.stream.mo(()=>{n(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(i=>{n(()=>this.E_(i))}),this.stream.onMessage(i=>{n(()=>++this.n_==1?this.A_(i):this.onNext(i))})}o_(){this.state=5,this.r_.jo(async()=>{this.state=0,this.start()})}E_(t){return C("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}T_(t){return e=>{this.li.enqueueAndForget(()=>this.Xo===t?e():(C("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},su=class extends bs{constructor(t,e,n,i,s,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}d_(t,e){return this.connection.qo("Listen",t,e)}A_(t){return this.onNext(t)}onNext(t){this.r_.reset();let e=rg(this.serializer,t),n=function(s){if(!("targetChange"in s))return U.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?ht(a.readTime):U.min()}(t);return this.listener.R_(e,n)}V_(t){let e={};e.database=Ea(this.serializer),e.addTarget=function(s,a){let u,c=a.target;if(u=es(c)?{documents:Nd(s,c)}:{query:Ws(s,c).ct},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=bd(s,a.resumeToken);let d=Ta(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(U.min())>0){u.readTime=Mn(s,a.snapshotVersion.toTimestamp());let d=Ta(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,t);let n=sg(this.serializer,t);n&&(e.labels=n),this.c_(e)}m_(t){let e={};e.database=Ea(this.serializer),e.removeTarget=t,this.c_(e)}},ou=class extends bs{constructor(t,e,n,i,s,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}d_(t,e){return this.connection.qo("Write",t,e)}A_(t){return O(!!t.streamToken),this.lastStreamToken=t.streamToken,O(!t.writeResults||t.writeResults.length===0),this.listener.p_()}onNext(t){O(!!t.streamToken),this.lastStreamToken=t.streamToken,this.r_.reset();let e=ig(t.writeResults,t.commitTime),n=ht(t.commitTime);return this.listener.y_(n,e)}w_(){let t={};t.database=Ea(this.serializer),this.c_(t)}g_(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>Qr(this.serializer,n))};this.c_(e)}};var au=class extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.S_=!1}b_(){if(this.S_)throw new x(b.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(t,e,n,i){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Oo(t,Ia(e,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(b.UNKNOWN,s.toString())})}ko(t,e,n,i,s){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.ko(t,Ia(e,n),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(b.UNKNOWN,a.toString())})}terminate(){this.S_=!0,this.connection.terminate()}},uu=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){this.D_===0&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(t){this.state==="Online"?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.M_("Offline")))}set(t){this.N_(),this.D_=0,t==="Online"&&(this.C_=!1),this.M_(t)}M_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}x_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(ct(e),this.C_=!1):C("OnlineStateTracker",e)}N_(){this.v_!==null&&(this.v_.cancel(),this.v_=null)}};var cu=class{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.L_=[],this.B_=new Map,this.k_=new Set,this.q_=[],this.Q_=s,this.Q_.uo(a=>{n.enqueueAndForget(async()=>{Ue(this)&&(C("RemoteStore","Restarting streams for network reachability change."),await async function(c){let d=k(c);d.k_.add(4),await Xn(d),d.K_.set("Unknown"),d.k_.delete(4),await di(d)}(this))})}),this.K_=new uu(n,i)}};async function di(r){if(Ue(r))for(let t of r.q_)await t(!0)}async function Xn(r){for(let t of r.q_)await t(!1)}function Hs(r,t){let e=k(r);e.B_.has(t.targetId)||(e.B_.set(t.targetId,t),ac(e)?oc(e):Zn(e).s_()&&sc(e,t))}function Bn(r,t){let e=k(r),n=Zn(e);e.B_.delete(t),n.s_()&&ef(e,t),e.B_.size===0&&(n.s_()?n.a_():Ue(e)&&e.K_.set("Unknown"))}function sc(r,t){if(r.U_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(U.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Zn(r).V_(t)}function ef(r,t){r.U_.xe(t),Zn(r).m_(t)}function oc(r){r.U_=new wa({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),ut:t=>r.B_.get(t)||null,nt:()=>r.datastore.serializer.databaseId}),Zn(r).start(),r.K_.F_()}function ac(r){return Ue(r)&&!Zn(r).i_()&&r.B_.size>0}function Ue(r){return k(r).k_.size===0}function nf(r){r.U_=void 0}async function wg(r){r.K_.set("Online")}async function vg(r){r.B_.forEach((t,e)=>{sc(r,t)})}async function Tg(r,t){nf(r),ac(r)?(r.K_.O_(t),oc(r)):r.K_.set("Unknown")}async function Ig(r,t,e){if(r.K_.set("Online"),t instanceof as&&t.state===2&&t.cause)try{await async function(i,s){let a=s.cause;for(let u of s.targetIds)i.B_.has(u)&&(await i.remoteSyncer.rejectListen(u,a),i.B_.delete(u),i.U_.removeTarget(u))}(r,t)}catch(n){C("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Ps(r,n)}else if(t instanceof bn?r.U_.$e(t):t instanceof os?r.U_.Je(t):r.U_.Ge(t),!e.isEqual(U.min()))try{let n=await Hd(r.localStore);e.compareTo(n)>=0&&await function(s,a){let u=s.U_.it(a);return u.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){let f=s.B_.get(d);f&&s.B_.set(d,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,d)=>{let f=s.B_.get(c);if(!f)return;s.B_.set(c,f.withResumeToken(ft.EMPTY_BYTE_STRING,f.snapshotVersion)),ef(s,c);let g=new Ln(f.target,c,d,f.sequenceNumber);sc(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,e)}catch(n){C("RemoteStore","Failed to raise snapshot:",n),await Ps(r,n)}}async function Ps(r,t,e){if(!Oe(t))throw t;r.k_.add(1),await Xn(r),r.K_.set("Offline"),e||(e=()=>Hd(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{C("RemoteStore","Retrying IndexedDB access"),await e(),r.k_.delete(1),await di(r)})}function rf(r,t){return t().catch(e=>Ps(r,e,t))}async function Yn(r){let t=k(r),e=ke(t),n=t.L_.length>0?t.L_[t.L_.length-1].batchId:-1;for(;Eg(t);)try{let i=await gg(t.localStore,n);if(i===null){t.L_.length===0&&e.a_();break}n=i.batchId,Ag(t,i)}catch(i){await Ps(t,i)}sf(t)&&of(t)}function Eg(r){return Ue(r)&&r.L_.length<10}function Ag(r,t){r.L_.push(t);let e=ke(r);e.s_()&&e.f_&&e.g_(t.mutations)}function sf(r){return Ue(r)&&!ke(r).i_()&&r.L_.length>0}function of(r){ke(r).start()}async function Sg(r){ke(r).w_()}async function Rg(r){let t=ke(r);for(let e of r.L_)t.g_(e.mutations)}async function bg(r,t,e){let n=r.L_.shift(),i=pa.from(n,t,e);await rf(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),await Yn(r)}async function Pg(r,t){t&&ke(r).f_&&await async function(n,i){if(function(a){return Ad(a)&&a!==b.ABORTED}(i.code)){let s=n.L_.shift();ke(n).__(),await rf(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),await Yn(n)}}(r,t),sf(r)&&of(r)}async function Rh(r,t){let e=k(r);e.asyncQueue.verifyOperationInProgress(),C("RemoteStore","RemoteStore received new credentials");let n=Ue(e);e.k_.add(3),await Xn(e),n&&e.K_.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.k_.delete(3),await di(e)}async function lu(r,t){let e=k(r);t?(e.k_.delete(2),await di(e)):t||(e.k_.add(2),await Xn(e),e.K_.set("Unknown"))}function Zn(r){return r.W_||(r.W_=function(e,n,i){let s=k(e);return s.b_(),new su(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Ro:wg.bind(null,r),mo:vg.bind(null,r),po:Tg.bind(null,r),R_:Ig.bind(null,r)}),r.q_.push(async t=>{t?(r.W_.__(),ac(r)?oc(r):r.K_.set("Unknown")):(await r.W_.stop(),nf(r))})),r.W_}function ke(r){return r.G_||(r.G_=function(e,n,i){let s=k(e);return s.b_(),new ou(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Ro:()=>Promise.resolve(),mo:Sg.bind(null,r),po:Pg.bind(null,r),p_:Rg.bind(null,r),y_:bg.bind(null,r)}),r.q_.push(async t=>{t?(r.G_.__(),await Yn(r)):(await r.G_.stop(),r.L_.length>0&&(C("RemoteStore",`Stopping write stream with ${r.L_.length} pending writes`),r.L_=[]))})),r.G_}var hu=class r{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new _t,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,s){let a=Date.now()+n,u=new r(t,e,a,i,s);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(b.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function tr(r,t){if(ct("AsyncQueue",`${t}: ${r}`),Oe(r))return new x(b.UNAVAILABLE,`${t}: ${r}`);throw r}var Vs=class r{static emptySet(t){return new r(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||M.comparator(e.key,n.key):(e,n)=>M.comparator(e.key,n.key),this.keyedMap=Vr(),this.sortedSet=new it(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var xs=class{constructor(){this.z_=new it(M.comparator)}track(t){let e=t.doc.key,n=this.z_.get(e);n?t.type!==0&&n.type===3?this.z_=this.z_.insert(e,t):t.type===3&&n.type!==1?this.z_=this.z_.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.z_=this.z_.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.z_=this.z_.remove(e):t.type===1&&n.type===2?this.z_=this.z_.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.z_=this.z_.insert(e,{type:2,doc:t.doc}):L():this.z_=this.z_.insert(e,t)}j_(){let t=[];return this.z_.inorderTraversal((e,n)=>{t.push(n)}),t}},Gn=class r{constructor(t,e,n,i,s,a,u,c,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,i,s){let a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new r(t,e,Vs.emptySet(e),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ci(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==n[i].type||!e[i].doc.isEqual(n[i].doc))return!1;return!0}};var du=class{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(t=>t.Z_())}},fu=class{constructor(){this.queries=bh(),this.onlineState="Unknown",this.X_=new Set}terminate(){(function(e,n){let i=k(e),s=i.queries;i.queries=bh(),s.forEach((a,u)=>{for(let c of u.J_)c.onError(n)})})(this,new x(b.ABORTED,"Firestore shutting down"))}};function bh(){return new zt(r=>ld(r),ci)}async function uc(r,t){let e=k(r),n=3,i=t.query,s=e.queries.get(i);s?!s.Y_()&&t.Z_()&&(n=2):(s=new du,n=t.Z_()?0:1);try{switch(n){case 0:s.H_=await e.onListen(i,!0);break;case 1:s.H_=await e.onListen(i,!1);break;case 2:await e.onFirstRemoteStoreListen(i)}}catch(a){let u=tr(a,`Initialization of query '${In(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,s),s.J_.push(t),t.ea(e.onlineState),s.H_&&t.ta(s.H_)&&lc(e)}async function cc(r,t){let e=k(r),n=t.query,i=3,s=e.queries.get(n);if(s){let a=s.J_.indexOf(t);a>=0&&(s.J_.splice(a,1),s.J_.length===0?i=t.Z_()?0:1:!s.Y_()&&t.Z_()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function Vg(r,t){let e=k(r),n=!1;for(let i of t){let s=i.query,a=e.queries.get(s);if(a){for(let u of a.J_)u.ta(i)&&(n=!0);a.H_=i}}n&&lc(e)}function xg(r,t,e){let n=k(r),i=n.queries.get(t);if(i)for(let s of i.J_)s.onError(e);n.queries.delete(t)}function lc(r){r.X_.forEach(t=>{t.next()})}var mu,Ph;(Ph=mu||(mu={})).na="default",Ph.Cache="cache";var Zr=class{constructor(t,e,n){this.query=t,this.ra=e,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=n||{}}ta(t){if(!this.options.includeMetadataChanges){let n=[];for(let i of t.docChanges)i.type!==3&&n.push(i);t=new Gn(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.ia?this.oa(t)&&(this.ra.next(t),e=!0):this._a(t,this.onlineState)&&(this.aa(t),e=!0),this.sa=t,e}onError(t){this.ra.error(t)}ea(t){this.onlineState=t;let e=!1;return this.sa&&!this.ia&&this._a(this.sa,t)&&(this.aa(this.sa),e=!0),e}_a(t,e){if(!t.fromCache||!this.Z_())return!0;let n=e!=="Offline";return(!this.options.ua||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}oa(t){if(t.docChanges.length>0)return!0;let e=this.sa&&this.sa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}aa(t){t=Gn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ia=!0,this.ra.next(t)}Z_(){return this.options.source!==mu.Cache}};var gu=class{constructor(t,e){this.ca=t,this.byteLength=e}la(){return"metadata"in this.ca}};var Cs=class{constructor(t){this.serializer=t}As(t){return Ht(this.serializer,t)}Rs(t){return t.metadata.exists?Dd(this.serializer,t.document,!1):wt.newNoDocument(this.As(t.metadata.name),this.Vs(t.metadata.readTime))}Vs(t){return ht(t)}},pu=class{constructor(t,e,n){this.ha=t,this.localStore=e,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=af(t)}Pa(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.ca.namedQuery)this.queries.push(t.ca.namedQuery);else if(t.ca.documentMetadata){this.documents.push({metadata:t.ca.documentMetadata}),t.ca.documentMetadata.exists||++e;let n=J.fromString(t.ca.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.ca.document&&(this.documents[this.documents.length-1].document=t.ca.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}Ta(t){let e=new Map,n=new Cs(this.serializer);for(let i of t)if(i.metadata.queries){let s=n.As(i.metadata.name);for(let a of i.metadata.queries){let u=(e.get(a)||j()).add(s);e.set(a,u)}}return e}async complete(){let t=await pg(this.localStore,new Cs(this.serializer),this.documents,this.ha.id),e=this.Ta(this.documents);for(let n of this.queries)await _g(this.localStore,n,e.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Ia:this.collectionGroups,Ea:t}}};function af(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var Ds=class{constructor(t){this.key=t}},Ns=class{constructor(t){this.key=t}},ks=class{constructor(t,e){this.query=t,this.da=e,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=j(),this.mutatedKeys=j(),this.Va=dd(t),this.ma=new Vs(this.Va)}get fa(){return this.da}ga(t,e){let n=e?e.pa:new xs,i=e?e.ma:this.ma,s=e?e.mutatedKeys:this.mutatedKeys,a=i,u=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((f,g)=>{let _=i.get(f),R=li(this.query,g)?g:null,D=!!_&&this.mutatedKeys.has(_.key),N=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),V=!1;_&&R?_.data.isEqual(R.data)?D!==N&&(n.track({type:3,doc:R}),V=!0):this.ya(_,R)||(n.track({type:2,doc:R}),V=!0,(c&&this.Va(R,c)>0||d&&this.Va(R,d)<0)&&(u=!0)):!_&&R?(n.track({type:0,doc:R}),V=!0):_&&!R&&(n.track({type:1,doc:_}),V=!0,(c||d)&&(u=!0)),V&&(R?(a=a.add(R),s=N?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{ma:a,pa:n,ss:u,mutatedKeys:s}}ya(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,i){let s=this.ma;this.ma=t.ma,this.mutatedKeys=t.mutatedKeys;let a=t.pa.j_();a.sort((f,g)=>function(R,D){let N=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L()}};return N(R)-N(D)}(f.type,g.type)||this.Va(f.doc,g.doc)),this.wa(n),i=i!=null&&i;let u=e&&!i?this.Sa():[],c=this.Ra.size===0&&this.current&&!i?1:0,d=c!==this.Aa;return this.Aa=c,a.length!==0||d?{snapshot:new Gn(this.query,t.ma,s,a,t.mutatedKeys,c===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),ba:u}:{ba:u}}ea(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({ma:this.ma,pa:new xs,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(t){return!this.da.has(t)&&!!this.ma.has(t)&&!this.ma.get(t).hasLocalMutations}wa(t){t&&(t.addedDocuments.forEach(e=>this.da=this.da.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.da=this.da.delete(e)),this.current=t.current)}Sa(){if(!this.current)return[];let t=this.Ra;this.Ra=j(),this.ma.forEach(n=>{this.Da(n.key)&&(this.Ra=this.Ra.add(n.key))});let e=[];return t.forEach(n=>{this.Ra.has(n)||e.push(new Ns(n))}),this.Ra.forEach(n=>{t.has(n)||e.push(new Ds(n))}),e}va(t){this.da=t.ds,this.Ra=j();let e=this.ga(t.documents);return this.applyChanges(e,!0)}Ca(){return Gn.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,this.Aa===0,this.hasCachedResults)}},_u=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},yu=class{constructor(t){this.key=t,this.Fa=!1}},wu=class{constructor(t,e,n,i,s,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ma={},this.xa=new zt(u=>ld(u),ci),this.Oa=new Map,this.Na=new Set,this.La=new it(M.comparator),this.Ba=new Map,this.ka=new Hr,this.qa={},this.Qa=new Map,this.Ka=On.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return this.$a===!0}};async function Cg(r,t,e=!0){let n=Js(r),i,s=n.xa.get(t);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Ca()):i=await uf(n,t,e,!0),i}async function Dg(r,t){let e=Js(r);await uf(e,t,!0,!1)}async function uf(r,t,e,n){let i=await qn(r.localStore,Ct(t)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,e),u;return n&&(u=await hc(r,t,s,a==="current",i.resumeToken)),r.isPrimaryClient&&e&&Hs(r.remoteStore,i),u}async function hc(r,t,e,n,i){r.Ua=(g,_,R)=>async function(N,V,B,G){let q=V.view.ga(B);q.ss&&(q=await Is(N.localStore,V.query,!1).then(({documents:v})=>V.view.ga(v,q)));let $=G&&G.targetChanges.get(V.targetId),Y=G&&G.targetMismatches.get(V.targetId)!=null,K=V.view.applyChanges(q,N.isPrimaryClient,$,Y);return vu(N,V.targetId,K.ba),K.snapshot}(r,g,_,R);let s=await Is(r.localStore,t,!0),a=new ks(t,s.ds),u=a.ga(s.documents),c=Kr.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",i),d=a.applyChanges(u,r.isPrimaryClient,c);vu(r,e,d.ba);let f=new _u(t,e,a);return r.xa.set(t,f),r.Oa.has(e)?r.Oa.get(e).push(t):r.Oa.set(e,[t]),d.snapshot}async function Ng(r,t,e){let n=k(r),i=n.xa.get(t),s=n.Oa.get(i.targetId);if(s.length>1)return n.Oa.set(i.targetId,s.filter(a=>!ci(a,t))),void n.xa.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await Un(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),e&&Bn(n.remoteStore,i.targetId),zn(n,i.targetId)}).catch(Le)):(zn(n,i.targetId),await Un(n.localStore,i.targetId,!0))}async function kg(r,t){let e=k(r),n=e.xa.get(t),i=e.Oa.get(n.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),Bn(e.remoteStore,n.targetId))}async function Fg(r,t,e){let n=gc(r);try{let i=await function(a,u){let c=k(a),d=lt.now(),f=u.reduce((R,D)=>R.add(D.key),j()),g,_;return c.persistence.runTransaction("Locally write mutations","readwrite",R=>{let D=Ft(),N=j();return c.hs.getEntries(R,f).next(V=>{D=V,D.forEach((B,G)=>{G.isValidDocument()||(N=N.add(B))})}).next(()=>c.localDocuments.getOverlayedDocuments(R,D)).next(V=>{g=V;let B=[];for(let G of u){let q=Jm(G,g.get(G.key).overlayedDocument);q!=null&&B.push(new jt(G.key,q,ed(q.value.mapValue),ut.exists(!0)))}return c.mutationQueue.addMutationBatch(R,d,B,u)}).next(V=>{_=V;let B=V.applyToLocalDocumentSet(g,N);return c.documentOverlayCache.saveOverlays(R,V.batchId,B)})}).then(()=>({batchId:_.batchId,changes:md(g)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let d=a.qa[a.currentUser.toKey()];d||(d=new it(z)),d=d.insert(u,c),a.qa[a.currentUser.toKey()]=d}(n,i.batchId,e),await fe(n,i.changes),await Yn(n.remoteStore)}catch(i){let s=tr(i,"Failed to persist write");e.reject(s)}}async function cf(r,t){let e=k(r);try{let n=await mg(e.localStore,t);t.targetChanges.forEach((i,s)=>{let a=e.Ba.get(s);a&&(O(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Fa=!0:i.modifiedDocuments.size>0?O(a.Fa):i.removedDocuments.size>0&&(O(a.Fa),a.Fa=!1))}),await fe(e,n,t)}catch(n){await Le(n)}}function Vh(r,t,e){let n=k(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let i=[];n.xa.forEach((s,a)=>{let u=a.view.ea(t);u.snapshot&&i.push(u.snapshot)}),function(a,u){let c=k(a);c.onlineState=u;let d=!1;c.queries.forEach((f,g)=>{for(let _ of g.J_)_.ea(u)&&(d=!0)}),d&&lc(c)}(n.eventManager,t),i.length&&n.Ma.R_(i),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function Mg(r,t,e){let n=k(r);n.sharedClientState.updateQueryState(t,"rejected",e);let i=n.Ba.get(t),s=i&&i.key;if(s){let a=new it(M.comparator);a=a.insert(s,wt.newNoDocument(s,U.min()));let u=j().add(s),c=new jr(U.min(),new Map,new it(z),a,u);await cf(n,c),n.La=n.La.remove(s),n.Ba.delete(t),mc(n)}else await Un(n.localStore,t,!1).then(()=>zn(n,t,e)).catch(Le)}async function Lg(r,t){let e=k(r),n=t.batch.batchId;try{let i=await fg(e.localStore,t);fc(e,n,null),dc(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await fe(e,i)}catch(i){await Le(i)}}async function Og(r,t,e){let n=k(r);try{let i=await function(a,u){let c=k(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return c.mutationQueue.lookupMutationBatch(d,u).next(g=>(O(g!==null),f=g.keys(),c.mutationQueue.removeMutationBatch(d,g))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>c.localDocuments.getDocuments(d,f))})}(n.localStore,t);fc(n,t,e),dc(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),await fe(n,i)}catch(i){await Le(i)}}async function qg(r,t){let e=k(r);Ue(e.remoteStore)||C("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=await function(a){let u=k(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(e.localStore);if(n===-1)return void t.resolve();let i=e.Qa.get(n)||[];i.push(t),e.Qa.set(n,i)}catch(n){let i=tr(n,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}}function dc(r,t){(r.Qa.get(t)||[]).forEach(e=>{e.resolve()}),r.Qa.delete(t)}function fc(r,t,e){let n=k(r),i=n.qa[n.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),n.qa[n.currentUser.toKey()]=i}}function zn(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Oa.get(t))r.xa.delete(n),e&&r.Ma.Wa(n,e);r.Oa.delete(t),r.isPrimaryClient&&r.ka.yr(t).forEach(n=>{r.ka.containsKey(n)||lf(r,n)})}function lf(r,t){r.Na.delete(t.path.canonicalString());let e=r.La.get(t);e!==null&&(Bn(r.remoteStore,e),r.La=r.La.remove(t),r.Ba.delete(e),mc(r))}function vu(r,t,e){for(let n of e)n instanceof Ds?(r.ka.addReference(n.key,t),Ug(r,n)):n instanceof Ns?(C("SyncEngine","Document no longer in limbo: "+n.key),r.ka.removeReference(n.key,t),r.ka.containsKey(n.key)||lf(r,n.key)):L()}function Ug(r,t){let e=t.key,n=e.path.canonicalString();r.La.get(e)||r.Na.has(n)||(C("SyncEngine","New document in limbo: "+e),r.Na.add(n),mc(r))}function mc(r){for(;r.Na.size>0&&r.La.size<r.maxConcurrentLimboResolutions;){let t=r.Na.values().next().value;r.Na.delete(t);let e=new M(J.fromString(t)),n=r.Ka.next();r.Ba.set(n,new yu(e)),r.La=r.La.insert(e,n),Hs(r.remoteStore,new Ln(Ct(Jn(e.path)),n,"TargetPurposeLimboResolution",Lt.oe))}}async function fe(r,t,e){let n=k(r),i=[],s=[],a=[];n.xa.isEmpty()||(n.xa.forEach((u,c)=>{a.push(n.Ua(c,t,e).then(d=>{var f;if((d||e)&&n.isPrimaryClient){let g=d?!d.fromCache:(f=e?.targetChanges.get(c.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,g?"current":"not-current")}if(d){i.push(d);let g=Ya.zi(c.targetId,d);s.push(g)}}))}),await Promise.all(a),n.Ma.R_(i),await async function(c,d){let f=k(c);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>S.forEach(d,_=>S.forEach(_.Wi,R=>f.persistence.referenceDelegate.addReference(g,_.targetId,R)).next(()=>S.forEach(_.Gi,R=>f.persistence.referenceDelegate.removeReference(g,_.targetId,R)))))}catch(g){if(!Oe(g))throw g;C("LocalStore","Failed to update sequence numbers: "+g)}for(let g of d){let _=g.targetId;if(!g.fromCache){let R=f.us.get(_),D=R.snapshotVersion,N=R.withLastLimboFreeSnapshotVersion(D);f.us=f.us.insert(_,N)}}}(n.localStore,s))}async function Bg(r,t){let e=k(r);if(!e.currentUser.isEqual(t)){C("SyncEngine","User change. New user:",t.toKey());let n=await Wd(e.localStore,t);e.currentUser=t,function(s,a){s.Qa.forEach(u=>{u.forEach(c=>{c.reject(new x(b.CANCELLED,a))})}),s.Qa.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await fe(e,n.Ts)}}function Gg(r,t){let e=k(r),n=e.Ba.get(t);if(n&&n.Fa)return j().add(n.key);{let i=j(),s=e.Oa.get(t);if(!s)return i;for(let a of s){let u=e.xa.get(a);i=i.unionWith(u.view.fa)}return i}}async function zg(r,t){let e=k(r),n=await Is(e.localStore,t.query,!0),i=t.view.va(n);return e.isPrimaryClient&&vu(e,t.targetId,i.ba),i}async function jg(r,t){let e=k(r);return Yd(e.localStore,t).then(n=>fe(e,n))}async function Kg(r,t,e,n){let i=k(r),s=await function(u,c){let d=k(u),f=k(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.On(g,c).next(_=>_?d.localDocuments.getDocuments(g,_):S.resolve(null)))}(i.localStore,t);s!==null?(e==="pending"?await Yn(i.remoteStore):e==="acknowledged"||e==="rejected"?(fc(i,t,n||null),dc(i,t),function(u,c){k(k(u).mutationQueue).Ln(c)}(i.localStore,t)):L(),await fe(i,s)):C("SyncEngine","Cannot apply mutation batch with id: "+t)}async function $g(r,t){let e=k(r);if(Js(e),gc(e),t===!0&&e.$a!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),i=await xh(e,n.toArray());e.$a=!0,await lu(e.remoteStore,!0);for(let s of i)Hs(e.remoteStore,s)}else if(t===!1&&e.$a!==!1){let n=[],i=Promise.resolve();e.Oa.forEach((s,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(zn(e,a),Un(e.localStore,a,!0))),Bn(e.remoteStore,a)}),await i,await xh(e,n),function(a){let u=k(a);u.Ba.forEach((c,d)=>{Bn(u.remoteStore,d)}),u.ka.wr(),u.Ba=new Map,u.La=new it(M.comparator)}(e),e.$a=!1,await lu(e.remoteStore,!1)}}async function xh(r,t,e){let n=k(r),i=[],s=[];for(let a of t){let u,c=n.Oa.get(a);if(c&&c.length!==0){u=await qn(n.localStore,Ct(c[0]));for(let d of c){let f=n.xa.get(d),g=await zg(n,f);g.snapshot&&s.push(g.snapshot)}}else{let d=await Xd(n.localStore,a);u=await qn(n.localStore,d),await hc(n,hf(d),a,!1,u.resumeToken)}i.push(u)}return n.Ma.R_(s),i}function hf(r){return ad(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Qg(r){return function(e){return k(k(e).persistence).$i()}(k(r).localStore)}async function Wg(r,t,e,n){let i=k(r);if(i.$a)return void C("SyncEngine","Ignoring unexpected query state notification.");let s=i.Oa.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let a=await Yd(i.localStore,hd(s[0])),u=jr.createSynthesizedRemoteEventForCurrentChange(t,e==="current",ft.EMPTY_BYTE_STRING);await fe(i,a,u);break}case"rejected":await Un(i.localStore,t,!0),zn(i,t,n);break;default:L()}}async function Hg(r,t,e){let n=Js(r);if(n.$a){for(let i of t){if(n.Oa.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){C("SyncEngine","Adding an already active target "+i);continue}let s=await Xd(n.localStore,i),a=await qn(n.localStore,s);await hc(n,hf(s),a.targetId,!1,a.resumeToken),Hs(n.remoteStore,a)}for(let i of e)n.Oa.has(i)&&await Un(n.localStore,i,!1).then(()=>{Bn(n.remoteStore,i),zn(n,i)}).catch(Le)}}function Js(r){let t=k(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=cf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Gg.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Mg.bind(null,t),t.Ma.R_=Vg.bind(null,t.eventManager),t.Ma.Wa=xg.bind(null,t.eventManager),t}function gc(r){let t=k(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Lg.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Og.bind(null,t),t}function Jg(r,t,e){let n=k(r);(async function(s,a,u){try{let c=await a.getMetadata();if(await function(R,D){let N=k(R),V=ht(D.createTime);return N.persistence.runTransaction("hasNewerBundle","readonly",B=>N.jr.getBundleMetadata(B,D.id)).then(B=>!!B&&B.createTime.compareTo(V)>=0)}(s.localStore,c))return await a.close(),u._completeWith(function(R){return{taskState:"Success",documentsLoaded:R.totalDocuments,bytesLoaded:R.totalBytes,totalDocuments:R.totalDocuments,totalBytes:R.totalBytes}}(c)),Promise.resolve(new Set);u._updateProgress(af(c));let d=new pu(c,s.localStore,a.serializer),f=await a.Ga();for(;f;){let _=await d.Pa(f);_&&u._updateProgress(_),f=await a.Ga()}let g=await d.complete();return await fe(s,g.Ea,void 0),await function(R,D){let N=k(R);return N.persistence.runTransaction("Save bundle","readwrite",V=>N.jr.saveBundleMetadata(V,D))}(s.localStore,c),u._completeWith(g.progress),Promise.resolve(g.Ia)}catch(c){return qt("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}})(n,t,e).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var Xs=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=hi(e.databaseInfo.databaseId),this.sharedClientState=this.za(e),this.persistence=this.ja(e),await this.persistence.start(),this.localStore=this.Ha(e),this.gcScheduler=this.Ja(e,this.localStore),this.indexBackfillerScheduler=this.Ya(e,this.localStore)}Ja(e,n){return null}Ya(e,n){return null}Ha(e){return Qd(this.persistence,new Ts,e.initialUser,this.serializer)}ja(e){return new Jr(ws.ei,this.serializer)}za(e){return new Ss}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}return r.provider={build:()=>new r},r})(),ti=class extends Xs{constructor(t){super(),this.cacheSizeBytes=t}Ja(t,e){O(this.persistence.referenceDelegate instanceof vs);let n=this.persistence.referenceDelegate.garbageCollector;return new ps(n,t.asyncQueue,e)}ja(t){let e=this.cacheSizeBytes!==void 0?kt.withCacheSize(this.cacheSizeBytes):kt.DEFAULT;return new Jr(n=>vs.ei(n,e),this.serializer)}},ei=class extends Xs{constructor(t,e,n){super(),this.Za=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.Za.initialize(this,t),await gc(this.Za.syncEngine),await Yn(this.Za.remoteStore),await this.persistence.Si(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ha(t){return Qd(this.persistence,new Ts,t.initialUser,this.serializer)}Ja(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new ps(n,t.asyncQueue,e)}Ya(t,e){let n=new ta(e,this.persistence);return new Zo(t.asyncQueue,n)}ja(t){let e=ic(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?kt.withCacheSize(this.cacheSizeBytes):kt.DEFAULT;return new Xa(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,tf(),ji(),this.serializer,this.sharedClientState,!!this.forceOwnership)}za(t){return new Ss}},Fs=class extends ei{constructor(t,e){super(t,e,!1),this.Za=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);let e=this.Za.syncEngine;this.sharedClientState instanceof Fr&&(this.sharedClientState.syncEngine={io:Kg.bind(null,e),so:Wg.bind(null,e),oo:Hg.bind(null,e),$i:Qg.bind(null,e),ro:jg.bind(null,e)},await this.sharedClientState.start()),await this.persistence.Si(async n=>{await $g(this.Za.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())})}za(t){let e=tf();if(!Fr.p(e))throw new x(b.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=ic(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Fr(e,t.asyncQueue,n,t.clientId,t.initialUser)}},er=(()=>{class r{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Vh(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Bg.bind(null,this.syncEngine),await lu(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new fu}()}createDatastore(e){let n=hi(e.databaseInfo.databaseId),i=function(a){return new iu(a)}(e.databaseInfo);return function(a,u,c,d){return new au(a,u,c,d)}(e.authCredentials,e.appCheckCredentials,i,n)}createRemoteStore(e){return function(i,s,a,u,c){return new cu(i,s,a,u,c)}(this.localStore,this.datastore,e.asyncQueue,n=>Vh(this.syncEngine,n,0),function(){return Rs.p()?new Rs:new nu}())}createSyncEngine(e,n){return function(s,a,u,c,d,f,g){let _=new wu(s,a,u,c,d,f);return g&&(_.$a=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){let a=k(s);C("RemoteStore","RemoteStore shutting down."),a.k_.add(5),await Xn(a),a.Q_.shutdown(),a.K_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}return r.provider={build:()=>new r},r})();function Ch(r,t=10240){let e=0;return{async read(){if(e<r.byteLength){let n={value:r.slice(e,e+t),done:!1};return e+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}var jn=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Xa(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Xa(this.observer.error,t):ct("Uncaught Error in snapshot listener:",t.toString()))}eu(){this.muted=!0}Xa(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var Tu=class{constructor(t,e){this.tu=t,this.serializer=e,this.metadata=new _t,this.buffer=new Uint8Array,this.nu=function(){return new TextDecoder("utf-8")}(),this.ru().then(n=>{n&&n.la()?this.metadata.resolve(n.ca.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.ca)}`))},n=>this.metadata.reject(n))}close(){return this.tu.cancel()}async getMetadata(){return this.metadata.promise}async Ga(){return await this.getMetadata(),this.ru()}async ru(){let t=await this.iu();if(t===null)return null;let e=this.nu.decode(t),n=Number(e);isNaN(n)&&this.su(`length string (${e}) is not valid number`);let i=await this.ou(n);return new gu(JSON.parse(i),t.length+n)}_u(){return this.buffer.findIndex(t=>t===123)}async iu(){for(;this._u()<0&&!await this.au(););if(this.buffer.length===0)return null;let t=this._u();t<0&&this.su("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async ou(t){for(;this.buffer.length<t;)await this.au()&&this.su("Reached the end of bundle when more is expected.");let e=this.nu.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}su(t){throw this.tu.cancel(),new Error(`Invalid bundle format: ${t}`)}async au(){let t=await this.tu.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}};var Iu=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new x(b.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=await async function(i,s){let a=k(i),u={documents:s.map(g=>$r(a.serializer,g))},c=await a.ko("BatchGetDocuments",a.serializer.databaseId,J.emptyPath(),u,s.length),d=new Map;c.forEach(g=>{let _=ng(a.serializer,g);d.set(_.key.toString(),_)});let f=[];return s.forEach(g=>{let _=d.get(g.toString());O(!!_),f.push(_)}),f}(this.datastore,t);return e.forEach(n=>this.recordVersion(n)),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(t.toString())}delete(t){this.write(new Ne(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,n)=>{let i=M.fromPath(n);this.mutations.push(new Br(i,this.precondition(i)))}),await async function(n,i){let s=k(n),a={writes:i.map(u=>Qr(s.serializer,u))};await s.Oo("Commit",s.serializer.databaseId,J.emptyPath(),a)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw L();e=U.min()}let n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new x(b.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(U.min())?ut.exists(!1):ut.updateTime(e):ut.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(U.min()))throw new x(b.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ut.updateTime(e)}return ut.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var Eu=class{constructor(t,e,n,i,s){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=i,this.deferred=s,this.uu=n.maxAttempts,this.r_=new Yr(this.asyncQueue,"transaction_retry")}cu(){this.uu-=1,this.lu()}lu(){this.r_.jo(async()=>{let t=new Iu(this.datastore),e=this.hu(t);e&&e.then(n=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.Pu(i)}))}).catch(n=>{this.Pu(n)})})}hu(t){try{let e=this.updateFunction(t);return!ai(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Pu(t){this.uu>0&&this.Tu(t)?(this.uu-=1,this.asyncQueue.enqueueAndForget(()=>(this.lu(),Promise.resolve()))):this.deferred.reject(t)}Tu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Ad(e)}return!1}};var Au=class{constructor(t,e,n,i,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=pt.UNAUTHENTICATED,this.clientId=Qi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,async a=>{C("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(n,a=>(C("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new _t;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=tr(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}};async function zo(r,t){r.asyncQueue.verifyOperationInProgress(),C("FirestoreClient","Initializing OfflineComponentProvider");let e=r.configuration;await t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(async i=>{n.isEqual(i)||(await Wd(t.localStore,i),n=i)}),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t}async function Dh(r,t){r.asyncQueue.verifyOperationInProgress();let e=await pc(r);C("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>Rh(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Rh(t.remoteStore,i)),r._onlineComponents=t}async function pc(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){C("FirestoreClient","Using user provided OfflineComponentProvider");try{await zo(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(i){return i.name==="FirebaseError"?i.code===b.FAILED_PRECONDITION||i.code===b.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(e))throw e;qt("Error using user provided cache. Falling back to memory cache: "+e),await zo(r,new Xs)}}else C("FirestoreClient","Using default OfflineComponentProvider"),await zo(r,new ti(void 0));return r._offlineComponents}async function Ys(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(C("FirestoreClient","Using user provided OnlineComponentProvider"),await Dh(r,r._uninitializedComponentsProvider._online)):(C("FirestoreClient","Using default OnlineComponentProvider"),await Dh(r,new er))),r._onlineComponents}function df(r){return pc(r).then(t=>t.persistence)}function nr(r){return pc(r).then(t=>t.localStore)}function ff(r){return Ys(r).then(t=>t.remoteStore)}function _c(r){return Ys(r).then(t=>t.syncEngine)}function mf(r){return Ys(r).then(t=>t.datastore)}async function Kn(r){let t=await Ys(r),e=t.eventManager;return e.onListen=Cg.bind(null,t.syncEngine),e.onUnlisten=Ng.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Dg.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=kg.bind(null,t.syncEngine),e}function Xg(r){return r.asyncQueue.enqueue(async()=>{let t=await df(r),e=await ff(r);return t.setNetworkEnabled(!0),function(i){let s=k(i);return s.k_.delete(0),di(s)}(e)})}function Yg(r){return r.asyncQueue.enqueue(async()=>{let t=await df(r),e=await ff(r);return t.setNetworkEnabled(!1),async function(i){let s=k(i);s.k_.add(0),await Xn(s),s.K_.set("Offline")}(e)})}function Zg(r,t){let e=new _t;return r.asyncQueue.enqueueAndForget(async()=>async function(i,s,a){try{let u=await function(d,f){let g=k(d);return g.persistence.runTransaction("read document","readonly",_=>g.localDocuments.getDocument(_,f))}(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new x(b.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let c=tr(u,`Failed to get document '${s} from cache`);a.reject(c)}}(await nr(r),t,e)),e.promise}function gf(r,t,e={}){let n=new _t;return r.asyncQueue.enqueueAndForget(async()=>function(s,a,u,c,d){let f=new jn({next:_=>{f.eu(),a.enqueueAndForget(()=>cc(s,g));let R=_.docs.has(u);!R&&_.fromCache?d.reject(new x(b.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&_.fromCache&&c&&c.source==="server"?d.reject(new x(b.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new Zr(Jn(u.path),f,{includeMetadataChanges:!0,ua:!0});return uc(s,g)}(await Kn(r),r.asyncQueue,t,e,n)),n.promise}function tp(r,t){let e=new _t;return r.asyncQueue.enqueueAndForget(async()=>async function(i,s,a){try{let u=await Is(i,s,!0),c=new ks(s,u.ds),d=c.ga(u.documents),f=c.applyChanges(d,!1);a.resolve(f.snapshot)}catch(u){let c=tr(u,`Failed to execute query '${s} against cache`);a.reject(c)}}(await nr(r),t,e)),e.promise}function pf(r,t,e={}){let n=new _t;return r.asyncQueue.enqueueAndForget(async()=>function(s,a,u,c,d){let f=new jn({next:_=>{f.eu(),a.enqueueAndForget(()=>cc(s,g)),_.fromCache&&c.source==="server"?d.reject(new x(b.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new Zr(u,f,{includeMetadataChanges:!0,ua:!0});return uc(s,g)}(await Kn(r),r.asyncQueue,t,e,n)),n.promise}function ep(r,t,e){let n=new _t;return r.asyncQueue.enqueueAndForget(async()=>{try{let i=await mf(r);n.resolve(async function(a,u,c){var d;let f=k(a),{request:g,lt:_,parent:R}=kd(f.serializer,ud(u),c);f.connection.Co||delete g.parent;let D=(await f.ko("RunAggregationQuery",f.serializer.databaseId,R,g,1)).filter(V=>!!V.result);O(D.length===1);let N=(d=D[0].result)===null||d===void 0?void 0:d.aggregateFields;return Object.keys(N).reduce((V,B)=>(V[_[B]]=N[B],V),{})}(i,t,e))}catch(i){n.reject(i)}}),n.promise}function np(r,t){let e=new jn(t);return r.asyncQueue.enqueueAndForget(async()=>function(i,s){k(i).X_.add(s),s.next()}(await Kn(r),e)),()=>{e.eu(),r.asyncQueue.enqueueAndForget(async()=>function(i,s){k(i).X_.delete(s)}(await Kn(r),e))}}function rp(r,t,e,n){let i=function(a,u){let c;return c=typeof a=="string"?Rd().encode(a):a,function(f,g){return new Tu(f,g)}(function(f,g){if(f instanceof Uint8Array)return Ch(f,g);if(f instanceof ArrayBuffer)return Ch(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),u)}(e,hi(t));r.asyncQueue.enqueueAndForget(async()=>{Jg(await _c(r),i,n)})}function ip(r,t){return r.asyncQueue.enqueue(async()=>function(n,i){let s=k(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.jr.getNamedQuery(a,i))}(await nr(r),t))}function sp(r,t){return r.asyncQueue.enqueue(async()=>async function(n,i){let s=k(n),a=s.indexManager,u=[];return s.persistence.runTransaction("Configure indexes","readwrite",c=>a.getFieldIndexes(c).next(d=>function(g,_,R,D,N){g=[...g],_=[..._],g.sort(R),_.sort(R);let V=g.length,B=_.length,G=0,q=0;for(;G<B&&q<V;){let $=R(g[q],_[G]);$<0?N(g[q++]):$>0?D(_[G++]):(G++,q++)}for(;G<B;)D(_[G++]);for(;q<V;)N(g[q++])}(d,i,pm,f=>{u.push(a.addFieldIndex(c,f))},f=>{u.push(a.deleteFieldIndex(c,f))})).next(()=>S.waitFor(u)))}(await nr(r),t))}function op(r,t){return r.asyncQueue.enqueue(async()=>function(n,i){k(n)._s.Hi=i}(await nr(r),t))}function ap(r){return r.asyncQueue.enqueue(async()=>function(e){let n=k(e),i=n.indexManager;return n.persistence.runTransaction("Delete All Indexes","readwrite",s=>i.deleteAllFieldIndexes(s))}(await nr(r)))}function _f(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var Nh=new Map;function yc(r,t,e){if(!e)throw new x(b.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function up(r,t,e,n){if(t===!0&&n===!0)throw new x(b.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function kh(r){if(!M.isDocumentKey(r))throw new x(b.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Fh(r){if(M.isDocumentKey(r))throw new x(b.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Zs(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":L()}function Q(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new x(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=Zs(r);throw new x(b.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function yf(r,t){if(t<=0)throw new x(b.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}var Ms=class{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new x(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new x(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}up("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=_f((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new x(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new x(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new x(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},on=class{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ms({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new x(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ms(t),t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new jo;switch(n.type){case"firstParty":return new Wo(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new x(b.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=Nh.get(e);n&&(C("ComponentProvider","Removing Datastore"),Nh.delete(e),n.terminate())}(this),Promise.resolve()}};function cp(r,t,e,n={}){var i;let s=(r=Q(r,on))._getSettings(),a=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&qt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,c;if(typeof n.mockUserToken=="string")u=n.mockUserToken,c=pt.MOCK_USER;else{u=Sl(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let d=n.mockUserToken.sub||n.mockUserToken.user_id;if(!d)throw new x(b.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new pt(d)}r._authCredentials=new Ko(new Ki(u,c))}}var Et=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},dt=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Jt(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}},Jt=class r extends Et{constructor(t,e,n){super(t,e,Jn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new dt(this.firestore,null,new M(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function kp(r,t,...e){if(r=vt(r),yc("collection","path",t),r instanceof on){let n=J.fromString(t,...e);return Fh(n),new Jt(r,null,n)}{if(!(r instanceof dt||r instanceof Jt))throw new x(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(J.fromString(t,...e));return Fh(n),new Jt(r.firestore,null,n)}}function Fp(r,t){if(r=Q(r,on),yc("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new x(b.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Et(r,null,function(n){return new Gt(J.emptyPath(),n)}(t))}function lp(r,t,...e){if(r=vt(r),arguments.length===1&&(t=Qi.newId()),yc("doc","path",t),r instanceof on){let n=J.fromString(t,...e);return kh(n),new dt(r,null,new M(n))}{if(!(r instanceof dt||r instanceof Jt))throw new x(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(J.fromString(t,...e));return kh(n),new dt(r.firestore,r instanceof Jt?r.converter:null,new M(n))}}function Mp(r,t){return r=vt(r),t=vt(t),(r instanceof dt||r instanceof Jt)&&(t instanceof dt||t instanceof Jt)&&r.firestore===t.firestore&&r.path===t.path&&r.converter===t.converter}function wf(r,t){return r=vt(r),t=vt(t),r instanceof Et&&t instanceof Et&&r.firestore===t.firestore&&ci(r._query,t._query)&&r.converter===t.converter}var Ls=class{constructor(t=Promise.resolve()){this.Iu=[],this.Eu=!1,this.du=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new Yr(this,"async_queue_retry"),this.fu=()=>{let n=ji();n&&C("AsyncQueue","Visibility state changed to "+n.visibilityState),this.r_.Jo()},this.gu=t;let e=ji();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.Eu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.pu(),this.yu(t)}enterRestrictedMode(t){if(!this.Eu){this.Eu=!0,this.Vu=t||!1;let e=ji();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.fu)}}enqueue(t){if(this.pu(),this.Eu)return new Promise(()=>{});let e=new _t;return this.yu(()=>this.Eu&&this.Vu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Iu.push(t),this.wu()))}async wu(){if(this.Iu.length!==0){try{await this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(t){if(!Oe(t))throw t;C("AsyncQueue","Operation failed with retryable error: "+t)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}}yu(t){let e=this.gu.then(()=>(this.Ru=!0,t().catch(n=>{this.Au=n,this.Ru=!1;let i=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(n);throw ct("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.Ru=!1,n))));return this.gu=e,e}enqueueAfterDelay(t,e,n){this.pu(),this.mu.indexOf(t)>-1&&(e=0);let i=hu.createAndSchedule(this,t,e,n,s=>this.Su(s));return this.du.push(i),i}pu(){this.Au&&L()}verifyOperationInProgress(){}async bu(){let t;do t=this.gu,await t;while(t!==this.gu)}Du(t){for(let e of this.du)if(e.timerId===t)return!0;return!1}vu(t){return this.bu().then(()=>{this.du.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.du)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.bu()})}Cu(t){this.mu.push(t)}Su(t){let e=this.du.indexOf(t);this.du.splice(e,1)}};function Su(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var Ru=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new _t,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var Lp=-1,tt=class extends on{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new Ls,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new Ls(t),this._firestoreClient=void 0,await t}}};function Op(r,t,e){e||(e="(default)");let n=Co(r,"firestore");if(n.isInitialized(e)){let i=n.getImmediate({identifier:e}),s=n.getOptions(e);if(Er(s,t))return i;throw new x(b.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(t.cacheSizeBytes!==void 0&&t.localCache!==void 0)throw new x(b.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(t.cacheSizeBytes!==void 0&&t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new x(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:t,instanceIdentifier:e})}function qp(r,t){let e=typeof r=="object"?r:Nl(),n=typeof r=="string"?r:t||"(default)",i=Co(e,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=Al("firestore");s&&cp(i,...s)}return i}function ot(r){if(r._terminated)throw new x(b.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||vf(r),r._firestoreClient}function vf(r){var t,e,n;let i=r._freezeSettings(),s=function(u,c,d,f){return new ea(u,c,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,_f(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new Au(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(u){let c=u?._online.build();return{_offline:u?._offline.build(c),_online:c}}(r._componentsProvider))}function Up(r,t){qt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();return Tf(r,er.provider,{build:n=>new ei(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}async function Bp(r){qt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings();Tf(r,er.provider,{build:e=>new Fs(e,t.cacheSizeBytes)})}function Tf(r,t,e){if((r=Q(r,tt))._firestoreClient||r._terminated)throw new x(b.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new x(b.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},vf(r)}function Gp(r){if(r._initialized&&!r._terminated)throw new x(b.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new _t;return r._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(n){if(!be.p())return Promise.resolve();let i=n+"main";await be.delete(i)}(ic(r._databaseId,r._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}function zp(r){return function(e){let n=new _t;return e.asyncQueue.enqueueAndForget(async()=>qg(await _c(e),n)),n.promise}(ot(r=Q(r,tt)))}function jp(r){return Xg(ot(r=Q(r,tt)))}function Kp(r){return Yg(ot(r=Q(r,tt)))}function $p(r){return Cl(r.app,"firestore",r._databaseId.database),r._delete()}function Qp(r,t){let e=ot(r=Q(r,tt)),n=new Ru;return rp(e,r._databaseId,t,n),n}function Wp(r,t){return ip(ot(r=Q(r,tt)),t).then(e=>e?new Et(r,null,e.query):null)}var an=class{constructor(t="count",e){this._internalFieldPath=e,this.type="AggregateField",this.aggregateType=t}},bu=class{constructor(t,e,n){this._userDataWriter=e,this._data=n,this.type="AggregateQuerySnapshot",this.query=t}data(){return this._userDataWriter.convertObjectMap(this._data)}};var $n=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(ft.fromBase64String(t))}catch(e){throw new x(b.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(ft.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var he=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new x(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new yt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};function Hp(){return new he("__name__")}var de=class{constructor(t){this._methodName=t}};var ni=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new x(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new x(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return z(this._lat,t._lat)||z(this._long,t._long)}};var Qn=class{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,t._values)}};var hp=/^__.*__$/,Pu=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new jt(t,this.data,this.fieldMask,e,this.fieldTransforms):new De(t,this.data,e,this.fieldTransforms)}},Os=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new jt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function If(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}var qs=class r{constructor(t,e,n,i,s,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.Fu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(t){return new r(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.xu({path:n,Nu:!1});return i.Lu(t),i}Bu(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.xu({path:n,Nu:!1});return i.Fu(),i}ku(t){return this.xu({path:void 0,Nu:!0})}qu(t){return Us(t,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Fu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Lu(this.path.get(t))}Lu(t){if(t.length===0)throw this.qu("Document fields must not be empty");if(If(this.Mu)&&hp.test(t))throw this.qu('Document fields cannot begin and end with "__"')}},Vu=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||hi(t)}$u(t,e,n,i=!1){return new qs({Mu:t,methodName:e,Ku:n,path:yt.emptyPath(),Nu:!1,Qu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function ln(r){let t=r._freezeSettings(),e=hi(r._databaseId);return new Vu(r._databaseId,!!t.ignoreUndefinedProperties,e)}function to(r,t,e,n,i,s={}){let a=r.$u(s.merge||s.mergeFields?2:0,t,e,i);Tc("Data must be an object, but it was:",a,n);let u=Sf(n,a),c,d;if(s.merge)c=new Ot(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let g of s.mergeFields){let _=ii(t,g,e);if(!a.contains(_))throw new x(b.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);bf(f,_)||f.push(_)}c=new Ot(f),d=a.fieldTransforms.filter(g=>c.covers(g.field))}else c=null,d=a.fieldTransforms;return new Pu(new Vt(u),c,d)}var ri=class r extends de{_toFieldTransform(t){if(t.Mu!==2)throw t.Mu===1?t.qu(`${this._methodName}() can only appear at the top level of your update data`):t.qu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};function Ef(r,t,e){return new qs({Mu:3,Ku:t.settings.Ku,methodName:r._methodName,Nu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var xu=class r extends de{_toFieldTransform(t){return new nn(t.path,new xe)}isEqual(t){return t instanceof r}},Cu=class r extends de{constructor(t,e){super(t),this.Uu=e}_toFieldTransform(t){let e=Ef(this,t,!0),n=this.Uu.map(s=>hn(s,e)),i=new ce(n);return new nn(t.path,i)}isEqual(t){return t instanceof r&&Er(this.Uu,t.Uu)}},Du=class r extends de{constructor(t,e){super(t),this.Uu=e}_toFieldTransform(t){let e=Ef(this,t,!0),n=this.Uu.map(s=>hn(s,e)),i=new le(n);return new nn(t.path,i)}isEqual(t){return t instanceof r&&Er(this.Uu,t.Uu)}},Nu=class r extends de{constructor(t,e){super(t),this.Wu=e}_toFieldTransform(t){let e=new Ce(t.serializer,_d(t.serializer,this.Wu));return new nn(t.path,e)}isEqual(t){return t instanceof r&&this.Wu===t.Wu}};function wc(r,t,e,n){let i=r.$u(1,t,e);Tc("Data must be an object, but it was:",i,n);let s=[],a=Vt.empty();qe(n,(c,d)=>{let f=eo(t,c,e);d=vt(d);let g=i.Bu(f);if(d instanceof ri)s.push(f);else{let _=hn(d,g);_!=null&&(s.push(f),a.set(f,_))}});let u=new Ot(s);return new Os(a,u,i.fieldTransforms)}function vc(r,t,e,n,i,s){let a=r.$u(1,t,e),u=[ii(t,n,e)],c=[i];if(s.length%2!=0)throw new x(b.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(ii(t,s[_])),c.push(s[_+1]);let d=[],f=Vt.empty();for(let _=u.length-1;_>=0;--_)if(!bf(d,u[_])){let R=u[_],D=c[_];D=vt(D);let N=a.Bu(R);if(D instanceof ri)d.push(R);else{let V=hn(D,N);V!=null&&(d.push(R),f.set(R,V))}}let g=new Ot(d);return new Os(f,g,a.fieldTransforms)}function Af(r,t,e,n=!1){return hn(e,r.$u(n?4:3,t))}function hn(r,t){if(Rf(r=vt(r)))return Tc("Unsupported field value:",t,r),Sf(r,t);if(r instanceof de)return function(n,i){if(!If(i.Mu))throw i.qu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.qu(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.Nu&&t.Mu!==4)throw t.qu("Nested arrays are not supported");return function(n,i){let s=[],a=0;for(let u of n){let c=hn(u,i.ku(a));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,t)}return function(n,i){if((n=vt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return _d(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=lt.fromDate(n);return{timestampValue:Mn(i.serializer,s)}}if(n instanceof lt){let s=new lt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Mn(i.serializer,s)}}if(n instanceof ni)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof $n)return{bytesValue:bd(i.serializer,n._byteString)};if(n instanceof dt){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.qu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ec(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof Qn)return function(a,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(c=>{if(typeof c!="number")throw u.qu("VectorValues must only contain numeric values.");return tc(u.serializer,c)})}}}}}}(n,i);throw i.qu(`Unsupported field value: ${Zs(n)}`)}(r,t)}function Sf(r,t){let e={};return Yh(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):qe(r,(n,i)=>{let s=hn(i,t.Ou(n));s!=null&&(e[n]=s)}),{mapValue:{fields:e}}}function Rf(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof lt||r instanceof ni||r instanceof $n||r instanceof dt||r instanceof de||r instanceof Qn)}function Tc(r,t,e){if(!Rf(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){let n=Zs(e);throw n==="an object"?t.qu(r+" a custom object"):t.qu(r+" "+n)}}function ii(r,t,e){if((t=vt(t))instanceof he)return t._internalPath;if(typeof t=="string")return eo(r,t);throw Us("Field path arguments must be of type string or ",r,!1,void 0,e)}var dp=new RegExp("[~\\*/\\[\\]]");function eo(r,t,e){if(t.search(dp)>=0)throw Us(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new he(...t.split("."))._internalPath}catch{throw Us(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function Us(r,t,e,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new x(b.INVALID_ARGUMENT,u+r+c)}function bf(r,t){return r.some(e=>e.isEqual(t))}var un=class{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new dt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new ku(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(no("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},ku=class extends un{data(){return super.data()}};function no(r,t){return typeof t=="string"?eo(r,t):t instanceof he?t._internalPath:t._delegate._internalPath}function Pf(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new x(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var si=class{},cn=class extends si{};function Jp(r,t,...e){let n=[];t instanceof si&&n.push(t),n=n.concat(e),function(s){let a=s.filter(c=>c instanceof Wn).length,u=s.filter(c=>c instanceof oi).length;if(a>1||a>0&&u>0)throw new x(b.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var oi=class r extends cn{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return xf(t._query,e),new Et(t.firestore,t.converter,ma(t._query,e))}_parse(t){let e=ln(t.firestore);return function(s,a,u,c,d,f,g){let _;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new x(b.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Lh(g,f);let R=[];for(let D of g)R.push(Mh(c,s,D));_={arrayValue:{values:R}}}else _=Mh(c,s,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Lh(g,f),_=Af(u,a,g,f==="in"||f==="not-in");return W.create(d,f,_)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function Xp(r,t,e){let n=t,i=no("where",r);return oi._create(i,n,e)}var Wn=class r extends si{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:Z.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let a=i,u=s.getFlattenedFilters();for(let c of u)xf(a,c),a=ma(a,c)}(t._query,e),new Et(t.firestore,t.converter,ma(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};function Yp(...r){return r.forEach(t=>Cf("or",t)),Wn._create("or",r)}function Zp(...r){return r.forEach(t=>Cf("and",t)),Wn._create("and",r)}var Fu=class r extends cn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=function(i,s,a){if(i.startAt!==null)throw new x(b.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new x(b.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new tn(s,a)}(t._query,this._field,this._direction);return new Et(t.firestore,t.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new Gt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}};function t_(r,t="asc"){let e=t,n=no("orderBy",r);return Fu._create(n,e)}var Bs=class r extends cn{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new Et(t.firestore,t.converter,rs(t._query,this._limit,this._limitType))}};function e_(r){return yf("limit",r),Bs._create("limit",r,"F")}function n_(r){return yf("limitToLast",r),Bs._create("limitToLast",r,"L")}var Gs=class r extends cn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Vf(t,this.type,this._docOrFields,this._inclusive);return new Et(t.firestore,t.converter,function(i,s){return new Gt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(t._query,e))}};function r_(...r){return Gs._create("startAt",r,!0)}function i_(...r){return Gs._create("startAfter",r,!1)}var zs=class r extends cn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Vf(t,this.type,this._docOrFields,this._inclusive);return new Et(t.firestore,t.converter,function(i,s){return new Gt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(t._query,e))}};function s_(...r){return zs._create("endBefore",r,!1)}function o_(...r){return zs._create("endAt",r,!0)}function Vf(r,t,e,n){if(e[0]=vt(e[0]),e[0]instanceof un)return function(s,a,u,c,d){if(!c)throw new x(b.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let g of Rn(s))if(g.field.isKeyField())f.push(Ze(a,c.key));else{let _=c.data.field(g.field);if(Ks(_))throw new x(b.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let R=g.field.canonicalString();throw new x(b.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${R}' (used as the orderBy) does not exist.`)}f.push(_)}return new Yt(f,d)}(r._query,r.firestore._databaseId,t,e[0]._document,n);{let i=ln(r.firestore);return function(a,u,c,d,f,g){let _=a.explicitOrderBy;if(f.length>_.length)throw new x(b.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let R=[];for(let D=0;D<f.length;D++){let N=f[D];if(_[D].field.isKeyField()){if(typeof N!="string")throw new x(b.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof N}`);if(!Yu(a)&&N.indexOf("/")!==-1)throw new x(b.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${N}' contains a slash.`);let V=a.path.child(J.fromString(N));if(!M.isDocumentKey(V))throw new x(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${V}' is not because it contains an odd number of segments.`);let B=new M(V);R.push(Ze(u,B))}else{let V=Af(c,d,N);R.push(V)}}return new Yt(R,g)}(r._query,r.firestore._databaseId,i,t,e,n)}}function Mh(r,t,e){if(typeof(e=vt(e))=="string"){if(e==="")throw new x(b.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yu(t)&&e.indexOf("/")!==-1)throw new x(b.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(J.fromString(e));if(!M.isDocumentKey(n))throw new x(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Ze(r,new M(n))}if(e instanceof dt)return Ze(r,e._key);throw new x(b.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zs(e)}.`)}function Lh(r,t){if(!Array.isArray(r)||r.length===0)throw new x(b.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function xf(r,t){let e=function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new x(b.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new x(b.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}function Cf(r,t){if(!(t instanceof oi||t instanceof Wn))throw new x(b.INVALID_ARGUMENT,`Function ${r}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}var js=class{convertValue(t,e="none"){switch(Pe(t)){case 0:return null;case 1:return t.booleanValue;case 2:return st(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ue(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw L()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return qe(t,(i,s)=>{n[i]=this.convertValue(s,e)}),n}convertVectorValue(t){var e,n,i;let s=(i=(n=(e=t.fields)===null||e===void 0?void 0:e.value.arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(a=>st(a.doubleValue));return new Qn(s)}convertGeoPoint(t){return new ni(st(t.latitude),st(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=$s(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Or(t));default:return null}}convertTimestamp(t){let e=ae(t);return new lt(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=J.fromString(t);O(Od(n));let i=new Cn(n.get(1),n.get(3)),s=new M(n.popFirst(5));return i.isEqual(e)||ct(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function ro(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var Mu=class extends js{constructor(t){super(),this.firestore=t}convertBytes(t){return new $n(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new dt(this.firestore,null,e)}};function a_(r){return new an("sum",ii("sum",r))}function u_(r){return new an("avg",ii("average",r))}function fp(){return new an("count")}function c_(r,t){var e,n;return r instanceof an&&t instanceof an&&r.aggregateType===t.aggregateType&&((e=r._internalFieldPath)===null||e===void 0?void 0:e.canonicalString())===((n=t._internalFieldPath)===null||n===void 0?void 0:n.canonicalString())}function l_(r,t){return wf(r.query,t.query)&&Er(r.data(),t.data())}var se=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Fe=class extends un{constructor(t,e,n,i,s,a){super(t,e,n,i,a),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Pn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(no("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}},Pn=class extends Fe{data(t={}){return super.data(t)}},Me=class{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new se(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Pn(this._firestore,this._userDataWriter,n.key,n,new se(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new x(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let c=new Pn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new se(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let c=new Pn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new se(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:mp(u.type),doc:c,oldIndex:d,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function mp(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function h_(r,t){return r instanceof Fe&&t instanceof Fe?r._firestore===t._firestore&&r._key.isEqual(t._key)&&(r._document===null?t._document===null:r._document.isEqual(t._document))&&r._converter===t._converter:r instanceof Me&&t instanceof Me&&r._firestore===t._firestore&&wf(r.query,t.query)&&r.metadata.isEqual(t.metadata)&&r._snapshot.isEqual(t._snapshot)}function d_(r){r=Q(r,dt);let t=Q(r.firestore,tt);return gf(ot(t),r._key).then(e=>Ic(t,r,e))}var Zt=class extends js{constructor(t){super(),this.firestore=t}convertBytes(t){return new $n(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new dt(this.firestore,null,e)}};function f_(r){r=Q(r,dt);let t=Q(r.firestore,tt),e=ot(t),n=new Zt(t);return Zg(e,r._key).then(i=>new Fe(t,n,r._key,i,new se(i!==null&&i.hasLocalMutations,!0),r.converter))}function m_(r){r=Q(r,dt);let t=Q(r.firestore,tt);return gf(ot(t),r._key,{source:"server"}).then(e=>Ic(t,r,e))}function g_(r){r=Q(r,Et);let t=Q(r.firestore,tt),e=ot(t),n=new Zt(t);return Pf(r._query),pf(e,r._query).then(i=>new Me(t,n,r,i))}function p_(r){r=Q(r,Et);let t=Q(r.firestore,tt),e=ot(t),n=new Zt(t);return tp(e,r._query).then(i=>new Me(t,n,r,i))}function __(r){r=Q(r,Et);let t=Q(r.firestore,tt),e=ot(t),n=new Zt(t);return pf(e,r._query,{source:"server"}).then(i=>new Me(t,n,r,i))}function y_(r,t,e){r=Q(r,dt);let n=Q(r.firestore,tt),i=ro(r.converter,t,e);return fi(n,[to(ln(n),"setDoc",r._key,i,r.converter!==null,e).toMutation(r._key,ut.none())])}function w_(r,t,e,...n){r=Q(r,dt);let i=Q(r.firestore,tt),s=ln(i),a;return a=typeof(t=vt(t))=="string"||t instanceof he?vc(s,"updateDoc",r._key,t,e,n):wc(s,"updateDoc",r._key,t),fi(i,[a.toMutation(r._key,ut.exists(!0))])}function v_(r){return fi(Q(r.firestore,tt),[new Ne(r._key,ut.none())])}function T_(r,t){let e=Q(r.firestore,tt),n=lp(r),i=ro(r.converter,t);return fi(e,[to(ln(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,ut.exists(!1))]).then(()=>n)}function I_(r,...t){var e,n,i;r=vt(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||Su(t[a])||(s=t[a],a++);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Su(t[a])){let g=t[a];t[a]=(e=g.next)===null||e===void 0?void 0:e.bind(g),t[a+1]=(n=g.error)===null||n===void 0?void 0:n.bind(g),t[a+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let c,d,f;if(r instanceof dt)d=Q(r.firestore,tt),f=Jn(r._key.path),c={next:g=>{t[a]&&t[a](Ic(d,r,g))},error:t[a+1],complete:t[a+2]};else{let g=Q(r,Et);d=Q(g.firestore,tt),f=g._query;let _=new Zt(d);c={next:R=>{t[a]&&t[a](new Me(d,_,g,R))},error:t[a+1],complete:t[a+2]},Pf(r._query)}return function(_,R,D,N){let V=new jn(N),B=new Zr(R,V,D);return _.asyncQueue.enqueueAndForget(async()=>uc(await Kn(_),B)),()=>{V.eu(),_.asyncQueue.enqueueAndForget(async()=>cc(await Kn(_),B))}}(ot(d),f,u,c)}function E_(r,t){return np(ot(r=Q(r,tt)),Su(t)?t:{next:t})}function fi(r,t){return function(n,i){let s=new _t;return n.asyncQueue.enqueueAndForget(async()=>Fg(await _c(n),i,s)),s.promise}(ot(r),t)}function Ic(r,t,e){let n=e.docs.get(t._key),i=new Zt(r);return new Fe(r,i,t._key,n,new se(e.hasPendingWrites,e.fromCache),t.converter)}function A_(r){return gp(r,{count:fp()})}function gp(r,t){let e=Q(r.firestore,tt),n=ot(e),i=Xh(t,(s,a)=>new is(a,s.aggregateType,s._internalFieldPath));return ep(n,r._query,i).then(s=>function(u,c,d){let f=new Zt(u);return new bu(c,f,d)}(e,r,s))}var Lu=class{constructor(t){this.kind="memory",this._onlineComponentProvider=er.provider,t?.garbageCollector?this._offlineComponentProvider=t.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new ti(void 0)}}toJSON(){return{kind:this.kind}}},Ou=class{constructor(t){let e;this.kind="persistent",t?.tabManager?(t.tabManager._initialize(t),e=t.tabManager):(e=pp(void 0),e._initialize(t)),this._onlineComponentProvider=e._onlineComponentProvider,this._offlineComponentProvider=e._offlineComponentProvider}toJSON(){return{kind:this.kind}}},qu=class{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Xs.provider}toJSON(){return{kind:this.kind}}},Uu=class{constructor(t){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new ti(t)}}toJSON(){return{kind:this.kind}}};function S_(){return new qu}function R_(r){return new Uu(r?.cacheSizeBytes)}function b_(r){return new Lu(r)}function P_(r){return new Ou(r)}var Bu=class{constructor(t){this.forceOwnership=t,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=er.provider,this._offlineComponentProvider={build:e=>new ei(e,t?.cacheSizeBytes,this.forceOwnership)}}},Gu=class{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=er.provider,this._offlineComponentProvider={build:e=>new Fs(e,t?.cacheSizeBytes)}}};function pp(r){return new Bu(r?.forceOwnership)}function V_(){return new Gu}var _p={maxAttempts:5};var zu=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=ln(t)}set(t,e,n){this._verifyNotCommitted();let i=Ee(t,this._firestore),s=ro(i.converter,e,n),a=to(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,ut.none())),this}update(t,e,n,...i){this._verifyNotCommitted();let s=Ee(t,this._firestore),a;return a=typeof(e=vt(e))=="string"||e instanceof he?vc(this._dataReader,"WriteBatch.update",s._key,e,n,i):wc(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(a.toMutation(s._key,ut.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Ee(t,this._firestore);return this._mutations=this._mutations.concat(new Ne(e._key,ut.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new x(b.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ee(r,t){if((r=vt(r)).firestore!==t)throw new x(b.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var ju=class extends class{constructor(e,n){this._firestore=e,this._transaction=n,this._dataReader=ln(e)}get(e){let n=Ee(e,this._firestore),i=new Mu(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return L();let a=s[0];if(a.isFoundDocument())return new un(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new un(this._firestore,i,n._key,null,n.converter);throw L()})}set(e,n,i){let s=Ee(e,this._firestore),a=ro(s.converter,n,i),u=to(this._dataReader,"Transaction.set",s._key,a,s.converter!==null,i);return this._transaction.set(s._key,u),this}update(e,n,i,...s){let a=Ee(e,this._firestore),u;return u=typeof(n=vt(n))=="string"||n instanceof he?vc(this._dataReader,"Transaction.update",a._key,n,i,s):wc(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(e){let n=Ee(e,this._firestore);return this._transaction.delete(n._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=Ee(t,this._firestore),n=new Zt(this._firestore);return super.get(t).then(i=>new Fe(this._firestore,n,e._key,i._document,new se(!1,!1),e.converter))}};function C_(r,t,e){r=Q(r,tt);let n=Object.assign(Object.assign({},_p),e);return function(s){if(s.maxAttempts<1)throw new x(b.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){let c=new _t;return s.asyncQueue.enqueueAndForget(async()=>{let d=await mf(s);new Eu(s.asyncQueue,d,u,a,c).cu()}),c.promise}(ot(r),i=>t(new ju(r,i)),n)}function D_(){return new ri("deleteField")}function N_(){return new xu("serverTimestamp")}function k_(...r){return new Cu("arrayUnion",r)}function F_(...r){return new Du("arrayRemove",r)}function M_(r){return new Nu("increment",r)}function L_(r){return new Qn(r)}function O_(r){return ot(r=Q(r,tt)),new zu(r,t=>fi(r,t))}function q_(r,t){let e=ot(r=Q(r,tt));if(!e._uninitializedComponentsProvider||e._uninitializedComponentsProvider._offline.kind==="memory")return qt("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(s){let a=typeof s=="string"?function(d){try{return JSON.parse(d)}catch(f){throw new x(b.INVALID_ARGUMENT,"Failed to parse JSON: "+f?.message)}}(s):s,u=[];if(Array.isArray(a.indexes))for(let c of a.indexes){let d=Oh(c,"collectionGroup"),f=[];if(Array.isArray(c.fields))for(let g of c.fields){let _=eo("setIndexConfiguration",Oh(g,"fieldPath"));g.arrayConfig==="CONTAINS"?f.push(new oe(_,2)):g.order==="ASCENDING"?f.push(new oe(_,0)):g.order==="DESCENDING"&&f.push(new oe(_,1))}u.push(new Re(Re.UNKNOWN_ID,d,f,xn.empty()))}return u}(t);return sp(e,n)}function Oh(r,t){if(typeof r[t]!="string")throw new x(b.INVALID_ARGUMENT,"Missing string value for: "+t);return r[t]}var Ku=class{constructor(t){this._firestore=t,this.type="PersistentCacheIndexManager"}};function U_(r){var t;r=Q(r,tt);let e=qh.get(r);if(e)return e;if(((t=ot(r)._uninitializedComponentsProvider)===null||t===void 0?void 0:t._offline.kind)!=="persistent")return null;let n=new Ku(r);return qh.set(r,n),n}function B_(r){Df(r,!0)}function G_(r){Df(r,!1)}function z_(r){ap(ot(r._firestore)).then(t=>C("deleting all persistent cache indexes succeeded")).catch(t=>qt("deleting all persistent cache indexes failed",t))}function Df(r,t){op(ot(r._firestore),t).then(e=>C(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>qt(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}var qh=new WeakMap;function j_(r){var t;let e=(t=ot(Q(r.firestore,tt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return e===void 0?null:Ws(e,Ct(r._query)).ct}function K_(r,t){var e;let n=Xh(t,(s,a)=>new is(a,s.aggregateType,s._internalFieldPath)),i=(e=ot(Q(r.firestore,tt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return i===void 0?null:kd(i,ud(r._query),n,!0).request}var Uh=class{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(t){return $u.instance.onExistenceFilterMismatch(t)}},$u=class r{constructor(){this.Gu=new Map}static get instance(){return Oi||(Oi=new r,function(e){if(ss)throw new Error("a TestingHooksSpi instance is already set");ss=e}(Oi)),Oi}tt(t){this.Gu.forEach(e=>e(t))}onExistenceFilterMismatch(t){let e=Symbol(),n=this.Gu;return n.set(e,t),()=>n.delete(e)}},Oi=null;(function(t,e=!0){(function(i){Hn=i})(Dl),xl(new Pl("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),u=new tt(new $o(n.getProvider("auth-internal")),new Ho(n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new x(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Cn(d.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:e},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),Do(Ml,"4.7.5",t),Do(Ml,"4.7.5","esm2017")})();export{Pp as a,qt as b,Vp as c,x as d,jo as e,Ll as f,Qi as g,lt as h,yt as i,M as j,Cp as k,ft as l,Cn as m,up as n,Q as o,cp as p,Et as q,dt as r,Jt as s,kp as t,Fp as u,lp as v,Mp as w,wf as x,Ru as y,Lp as z,tt as A,Op as B,qp as C,ot as D,Up as E,Bp as F,Gp as G,zp as H,jp as I,Kp as J,$p as K,Qp as L,Wp as M,an as N,bu as O,$n as P,he as Q,Hp as R,de as S,ni as T,Qn as U,cn as V,Jp as W,oi as X,Xp as Y,Wn as Z,Yp as _,Zp as $,Fu as aa,t_ as ba,Bs as ca,e_ as da,n_ as ea,Gs as fa,r_ as ga,i_ as ha,zs as ia,s_ as ja,o_ as ka,js as la,a_ as ma,u_ as na,fp as oa,c_ as pa,l_ as qa,se as ra,Fe as sa,Pn as ta,Me as ua,h_ as va,d_ as wa,f_ as xa,m_ as ya,g_ as za,p_ as Aa,__ as Ba,y_ as Ca,w_ as Da,v_ as Ea,T_ as Fa,I_ as Ga,E_ as Ha,fi as Ia,A_ as Ja,gp as Ka,S_ as La,R_ as Ma,b_ as Na,P_ as Oa,pp as Pa,V_ as Qa,zu as Ra,ju as Sa,C_ as Ta,D_ as Ua,N_ as Va,k_ as Wa,F_ as Xa,M_ as Ya,L_ as Za,O_ as _a,q_ as $a,Ku as ab,U_ as bb,B_ as cb,G_ as db,z_ as eb,j_ as fb,K_ as gb,Uh as hb};
