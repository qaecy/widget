import{a as b}from"./chunk-22TYSVVA.js";import{O as n,S as i,Ta as a,bc as d,cc as F,ec as C}from"./chunk-SUJ2ERSS.js";import{Da as Z,N as H,ea as M,ja as B,ka as W,l as R,sa as V,v as k}from"./chunk-GSV7GFVO.js";import{Ca as O,Ga as $,W as q,Y as J,t as T,v as _,wa as A,za as Y}from"./chunk-QWYGOFBQ.js";import{d as K}from"./chunk-VNCJOYNM.js";import{O as G}from"./chunk-36JE2O54.js";import{a as m}from"./chunk-DAQOROHW.js";var N=function(e){return e.AUTH_USER_INPUT_NEEDED="'Your setup requires input from the user either because one than one SSO provider is set or because user/pw is required. User input is therefore needed'",e.CHAT_SESSION_CREATED="A new chat session was created",e.CREATING_CHAT_SESSION="Creating chat session...",e.LAST_VISIT_SET="Last visit updated",e.NO_FILES_NO_SYNC_RIGHTS="The project has no files and you do not have sync rights. Therefore, there is nothing to search. Please reach out to a project admin.",e.ORGANIZATIONS_NONE="The user is not assosiated with an organization.",e.ORGANIZATIONS_SINGLE="The user is assosiated with exactly one organization.",e.ORGANIZATIONS_MULTIPLE="The user is assosiated with more than one organization.",e.PROJECT_HAS_DATA="Received project data",e.PROJECT_NO_DATA="No data found for the specified project",e}(N||{});var u=function(e){return e.AGENT_API_NOT_AVAILABLE="The agent API is offline",e.AGENT_API_NOT_CALLABLE="The agent API was not callable",e.FIREBASE_NOT_INITIALIZED="Firebase has not been initialized",e.MISSING_CONFIG='"Please provide config using init() method!"',e.MISSING_PROJECT_DATA="Project data is not available",e.MISSING_PROJECT_ID='No project id is defined. Please specify using the "pid" attribute',e.MISSING_USER_ID="User id is not available.",e.ORG_NO_ADMINS_SELECTED="An organization must have at least one admin",e.ORG_NO_MEMBERS_SELECTED="An organization must have at least one member",e.PROJ_NO_ADMINS_SELECTED="A project must have at least one admin",e.PROJ_NO_MEMBERS_SELECTED="A project must have at least one member",e}(u||{});var Q=class{id;name;created=new Date().toISOString();admins=[];members=[];alternativeIDs=[];constructor(h=b(),t="ABC"){this.id=h,this.name=t,this.alternativeIDs=[h]}},X=class{organizationID;id;name;created=new Date().toISOString();lastSync=null;isPublic=!1;members=[];syncers=[];admins=[];alternativeIDs=[];syncDetails={};constructor(h,t=b(),r="ABC"){this.organizationID=h,this.id=t,this.name=r,this.alternativeIDs=[t]}},P=class{id;projectId;userId;created=new Date().toISOString();updated=new Date().toISOString();constructor(h=b(),t,r){this.id=h,this.projectId=t,this.userId=r}};var ee=class extends P{entries=[]};var y=class{auth=new U;menuAlwaysVisible=!1;menuOptions=[j.ASSISTANT,j.SYNC_OVERVIEW,j.SIGN_OUT];hostApp=te.SHAREPOINT;config},U=class{providers=[S.MICROSOFT];persistence=g.LOCAL},j=function(e){return e.ASSISTANT="ASSISTANT",e.SYNC_OVERVIEW="SYNC_OVERVIEW",e.SIGN_OUT="SIGN_OUT",e}(j||{}),S=function(e){return e.GOOGLE="GOOGLE",e.MICROSOFT="microsoft.com",e.USER_PW="USER_PW",e.NO_AUTH="NO_AUTH",e}(S||{}),g=function(e){return e.LOCAL="LOCAL",e.SESSION="SESSION",e.NONE="NONE",e}(g||{}),te=function(e){return e.SHAREPOINT="SharePoint",e.QAECY="QAECY",e}(te||{});var I=(()=>{class e{_auth;_persistence=g.NONE;_user=a(void 0);_selectedProvider=a(void 0);constructor(){this._auth=Z(G()),this._auth.onAuthStateChanged(t=>{t?this._user.update(()=>Object.assign({},t)):this._user.update(()=>{})})}get user(){return this._user}async setPersistence(t){if(this._persistence!==t){switch(this._persistence=t,t){case g.LOCAL:await this._auth.setPersistence(B);break;case g.SESSION:await this._auth.setPersistence(W);break;case g.NONE:await this._auth.setPersistence(R);break;default:await this._auth.setPersistence(R)}console.info(`New persistence setting: ${t}`)}}set providers(t){if(t.length===1){let r=t[0];r!==S.USER_PW&&r!==S.NO_AUTH&&this._selectedProvider.set(t[0])}}set selectedProvider(t){this._selectedProvider.set(t),this._user()===void 0&&this.getUserOrRequestSignIn()}async signOut(){await M(this._auth)}async getUserOrRequestSignIn(){let t=this._auth.currentUser,r=this._selectedProvider();if(!t)if(r!==void 0){let s=new k(r);t=(await V(this._auth,s)).user}else console.info(N.AUTH_USER_INPUT_NEEDED);return t}async userPWSignIn(t,r){return(await H(this._auth,t,r)).user}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var x="qaecy-mvp-406413";var re="spaces_chats_eu_west6",se="spaces_raw_eu_west6",oe="spaces_processed_eu_west6",ie="europe-west6",ne="chatSessions",ae="organizations",ce="projects",ue="users",fe="userTermsAcceptance",de="acceptTerms",pe="https://accessors-api-gateway-ueyeemwf2a-oa.a.run.app",he="http://localhost:8093",We="assistant/chat-session",Ve="assistant/wake-up",Ze="https://www.qaecy.com/termsofuse",L="567369dcf855a9c0330ea01cc0f98fab";var p=(()=>{class e{_app;_auth;_functionAcceptTerms;_storageProcessed;_storageRaw;_storageChatSessions;_collectionChatSessions;_collectionOrganizations;_collectionProjects;_collectionUsers;_collectionUserTermsAcceptance;_ready=a(!1);_usingEmulators=a(!1);get app(){return this._app}get usingEmulators(){return this._usingEmulators}get functionAcceptTerms(){return this._functionAcceptTerms}get storageProcessed(){return this._storageProcessed}get storageRaw(){return this._storageRaw}get storageChatSessions(){return this._storageChatSessions}get collectionChatSessions(){return this._collectionChatSessions}get collectionOrganizations(){return this._collectionOrganizations}get collectionProjects(){return this._collectionProjects}get collectionUsers(){return this._collectionUsers}get collectionUserTermsAcceptance(){return this._collectionUserTermsAcceptance}get ready(){return this._ready}async init(t){let{initializeApp:r}=await import("./chunk-ZICKP5DU.js"),{connectAuthEmulator:s,getAuth:o}=await import("./chunk-SLAVO63I.js"),{connectFirestoreEmulator:c,getFirestore:f}=await import("./chunk-UCUTNQLC.js"),{connectFunctionsEmulator:w,getFunctions:we}=await import("./chunk-SOGWAEGZ.js"),{connectStorageEmulator:D,getStorage:v}=await import("./chunk-KLWV5IKU.js"),Ne=Object.assign(t,{authDomain:`${x}.firebaseapp.com`,projectId:x,messagingSenderId:"734737865998"}),E=r(Ne),z=we(E,ie);this._functionAcceptTerms=K(z,de),this._storageProcessed=v(E,oe),this._storageRaw=v(E,se),this._storageChatSessions=v(E,re),this._collectionChatSessions=T(f(),ne),this._collectionOrganizations=T(f(),ae),this._collectionProjects=T(f(),ce),this._collectionUsers=T(f(),ue),this._collectionUserTermsAcceptance=T(f(),fe),this._auth=o(E),t.useEmulator&&(s(this._auth,"http://localhost:9099"),c(f(E),"localhost",8080),w(z,"localhost",5001),D(this._storageProcessed,"localhost",9199),D(this._storageRaw,"localhost",9199),D(this._storageChatSessions,"localhost",9199),console.info("Firebase emulators attached")),this._usingEmulators.set(t.useEmulator),this._app=E,this._ready.set(!0)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var le=(()=>{class e{_firebase=i(p);_collection=this._firebase.collectionProjects;async getProjectData(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,t);try{return(await A(r)).data()}catch(s){console.warn(s);return}}async createProjectIfNotExists(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,t.id);try{await O(r,m({},t))}catch(s){console.warn(s)}}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var _e=(()=>{class e{_repo=i(le);_projectId=a(void 0);_projectData=a(void 0);hostInfo=a(void 0);set projectId(t){t!==this._projectId()&&(this._projectId.set(t),this._fetchProjectData())}get projectData(){return this._projectData}async createProject(t){await this._repo.createProjectIfNotExists(t),await this._fetchProjectData()}async _fetchProjectData(){let t=this._projectId();if(t===void 0)throw new Error("Project not set");let r=await this._repo.getProjectData(t);r===void 0?this._projectData.set(null):this._projectData.update(()=>Object.assign({},r))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var me=(()=>{class e{_firebase=i(p);_collection=this._firebase.collectionOrganizations;async getUserOrganizations(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);try{let r=[];for(let s of t){let c=(await Y(q(this._collection,J("members","array-contains",s)))).docs.map(f=>f.data());if(c.length){r=c;break}}return r}catch(r){return console.warn(r),[]}}async createOrganizationIfNotExists(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,t.id);try{let s=await A(r);if(console.log("AA"),s.exists())return;let o=await O(r,m({},t));console.log(o)}catch(s){console.warn(s)}}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Ie=(()=>{class e{_firebase=i(p);_collection=this._firebase.collectionUsers;async getUserData(t,r=!0){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let s=_(this._collection,t),c=(await A(s)).data();return r&&c!==void 0&&this._setLastVisit(c),c}async _setLastVisit(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,t.id);t.lastVisit=new Date().toISOString(),await O(r,m({},t)),console.info(N.LAST_VISIT_SET)}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Ee=(e,h)=>e===h?!0:e===void 0||h===void 0||e.length!==h.length?!1:e.every((t,r)=>t===h[r]);var Se=(()=>{class e{_repo=i(Ie);_auth=i(I);_organizationRepo=i(me);organizations=a(void 0,{equal:(t,r)=>t!==void 0&&r!==void 0&&Ee(t,r)});_userData=a(void 0);isOrgAdmin=a(!1);_userIds=a([]);onUserChange=C(async()=>{if(this._auth.user()===void 0){this.organizations.update(()=>{});return}this.fetchUserOrganizations(),this._fetchUserData()});get userIds(){return this._userIds}get userData(){return this._userData}async fetchUserOrganizations(){let t=this._auth.user();if(t===void 0)throw new Error("Can't fetch organizations when user is not signed in");let r=t.providerData.map(c=>c.uid),s=[t.uid,...r];if(t===void 0)throw new Error("User not set");let o=await this._organizationRepo.getUserOrganizations(s);this._userIds.set(s),this.organizations.update(()=>[...o])}async _fetchUserData(){let t=this._auth.user();if(t===void 0)throw new Error("Can't fetch user data when user is not signed in");let r=await this._repo.getUserData(t.uid);this._userData.update(()=>Object.assign({},r))}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var ge=(()=>{class e{options=a(new y);static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Te=(()=>{class e{_firebase=i(p);_collection=this._firebase.collectionUserTermsAcceptance;_termsAcceptanceData=a(void 0);get termsAcceptanceData(){return this._termsAcceptanceData}subscribeToUserTermsAcceptance(t){if(this._collection===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let r=_(this._collection,t);return $(r,async s=>{if(s.exists()){let o=s.data();this._termsAcceptanceData.update(()=>Object.assign({},o))}})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Ae=(()=>{class e{_firebase=i(p);_auth=i(I);_repo=i(Te);userHasAcceptedTerms=d(()=>this._repo.termsAcceptanceData()!==void 0);userHasAcceptedOutdatedTerms=d(()=>{let t=this._repo.termsAcceptanceData();return t===void 0?!1:t.documentHash!==L});subscribeToUserTermsAcceptanceOnUserChange=C(async()=>{let t=this._auth.user();t!==void 0&&this._repo.subscribeToUserTermsAcceptance(t.uid)});async setTermsAndConditionsAccept(){let t=this._firebase.functionAcceptTerms;if(t===void 0)throw new Error(u.FIREBASE_NOT_INITIALIZED);let s=await(await fetch("https://api.ipify.org?format=json")).json();await t({documentHash:L,ip:s.ip})}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Oe=(()=>{class e{_auth=i(I);_firebase=i(p);_baseURL=d(()=>this._firebase.usingEmulators()?he:pe);_token=d(()=>this._auth.user()?.accessToken);async sendAuthenticatedRequest(t,r,s,o={}){let c={"Content-Type":"application/json"};if(this._token()===void 0)throw new Error("Token not available");c.Authorization=`Bearer ${this._token()}`,o.method=r,o.headers=o.headers===void 0?c:m(m({},o.headers),c),s!==void 0&&(o.body=JSON.stringify(s)),r!=="POST"&&delete o.body;let f=`${this._baseURL()}/${t}`,w=await fetch(f,o);if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);return w}pingRoute=async(t,r=5e3)=>{let s=`${this._baseURL()}/${t}`;try{let o=new AbortController,c=setTimeout(()=>o.abort(),r);if(this._token()===void 0)throw new Error("Token not available");let f={Authorization:`Bearer ${this._token()}`};return await fetch(s,{signal:o.signal,headers:f}),clearTimeout(c),!0}catch(o){return o.name==="AbortError"?console.error("Request timed out"):console.error("Server is offline or unreachable"),!1}};static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var lr=(()=>{class e{_optionsService=i(ge);_auth=i(I);_gateway=i(Oe);_user=i(Se);_terms=i(Ae);_project=i(_e);view=a("sync");_selectedOrganization=F(()=>{let t=this._user.organizations();if(!(t===void 0||!t.length)&&t.length===1)return t[0]});_userIsOrgAdmin=d(()=>{let t=this._selectedOrganization();return t===void 0?!1:this._isCurrentUserOrgAdmin(t)});_userCanSync=d(()=>{let t=this._project.projectData();return!t||t===void 0?!1:this._isCurrentUserSyncer(t)});authDisabled=d(()=>this._optionsService.options().auth.providers.length===1&&this._optionsService.options().auth.providers[0]===S.NO_AUTH);userOrganizations=this._user.organizations;projectData=this._project.projectData;projectExists=d(()=>this.projectData()!==null);userHasOrgs=d(()=>{let t=this.userOrganizations();return!(t===void 0||t.length===0)});userHasAgreedToTerms=this._terms.userHasAcceptedTerms;userHasAgreedToOutdatedTerms=this._terms.userHasAcceptedOutdatedTerms;set options(t){this._optionsService.options.set(t),this._auth.providers=t.auth.providers,this._auth.setPersistence(t.auth.persistence).then(()=>{this._auth.getUserOrRequestSignIn()}).catch(r=>{console.error(r)})}get options(){return this._optionsService.options}get user(){return this._auth.user}set projectId(t){this._project.projectId=t}get selectedOrganization(){return this._selectedOrganization}set selectedOrganization(t){this._selectedOrganization.set(t)}get userIsOrgAdmin(){return this._userIsOrgAdmin}get userCanSync(){return this._userCanSync}_isCurrentUserOrgAdmin(t){let r=this._user.userIds(),s=!1;for(let o of r)if(t.admins.includes(o)){s=!0;break}return s}_isCurrentUserSyncer(t){let r=this._user.userIds(),s=!1;for(let o of r)if(t.syncers.includes(o)||t.admins.includes(o)){s=!0;break}return s}static \u0275fac=function(r){return new(r||e)};static \u0275prov=n({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();export{Q as a,X as b,ee as c,y as d,j as e,S as f,N as g,I as h,We as i,Ve as j,Ze as k,p as l,u as m,_e as n,me as o,Se as p,ge as q,Ae as r,Oe as s,lr as t};
