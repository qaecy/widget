import{a as w}from"./chunk-22TYSVVA.js";import{O as n,S as o,Ta as i,dc as d,ec as N,gc as j}from"./chunk-I7ZHWVYA.js";import{$ as V,Da as $,N as W,ea as q,ja as J,ka as Y,l as y,sa as K,v as Z}from"./chunk-GSV7GFVO.js";import{Ca as O,Ga as A,W as P,Y as v,t as I,v as u,wa as S,za as Q}from"./chunk-QWYGOFBQ.js";import{d as X}from"./chunk-VNCJOYNM.js";import{O as M}from"./chunk-36JE2O54.js";import{a as T}from"./chunk-DAQOROHW.js";var C=function(t){return t.AUTH_USER_INPUT_NEEDED="'Your setup requires input from the user either because one than one SSO provider is set or because user/pw is required. User input is therefore needed'",t.CHAT_SESSION_CREATED="A new chat session was created",t.CREATING_CHAT_SESSION="Creating chat session...",t.LAST_VISIT_SET="Last visit updated",t.NO_FILES_NO_SYNC_RIGHTS="The project has no files and you do not have sync rights. Therefore, there is nothing to search. Please reach out to a project admin.",t.ORGANIZATIONS_NONE="The user is not assosiated with an organization.",t.ORGANIZATIONS_SINGLE="The user is assosiated with exactly one organization.",t.ORGANIZATIONS_MULTIPLE="The user is assosiated with more than one organization.",t.PROJECT_HAS_DATA="Received project data",t.PROJECT_NO_DATA="No data found for the specified project",t}(C||{});var L="qaecy-mvp-406413";var ee="spaces_chats_eu_west6",te="spaces_raw_eu_west6",se="spaces_processed_eu_west6",re="europe-west6",oe="chatSessions",ie="organizations",ne="projects",ae="users",ce="userTermsAcceptance",ue="tiers",_e="acceptTerms",je="https://accessors-api-gateway-ueyeemwf2a-oa.a.run.app",De="http://localhost:8093",Re="assistant/chat-session",xe="assistant/wake-up",Ue="https://www.qaecy.com/termsofuse",z="567369dcf855a9c0330ea01cc0f98fab";var ye={free:1,unlimited:2};var a=function(t){return t.AGENT_API_NOT_AVAILABLE="The agent API is offline",t.AGENT_API_NOT_CALLABLE="The agent API was not callable",t.FIREBASE_NOT_INITIALIZED="Firebase has not been initialized",t.MISSING_CONFIG='"Please provide config using init() method!"',t.MISSING_PROJECT_DATA="Project data is not available",t.MISSING_PROJECT_ID='No project id is defined. Please specify using the "pid" attribute',t.MISSING_USER_ID="User id is not available.",t.ORG_NO_ADMINS_SELECTED="An organization must have at least one admin",t.ORG_NO_MEMBERS_SELECTED="An organization must have at least one member",t.PROJ_NO_ADMINS_SELECTED="A project must have at least one admin",t.PROJ_NO_MEMBERS_SELECTED="A project must have at least one member",t}(a||{});var pe=class{id;name;created=new Date().toISOString();admins=[];members=[];alternativeIDs=[];constructor(h=w(),e="ABC"){this.id=h,this.name=e,this.alternativeIDs=[h]}},de=class{organizationID;id;name;created=new Date().toISOString();lastSync=null;isPublic=!1;members=[];syncers=[];admins=[];alternativeIDs=[];syncDetails={};constructor(h,e=w(),s="ABC"){this.organizationID=h,this.id=e,this.name=s,this.alternativeIDs=[e]}},F=class{id;projectId;userId;created=new Date().toISOString();updated=new Date().toISOString();constructor(h=w(),e,s){this.id=h,this.projectId=e,this.userId=s}};var he=class extends F{entries=[]},k=class{prompt;id;responseText="";created=new Date().toISOString();updated=new Date().toISOString();finished=!1;error="";chunkCount=0;constructor(h,e=w()){this.prompt=h,this.id=e}};var fe=class extends k{context={};promptHTML=""};var R=class{auth=new B;menuAlwaysVisible=!1;menuOptions=[D.ASSISTANT,D.SYNC_OVERVIEW,D.SIGN_OUT];hostApp=le.SHAREPOINT;config;fab=new G},B=class{providers=[g.MICROSOFT];persistence=E.LOCAL},D=function(t){return t.ASSISTANT="ASSISTANT",t.SYNC_OVERVIEW="SYNC_OVERVIEW",t.SIGN_OUT="SIGN_OUT",t}(D||{}),g=function(t){return t.GOOGLE="GOOGLE",t.MICROSOFT="microsoft.com",t.USER_PW="USER_PW",t.NO_AUTH="NO_AUTH",t}(g||{}),E=function(t){return t.LOCAL="LOCAL",t.SESSION="SESSION",t.NONE="NONE",t}(E||{}),le=function(t){return t.SHAREPOINT="SharePoint",t.QAECY="QAECY",t}(le||{}),G=class{borderRadius="1rem";chatWidth="300px";chatHeight="70vh"};var b=(()=>{class t{_auth;_persistence=E.NONE;_user=i(void 0);_selectedProvider=i(void 0);_token=i(void 0);_tokenRefreshUnsubscribe;userIds=d(()=>{let e=this._user();if(e===void 0)return[];let s=[e.uid];return e.providerData.forEach(r=>s.push(r.uid)),s});constructor(){this._auth=$(M()),this._auth.onAuthStateChanged(e=>{if(e)this._user.update(()=>Object.assign({},e)),this._subscribeToTokenChanges();else{this._user.update(()=>{}),this._token.set(void 0);let s=this._tokenRefreshUnsubscribe;s!==void 0&&s()}})}get user(){return this._user}get token(){return this._token}async setPersistence(e){if(this._persistence!==e){switch(this._persistence=e,e){case E.LOCAL:await this._auth.setPersistence(J);break;case E.SESSION:await this._auth.setPersistence(Y);break;case E.NONE:await this._auth.setPersistence(y);break;default:await this._auth.setPersistence(y)}console.info(`New persistence setting: ${e}`)}}set providers(e){if(e.length===1){let s=e[0];s!==g.USER_PW&&s!==g.NO_AUTH&&this._selectedProvider.set(e[0])}}set selectedProvider(e){this._selectedProvider.set(e),this._user()===void 0&&this.getUserOrRequestSignIn()}async signOut(){await q(this._auth)}async getUserOrRequestSignIn(){let e=this._auth.currentUser,s=this._selectedProvider();if(!e)if(s!==void 0){let r=new Z(s);e=(await K(this._auth,r)).user}else console.info(C.AUTH_USER_INPUT_NEEDED);return e}async userPWSignIn(e,s){return(await W(this._auth,e,s)).user}_subscribeToTokenChanges(){this._tokenRefreshUnsubscribe=V(this._auth,async e=>{if(e){let s=await e.getIdToken();this._token.set(s),console.log("Token refreshed")}})}static \u0275fac=function(s){return new(s||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var p=(()=>{class t{_app;_auth;_functionAcceptTerms;_storageProcessed;_storageRaw;_storageChatSessions;_collectionChatSessions;_collectionOrganizations;_collectionProjects;_collectionUsers;_collectionUserTermsAcceptance;_collectionTiers;_ready=i(!1);_usingEmulators=i(!1);get app(){return this._app}get usingEmulators(){return this._usingEmulators}get functionAcceptTerms(){return this._functionAcceptTerms}get storageProcessed(){return this._storageProcessed}get storageRaw(){return this._storageRaw}get storageChatSessions(){return this._storageChatSessions}get collectionChatSessions(){return this._collectionChatSessions}get collectionOrganizations(){return this._collectionOrganizations}get collectionProjects(){return this._collectionProjects}get collectionUsers(){return this._collectionUsers}get collectionUserTermsAcceptance(){return this._collectionUserTermsAcceptance}get collectionTiers(){return this._collectionTiers}get ready(){return this._ready}async init(e){let{initializeApp:s}=await import("./chunk-ZICKP5DU.js"),{connectAuthEmulator:r,getAuth:c}=await import("./chunk-SLAVO63I.js"),{connectFirestoreEmulator:f,getFirestore:l}=await import("./chunk-UCUTNQLC.js"),{connectFunctionsEmulator:be,getFunctions:Ne}=await import("./chunk-SOGWAEGZ.js"),{connectStorageEmulator:x,getStorage:U}=await import("./chunk-KLWV5IKU.js"),we=Object.assign(e,{authDomain:`${L}.firebaseapp.com`,projectId:L,messagingSenderId:"734737865998"}),m=s(we),H=Ne(m,re);this._functionAcceptTerms=X(H,_e),this._storageProcessed=U(m,se),this._storageRaw=U(m,te),this._storageChatSessions=U(m,ee),this._collectionChatSessions=I(l(),oe),this._collectionOrganizations=I(l(),ie),this._collectionProjects=I(l(),ne),this._collectionUsers=I(l(),ae),this._collectionUserTermsAcceptance=I(l(),ce),this._collectionTiers=I(l(),ue),this._auth=c(m),e.useEmulator&&(r(this._auth,"http://localhost:9099"),f(l(m),"localhost",8080),be(H,"localhost",5001),x(this._storageProcessed,"localhost",9199),x(this._storageRaw,"localhost",9199),x(this._storageChatSessions,"localhost",9199),console.info("Firebase emulators attached")),this._usingEmulators.set(e.useEmulator),this._app=m,this._ready.set(!0)}static \u0275fac=function(s){return new(s||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var me=(()=>{class t{_firebase=o(p);_collection=this._firebase.collectionProjects;_projectData=i(void 0);_projectDataUnsubscribe;get projectData(){return this._projectData}destroy(){this._unsubscribe(this._projectDataUnsubscribe)}subscribeToProjectData(e){if(this._collection===void 0)throw new Error(a.FIREBASE_NOT_INITIALIZED);let s=u(this._collection,e);this._projectDataUnsubscribe=A(s,async r=>{if(r.exists()){let c=r.data();this._projectData.update(()=>Object.assign({},c))}})}async projectExists(e){if(this._collection===void 0)throw new Error(a.FIREBASE_NOT_INITIALIZED);let s=u(this._collection,e);return(await S(s)).exists()}async createProjectIfNotExists(e){if(this._collection===void 0)throw new Error(a.FIREBASE_NOT_INITIALIZED);let s=u(this._collection,e.id);try{await O(s,T({},e))}catch(r){console.warn(r)}}_unsubscribe(e){e!==void 0&&e()}static \u0275fac=function(s){return new(s||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Ie=(()=>{class t{_repo=o(me);_projectId=i(void 0);hostInfo=i(void 0);projectData=this._repo.projectData;async projectExists(e){return this._repo.projectExists(e)}setProjectId(e){this._projectId.set(e),e!==void 0&&this._repo.subscribeToProjectData(e)}async createProject(e){await this._repo.createProjectIfNotExists(e),this._repo.subscribeToProjectData(e.id)}static \u0275fac=function(s){return new(s||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var ge=(()=>{class t{_firebase=o(p);_collection=this._firebase.collectionOrganizations;_userOrganizations=i(void 0);_userOrganizationsUnsubscribe;get userOrganizations(){return this._userOrganizations}destroy(){this._unsubscribe(this._userOrganizationsUnsubscribe)}subscribeToUserOrganizations(e){if(this._collection===void 0)throw new Error(a.FIREBASE_NOT_INITIALIZED);let s=P(this._collection,v("members","array-contains-any",e));this._userOrganizationsUnsubscribe=A(s,async r=>{let c=r.docs.map(f=>f.data());this._userOrganizations.update(()=>[...c])})}async userBelongsToAnOrganization(e){if(this._collection===void 0)throw new Error(a.FIREBASE_NOT_INITIALIZED);let s=P(this._collection,v("members","array-contains-any",e));return!(await Q(s)).empty}async createOrganizationIfNotExists(e){if(this._collection===void 0)throw new Error(a.FIREBASE_NOT_INITIALIZED);let s=u(this._collection,e.id);try{if((await S(s)).exists())return;await O(s,T({},e))}catch(r){console.warn(r)}}_unsubscribe(e){e!==void 0&&e()}static \u0275fac=function(s){return new(s||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Ee=(()=>{class t{_firebase=o(p);_collection=this._firebase.collectionUsers;async getUserData(e,s=!0){if(this._collection===void 0)throw new Error(a.FIREBASE_NOT_INITIALIZED);let r=u(this._collection,e),f=(await S(r)).data();return s&&f!==void 0&&this._setLastVisit(f),f}async _setLastVisit(e){if(this._collection===void 0)throw new Error(a.FIREBASE_NOT_INITIALIZED);let s=u(this._collection,e.id);e.lastVisit=new Date().toISOString(),await O(s,T({},e)),console.info(C.LAST_VISIT_SET)}static \u0275fac=function(s){return new(s||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Te=(()=>{class t{_repo=o(Ee);_auth=o(b);_organizationRepo=o(ge);userOrganizations=this._organizationRepo.userOrganizations;_userBelongsToAnOrganization=N(()=>{let e=this.userOrganizations();if(e!==void 0)return e.length>0});_userData=i(void 0);isOrgAdmin=i(!1);onUserChange=j(async()=>{let e=this._auth.userIds();e.length&&(this._organizationRepo.subscribeToUserOrganizations(e),this._organizationRepo.userBelongsToAnOrganization(e).then(s=>this._userBelongsToAnOrganization.set(s)),this._fetchUserData())});get userBelongsToAnOrganization(){return this._userBelongsToAnOrganization}get userIds(){return this._auth.userIds}get userData(){return this._userData}async _fetchUserData(){let e=this._auth.user();if(e===void 0)throw new Error("Can't fetch user data when user is not signed in");let s=await this._repo.getUserData(e.uid);this._userData.update(()=>Object.assign({},s))}static \u0275fac=function(s){return new(s||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Se=(()=>{class t{options=i(new R);static \u0275fac=function(s){return new(s||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Oe=(()=>{class t{_firebase=o(p);_collection=this._firebase.collectionUserTermsAcceptance;_termsAcceptanceData=i(void 0);_termsUnsubscribe;get termsAcceptanceData(){return this._termsAcceptanceData}destroy(){this._unsubscribe(this._termsUnsubscribe)}subscribeToUserTermsAcceptance(e){if(this._collection===void 0)throw new Error(a.FIREBASE_NOT_INITIALIZED);let s=u(this._collection,e);this._termsUnsubscribe=A(s,async r=>{if(r.exists()){let c=r.data();this._termsAcceptanceData.update(()=>Object.assign({},c))}})}_unsubscribe(e){e!==void 0&&e()}static \u0275fac=function(s){return new(s||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Ae=(()=>{class t{_firebase=o(p);_auth=o(b);_repo=o(Oe);userHasAcceptedTerms=d(()=>this._repo.termsAcceptanceData()!==void 0);userHasAcceptedOutdatedTerms=d(()=>{let e=this._repo.termsAcceptanceData();return e===void 0?!1:e.documentHash!==z});subscribeToUserTermsAcceptanceOnUserChange=j(async()=>{let e=this._auth.user();e!==void 0&&this._repo.subscribeToUserTermsAcceptance(e.uid)});async setTermsAndConditionsAccept(){let e=this._firebase.functionAcceptTerms;if(e===void 0)throw new Error(a.FIREBASE_NOT_INITIALIZED);let r=await(await fetch("https://api.ipify.org?format=json")).json();await e({documentHash:z,ip:r.ip})}static \u0275fac=function(s){return new(s||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var cs=(()=>{class t{_optionsService=o(Se);_auth=o(b);_user=o(Te);_terms=o(Ae);_project=o(Ie);view=i("sync");_selectedOrganization=N(()=>{let e=this._user.userOrganizations();if(!(e===void 0||!e.length)&&e.length===1)return e[0]});_userIsOrgAdmin=d(()=>{let e=this._selectedOrganization();return e===void 0?!1:this._isCurrentUserOrgAdmin(e)});_userCanSync=d(()=>{let e=this._project.projectData();return!e||e===void 0?!1:this._isCurrentUserSyncer(e)});authDisabled=d(()=>this._optionsService.options().auth.providers.length===1&&this._optionsService.options().auth.providers[0]===g.NO_AUTH);userOrganizations=this._user.userOrganizations;projectData=this._project.projectData;_projectExists=N(()=>{if(this._project.projectData()!==void 0)return!0});userHasOrgs=this._user.userBelongsToAnOrganization;userHasAgreedToTerms=this._terms.userHasAcceptedTerms;userHasAgreedToOutdatedTerms=this._terms.userHasAcceptedOutdatedTerms;set options(e){this._optionsService.options.set(e),this._auth.providers=e.auth.providers,this._auth.setPersistence(e.auth.persistence).then(()=>{this._auth.getUserOrRequestSignIn()}).catch(s=>{console.error(s)})}get options(){return this._optionsService.options}get user(){return this._auth.user}get projectExists(){return this._projectExists}set projectId(e){this._project.setProjectId(e),e!==void 0&&this._project.projectExists(e).then(s=>this._projectExists.set(s))}get selectedOrganization(){return this._selectedOrganization}set selectedOrganization(e){this._selectedOrganization.set(e)}get userIsOrgAdmin(){return this._userIsOrgAdmin}get userCanSync(){return this._userCanSync}_isCurrentUserOrgAdmin(e){let s=this._user.userIds(),r=!1;for(let c of s)if(e.admins.includes(c)){r=!0;break}return r}_isCurrentUserSyncer(e){let s=this._user.userIds(),r=!1;for(let c of s)if(e.syncers.includes(c)||e.admins.includes(c)){r=!0;break}return r}static \u0275fac=function(s){return new(s||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();export{pe as a,de as b,F as c,he as d,fe as e,R as f,D as g,g as h,G as i,C as j,b as k,je as l,De as m,Re as n,xe as o,Ue as p,ye as q,p as r,a as s,Ie as t,ge as u,Te as v,Se as w,Ae as x,cs as y};
