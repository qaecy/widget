import{a as A}from"./chunk-45ZKWNO6.js";import{O as n,Q as C,R as f,S as c,Ta as a,ac as I,bc as U,dc as T}from"./chunk-6VJMAFGR.js";import{Da as G,N as L,ea as z,ja as k,ka as F,l as b,sa as V,v as x}from"./chunk-LOUWY4NJ.js";import{C as S,Ca as O,W as H,Y as q,t as w,v as p,wa as y,za as W}from"./chunk-RIETPOXV.js";import{O as g}from"./chunk-I7PEP2DU.js";import{a as h,b as M,h as s}from"./chunk-TJICSKBO.js";var v=function(t){return t.AUTH_USER_INPUT_NEEDED="'Your setup requires input from the user either because one than one SSO provider is set or because user/pw is required. User input is therefore needed'",t.LAST_VISIT_SET="Last visit updated",t.NO_FILES_NO_SYNC_RIGHTS="The project has no files and you do not have sync rights. Therefore, there is nothing to search. Please reach out to a project admin.",t.ORGANIZATIONS_NONE="The user is not assosiated with an organization.",t.ORGANIZATIONS_SINGLE="The user is assosiated with exactly one organization.",t.ORGANIZATIONS_MULTIPLE="The user is assosiated with more than one organization.",t.PROJECT_HAS_DATA="Received project data",t.PROJECT_NO_DATA="No data found for the specified project",t}(v||{});var Y=class{id;name;created=new Date().toISOString();admins=[];members=[];alternativeIDs=[];constructor(d=A(),e="ABC"){this.id=d,this.name=e,this.alternativeIDs=[d]}},B=class{organizationID;id;name;created=new Date().toISOString();lastSync=null;isPublic=!1;members=[];syncers=[];admins=[];alternativeIDs=[];syncDetails={};constructor(d,e=A(),r="ABC"){this.organizationID=d,this.id=e,this.name=r,this.alternativeIDs=[e]}};var N=class{auth=new R;menuAlwaysVisible=!1;menuOptions=[D.ASSISTANT,D.SYNC_OVERVIEW,D.SIGN_OUT];hostApp=J.SHAREPOINT;config},R=class{providers=[m.MICROSOFT];persistence=_.LOCAL},D=function(t){return t.ASSISTANT="ASSISTANT",t.SYNC_OVERVIEW="SYNC_OVERVIEW",t.SIGN_OUT="SIGN_OUT",t}(D||{}),m=function(t){return t.GOOGLE="GOOGLE",t.MICROSOFT="microsoft.com",t.USER_PW="USER_PW",t.NO_AUTH="NO_AUTH",t}(m||{}),_=function(t){return t.LOCAL="LOCAL",t.SESSION="SESSION",t.NONE="NONE",t}(_||{}),J=function(t){return t.SHAREPOINT="SharePoint",t.QAECY="QAECY",t}(J||{});var P=(()=>{class t{_collection;constructor(){let e=S(g());this._collection=w(e,"users")}getUserData(e,r=!0){return s(this,null,function*(){let i=p(this._collection,e),u=(yield y(i)).data();return r&&u!==void 0&&this._setLastVisit(u),u})}_setLastVisit(e){return s(this,null,function*(){let r=p(this._collection,e.id);e.lastVisit=new Date().toISOString(),yield O(r,h({},e)),console.info(v.LAST_VISIT_SET)})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var E=(()=>{class t{_userRepo=c(P);_auth;_persistence=_.NONE;_user=a(void 0);_selectedProvider=a(void 0);constructor(){this._auth=G(g()),this._auth.onAuthStateChanged(e=>{e?this._user.update(()=>Object.assign({},e)):this._user.update(()=>{})})}get user(){return this._user}setPersistence(e){return s(this,null,function*(){if(this._persistence!==e){switch(this._persistence=e,e){case _.LOCAL:yield this._auth.setPersistence(k);break;case _.SESSION:yield this._auth.setPersistence(F);break;case _.NONE:yield this._auth.setPersistence(b);break;default:yield this._auth.setPersistence(b)}console.info(`New persistence setting: ${e}`)}})}set providers(e){if(e.length===1){let r=e[0];r!==m.USER_PW&&r!==m.NO_AUTH&&this._selectedProvider.set(e[0])}}set selectedProvider(e){this._selectedProvider.set(e),this._user()===void 0&&this.getUserOrRequestSignIn()}signOut(){return s(this,null,function*(){yield z(this._auth)})}getUserOrRequestSignIn(){return s(this,null,function*(){let e=this._auth.currentUser,r=this._selectedProvider();if(!e)if(r!==void 0){let i=new x(r);e=(yield V(this._auth,i)).user}else console.info(v.AUTH_USER_INPUT_NEEDED);return e})}userPWSignIn(e,r){return s(this,null,function*(){return(yield L(this._auth,e,r)).user})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Q=(()=>{class t{_collection;constructor(){let e=S(g());this._collection=w(e,"projects")}getProjectData(e){return s(this,null,function*(){let r=p(this._collection,e);try{return(yield y(r)).data()}catch(i){console.warn(i);return}})}createProjectIfNotExists(e){return s(this,null,function*(){let r=p(this._collection,e.id);try{yield O(r,h({},e))}catch(i){console.warn(i)}})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Z=(()=>{class t{_repo=c(Q);_projectId=a(void 0);_projectData=a(void 0);hostInfo=a(void 0);constructor(){}set projectId(e){e!==this._projectId()&&(this._projectId.set(e),this._fetchProjectData())}get projectData(){return this._projectData}createProject(e){return s(this,null,function*(){yield this._repo.createProjectIfNotExists(e),yield this._fetchProjectData()})}_fetchProjectData(){return s(this,null,function*(){let e=this._projectId();if(e===void 0)throw new Error("Project not set");let r=yield this._repo.getProjectData(e);r===void 0?this._projectData.set(null):this._projectData.update(()=>Object.assign({},r))})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var $=(()=>{class t{_collection;constructor(){let e=S(g());this._collection=w(e,"organizations")}getUserOrganizations(e){return s(this,null,function*(){try{let r=[];for(let i of e){let u=(yield W(H(this._collection,q("members","array-contains",i)))).docs.map(j=>j.data());if(u.length){r=u;break}}return r}catch(r){return console.warn(r),[]}})}createOrganizationIfNotExists(e){return s(this,null,function*(){let r=p(this._collection,e.id);try{if((yield y(r)).exists())return;let o=yield O(r,h({},e));console.log(o)}catch(i){console.warn(i)}})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var K=(t,d)=>t===d?!0:t===void 0||d===void 0||t.length!==d.length?!1:t.every((e,r)=>e===d[r]);var X=(()=>{class t{_repo=c(P);_auth=c(E);_organizationRepo=c($);organizations=a(void 0,{equal:(e,r)=>e!==void 0&&r!==void 0&&K(e,r)});_userData=a(void 0);isOrgAdmin=a(!1);_userIds=a([]);onUserChange=T(()=>s(this,null,function*(){if(this._auth.user()===void 0){this.organizations.update(()=>{});return}this.fetchUserOrganizations(),this._fetchUserData()}));constructor(){}get userIds(){return this._userIds}fetchUserOrganizations(){return s(this,null,function*(){let e=this._auth.user();if(e===void 0)throw new Error("Can't fetch organizations when user is not signed in");let r=e.providerData.map(u=>u.uid),i=[e.uid,...r];if(e===void 0)throw new Error("User not set");let o=yield this._organizationRepo.getUserOrganizations(i);this._userIds.set(i),this.organizations.update(()=>[...o])})}_fetchUserData(){return s(this,null,function*(){let e=this._auth.user();if(e===void 0)throw new Error("Can't fetch user data when user is not signed in");let r=yield this._repo.getUserData(e.uid);this._userData.update(()=>Object.assign({},r))})}static \u0275fac=function(r){return new(r||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var ee=(()=>{class t{options=a(new N);static \u0275fac=function(r){return new(r||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var at=(()=>{class t{_optionsService=c(ee);_auth=c(E);_user=c(X);_project=c(Z);view=a("sync");_selectedOrganization=U(()=>{let e=this._user.organizations();if(!(e===void 0||!e.length)&&e.length===1)return e[0]});_userIsOrgAdmin=I(()=>{let e=this._selectedOrganization();return e===void 0?!1:this._isCurrentUserOrgAdmin(e)});_userCanSync=I(()=>{let e=this._project.projectData();return!e||e===void 0?!1:this._isCurrentUserSyncer(e)});authDisabled=I(()=>this._optionsService.options().auth.providers.length===1&&this._optionsService.options().auth.providers[0]===m.NO_AUTH);x=T(()=>this._userCanSync());userOrganizations=this._user.organizations;projectData=this._project.projectData;projectExists=I(()=>this.projectData()!==null);userHasOrgs=I(()=>{let e=this.userOrganizations();return!(e===void 0||e.length===0)});constructor(){}set options(e){this._optionsService.options.set(e),this._auth.providers=e.auth.providers,this._auth.setPersistence(e.auth.persistence).then(()=>{this._auth.getUserOrRequestSignIn()}).catch(r=>{console.error(r)})}get options(){return this._optionsService.options}get user(){return this._auth.user}set projectId(e){this._project.projectId=e}get selectedOrganization(){return this._selectedOrganization}set selectedOrganization(e){this._selectedOrganization.set(e)}get userIsOrgAdmin(){return this._userIsOrgAdmin}get userCanSync(){return this._userCanSync}_isCurrentUserOrgAdmin(e){let r=this._user.userIds(),i=!1;for(let o of r)if(e.admins.includes(o)){i=!0;break}return i}_isCurrentUserSyncer(e){let r=this._user.userIds(),i=!1;for(let o of r)if(e.syncers.includes(o)||e.admins.includes(o)){i=!0;break}return i}static \u0275fac=function(r){return new(r||t)};static \u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var re=new C("google-tag-manager-config"),ie=(()=>{class t{constructor(e){this._googleTagManagerConfig={id:null,gtm_auth:"",gtm_preview:""},e&&this.set(e)}set(e){this._googleTagManagerConfig=e}get(){return this._googleTagManagerConfig}static{this.\u0275fac=function(r){return new(r||t)(f(re,8))}}static{this.\u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var _t=(()=>{class t{constructor(e,r,i="noisy",o,u,j,te){this.googleTagManagerConfiguration=e,this.googleTagManagerId=r,this.googleTagManagerMode=i,this.googleTagManagerAuth=o,this.googleTagManagerPreview=u,this.googleTagManagerResourcePath=j,this.googleTagManagerCSPNonce=te,this.isLoaded=!1,this.browserGlobals={windowRef(){return window},documentRef(){return document}},this.config=this.googleTagManagerConfiguration?.get(),this.config==null&&(this.config={id:null}),this.config=M(h({},this.config),{id:r||this.config.id,gtm_auth:o||this.config.gtm_auth,gtm_preview:u||this.config.gtm_preview,gtm_resource_path:j||this.config.gtm_resource_path}),this.config.id!=null}checkForId(){if(this.googleTagManagerMode!=="silent"&&!this.config.id)throw new Error("Google tag manager ID not provided.");return!!this.config.id}getDataLayer(){this.checkForId();let e=this.browserGlobals.windowRef();return e.dataLayer=e.dataLayer||[],e.dataLayer}pushOnDataLayer(e){this.checkForId(),this.getDataLayer().push(e)}addGtmToDom(){return new Promise((e,r)=>{if(this.isLoaded)return e(this.isLoaded);if(!this.checkForId())return e(!1);let i=this.browserGlobals.documentRef();this.pushOnDataLayer({"gtm.start":new Date().getTime(),event:"gtm.js"});let o=i.createElement("script");o.id="GTMscript",o.async=!0,o.src=this.applyGtmQueryParams(this.config.gtm_resource_path?this.config.gtm_resource_path:"https://www.googletagmanager.com/gtm.js"),o.addEventListener("load",()=>e(this.isLoaded=!0)),o.addEventListener("error",()=>r(!1)),this.googleTagManagerCSPNonce&&o.setAttribute("nonce",this.googleTagManagerCSPNonce),i.head.insertBefore(o,i.head.firstChild)})}pushTag(e){return new Promise((r,i)=>{if(!this.checkForId())return r();if(!this.isLoaded)this.addGtmToDom().then(()=>(this.pushOnDataLayer(e),r())).catch(()=>i());else return this.pushOnDataLayer(e),r()})}applyGtmQueryParams(e){return e.indexOf("?")===-1&&(e+="?"),e+Object.keys(this.config).filter(r=>this.config[r]).map(r=>`${r}=${this.config[r]}`).join("&")}static{this.\u0275fac=function(r){return new(r||t)(f(ie,8),f("googleTagManagerId",8),f("googleTagManagerMode",8),f("googleTagManagerAuth",8),f("googleTagManagerPreview",8),f("googleTagManagerResourcePath",8),f("googleTagManagerCSPNonce",8))}}static{this.\u0275prov=n({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();export{Y as a,B as b,N as c,D as d,m as e,v as f,E as g,Z as h,$ as i,X as j,ee as k,at as l,_t as m};
