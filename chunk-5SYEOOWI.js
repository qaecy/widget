import{a as A}from"./chunk-22TYSVVA.js";import{O as i,S as n,Ta as o,bc as m,cc as x,ec as R}from"./chunk-SUJ2ERSS.js";import{Da as q,N as F,ea as B,ja as G,ka as H,l as P,sa as k,v as z}from"./chunk-GSV7GFVO.js";import{Ca as O,W as M,Y as V,t as N,v as f,wa as g,za as W}from"./chunk-QWYGOFBQ.js";import{d as Z}from"./chunk-VNCJOYNM.js";import{O as L}from"./chunk-36JE2O54.js";import{a as S}from"./chunk-DAQOROHW.js";var T=function(t){return t.AUTH_USER_INPUT_NEEDED="'Your setup requires input from the user either because one than one SSO provider is set or because user/pw is required. User input is therefore needed'",t.LAST_VISIT_SET="Last visit updated",t.NO_FILES_NO_SYNC_RIGHTS="The project has no files and you do not have sync rights. Therefore, there is nothing to search. Please reach out to a project admin.",t.ORGANIZATIONS_NONE="The user is not assosiated with an organization.",t.ORGANIZATIONS_SINGLE="The user is assosiated with exactly one organization.",t.ORGANIZATIONS_MULTIPLE="The user is assosiated with more than one organization.",t.PROJECT_HAS_DATA="Received project data",t.PROJECT_NO_DATA="No data found for the specified project",t}(T||{});var J=class{id;name;created=new Date().toISOString();admins=[];members=[];alternativeIDs=[];constructor(c=A(),e="ABC"){this.id=c,this.name=e,this.alternativeIDs=[c]}},K=class{organizationID;id;name;created=new Date().toISOString();lastSync=null;isPublic=!1;members=[];syncers=[];admins=[];alternativeIDs=[];syncDetails={};constructor(c,e=A(),r="ABC"){this.organizationID=c,this.id=e,this.name=r,this.alternativeIDs=[e]}},v=class{id;projectId;userId;created=new Date().toISOString();updated=new Date().toISOString();constructor(c=A(),e,r){this.id=c,this.projectId=e,this.userId=r}};var Y=class extends v{entries=[]};var C=class{auth=new U;menuAlwaysVisible=!1;menuOptions=[w.ASSISTANT,w.SYNC_OVERVIEW,w.SIGN_OUT];hostApp=Q.SHAREPOINT;config},U=class{providers=[p.MICROSOFT];persistence=I.LOCAL},w=function(t){return t.ASSISTANT="ASSISTANT",t.SYNC_OVERVIEW="SYNC_OVERVIEW",t.SIGN_OUT="SIGN_OUT",t}(w||{}),p=function(t){return t.GOOGLE="GOOGLE",t.MICROSOFT="microsoft.com",t.USER_PW="USER_PW",t.NO_AUTH="NO_AUTH",t}(p||{}),I=function(t){return t.LOCAL="LOCAL",t.SESSION="SESSION",t.NONE="NONE",t}(I||{}),Q=function(t){return t.SHAREPOINT="SharePoint",t.QAECY="QAECY",t}(Q||{});var j=(()=>{class t{_auth;_persistence=I.NONE;_user=o(void 0);_selectedProvider=o(void 0);constructor(){this._auth=q(L()),this._auth.onAuthStateChanged(e=>{e?this._user.update(()=>Object.assign({},e)):this._user.update(()=>{})})}get user(){return this._user}async setPersistence(e){if(this._persistence!==e){switch(this._persistence=e,e){case I.LOCAL:await this._auth.setPersistence(G);break;case I.SESSION:await this._auth.setPersistence(H);break;case I.NONE:await this._auth.setPersistence(P);break;default:await this._auth.setPersistence(P)}console.info(`New persistence setting: ${e}`)}}set providers(e){if(e.length===1){let r=e[0];r!==p.USER_PW&&r!==p.NO_AUTH&&this._selectedProvider.set(e[0])}}set selectedProvider(e){this._selectedProvider.set(e),this._user()===void 0&&this.getUserOrRequestSignIn()}async signOut(){await B(this._auth)}async getUserOrRequestSignIn(){let e=this._auth.currentUser,r=this._selectedProvider();if(!e)if(r!==void 0){let s=new z(r);e=(await k(this._auth,s)).user}else console.info(T.AUTH_USER_INPUT_NEEDED);return e}async userPWSignIn(e,r){return(await F(this._auth,e,r)).user}static \u0275fac=function(r){return new(r||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var $="qaecy_chat_sessions_europe_west_6",X="qaecy_raw_europe_west_6",tt="qaecy_processed_europe_west_6",et="chatSessions",rt="organizations",st="projects",it="users",ot="assistant",nt="europe-west6";var E=(()=>{class t{_app;_functionAssistant;_storageProcessed;_storageRaw;_storageChatSessions;_collectionChatSessions;_collectionOrganizations;_collectionProjects;_collectionUsers;_ready=o(!1);get app(){return this._app}get functionAssistant(){return this._functionAssistant}get storageProcessed(){return this._storageProcessed}get storageRaw(){return this._storageRaw}get storageChatSessions(){return this._storageChatSessions}get collectionChatSessions(){return this._collectionChatSessions}get collectionOrganizations(){return this._collectionOrganizations}get collectionProjects(){return this._collectionProjects}get collectionUsers(){return this._collectionUsers}get ready(){return this._ready}async init(e){let{initializeApp:r}=await import("./chunk-ZICKP5DU.js"),{connectAuthEmulator:s,getAuth:a}=await import("./chunk-SLAVO63I.js"),{connectFirestoreEmulator:u,getFirestore:_}=await import("./chunk-UCUTNQLC.js"),{connectFunctionsEmulator:lt,getFunctions:pt}=await import("./chunk-SOGWAEGZ.js"),{connectStorageEmulator:y,getStorage:D}=await import("./chunk-KLWV5IKU.js"),It=Object.assign(e,{authDomain:"qaecy-widget.firebaseapp.com",projectId:"qaecy-widget",messagingSenderId:"734737865998"}),l=r(It),b=pt(l,nt);this._functionAssistant=Z(b,ot),this._storageProcessed=D(l,tt),this._storageRaw=D(l,X),this._storageChatSessions=D(l,$),this._collectionChatSessions=N(_(),et),this._collectionOrganizations=N(_(),rt),this._collectionProjects=N(_(),st),this._collectionUsers=N(_(),it),e.useEmulator&&(s(a(l),"http://localhost:9099"),u(_(l),"localhost",8080),lt(b,"localhost",5001),y(this._storageProcessed,"localhost",9199),y(this._storageRaw,"localhost",9199),y(this._storageChatSessions,"localhost",9199),console.info("Firebase emulators attached")),this._app=l,this._ready.set(!0)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var d=function(t){return t.FIREBASE_NOT_INITIALIZED="Firebase has not been initialized",t.MISSING_CONFIG='"Please provide config using init() method!"',t.MISSING_PROJECT_DATA="Project data is not available",t.MISSING_PROJECT_ID='No project id is defined. Please specify using the "pid" attribute',t.MISSING_USER_ID="User id is not available.",t.ORG_NO_ADMINS_SELECTED="An organization must have at least one admin",t.ORG_NO_MEMBERS_SELECTED="An organization must have at least one member",t.PROJ_NO_ADMINS_SELECTED="A project must have at least one admin",t.PROJ_NO_MEMBERS_SELECTED="A project must have at least one member",t}(d||{});var at=(()=>{class t{_firebase=n(E);_collection=this._firebase.collectionProjects;async getProjectData(e){if(this._collection===void 0)throw new Error(d.FIREBASE_NOT_INITIALIZED);let r=f(this._collection,e);try{return(await g(r)).data()}catch(s){console.warn(s);return}}async createProjectIfNotExists(e){if(this._collection===void 0)throw new Error(d.FIREBASE_NOT_INITIALIZED);let r=f(this._collection,e.id);try{await O(r,S({},e))}catch(s){console.warn(s)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var ct=(()=>{class t{_repo=n(at);_projectId=o(void 0);_projectData=o(void 0);hostInfo=o(void 0);set projectId(e){e!==this._projectId()&&(this._projectId.set(e),this._fetchProjectData())}get projectData(){return this._projectData}async createProject(e){await this._repo.createProjectIfNotExists(e),await this._fetchProjectData()}async _fetchProjectData(){let e=this._projectId();if(e===void 0)throw new Error("Project not set");let r=await this._repo.getProjectData(e);r===void 0?this._projectData.set(null):this._projectData.update(()=>Object.assign({},r))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var ut=(()=>{class t{_firebase=n(E);_collection=this._firebase.collectionOrganizations;async getUserOrganizations(e){if(this._collection===void 0)throw new Error(d.FIREBASE_NOT_INITIALIZED);try{let r=[];for(let s of e){let u=(await W(M(this._collection,V("members","array-contains",s)))).docs.map(_=>_.data());if(u.length){r=u;break}}return r}catch(r){return console.warn(r),[]}}async createOrganizationIfNotExists(e){if(this._collection===void 0)throw new Error(d.FIREBASE_NOT_INITIALIZED);let r=f(this._collection,e.id);try{if((await g(r)).exists())return;let a=await O(r,S({},e));console.log(a)}catch(s){console.warn(s)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var dt=(()=>{class t{_firebase=n(E);_collection=this._firebase.collectionUsers;async getUserData(e,r=!0){if(this._collection===void 0)throw new Error(d.FIREBASE_NOT_INITIALIZED);let s=f(this._collection,e),u=(await g(s)).data();return r&&u!==void 0&&this._setLastVisit(u),u}async _setLastVisit(e){if(this._collection===void 0)throw new Error(d.FIREBASE_NOT_INITIALIZED);let r=f(this._collection,e.id);e.lastVisit=new Date().toISOString(),await O(r,S({},e)),console.info(T.LAST_VISIT_SET)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var ft=(t,c)=>t===c?!0:t===void 0||c===void 0||t.length!==c.length?!1:t.every((e,r)=>e===c[r]);var ht=(()=>{class t{_repo=n(dt);_auth=n(j);_organizationRepo=n(ut);organizations=o(void 0,{equal:(e,r)=>e!==void 0&&r!==void 0&&ft(e,r)});_userData=o(void 0);isOrgAdmin=o(!1);_userIds=o([]);onUserChange=R(async()=>{if(this._auth.user()===void 0){this.organizations.update(()=>{});return}this.fetchUserOrganizations(),this._fetchUserData()});get userIds(){return this._userIds}get userData(){return this._userData}async fetchUserOrganizations(){let e=this._auth.user();if(e===void 0)throw new Error("Can't fetch organizations when user is not signed in");let r=e.providerData.map(u=>u.uid),s=[e.uid,...r];if(e===void 0)throw new Error("User not set");let a=await this._organizationRepo.getUserOrganizations(s);this._userIds.set(s),this.organizations.update(()=>[...a])}async _fetchUserData(){let e=this._auth.user();if(e===void 0)throw new Error("Can't fetch user data when user is not signed in");let r=await this._repo.getUserData(e.uid);this._userData.update(()=>Object.assign({},r))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var _t=(()=>{class t{options=o(new C);static \u0275fac=function(r){return new(r||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var be=(()=>{class t{_optionsService=n(_t);_auth=n(j);_user=n(ht);_project=n(ct);view=o("sync");_selectedOrganization=x(()=>{let e=this._user.organizations();if(!(e===void 0||!e.length)&&e.length===1)return e[0]});_userIsOrgAdmin=m(()=>{let e=this._selectedOrganization();return e===void 0?!1:this._isCurrentUserOrgAdmin(e)});_userCanSync=m(()=>{let e=this._project.projectData();return!e||e===void 0?!1:this._isCurrentUserSyncer(e)});authDisabled=m(()=>this._optionsService.options().auth.providers.length===1&&this._optionsService.options().auth.providers[0]===p.NO_AUTH);userOrganizations=this._user.organizations;projectData=this._project.projectData;projectExists=m(()=>this.projectData()!==null);userHasOrgs=m(()=>{let e=this.userOrganizations();return!(e===void 0||e.length===0)});set options(e){this._optionsService.options.set(e),this._auth.providers=e.auth.providers,this._auth.setPersistence(e.auth.persistence).then(()=>{this._auth.getUserOrRequestSignIn()}).catch(r=>{console.error(r)})}get options(){return this._optionsService.options}get user(){return this._auth.user}set projectId(e){this._project.projectId=e}get selectedOrganization(){return this._selectedOrganization}set selectedOrganization(e){this._selectedOrganization.set(e)}get userIsOrgAdmin(){return this._userIsOrgAdmin}get userCanSync(){return this._userCanSync}_isCurrentUserOrgAdmin(e){let r=this._user.userIds(),s=!1;for(let a of r)if(e.admins.includes(a)){s=!0;break}return s}_isCurrentUserSyncer(e){let r=this._user.userIds(),s=!1;for(let a of r)if(e.syncers.includes(a)||e.admins.includes(a)){s=!0;break}return s}static \u0275fac=function(r){return new(r||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();export{J as a,K as b,Y as c,C as d,w as e,p as f,T as g,j as h,E as i,d as j,ct as k,ut as l,ht as m,_t as n,be as o};
